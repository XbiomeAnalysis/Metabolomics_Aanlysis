<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Functional Analysis | Data Analysis in Metabolomics</title>
  <meta name="description" content="A template for Data Analysis in Metabolomics" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Functional Analysis | Data Analysis in Metabolomics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A template for Data Analysis in Metabolomics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Functional Analysis | Data Analysis in Metabolomics" />
  
  <meta name="twitter:description" content="A template for Data Analysis in Metabolomics" />
  

<meta name="author" content="Hua Zou and Bangzhuo Tong" />


<meta name="date" content="2023-12-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="statistical-analysis-1.html"/>
<link rel="next" href="metorigin-analysis.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Analysis in Metabolomics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-metabolomics"><i class="fa fa-check"></i><b>1.1</b> What is metabolomics?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#workflow-of-metabolomics-data-analysis"><i class="fa fa-check"></i><b>1.2</b> Workflow of metabolomics data analysis</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#statistical-analysis"><i class="fa fa-check"></i><b>1.2.1</b> Statistical Analysis</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#functional-analysis"><i class="fa fa-check"></i><b>1.2.2</b> Functional Analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i><b>1.3</b> Software</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#reference"><i class="fa fa-check"></i><b>1.4</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-processing.html"><a href="data-processing.html#loading-packages"><i class="fa fa-check"></i><b>2.1</b> Loading packages</a></li>
<li class="chapter" data-level="2.2" data-path="data-processing.html"><a href="data-processing.html#importing-data"><i class="fa fa-check"></i><b>2.2</b> Importing data</a></li>
<li class="chapter" data-level="2.3" data-path="data-processing.html"><a href="data-processing.html#data-checking"><i class="fa fa-check"></i><b>2.3</b> Data Checking</a></li>
<li class="chapter" data-level="2.4" data-path="data-processing.html"><a href="data-processing.html#data-trimming"><i class="fa fa-check"></i><b>2.4</b> Data Trimming</a></li>
<li class="chapter" data-level="2.5" data-path="data-processing.html"><a href="data-processing.html#missing-value-imputation"><i class="fa fa-check"></i><b>2.5</b> Missing value imputation</a></li>
<li class="chapter" data-level="2.6" data-path="data-processing.html"><a href="data-processing.html#data-filtering"><i class="fa fa-check"></i><b>2.6</b> Data Filtering</a></li>
<li class="chapter" data-level="2.7" data-path="data-processing.html"><a href="data-processing.html#data-normalization"><i class="fa fa-check"></i><b>2.7</b> Data Normalization</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="data-processing.html"><a href="data-processing.html#normalization-by-normalizedata-function"><i class="fa fa-check"></i><b>2.7.1</b> Normalization by <strong>NormalizeData</strong> function</a></li>
<li class="chapter" data-level="2.7.2" data-path="data-processing.html"><a href="data-processing.html#normalization-by-poma-r-package"><i class="fa fa-check"></i><b>2.7.2</b> Normalization by <strong>POMA</strong> R package</a></li>
<li class="chapter" data-level="2.7.3" data-path="data-processing.html"><a href="data-processing.html#comparison-of-unnormalized-and-normalized-dataset"><i class="fa fa-check"></i><b>2.7.3</b> Comparison of unnormalized and normalized dataset</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="data-processing.html"><a href="data-processing.html#removing-outliers"><i class="fa fa-check"></i><b>2.8</b> Removing outliers</a></li>
<li class="chapter" data-level="2.9" data-path="data-processing.html"><a href="data-processing.html#data-distribution"><i class="fa fa-check"></i><b>2.9</b> Data distribution</a></li>
<li class="chapter" data-level="2.10" data-path="data-processing.html"><a href="data-processing.html#saving-datasets-into-rds-files"><i class="fa fa-check"></i><b>2.10</b> Saving datasets into RDS files</a></li>
<li class="chapter" data-level="2.11" data-path="data-processing.html"><a href="data-processing.html#systematic-information"><i class="fa fa-check"></i><b>2.11</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html"><i class="fa fa-check"></i><b>3</b> Statistical Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#data-preprocessing"><i class="fa fa-check"></i><b>3.1</b> Data Preprocessing</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#environment-setup"><i class="fa fa-check"></i><b>3.1.1</b> Environment setup</a></li>
<li class="chapter" data-level="3.1.2" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#loading-data"><i class="fa fa-check"></i><b>3.1.2</b> Loading data</a></li>
<li class="chapter" data-level="3.1.3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#object-preparation"><i class="fa fa-check"></i><b>3.1.3</b> Object Preparation</a></li>
<li class="chapter" data-level="3.1.4" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#data-checking-1"><i class="fa fa-check"></i><b>3.1.4</b> Data Checking</a></li>
<li class="chapter" data-level="3.1.5" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#missing-value-imputation-1"><i class="fa fa-check"></i><b>3.1.5</b> Missing value imputation</a></li>
<li class="chapter" data-level="3.1.6" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#data-filtering-1"><i class="fa fa-check"></i><b>3.1.6</b> Data Filtering</a></li>
<li class="chapter" data-level="3.1.7" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#data-normalization-1"><i class="fa fa-check"></i><b>3.1.7</b> Data Normalization</a></li>
<li class="chapter" data-level="3.1.8" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#removing-outliers-1"><i class="fa fa-check"></i><b>3.1.8</b> Removing outliers</a></li>
<li class="chapter" data-level="3.1.9" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#saving-datasets-into-rds-files-1"><i class="fa fa-check"></i><b>3.1.9</b> Saving datasets into RDS files</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#cluster-analysis"><i class="fa fa-check"></i><b>3.2</b> Cluster Analysis</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#loading-packages-1"><i class="fa fa-check"></i><b>3.2.1</b> Loading packages</a></li>
<li class="chapter" data-level="3.2.2" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#importing-data-1"><i class="fa fa-check"></i><b>3.2.2</b> Importing data</a></li>
<li class="chapter" data-level="3.2.3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#hierarchical-clustering"><i class="fa fa-check"></i><b>3.2.3</b> Hierarchical Clustering</a></li>
<li class="chapter" data-level="3.2.4" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#partitional-clustering"><i class="fa fa-check"></i><b>3.2.4</b> Partitional Clustering</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#chemometrics-analysis"><i class="fa fa-check"></i><b>3.3</b> Chemometrics Analysis</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#loading-packages-2"><i class="fa fa-check"></i><b>3.3.1</b> Loading packages</a></li>
<li class="chapter" data-level="3.3.2" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#importing-data-2"><i class="fa fa-check"></i><b>3.3.2</b> Importing data</a></li>
<li class="chapter" data-level="3.3.3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#principal-component-analysis-pca"><i class="fa fa-check"></i><b>3.3.3</b> Principal Component Analysis (PCA)</a></li>
<li class="chapter" data-level="3.3.4" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#partial-least-squares-discriminant-analysis-pls-da"><i class="fa fa-check"></i><b>3.3.4</b> Partial Least Squares-Discriminant Analysis (PLS-DA)</a></li>
<li class="chapter" data-level="3.3.5" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#sparse-partial-least-squares-discriminant-analysis-spls-da"><i class="fa fa-check"></i><b>3.3.5</b> Sparse Partial Least Squares-Discriminant Analysis (sPLS-DA)</a></li>
<li class="chapter" data-level="3.3.6" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#orthogonal-partial-least-squares-discriminant-analysis-orthopls-da"><i class="fa fa-check"></i><b>3.3.6</b> Orthogonal Partial Least Squares-Discriminant Analysis (orthoPLS-DA)</a></li>
<li class="chapter" data-level="3.3.7" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#chemometrics-analysis-by-own-scripts"><i class="fa fa-check"></i><b>3.3.7</b> Chemometrics Analysis by own scripts</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#univariate-analysis"><i class="fa fa-check"></i><b>3.4</b> Univariate Analysis</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#loading-packages-3"><i class="fa fa-check"></i><b>3.4.1</b> Loading packages</a></li>
<li class="chapter" data-level="3.4.2" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#importing-data-3"><i class="fa fa-check"></i><b>3.4.2</b> Importing data</a></li>
<li class="chapter" data-level="3.4.3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#fold-change-analysis"><i class="fa fa-check"></i><b>3.4.3</b> Fold Change Analysis</a></li>
<li class="chapter" data-level="3.4.4" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#t-test"><i class="fa fa-check"></i><b>3.4.4</b> T Test</a></li>
<li class="chapter" data-level="3.4.5" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#wilcoxon-test"><i class="fa fa-check"></i><b>3.4.5</b> Wilcoxon Test</a></li>
<li class="chapter" data-level="3.4.6" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#limma-test"><i class="fa fa-check"></i><b>3.4.6</b> Limma Test</a></li>
<li class="chapter" data-level="3.4.7" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#volcano-plot"><i class="fa fa-check"></i><b>3.4.7</b> Volcano plot</a></li>
<li class="chapter" data-level="3.4.8" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#vip-variable-influence-on-projection-coefficient"><i class="fa fa-check"></i><b>3.4.8</b> VIP (Variable influence on projection &amp; coefficient)</a></li>
<li class="chapter" data-level="3.4.9" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#t-test-by-local-codes"><i class="fa fa-check"></i><b>3.4.9</b> T-test by local codes</a></li>
<li class="chapter" data-level="3.4.10" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#merging-result"><i class="fa fa-check"></i><b>3.4.10</b> Merging result</a></li>
<li class="chapter" data-level="3.4.11" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#volcano-of-merged-results"><i class="fa fa-check"></i><b>3.4.11</b> Volcano of Merged Results</a></li>
<li class="chapter" data-level="3.4.12" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#correlation-heatmaps"><i class="fa fa-check"></i><b>3.4.12</b> Correlation Heatmaps</a></li>
<li class="chapter" data-level="3.4.13" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#glasso-this-function-will-compute-a-gaussian-graphical-model-using-the-glmnet-package"><i class="fa fa-check"></i><b>3.4.13</b> glasso: this function will compute a Gaussian Graphical Model using the glmnet package</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#multivariate-analysis"><i class="fa fa-check"></i><b>3.5</b> Multivariate analysis</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#loading-packages-4"><i class="fa fa-check"></i><b>3.5.1</b> Loading packages</a></li>
<li class="chapter" data-level="3.5.2" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#importing-data-4"><i class="fa fa-check"></i><b>3.5.2</b> Importing data</a></li>
<li class="chapter" data-level="3.5.3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#data-curation"><i class="fa fa-check"></i><b>3.5.3</b> Data curation</a></li>
<li class="chapter" data-level="3.5.4" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#regularized-generalized-linear-models"><i class="fa fa-check"></i><b>3.5.4</b> Regularized Generalized Linear Models</a></li>
<li class="chapter" data-level="3.5.5" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#adjusting-for-confounding-variables"><i class="fa fa-check"></i><b>3.5.5</b> Adjusting for confounding variables</a></li>
<li class="chapter" data-level="3.5.6" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#classification"><i class="fa fa-check"></i><b>3.5.6</b> Classification</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#network-analysis"><i class="fa fa-check"></i><b>3.6</b> Network Analysis</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#introduction-1"><i class="fa fa-check"></i><b>3.6.1</b> Introduction</a></li>
<li class="chapter" data-level="3.6.2" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#loading-packages-5"><i class="fa fa-check"></i><b>3.6.2</b> Loading packages</a></li>
<li class="chapter" data-level="3.6.3" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#importing-data-5"><i class="fa fa-check"></i><b>3.6.3</b> Importing data</a></li>
<li class="chapter" data-level="3.6.4" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#data-curation-1"><i class="fa fa-check"></i><b>3.6.4</b> Data curation</a></li>
<li class="chapter" data-level="3.6.5" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#associations-among-features"><i class="fa fa-check"></i><b>3.6.5</b> Associations Among Features</a></li>
<li class="chapter" data-level="3.6.6" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#network-comparison"><i class="fa fa-check"></i><b>3.6.6</b> Network comparison</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="statistical-analysis-1.html"><a href="statistical-analysis-1.html#systematic-information-1"><i class="fa fa-check"></i><b>3.7</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html"><i class="fa fa-check"></i><b>4</b> Functional Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#enrichment-analysis"><i class="fa fa-check"></i><b>4.1</b> Enrichment Analysis</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#enviroment-setup"><i class="fa fa-check"></i><b>4.1.1</b> Enviroment Setup</a></li>
<li class="chapter" data-level="4.1.2" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#over-representation-analysis-ora"><i class="fa fa-check"></i><b>4.1.2</b> Over representation analysis (ORA)</a></li>
<li class="chapter" data-level="4.1.3" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#clean-environment-1"><i class="fa fa-check"></i><b>4.1.3</b> Clean environment 1</a></li>
<li class="chapter" data-level="4.1.4" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#single-sample-profiling"><i class="fa fa-check"></i><b>4.1.4</b> Single Sample Profiling</a></li>
<li class="chapter" data-level="4.1.5" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#clean-environment-2"><i class="fa fa-check"></i><b>4.1.5</b> Clean environment 2</a></li>
<li class="chapter" data-level="4.1.6" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#quantitative-enrichment-analysis-qea"><i class="fa fa-check"></i><b>4.1.6</b> Quantitative Enrichment Analysis (QEA)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#pathway-analysis"><i class="fa fa-check"></i><b>4.2</b> Pathway Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#enviroment-set-up"><i class="fa fa-check"></i><b>4.2.1</b> Enviroment Set up</a></li>
<li class="chapter" data-level="4.2.2" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#over-representation-analysis"><i class="fa fa-check"></i><b>4.2.2</b> Over representation analysis</a></li>
<li class="chapter" data-level="4.2.3" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#clean-environment-3"><i class="fa fa-check"></i><b>4.2.3</b> Clean environment 3</a></li>
<li class="chapter" data-level="4.2.4" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#concentration-table-qea"><i class="fa fa-check"></i><b>4.2.4</b> Concentration Table (QEA)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#functional-analysis-by-r-package"><i class="fa fa-check"></i><b>4.3</b> Functional Analysis by R package</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#loading-r-packages"><i class="fa fa-check"></i><b>4.3.1</b> Loading R packages</a></li>
<li class="chapter" data-level="4.3.2" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#importing-data-6"><i class="fa fa-check"></i><b>4.3.2</b> Importing Data</a></li>
<li class="chapter" data-level="4.3.3" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#differential-analysis"><i class="fa fa-check"></i><b>4.3.3</b> Differential Analysis</a></li>
<li class="chapter" data-level="4.3.4" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#metabolites-id-for-merged-results"><i class="fa fa-check"></i><b>4.3.4</b> Metabolites ID for Merged Results</a></li>
<li class="chapter" data-level="4.3.5" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#kegg-pathway-compound"><i class="fa fa-check"></i><b>4.3.5</b> KEGG PATHWAY COMPOUND</a></li>
<li class="chapter" data-level="4.3.6" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#functions-related-to-analysis"><i class="fa fa-check"></i><b>4.3.6</b> Functions related to Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="functional-analysis-1.html"><a href="functional-analysis-1.html#session-info"><i class="fa fa-check"></i><b>4.4</b> Session info</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html"><i class="fa fa-check"></i><b>5</b> MetOrigin Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#loading-packages-6"><i class="fa fa-check"></i><b>5.1</b> Loading packages</a></li>
<li class="chapter" data-level="5.2" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#importing-data-7"><i class="fa fa-check"></i><b>5.2</b> Importing data</a></li>
<li class="chapter" data-level="5.3" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#differential-analysis-1"><i class="fa fa-check"></i><b>5.3</b> Differential Analysis</a></li>
<li class="chapter" data-level="5.4" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#de-metabolites"><i class="fa fa-check"></i><b>5.4</b> DE metabolites</a></li>
<li class="chapter" data-level="5.5" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#obtain-inputs-for-metorigin"><i class="fa fa-check"></i><b>5.5</b> Obtain inputs for Metorigin</a></li>
<li class="chapter" data-level="5.6" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#save-result"><i class="fa fa-check"></i><b>5.6</b> Save result</a></li>
<li class="chapter" data-level="5.7" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#metorigin-user-tutorial"><i class="fa fa-check"></i><b>5.7</b> MetOrigin User Tutorial</a></li>
<li class="chapter" data-level="5.8" data-path="metorigin-analysis.html"><a href="metorigin-analysis.html#session-info-1"><i class="fa fa-check"></i><b>5.8</b> Session info</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>6</b> Example</a>
<ul>
<li class="chapter" data-level="6.1" data-path="example.html"><a href="example.html#loading-packages-7"><i class="fa fa-check"></i><b>6.1</b> Loading packages</a></li>
<li class="chapter" data-level="6.2" data-path="example.html"><a href="example.html#importing-data-8"><i class="fa fa-check"></i><b>6.2</b> Importing data</a></li>
<li class="chapter" data-level="6.3" data-path="example.html"><a href="example.html#data-processing-1"><i class="fa fa-check"></i><b>6.3</b> Data Processing</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="example.html"><a href="example.html#data-checking-2"><i class="fa fa-check"></i><b>6.3.1</b> Data Checking</a></li>
<li class="chapter" data-level="6.3.2" data-path="example.html"><a href="example.html#missing-value-imputation-2"><i class="fa fa-check"></i><b>6.3.2</b> Missing value imputation</a></li>
<li class="chapter" data-level="6.3.3" data-path="example.html"><a href="example.html#data-filtering-2"><i class="fa fa-check"></i><b>6.3.3</b> Data Filtering</a></li>
<li class="chapter" data-level="6.3.4" data-path="example.html"><a href="example.html#data-normalization-2"><i class="fa fa-check"></i><b>6.3.4</b> Data Normalization</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="example.html"><a href="example.html#cluster-analysis-1"><i class="fa fa-check"></i><b>6.4</b> Cluster Analysis</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="example.html"><a href="example.html#hierarchical-clustering-1"><i class="fa fa-check"></i><b>6.4.1</b> Hierarchical Clustering</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="example.html"><a href="example.html#chemometrics-analysis-1"><i class="fa fa-check"></i><b>6.5</b> Chemometrics Analysis</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="example.html"><a href="example.html#partial-least-squares-discriminant-analysis-pls-da-1"><i class="fa fa-check"></i><b>6.5.1</b> Partial Least Squares-Discriminant Analysis (PLS-DA)</a></li>
<li class="chapter" data-level="6.5.2" data-path="example.html"><a href="example.html#sparse-partial-least-squares-discriminant-analysis-spls-da-1"><i class="fa fa-check"></i><b>6.5.2</b> Sparse Partial Least Squares-Discriminant Analysis (sPLS-DA)</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="example.html"><a href="example.html#univariate-analysis-1"><i class="fa fa-check"></i><b>6.6</b> Univariate Analysis</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="example.html"><a href="example.html#fold-change-analysis-1"><i class="fa fa-check"></i><b>6.6.1</b> Fold Change Analysis</a></li>
<li class="chapter" data-level="6.6.2" data-path="example.html"><a href="example.html#vip-variable-influence-on-projection-coefficient-1"><i class="fa fa-check"></i><b>6.6.2</b> VIP (Variable influence on projection &amp; coefficient)</a></li>
<li class="chapter" data-level="6.6.3" data-path="example.html"><a href="example.html#t-test-by-local-codes-1"><i class="fa fa-check"></i><b>6.6.3</b> T-test by local codes</a></li>
<li class="chapter" data-level="6.6.4" data-path="example.html"><a href="example.html#merging-result-1"><i class="fa fa-check"></i><b>6.6.4</b> Merging result</a></li>
<li class="chapter" data-level="6.6.5" data-path="example.html"><a href="example.html#volcano-of-merged-results-1"><i class="fa fa-check"></i><b>6.6.5</b> Volcano of Merged Results</a></li>
<li class="chapter" data-level="6.6.6" data-path="example.html"><a href="example.html#t-test-1"><i class="fa fa-check"></i><b>6.6.6</b> T Test</a></li>
<li class="chapter" data-level="6.6.7" data-path="example.html"><a href="example.html#volcano-plot-1"><i class="fa fa-check"></i><b>6.6.7</b> Volcano plot</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="example.html"><a href="example.html#feature-selection"><i class="fa fa-check"></i><b>6.7</b> Feature Selection</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="example.html"><a href="example.html#regularized-generalized-linear-models-lasso-alpha-1"><i class="fa fa-check"></i><b>6.7.1</b> Regularized Generalized Linear Models (Lasso: alpha = 1)</a></li>
<li class="chapter" data-level="6.7.2" data-path="example.html"><a href="example.html#classification-random-forest"><i class="fa fa-check"></i><b>6.7.2</b> Classification (Random Forest)</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="example.html"><a href="example.html#network-analysis-2"><i class="fa fa-check"></i><b>6.8</b> Network Analysis</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="example.html"><a href="example.html#data-curation-2"><i class="fa fa-check"></i><b>6.8.1</b> Data curation</a></li>
<li class="chapter" data-level="6.8.2" data-path="example.html"><a href="example.html#building-network-model-4"><i class="fa fa-check"></i><b>6.8.2</b> Building network model</a></li>
<li class="chapter" data-level="6.8.3" data-path="example.html"><a href="example.html#visualizing-the-network-4"><i class="fa fa-check"></i><b>6.8.3</b> Visualizing the network</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="example.html"><a href="example.html#network-analysis-by-wgcna"><i class="fa fa-check"></i><b>6.9</b> Network Analysis by WGCNA</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="example.html"><a href="example.html#data-curation-3"><i class="fa fa-check"></i><b>6.9.1</b> Data curation</a></li>
<li class="chapter" data-level="6.9.2" data-path="example.html"><a href="example.html#tuning-soft-thresholds"><i class="fa fa-check"></i><b>6.9.2</b> Tuning soft thresholds</a></li>
<li class="chapter" data-level="6.9.3" data-path="example.html"><a href="example.html#create-the-network-using-the-blockwisemodules"><i class="fa fa-check"></i><b>6.9.3</b> Create the network using the <code>blockwiseModules</code></a></li>
<li class="chapter" data-level="6.9.4" data-path="example.html"><a href="example.html#plot-modules"><i class="fa fa-check"></i><b>6.9.4</b> plot modules</a></li>
<li class="chapter" data-level="6.9.5" data-path="example.html"><a href="example.html#relationships-among-modules"><i class="fa fa-check"></i><b>6.9.5</b> Relationships among modules</a></li>
<li class="chapter" data-level="6.9.6" data-path="example.html"><a href="example.html#module-eigengene-correlation"><i class="fa fa-check"></i><b>6.9.6</b> Module (Eigengene) correlation</a></li>
<li class="chapter" data-level="6.9.7" data-path="example.html"><a href="example.html#relate-module-cluster-assignments-to-groups"><i class="fa fa-check"></i><b>6.9.7</b> Relate Module (cluster) Assignments to Groups</a></li>
<li class="chapter" data-level="6.9.8" data-path="example.html"><a href="example.html#generate-and-export-networks"><i class="fa fa-check"></i><b>6.9.8</b> Generate and Export Networks</a></li>
<li class="chapter" data-level="6.9.9" data-path="example.html"><a href="example.html#network-visualization"><i class="fa fa-check"></i><b>6.9.9</b> Network visualization</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="example.html"><a href="example.html#systematic-information-2"><i class="fa fa-check"></i><b>6.10</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis in Metabolomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functional-analysis-1" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Functional Analysis<a href="functional-analysis-1.html#functional-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Following two chapters would focus on the Enrichment Analysis and Pathway Analysis of metabolomic data. Enrichment Analysis includes three sections (i.e., ORA, SSP and QEA) and Pathway Analysis only includes ORA and QEA.</strong></p>
<p><strong>The main difference between Enrichment Analysis and Pathway Analysis are the data set that input metabolites are enriched to. In Enrichment Analysis, input metabolites are enriched to pre-defined metabolite sets while in Pathway Analysis, metabolites are enriched to pathways in KEGG.</strong></p>
<p>Workflow of Enrichment analysis and Pathway analysis is attached below. Users can choose analysis module according to their data type or interest.<br />
<img src="figures/FlowChart_Chap7-8.jpg" alt="Flowchart" /></p>
<hr />
<p><strong>See more details please go to the below tutorial (<a href="https://www.metaboanalyst.ca/docs/Tutorials.xhtml">MetaboAnalyst website</a>)</strong>:</p>
<div class="float">
<embed src="./dataset/Tutorial/MetaboAnalyst_Functional_Analysis_20231127.pdf" style="width:100.0%" height="800" />
<div class="figcaption">Functional Analysis Tutorial in MetaboAnalyst website</div>
</div>
<div id="enrichment-analysis" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Enrichment Analysis<a href="functional-analysis-1.html#enrichment-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this tutorial, we aim to help you to walk through the enrichment analysis in Metaboanalyst5.</p>
<p>This module performs metabolite set enrichment analysis (MSEA) for human and mammalian species based on several libraries containing ~9000 groups of metabolite sets. Users can upload either:</p>
<p><strong>1) a list of compounds</strong></p>
<p><strong>2) a list of compounds with concentrations</strong></p>
<p><strong>3) a concentration table</strong></p>
<p>Before carrying out the analysis, you are advised to acquire a list of metabolites in your interest (e.g., Statistical Analysis), then apply them to different modules in this tutorial according to the input file format.</p>
<p><strong>Here, we apply SCFA sequencing data of stool samples in GvHD project as demo data.</strong></p>
<div id="enviroment-setup" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Enviroment Setup<a href="functional-analysis-1.html#enviroment-setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="functional-analysis-1.html#cb177-1" tabindex="-1"></a><span class="fu">library</span>(MetaboAnalystR)</span>
<span id="cb177-2"><a href="functional-analysis-1.html#cb177-2" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb177-3"><a href="functional-analysis-1.html#cb177-3" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb177-4"><a href="functional-analysis-1.html#cb177-4" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb177-5"><a href="functional-analysis-1.html#cb177-5" tabindex="-1"></a><span class="co">#library(googledrive)</span></span></code></pre></div>
<hr />
</div>
<div id="over-representation-analysis-ora" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Over representation analysis (ORA)<a href="functional-analysis-1.html#over-representation-analysis-ora" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>ORA is used to evaluate whether a particular set of metabolites is represented more than expected by chance within a given compound list.<br />
ORA is performed when the user provides only a list of compound names.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="functional-analysis-1.html#cb178-1" tabindex="-1"></a><span class="do">## Read input from the SCFA data of GvHD project.</span></span>
<span id="cb178-2"><a href="functional-analysis-1.html#cb178-2" tabindex="-1"></a>SCFA_tbl <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;./dataset/InputFiles/GvHD_stool_metabolites_SCFA.xlsx&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb178-3"><a href="functional-analysis-1.html#cb178-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb178-4"><a href="functional-analysis-1.html#cb178-4" tabindex="-1"></a></span>
<span id="cb178-5"><a href="functional-analysis-1.html#cb178-5" tabindex="-1"></a>metabolite_lst <span class="ot">&lt;-</span> SCFA_tbl<span class="sc">$</span>Compounds</span>
<span id="cb178-6"><a href="functional-analysis-1.html#cb178-6" tabindex="-1"></a></span>
<span id="cb178-7"><a href="functional-analysis-1.html#cb178-7" tabindex="-1"></a><span class="do">## Create mSetObj, always initiate your mSet at the beginning.</span></span>
<span id="cb178-8"><a href="functional-analysis-1.html#cb178-8" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;msetora&quot;</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<p>[1] “MetaboAnalyst R objects initialized …”</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="functional-analysis-1.html#cb179-1" tabindex="-1"></a><span class="do">## Set up mSetObj with the list of compounds</span></span>
<span id="cb179-2"><a href="functional-analysis-1.html#cb179-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Setup.MapData</span>(mSet, metabolite_lst)</span>
<span id="cb179-3"><a href="functional-analysis-1.html#cb179-3" tabindex="-1"></a></span>
<span id="cb179-4"><a href="functional-analysis-1.html#cb179-4" tabindex="-1"></a><span class="do">## Cross reference list of compounds against libraries (hmdb, pubchem, chebi, kegg, metlin)</span></span>
<span id="cb179-5"><a href="functional-analysis-1.html#cb179-5" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CrossReferencing</span>(mSet, <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”
[1] “1”<br />
[2] “Name matching OK, please inspect (and manual correct) the results then proceed.”</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="functional-analysis-1.html#cb180-1" tabindex="-1"></a><span class="do">## Example compound name map</span></span>
<span id="cb180-2"><a href="functional-analysis-1.html#cb180-2" tabindex="-1"></a>mSet<span class="sc">$</span>name.map</span></code></pre></div>
<p>$query.vec
[1] “Acetic acid” “Propionic acid” “Isobutyric acid” “Butyric acid” “Isovaleric acid” “Valeric acid” “Hexanoic acid”</p>
<p>$hit.inx
[1] 29 158 1241 28 566 708 409</p>
<p>$hit.values
[1] “Acetic acid” “Propionic acid” “Isobutyric acid” “Butyric acid” “Isovaleric acid” “Valeric acid” “Caproic acid”</p>
<p>$match.state
[1] 1 1 1 1 1 1 1</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="functional-analysis-1.html#cb181-1" tabindex="-1"></a><span class="do">## Create the mapping results table</span></span>
<span id="cb181-2"><a href="functional-analysis-1.html#cb181-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CreateMappingResultTable</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="functional-analysis-1.html#cb182-1" tabindex="-1"></a><span class="do">## Set the metabolite filter</span></span>
<span id="cb182-2"><a href="functional-analysis-1.html#cb182-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetMetabolomeFilter</span>(mSet, F)</span>
<span id="cb182-3"><a href="functional-analysis-1.html#cb182-3" tabindex="-1"></a></span>
<span id="cb182-4"><a href="functional-analysis-1.html#cb182-4" tabindex="-1"></a><span class="do">## Select metabolite set library, we use fecal in this example, you can also choose &quot;kegg_pathway&quot;, &quot;smpdb_pathway&quot;, &quot;blood&quot;, &quot;urine&quot;, &quot;csf&quot;, &quot;snp&quot;, &quot;predicted&quot;, &quot;location&quot;, &quot;drug, etc,.</span></span>
<span id="cb182-5"><a href="functional-analysis-1.html#cb182-5" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetCurrentMsetLib</span>(mSet, <span class="st">&quot;fecal&quot;</span>, <span class="dv">2</span>)</span>
<span id="cb182-6"><a href="functional-analysis-1.html#cb182-6" tabindex="-1"></a></span>
<span id="cb182-7"><a href="functional-analysis-1.html#cb182-7" tabindex="-1"></a><span class="do">## Calculate hypergeometric score, results table generated in your working directory</span></span>
<span id="cb182-8"><a href="functional-analysis-1.html#cb182-8" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CalculateHyperScore</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="functional-analysis-1.html#cb183-1" tabindex="-1"></a>ora_res <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;./msea_ora_result.csv&#39;</span>, <span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb183-2"><a href="functional-analysis-1.html#cb183-2" tabindex="-1"></a><span class="do">## Enrichment Ratio is computed by Hits / Expected, where hits = observed hits expected = expected hits (see the Table below)</span></span>
<span id="cb183-3"><a href="functional-analysis-1.html#cb183-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ora_res))</span></code></pre></div>
<table>
<colgroup>
<col width="57%" />
<col width="6%" />
<col width="9%" />
<col width="5%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">total</th>
<th align="right">expected</th>
<th align="right">hits</th>
<th align="right">Raw p</th>
<th align="right">Holm p</th>
<th align="right">FDR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Irritable Bowel Syndrome</td>
<td align="right">93</td>
<td align="right">0.5140</td>
<td align="right">7</td>
<td align="right">0e+00</td>
<td align="right">4.0e-07</td>
<td align="right">2.0e-07</td>
</tr>
<tr class="even">
<td align="left">Celiac Disease</td>
<td align="right">98</td>
<td align="right">0.5410</td>
<td align="right">7</td>
<td align="right">0e+00</td>
<td align="right">6.0e-07</td>
<td align="right">2.0e-07</td>
</tr>
<tr class="odd">
<td align="left">Treated Celiac Disease</td>
<td align="right">98</td>
<td align="right">0.5410</td>
<td align="right">7</td>
<td align="right">0e+00</td>
<td align="right">6.0e-07</td>
<td align="right">2.0e-07</td>
</tr>
<tr class="even">
<td align="left">Juvenile Idiopathic Arthritis</td>
<td align="right">3</td>
<td align="right">0.0166</td>
<td align="right">3</td>
<td align="right">1e-07</td>
<td align="right">4.1e-06</td>
<td align="right">1.1e-06</td>
</tr>
<tr class="odd">
<td align="left">Pervasive Developmental Disorder Not Otherwise Specified</td>
<td align="right">82</td>
<td align="right">0.4530</td>
<td align="right">6</td>
<td align="right">4e-07</td>
<td align="right">1.6e-05</td>
<td align="right">3.0e-06</td>
</tr>
<tr class="even">
<td align="left">Nonalcoholic Fatty Liver Disease</td>
<td align="right">158</td>
<td align="right">0.8730</td>
<td align="right">7</td>
<td align="right">4e-07</td>
<td align="right">1.6e-05</td>
<td align="right">3.0e-06</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="functional-analysis-1.html#cb184-1" tabindex="-1"></a><span class="do">## Plot the ORA, bar-graph</span></span>
<span id="cb184-2"><a href="functional-analysis-1.html#cb184-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotORA</span>(mSet, <span class="st">&quot;./dataset/OutputFiles/ora_0_&quot;</span>, <span class="st">&quot;bar&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb184-3"><a href="functional-analysis-1.html#cb184-3" tabindex="-1"></a></span>
<span id="cb184-4"><a href="functional-analysis-1.html#cb184-4" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/ora_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/ora_0_dpi250.png" width="1125" /></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="functional-analysis-1.html#cb185-1" tabindex="-1"></a><span class="do">## Plot DotPlot</span></span>
<span id="cb185-2"><a href="functional-analysis-1.html#cb185-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotEnrichDotPlot</span>(mSet, <span class="st">&quot;ora&quot;</span>, <span class="st">&quot;./dataset/OutputFiles/ora_dot_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb185-3"><a href="functional-analysis-1.html#cb185-3" tabindex="-1"></a></span>
<span id="cb185-4"><a href="functional-analysis-1.html#cb185-4" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/ora_dot_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/ora_dot_0_dpi250.png" width="1500" /></p>
</div>
<div id="clean-environment-1" class="section level3 hasAnchor" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> Clean environment 1<a href="functional-analysis-1.html#clean-environment-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remove all variables in env because a new mSet object needs to be created for the following analysis.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="functional-analysis-1.html#cb186-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<hr />
</div>
<div id="single-sample-profiling" class="section level3 hasAnchor" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> Single Sample Profiling<a href="functional-analysis-1.html#single-sample-profiling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For common human biofluids such as blood, urine, or CSF, normal concentration ranges are known for many metabolites.</p>
<p>In clinical metabolomic studies, it is often desirable to know whether certain metabolite concentrations in a given sample are significantly higher or lower than their normal ranges. MSEA’s SSP module is designed to provide this kind of analysis.</p>
<p>In particular, SSP is performed when the user provides a two-column list of both compounds and concentrations. When called, the SSP module will compare the measured concentration values of each compound to its recorded normal reference ranges of the corresponding biofluid.</p>
<p>Input for this module should be a list of metabolites and their concentrations (could be one column (1 x N) from a N * M abundance table with M samples/columns with N metabolites/rows).</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="functional-analysis-1.html#cb187-1" tabindex="-1"></a><span class="do">## Read input from the SCFA data of GvHD project.</span></span>
<span id="cb187-2"><a href="functional-analysis-1.html#cb187-2" tabindex="-1"></a>SCFA_tbl <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;./dataset/InputFiles/GvHD_stool_metabolites_SCFA.xlsx&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb187-3"><a href="functional-analysis-1.html#cb187-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb187-4"><a href="functional-analysis-1.html#cb187-4" tabindex="-1"></a></span>
<span id="cb187-5"><a href="functional-analysis-1.html#cb187-5" tabindex="-1"></a><span class="do">## Initialize mSet object</span></span>
<span id="cb187-6"><a href="functional-analysis-1.html#cb187-6" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;msetssp&quot;</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<p>[1] “MetaboAnalyst R objects initialized …”</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="functional-analysis-1.html#cb188-1" tabindex="-1"></a><span class="do">## Read in metabolites names from SCFA_tbl</span></span>
<span id="cb188-2"><a href="functional-analysis-1.html#cb188-2" tabindex="-1"></a>cmpd.vec <span class="ot">&lt;-</span> SCFA_tbl<span class="sc">$</span>Compounds</span>
<span id="cb188-3"><a href="functional-analysis-1.html#cb188-3" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Setup.MapData</span>(mSet, cmpd.vec)</span>
<span id="cb188-4"><a href="functional-analysis-1.html#cb188-4" tabindex="-1"></a></span>
<span id="cb188-5"><a href="functional-analysis-1.html#cb188-5" tabindex="-1"></a><span class="do">## Read in concentration of sample CJY-V0 from SCFA_tbl</span></span>
<span id="cb188-6"><a href="functional-analysis-1.html#cb188-6" tabindex="-1"></a>conc.vec <span class="ot">&lt;-</span> SCFA_tbl<span class="sc">$</span><span class="st">`</span><span class="at">CJY-V0</span><span class="st">`</span></span>
<span id="cb188-7"><a href="functional-analysis-1.html#cb188-7" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Setup.ConcData</span>(mSet, conc.vec)</span>
<span id="cb188-8"><a href="functional-analysis-1.html#cb188-8" tabindex="-1"></a></span>
<span id="cb188-9"><a href="functional-analysis-1.html#cb188-9" tabindex="-1"></a><span class="do">## Set unit of metabolites&#39; concentration</span></span>
<span id="cb188-10"><a href="functional-analysis-1.html#cb188-10" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Setup.BiofluidType</span>(mSet, <span class="st">&quot;urine&quot;</span>)</span>
<span id="cb188-11"><a href="functional-analysis-1.html#cb188-11" tabindex="-1"></a></span>
<span id="cb188-12"><a href="functional-analysis-1.html#cb188-12" tabindex="-1"></a><span class="do">## Check names</span></span>
<span id="cb188-13"><a href="functional-analysis-1.html#cb188-13" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CrossReferencing</span>(mSet, <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”
[1] “1”<br />
[2] “Name matching OK, please inspect (and manual correct) the results then proceed.”</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="functional-analysis-1.html#cb189-1" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CreateMappingResultTable</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="functional-analysis-1.html#cb190-1" tabindex="-1"></a><span class="do">## Calculate SSP</span></span>
<span id="cb190-2"><a href="functional-analysis-1.html#cb190-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CalculateSSP</span>(<span class="at">mSetObj =</span> mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="functional-analysis-1.html#cb191-1" tabindex="-1"></a><span class="do">## Select all metabolites in our interests and do ORA.</span></span>
<span id="cb191-2"><a href="functional-analysis-1.html#cb191-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Setup.MapData</span>(mSet, cmpd.vec)</span>
<span id="cb191-3"><a href="functional-analysis-1.html#cb191-3" tabindex="-1"></a></span>
<span id="cb191-4"><a href="functional-analysis-1.html#cb191-4" tabindex="-1"></a><span class="do">## Filter</span></span>
<span id="cb191-5"><a href="functional-analysis-1.html#cb191-5" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetMetabolomeFilter</span>(mSet, F)</span>
<span id="cb191-6"><a href="functional-analysis-1.html#cb191-6" tabindex="-1"></a></span>
<span id="cb191-7"><a href="functional-analysis-1.html#cb191-7" tabindex="-1"></a><span class="do">## Setup library</span></span>
<span id="cb191-8"><a href="functional-analysis-1.html#cb191-8" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetCurrentMsetLib</span>(mSet, <span class="st">&quot;smpdb_pathway&quot;</span>, <span class="dv">2</span>)</span>
<span id="cb191-9"><a href="functional-analysis-1.html#cb191-9" tabindex="-1"></a></span>
<span id="cb191-10"><a href="functional-analysis-1.html#cb191-10" tabindex="-1"></a><span class="do">## Calculate hyperscore</span></span>
<span id="cb191-11"><a href="functional-analysis-1.html#cb191-11" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CalculateHyperScore</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="functional-analysis-1.html#cb192-1" tabindex="-1"></a>ora_res <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;./msea_ora_result.csv&#39;</span>,<span class="at">check.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb192-2"><a href="functional-analysis-1.html#cb192-2" tabindex="-1"></a></span>
<span id="cb192-3"><a href="functional-analysis-1.html#cb192-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ora_res))</span></code></pre></div>
<table>
<colgroup>
<col width="61%" />
<col width="5%" />
<col width="8%" />
<col width="4%" />
<col width="7%" />
<col width="6%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">total</th>
<th align="right">expected</th>
<th align="right">hits</th>
<th align="right">Raw p</th>
<th align="right">Holm p</th>
<th align="right">FDR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Fatty Acid Biosynthesis</td>
<td align="right">35</td>
<td align="right">0.2390</td>
<td align="right">3</td>
<td align="right">0.00117</td>
<td align="right">0.114</td>
<td align="right">0.114</td>
</tr>
<tr class="even">
<td align="left">Vitamin K Metabolism</td>
<td align="right">14</td>
<td align="right">0.0957</td>
<td align="right">1</td>
<td align="right">0.09210</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="left">Beta Oxidation of Very Long Chain Fatty Acids</td>
<td align="right">17</td>
<td align="right">0.1160</td>
<td align="right">1</td>
<td align="right">0.11100</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">Butyrate Metabolism</td>
<td align="right">19</td>
<td align="right">0.1300</td>
<td align="right">1</td>
<td align="right">0.12300</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="left">Ethanol Degradation</td>
<td align="right">19</td>
<td align="right">0.1300</td>
<td align="right">1</td>
<td align="right">0.12300</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="left">Mitochondrial Beta-Oxidation of Short Chain Saturated Fatty Acids</td>
<td align="right">27</td>
<td align="right">0.1850</td>
<td align="right">1</td>
<td align="right">0.17100</td>
<td align="right">1.000</td>
<td align="right">1.000</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="functional-analysis-1.html#cb193-1" tabindex="-1"></a><span class="do">## Plot</span></span>
<span id="cb193-2"><a href="functional-analysis-1.html#cb193-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotORA</span>(<span class="at">mSetObj =</span> mSet, <span class="at">imgName =</span> <span class="st">&quot;./dataset/OutputFiles/SSP_ora_0_&quot;</span>,</span>
<span id="cb193-3"><a href="functional-analysis-1.html#cb193-3" tabindex="-1"></a>              <span class="at">imgOpt =</span>  <span class="st">&quot;net&quot;</span>, <span class="at">format =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb193-4"><a href="functional-analysis-1.html#cb193-4" tabindex="-1"></a></span>
<span id="cb193-5"><a href="functional-analysis-1.html#cb193-5" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/SSP_ora_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/SSP_ora_0_dpi250.png" width="1125" /></p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="functional-analysis-1.html#cb194-1" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotEnrichDotPlot</span>(<span class="at">mSetObj =</span> mSet, <span class="at">enrichType =</span> <span class="st">&quot;ora&quot;</span>, </span>
<span id="cb194-2"><a href="functional-analysis-1.html#cb194-2" tabindex="-1"></a>                        <span class="at">imgName =</span> <span class="st">&quot;./dataset/OutputFiles/SSP_ora_dot_0_&quot;</span>, </span>
<span id="cb194-3"><a href="functional-analysis-1.html#cb194-3" tabindex="-1"></a>                        <span class="at">format =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb194-4"><a href="functional-analysis-1.html#cb194-4" tabindex="-1"></a></span>
<span id="cb194-5"><a href="functional-analysis-1.html#cb194-5" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/SSP_ora_dot_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/SSP_ora_dot_0_dpi250.png" width="1500" /></p>
</div>
<div id="clean-environment-2" class="section level3 hasAnchor" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> Clean environment 2<a href="functional-analysis-1.html#clean-environment-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Remove all variables in env because a new mSet object needs to be created for the following analysis.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="functional-analysis-1.html#cb195-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<hr />
</div>
<div id="quantitative-enrichment-analysis-qea" class="section level3 hasAnchor" number="4.1.6">
<h3><span class="header-section-number">4.1.6</span> Quantitative Enrichment Analysis (QEA)<a href="functional-analysis-1.html#quantitative-enrichment-analysis-qea" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>QEA is performed when the user uploads a concentration table containing metabolite concentration data from multiple samples.</p>
<p>QEA is based on the <em>globaltest</em> algorithm to perform enrichment analysis directly from raw concentration data and does not require a list of significantly changed compounds.</p>
<p>Especially, QEA adopted <em>globaltest</em> as the backend. Please find <em><a href="https://academic.oup.com/bioinformatics/article/20/1/93/229017">citation</a></em> for detailed introduction.<br />
In short, <em>globaltest</em> calculates Q values, the formula to calculate Q-statistic can be obtained from the original publication by (Goeman JJ, et al). Q-statistic can be intuitively interpreted as an aggregate of squared covariance between concentration changes and the phenotypes - compounds with large variance have much more influence on the Q than compound with small variance.</p>
<p>And the null hypothesis in QEA to be tested are made to be whether two groups of samples <strong>are not different</strong> with respect to their overall metabolites’ abundance pattern. Under this hypothesis, expectation and standard deviation can be calculated and p value can be estimated. If p &lt; 0.05, it means that two groups of samples <strong>are different</strong> with respect to their overall metabolites’ abundance pattern.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="functional-analysis-1.html#cb196-1" tabindex="-1"></a><span class="do">## Create mSetObj</span></span>
<span id="cb196-2"><a href="functional-analysis-1.html#cb196-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;msetqea&quot;</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Starting Rserve:
/Library/Frameworks/R.framework/Resources/bin/R CMD /Library/Frameworks/R.framework/Versions/4.1/Resources/library/Rserve/libs//Rserve –no-save</p>
<p>[1] “MetaboAnalyst R objects initialized …”</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="functional-analysis-1.html#cb197-1" tabindex="-1"></a><span class="do">## Read in data table</span></span>
<span id="cb197-2"><a href="functional-analysis-1.html#cb197-2" tabindex="-1"></a>SCFA_tbl <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;./dataset/InputFiles/GvHD_stool_metabolites_SCFA.xlsx&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb197-3"><a href="functional-analysis-1.html#cb197-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb197-4"><a href="functional-analysis-1.html#cb197-4" tabindex="-1"></a></span>
<span id="cb197-5"><a href="functional-analysis-1.html#cb197-5" tabindex="-1"></a><span class="do">## Replace N/A with NA</span></span>
<span id="cb197-6"><a href="functional-analysis-1.html#cb197-6" tabindex="-1"></a>SCFA_tbl[SCFA_tbl <span class="sc">==</span> <span class="st">&quot;N/A&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb197-7"><a href="functional-analysis-1.html#cb197-7" tabindex="-1"></a></span>
<span id="cb197-8"><a href="functional-analysis-1.html#cb197-8" tabindex="-1"></a><span class="do">## Select columns from input data table</span></span>
<span id="cb197-9"><a href="functional-analysis-1.html#cb197-9" tabindex="-1"></a>SCFA_tbl <span class="ot">&lt;-</span> SCFA_tbl[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(SCFA_tbl))] <span class="sc">%&gt;%</span> <span class="fu">column_to_rownames</span>(<span class="st">&#39;Compounds&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb197-10"><a href="functional-analysis-1.html#cb197-10" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span>
<span id="cb197-11"><a href="functional-analysis-1.html#cb197-11" tabindex="-1"></a></span>
<span id="cb197-12"><a href="functional-analysis-1.html#cb197-12" tabindex="-1"></a><span class="do">## Create Group Info</span></span>
<span id="cb197-13"><a href="functional-analysis-1.html#cb197-13" tabindex="-1"></a>SCFA_tbl <span class="sc">%&lt;&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Group =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">&#39;A&#39;</span>,<span class="dv">25</span>), <span class="fu">rep</span>(<span class="st">&#39;B&#39;</span>,<span class="dv">31</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb197-14"><a href="functional-analysis-1.html#cb197-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&#39;Group&#39;</span>, <span class="fu">colnames</span>(.)[<span class="fu">colnames</span>(.) <span class="sc">!=</span> <span class="st">&#39;Group&#39;</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb197-15"><a href="functional-analysis-1.html#cb197-15" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&#39;Samples&#39;</span>)</span>
<span id="cb197-16"><a href="functional-analysis-1.html#cb197-16" tabindex="-1"></a></span>
<span id="cb197-17"><a href="functional-analysis-1.html#cb197-17" tabindex="-1"></a><span class="do">## Write data table in csv file</span></span>
<span id="cb197-18"><a href="functional-analysis-1.html#cb197-18" tabindex="-1"></a><span class="fu">write.csv</span>(SCFA_tbl, <span class="st">&#39;./dataset/OutputFiles/GvHD_stool_metabolites_SCFA.csv&#39;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb197-19"><a href="functional-analysis-1.html#cb197-19" tabindex="-1"></a></span>
<span id="cb197-20"><a href="functional-analysis-1.html#cb197-20" tabindex="-1"></a><span class="do">## Read in data table</span></span>
<span id="cb197-21"><a href="functional-analysis-1.html#cb197-21" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Read.TextData</span>(mSet, <span class="st">&quot;./dataset/OutputFiles/GvHD_stool_metabolites_SCFA.csv&quot;</span>, <span class="st">&quot;rowu&quot;</span>, <span class="st">&quot;disc&quot;</span>)</span>
<span id="cb197-22"><a href="functional-analysis-1.html#cb197-22" tabindex="-1"></a></span>
<span id="cb197-23"><a href="functional-analysis-1.html#cb197-23" tabindex="-1"></a><span class="co"># Perform cross-referencing of compound names</span></span>
<span id="cb197-24"><a href="functional-analysis-1.html#cb197-24" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CrossReferencing</span>(mSet, <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”
[1] “1”<br />
[2] “Name matching OK, please inspect (and manual correct) the results then proceed.”</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="functional-analysis-1.html#cb198-1" tabindex="-1"></a><span class="co"># Create mapping results table</span></span>
<span id="cb198-2"><a href="functional-analysis-1.html#cb198-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CreateMappingResultTable</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="functional-analysis-1.html#cb199-1" tabindex="-1"></a><span class="co"># Mandatory check of data</span></span>
<span id="cb199-2"><a href="functional-analysis-1.html#cb199-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SanityCheckData</span>(mSet)</span></code></pre></div>
<p>[1] “Successfully passed sanity check!”<br />
[2] “Samples are not paired.”<br />
[3] “2 groups were detected in samples.”<br />
[4] “Only English letters, numbers, underscore, hyphen and forward slash (/) are allowed.”<br />
[5] “<font color=\"orange\">Other special characters or punctuations (if any) will be stripped off.</font>”<br />
[6] “All data values are numeric.”<br />
[7] “A total of 26 (6.6%) missing values were detected.”<br />
[8] “<u>By default, missing values will be replaced by 1/5 of min positive values of their corresponding variables</u>”
[9] “Click the <b>Proceed</b> button if you accept the default practice;”<br />
[10] “Or click the <b>Missing Values</b> button to use other methods.”</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="functional-analysis-1.html#cb200-1" tabindex="-1"></a><span class="co"># Replace missing values with minimum concentration levels</span></span>
<span id="cb200-2"><a href="functional-analysis-1.html#cb200-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">ReplaceMin</span>(mSet)</span>
<span id="cb200-3"><a href="functional-analysis-1.html#cb200-3" tabindex="-1"></a></span>
<span id="cb200-4"><a href="functional-analysis-1.html#cb200-4" tabindex="-1"></a><span class="co"># Perform no normalization</span></span>
<span id="cb200-5"><a href="functional-analysis-1.html#cb200-5" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PreparePrenormData</span>(mSet)</span>
<span id="cb200-6"><a href="functional-analysis-1.html#cb200-6" tabindex="-1"></a></span>
<span id="cb200-7"><a href="functional-analysis-1.html#cb200-7" tabindex="-1"></a><span class="co">#mSet &lt;- Normalization(mSet, rowNorm = &quot;SumNorm&quot;, transNorm = &quot;LogNorm&quot;, scaleNorm = &quot;ParetoNorm&quot;, ref = &quot;PIF_178&quot;, ratio=FALSE, ratioNum=20)</span></span>
<span id="cb200-8"><a href="functional-analysis-1.html#cb200-8" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Normalization</span>(mSet, <span class="at">rowNorm =</span> <span class="st">&quot;SumNorm&quot;</span>, <span class="at">transNorm =</span> <span class="st">&quot;LogNorm&quot;</span>, <span class="at">scaleNorm =</span> <span class="st">&quot;ParetoNorm&quot;</span>)</span>
<span id="cb200-9"><a href="functional-analysis-1.html#cb200-9" tabindex="-1"></a></span>
<span id="cb200-10"><a href="functional-analysis-1.html#cb200-10" tabindex="-1"></a><span class="co"># Plot normalization</span></span>
<span id="cb200-11"><a href="functional-analysis-1.html#cb200-11" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotNormSummary</span>(mSet, <span class="st">&quot;./dataset/OutputFiles/norm_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb200-12"><a href="functional-analysis-1.html#cb200-12" tabindex="-1"></a></span>
<span id="cb200-13"><a href="functional-analysis-1.html#cb200-13" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/norm_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/norm_0_dpi250.png" width="1312" /></p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="functional-analysis-1.html#cb201-1" tabindex="-1"></a><span class="co"># Plot sample-wise normalization</span></span>
<span id="cb201-2"><a href="functional-analysis-1.html#cb201-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotSampleNormSummary</span>(mSet, <span class="st">&quot;./dataset/OutputFiles/snorm_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb201-3"><a href="functional-analysis-1.html#cb201-3" tabindex="-1"></a></span>
<span id="cb201-4"><a href="functional-analysis-1.html#cb201-4" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/snorm_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/snorm_0_dpi250.png" width="1312" /></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="functional-analysis-1.html#cb202-1" tabindex="-1"></a><span class="co"># Set the metabolome filter</span></span>
<span id="cb202-2"><a href="functional-analysis-1.html#cb202-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetMetabolomeFilter</span>(mSet, F)</span>
<span id="cb202-3"><a href="functional-analysis-1.html#cb202-3" tabindex="-1"></a></span>
<span id="cb202-4"><a href="functional-analysis-1.html#cb202-4" tabindex="-1"></a><span class="co"># Set the metabolite set library to pathway</span></span>
<span id="cb202-5"><a href="functional-analysis-1.html#cb202-5" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetCurrentMsetLib</span>(mSet, <span class="st">&quot;smpdb_pathway&quot;</span>, <span class="dv">2</span>)</span>
<span id="cb202-6"><a href="functional-analysis-1.html#cb202-6" tabindex="-1"></a></span>
<span id="cb202-7"><a href="functional-analysis-1.html#cb202-7" tabindex="-1"></a><span class="co"># Calculate the global test score</span></span>
<span id="cb202-8"><a href="functional-analysis-1.html#cb202-8" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CalculateGlobalTestScore</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="functional-analysis-1.html#cb203-1" tabindex="-1"></a>msea_qea_res <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;./msea_qea_result.csv&#39;</span>)</span>
<span id="cb203-2"><a href="functional-analysis-1.html#cb203-2" tabindex="-1"></a></span>
<span id="cb203-3"><a href="functional-analysis-1.html#cb203-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(msea_qea_res))</span></code></pre></div>
<table>
<colgroup>
<col width="51%" />
<col width="8%" />
<col width="3%" />
<col width="9%" />
<col width="8%" />
<col width="6%" />
<col width="5%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">X</th>
<th align="right">Total.Cmpd</th>
<th align="right">Hits</th>
<th align="right">Statistic.Q</th>
<th align="right">Expected.Q</th>
<th align="right">Raw.p</th>
<th align="right">Holm.p</th>
<th align="right">FDR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Propanoate Metabolism</td>
<td align="right">42</td>
<td align="right">1</td>
<td align="right">4.3168</td>
<td align="right">1.8182</td>
<td align="right">0.12440</td>
<td align="right">1</td>
<td align="right">0.62002</td>
</tr>
<tr class="even">
<td align="left">Vitamin K Metabolism</td>
<td align="right">14</td>
<td align="right">1</td>
<td align="right">4.3168</td>
<td align="right">1.8182</td>
<td align="right">0.12440</td>
<td align="right">1</td>
<td align="right">0.62002</td>
</tr>
<tr class="odd">
<td align="left">Butyrate Metabolism</td>
<td align="right">19</td>
<td align="right">1</td>
<td align="right">2.1853</td>
<td align="right">1.8182</td>
<td align="right">0.27692</td>
<td align="right">1</td>
<td align="right">0.62002</td>
</tr>
<tr class="even">
<td align="left">Fatty Acid Biosynthesis</td>
<td align="right">35</td>
<td align="right">3</td>
<td align="right">1.7437</td>
<td align="right">1.8182</td>
<td align="right">0.37316</td>
<td align="right">1</td>
<td align="right">0.62002</td>
</tr>
<tr class="odd">
<td align="left">Beta Oxidation of Very Long Chain Fatty Acids</td>
<td align="right">17</td>
<td align="right">1</td>
<td align="right">1.4123</td>
<td align="right">1.8182</td>
<td align="right">0.38302</td>
<td align="right">1</td>
<td align="right">0.62002</td>
</tr>
<tr class="even">
<td align="left">Mitochondrial Beta-Oxidation of Short Chain Saturated Fatty Acids</td>
<td align="right">27</td>
<td align="right">1</td>
<td align="right">1.4123</td>
<td align="right">1.8182</td>
<td align="right">0.38302</td>
<td align="right">1</td>
<td align="right">0.62002</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="functional-analysis-1.html#cb204-1" tabindex="-1"></a><span class="co"># Plot the QEA</span></span>
<span id="cb204-2"><a href="functional-analysis-1.html#cb204-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotQEA.Overview</span>(mSet, <span class="st">&quot;./dataset/OutputFiles/qea_0_&quot;</span>, <span class="st">&quot;bar&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb204-3"><a href="functional-analysis-1.html#cb204-3" tabindex="-1"></a></span>
<span id="cb204-4"><a href="functional-analysis-1.html#cb204-4" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/qea_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/qea_0_dpi250.png" width="1125" /></p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="functional-analysis-1.html#cb205-1" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotEnrichDotPlot</span>(mSet, <span class="st">&quot;qea&quot;</span>, <span class="st">&quot;./dataset/OutputFiles/qea_dot_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb205-2"><a href="functional-analysis-1.html#cb205-2" tabindex="-1"></a></span>
<span id="cb205-3"><a href="functional-analysis-1.html#cb205-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/qea_dot_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/qea_dot_0_dpi250.png" width="1500" /></p>
<p>Remove all variables in env because a new mSet object needs to be created for the following analysis.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="functional-analysis-1.html#cb206-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<hr />
</div>
</div>
<div id="pathway-analysis" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Pathway Analysis<a href="functional-analysis-1.html#pathway-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this tutorial, we aim to help you to walk through the pathway analysis in Metaboanalyst5.</p>
<p>This module supports pathway analysis (integrating enrichment analysis and pathway topology analysis) and visualization for 26 model organisms, including Human, Mouse, Rat, Cow, Chicken, Zebrafish, Arabidopsis thaliana, Rice, Drosophila, Malaria, S. cerevisae, E.coli, and others species.</p>
<p>Here, we apply TM metabolites sequencing data of stool samples in GvHD project as demo data. Moreover, to reduce data noise, we selected differentially abundant metabolites in aGVHD patients from the differential analysis result in Xu XiaoMin’s analysis.</p>
<div id="enviroment-set-up" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Enviroment Set up<a href="functional-analysis-1.html#enviroment-set-up" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<hr />
</div>
<div id="over-representation-analysis" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Over representation analysis<a href="functional-analysis-1.html#over-representation-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar to ORA in Enrichment analysis.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="functional-analysis-1.html#cb207-1" tabindex="-1"></a><span class="do">## Read in differentially abundant TM metanolites data from GVHD project</span></span>
<span id="cb207-2"><a href="functional-analysis-1.html#cb207-2" tabindex="-1"></a>DA_metabolites <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;./dataset/InputFiles/DA_metabolites_agvhd_adult_result.xlsx&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb207-3"><a href="functional-analysis-1.html#cb207-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb207-4"><a href="functional-analysis-1.html#cb207-4" tabindex="-1"></a></span>
<span id="cb207-5"><a href="functional-analysis-1.html#cb207-5" tabindex="-1"></a><span class="do">## Create vector consisting of compounds for enrichment analysis</span></span>
<span id="cb207-6"><a href="functional-analysis-1.html#cb207-6" tabindex="-1"></a>tmp.vec <span class="ot">&lt;-</span> DA_metabolites<span class="sc">$</span>Compounds</span>
<span id="cb207-7"><a href="functional-analysis-1.html#cb207-7" tabindex="-1"></a></span>
<span id="cb207-8"><a href="functional-analysis-1.html#cb207-8" tabindex="-1"></a><span class="do">## Create mSetObj for storing objects created during your analysis</span></span>
<span id="cb207-9"><a href="functional-analysis-1.html#cb207-9" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;pathora&quot;</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<p>[1] “MetaboAnalyst R objects initialized …”</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="functional-analysis-1.html#cb208-1" tabindex="-1"></a><span class="do">## Set up mSetObj with the list of compounds</span></span>
<span id="cb208-2"><a href="functional-analysis-1.html#cb208-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Setup.MapData</span>(mSet, tmp.vec)</span>
<span id="cb208-3"><a href="functional-analysis-1.html#cb208-3" tabindex="-1"></a></span>
<span id="cb208-4"><a href="functional-analysis-1.html#cb208-4" tabindex="-1"></a><span class="do">## Cross reference list of compounds against libraries (hmdb, pubchem, chebi, kegg, metlin). This step is to make sure that all metabolites names provided match the metabolites&#39; names in KEGG database.</span></span>
<span id="cb208-5"><a href="functional-analysis-1.html#cb208-5" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CrossReferencing</span>(mSet, <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”
[1] “0”<br />
[2] “Over half of the compound IDs could not be matched to our database. Please make sure that correct compound IDs or common compound names are used.”</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="functional-analysis-1.html#cb209-1" tabindex="-1"></a><span class="do">## Remove metabolites failed to match the metabolites&#39; names in KEGG database.</span></span>
<span id="cb209-2"><a href="functional-analysis-1.html#cb209-2" tabindex="-1"></a>tmp.vec <span class="ot">&lt;-</span> tmp.vec[mSet<span class="sc">$</span>name.map<span class="sc">$</span>match.state <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb209-3"><a href="functional-analysis-1.html#cb209-3" tabindex="-1"></a></span>
<span id="cb209-4"><a href="functional-analysis-1.html#cb209-4" tabindex="-1"></a><span class="do">## Re-initialize mSet object</span></span>
<span id="cb209-5"><a href="functional-analysis-1.html#cb209-5" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;pathora&quot;</span>, <span class="cn">FALSE</span>)</span>
<span id="cb209-6"><a href="functional-analysis-1.html#cb209-6" tabindex="-1"></a></span>
<span id="cb209-7"><a href="functional-analysis-1.html#cb209-7" tabindex="-1"></a><span class="do">## Set up mSetObj with the matched list of compounds</span></span>
<span id="cb209-8"><a href="functional-analysis-1.html#cb209-8" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Setup.MapData</span>(mSet, tmp.vec)</span>
<span id="cb209-9"><a href="functional-analysis-1.html#cb209-9" tabindex="-1"></a></span>
<span id="cb209-10"><a href="functional-analysis-1.html#cb209-10" tabindex="-1"></a><span class="do">## Cross reference list of compounds against libraries (hmdb, pubchem, chebi, kegg, metlin). Check again if all metabolites&#39; names have their matches in KEGG database</span></span>
<span id="cb209-11"><a href="functional-analysis-1.html#cb209-11" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CrossReferencing</span>(mSet, <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”
[1] “1”<br />
[2] “Name matching OK, please inspect (and manual correct) the results then proceed.”</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="functional-analysis-1.html#cb210-1" tabindex="-1"></a><span class="do">## Creates a mapping result table shows HMDB, KEGG, PubChem, etc. IDs. Saved as &quot;name_map.csv&quot; or can be found in mSet$dataSet$map.table. Compounds with no hits will contain NAs across the columns.</span></span>
<span id="cb210-2"><a href="functional-analysis-1.html#cb210-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CreateMappingResultTable</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="functional-analysis-1.html#cb211-1" tabindex="-1"></a><span class="do">## Select the pathway library, ranging from mammals to prokaryotes</span></span>
<span id="cb211-2"><a href="functional-analysis-1.html#cb211-2" tabindex="-1"></a><span class="do">## Note the third parameter, where users need to input the KEGG pathway version.</span></span>
<span id="cb211-3"><a href="functional-analysis-1.html#cb211-3" tabindex="-1"></a><span class="do">## Use &quot;current&quot; for the latest KEGG pathway library or &quot;v2018&quot; for the KEGG pathway library version prior to November 2019.</span></span>
<span id="cb211-4"><a href="functional-analysis-1.html#cb211-4" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetKEGG.PathLib</span>(mSet, <span class="st">&quot;hsa&quot;</span>, <span class="st">&quot;current&quot;</span>)</span>
<span id="cb211-5"><a href="functional-analysis-1.html#cb211-5" tabindex="-1"></a></span>
<span id="cb211-6"><a href="functional-analysis-1.html#cb211-6" tabindex="-1"></a><span class="do">## Set the metabolite filter. Default set to false</span></span>
<span id="cb211-7"><a href="functional-analysis-1.html#cb211-7" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetMetabolomeFilter</span>(mSet, F)</span>
<span id="cb211-8"><a href="functional-analysis-1.html#cb211-8" tabindex="-1"></a></span>
<span id="cb211-9"><a href="functional-analysis-1.html#cb211-9" tabindex="-1"></a><span class="do">## Calculate the over representation analysis score, here we selected to use the hypergeometric test (alternative is Fisher&#39;s exact test)</span></span>
<span id="cb211-10"><a href="functional-analysis-1.html#cb211-10" tabindex="-1"></a><span class="do">## A results table &quot;pathway_results.csv&quot; will be created and found within your working directory</span></span>
<span id="cb211-11"><a href="functional-analysis-1.html#cb211-11" tabindex="-1"></a><span class="co"># mSet &lt;- CalculateOraScore(mSet, &quot;rbc&quot;, &quot;hyperg&quot;)</span></span>
<span id="cb211-12"><a href="functional-analysis-1.html#cb211-12" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb211-13"><a href="functional-analysis-1.html#cb211-13" tabindex="-1"></a><span class="co"># pathway_res &lt;- read.csv(&#39;./pathway_results.csv&#39;)</span></span>
<span id="cb211-14"><a href="functional-analysis-1.html#cb211-14" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb211-15"><a href="functional-analysis-1.html#cb211-15" tabindex="-1"></a><span class="co"># knitr::kable(head(pathway_res))</span></span>
<span id="cb211-16"><a href="functional-analysis-1.html#cb211-16" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb211-17"><a href="functional-analysis-1.html#cb211-17" tabindex="-1"></a><span class="co"># # Plot of the Pathway Analysis Overview</span></span>
<span id="cb211-18"><a href="functional-analysis-1.html#cb211-18" tabindex="-1"></a><span class="co"># mSet &lt;- PlotPathSummary(mSet,show.grid=FALSE, &quot;./dataset/OutputFiles/path_view_0_&quot;, &quot;png&quot;, dpi =250, width=NA)</span></span>
<span id="cb211-19"><a href="functional-analysis-1.html#cb211-19" tabindex="-1"></a></span>
<span id="cb211-20"><a href="functional-analysis-1.html#cb211-20" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/path_view_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/path_view_0_dpi250.png" width="875" /></p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="functional-analysis-1.html#cb212-1" tabindex="-1"></a><span class="co"># Plot a specific metabolic pathway, in this case &quot;Glycine, serine and threonine metabolism&quot;</span></span>
<span id="cb212-2"><a href="functional-analysis-1.html#cb212-2" tabindex="-1"></a><span class="co"># mSet &lt;- PlotKEGGPath(mSetObj = mSet, pathName = &quot;Glycine, serine and threonine metabolism&quot;, 528, 480, &quot;png&quot;, dpi=72)</span></span></code></pre></div>
</div>
<div id="clean-environment-3" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Clean environment 3<a href="functional-analysis-1.html#clean-environment-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="functional-analysis-1.html#cb213-1" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span></code></pre></div>
<hr />
</div>
<div id="concentration-table-qea" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Concentration Table (QEA)<a href="functional-analysis-1.html#concentration-table-qea" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similar to QEA in Enrichment analysis.</p>
<p>KO enrichment is calculated via the global test algorithm when abundance of metabolites are provided.</p>
<p>Global test evaluates whether a set of genes (i.e. KEGG pathways) is significantly associated with a variable of interest. Compared to ORA, which uses only the total number of KO hits in a pathway, global test considers the gene abundance values and is considered to be more sensitive than ORA. <strong>It assumes that if a gene set can be used to predict an outcome of interest, the gene expression patterns per outcome must be different</strong>.</p>
<p>The global test algorithm is implemented in MicrobiomeAnalyst using the globaltest R package. P-values for both methods are corrected for multiple-testing using the Benjamini and Hochberg’s False-Discovery Rate (FDR).</p>
<p>In this module, we use differentially abundant metabolites in aGVHD patients from the differential analysis result in Xu XiaoMin’s analysis and their abundance as input.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="functional-analysis-1.html#cb214-1" tabindex="-1"></a><span class="do">## Read in differentially abundant TM metanolites data from GVHD project</span></span>
<span id="cb214-2"><a href="functional-analysis-1.html#cb214-2" tabindex="-1"></a>DA_metabolites <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;./dataset/InputFiles/DA_metabolites_agvhd_adult_result.xlsx&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb214-3"><a href="functional-analysis-1.html#cb214-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb214-4"><a href="functional-analysis-1.html#cb214-4" tabindex="-1"></a></span>
<span id="cb214-5"><a href="functional-analysis-1.html#cb214-5" tabindex="-1"></a><span class="do">## Initialize data object</span></span>
<span id="cb214-6"><a href="functional-analysis-1.html#cb214-6" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;pathqea&quot;</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<p>Starting Rserve:
/Library/Frameworks/R.framework/Resources/bin/R CMD /Library/Frameworks/R.framework/Versions/4.1/Resources/library/Rserve/libs//Rserve –no-save</p>
<p>[1] “MetaboAnalyst R objects initialized …”</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="functional-analysis-1.html#cb215-1" tabindex="-1"></a><span class="do">## Read in data table</span></span>
<span id="cb215-2"><a href="functional-analysis-1.html#cb215-2" tabindex="-1"></a>input_df <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&#39;./dataset/InputFiles/GvHD_stool_metabolites_TM.xlsx&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb215-3"><a href="functional-analysis-1.html#cb215-3" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb215-4"><a href="functional-analysis-1.html#cb215-4" tabindex="-1"></a>  .[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">25</span><span class="sc">:</span><span class="fu">ncol</span>(.))] <span class="sc">%&gt;%</span> </span>
<span id="cb215-5"><a href="functional-analysis-1.html#cb215-5" tabindex="-1"></a>  <span class="fu">column_to_rownames</span>(<span class="st">&#39;Compounds&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb215-6"><a href="functional-analysis-1.html#cb215-6" tabindex="-1"></a>  .[DA_metabolites<span class="sc">$</span>Compounds,] <span class="sc">%&gt;%</span> </span>
<span id="cb215-7"><a href="functional-analysis-1.html#cb215-7" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb215-8"><a href="functional-analysis-1.html#cb215-8" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb215-9"><a href="functional-analysis-1.html#cb215-9" tabindex="-1"></a></span>
<span id="cb215-10"><a href="functional-analysis-1.html#cb215-10" tabindex="-1"></a>Groupinfo <span class="ot">&lt;-</span> <span class="fu">rownames</span>(input_df) <span class="sc">%&gt;%</span> </span>
<span id="cb215-11"><a href="functional-analysis-1.html#cb215-11" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_split</span>(<span class="st">&#39;-&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb215-12"><a href="functional-analysis-1.html#cb215-12" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb215-13"><a href="functional-analysis-1.html#cb215-13" tabindex="-1"></a>  .[<span class="dv">2</span>,] <span class="sc">%&gt;%</span> </span>
<span id="cb215-14"><a href="functional-analysis-1.html#cb215-14" tabindex="-1"></a>  <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb215-15"><a href="functional-analysis-1.html#cb215-15" tabindex="-1"></a>  <span class="fu">as.vector</span>()</span>
<span id="cb215-16"><a href="functional-analysis-1.html#cb215-16" tabindex="-1"></a></span>
<span id="cb215-17"><a href="functional-analysis-1.html#cb215-17" tabindex="-1"></a>input_df <span class="sc">%&lt;&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Group =</span> Groupinfo) <span class="sc">%&gt;%</span> </span>
<span id="cb215-18"><a href="functional-analysis-1.html#cb215-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&#39;Group&#39;</span>, <span class="fu">colnames</span>(.)[<span class="fu">colnames</span>(.) <span class="sc">!=</span> <span class="st">&#39;Group&#39;</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb215-19"><a href="functional-analysis-1.html#cb215-19" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&#39;Sample&#39;</span>)</span>
<span id="cb215-20"><a href="functional-analysis-1.html#cb215-20" tabindex="-1"></a></span>
<span id="cb215-21"><a href="functional-analysis-1.html#cb215-21" tabindex="-1"></a><span class="do">## Write reformed metabolites abundance table into csv file</span></span>
<span id="cb215-22"><a href="functional-analysis-1.html#cb215-22" tabindex="-1"></a><span class="fu">write.csv</span>(input_df, <span class="st">&#39;./dataset/OutputFiles/GvHD_stool_metabolites_TM.csv&#39;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb215-23"><a href="functional-analysis-1.html#cb215-23" tabindex="-1"></a></span>
<span id="cb215-24"><a href="functional-analysis-1.html#cb215-24" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Read.TextData</span>(mSet, <span class="st">&#39;./dataset/OutputFiles/GvHD_stool_metabolites_TM.csv&#39;</span>, <span class="st">&quot;rowu&quot;</span>, <span class="st">&quot;disc&quot;</span>)</span>
<span id="cb215-25"><a href="functional-analysis-1.html#cb215-25" tabindex="-1"></a></span>
<span id="cb215-26"><a href="functional-analysis-1.html#cb215-26" tabindex="-1"></a><span class="do">## Show first few rows in data table</span></span>
<span id="cb215-27"><a href="functional-analysis-1.html#cb215-27" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(input_df))</span></code></pre></div>
<table style="width:100%;">
<colgroup>
<col width="0%" />
<col width="0%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="4%" />
<col width="2%" />
<col width="5%" />
<col width="1%" />
<col width="3%" />
<col width="2%" />
<col width="1%" />
<col width="1%" />
<col width="2%" />
<col width="4%" />
<col width="1%" />
<col width="3%" />
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="9%" />
<col width="14%" />
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="1%" />
<col width="2%" />
<col width="1%" />
<col width="1%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Sample</th>
<th align="left">Group</th>
<th align="right">Erucic acid</th>
<th align="right">5-Methylcytosine</th>
<th align="right">D-Gluconic Acid</th>
<th align="right">LPE(14:0/0:0)</th>
<th align="right">N-Acetylglucosamine 1-Phosphate</th>
<th align="right">7-ketodeoxycholic acid</th>
<th align="right">Bis(1-inositol) -3,1’-phosphate 1-phosphate</th>
<th align="right">Asp-phe</th>
<th align="right">Phenylacetyl-L-Glutamine</th>
<th align="right">N-Acetylglycine</th>
<th align="right">Carnitine C2:0</th>
<th align="right">Acetylcholine</th>
<th align="right">Lithocholic acid</th>
<th align="right">3-Carboxypropyltrimethylammonium</th>
<th align="right">Biotinamide</th>
<th align="right">5’-deoxy-5’-fluoroadenosine</th>
<th align="right">Carnitine C5:1</th>
<th align="right">Val-Val</th>
<th align="right">Gly Leu Tyr</th>
<th align="right">Ile-Thr</th>
<th align="right">Isoleucyl-Serine</th>
<th align="right">Isoleucyl-Tyrosine</th>
<th align="right">Phe Val Ala</th>
<th align="right">Phosphonic acid, P-[(3R)-3-amino-4-[(3-hexylphenyl)amino]-4-oxobutyl]-</th>
<th align="right">2-[2,4-dihydroxy-3-(3-methylbut-2-en-1-yl)phenyl]-1-[2,4,6-trihydroxy-3-(3-methylbut-2-en-1-yl)phenyl]propan-1-one</th>
<th align="right">Asp Ile Ile</th>
<th align="right">Gly Leu Val</th>
<th align="right">Ile Glu Leu</th>
<th align="right">Ile Ile Asn</th>
<th align="right">Lys Pro Ile</th>
<th align="right">Phylloquinone oxide</th>
<th align="right">Thr Val Met</th>
<th align="right">Val Leu Thr</th>
<th align="right">(2R,3S,4R,5R)-2,3,4,5,6-pentahydroxyhexanoate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">TZW-V0</td>
<td align="left">V0</td>
<td align="right">1629500</td>
<td align="right">630750</td>
<td align="right">11598000</td>
<td align="right">1900000</td>
<td align="right">1048900</td>
<td align="right">142580.0</td>
<td align="right">4516900</td>
<td align="right">1896000</td>
<td align="right">483960</td>
<td align="right">75306000</td>
<td align="right">35820000</td>
<td align="right">169220</td>
<td align="right">30462</td>
<td align="right">169220</td>
<td align="right">72050</td>
<td align="right">52622</td>
<td align="right">48756</td>
<td align="right">6690500</td>
<td align="right">382840</td>
<td align="right">151620</td>
<td align="right">863010</td>
<td align="right">3696700</td>
<td align="right">371890</td>
<td align="right">419900</td>
<td align="right">376300</td>
<td align="right">1992200</td>
<td align="right">304420</td>
<td align="right">321110</td>
<td align="right">243390</td>
<td align="right">17617</td>
<td align="right">3885</td>
<td align="right">1950000</td>
<td align="right">582200</td>
<td align="right">208490000</td>
</tr>
<tr class="even">
<td align="left">LBC-V0</td>
<td align="left">V0</td>
<td align="right">17057</td>
<td align="right">220290</td>
<td align="right">8239500</td>
<td align="right">68958</td>
<td align="right">9880900</td>
<td align="right">6446.1</td>
<td align="right">313960</td>
<td align="right">19488000</td>
<td align="right">569570</td>
<td align="right">11310000</td>
<td align="right">81713000</td>
<td align="right">90812</td>
<td align="right">9</td>
<td align="right">90812</td>
<td align="right">533990</td>
<td align="right">9</td>
<td align="right">338900</td>
<td align="right">1044600</td>
<td align="right">9</td>
<td align="right">99102</td>
<td align="right">468170</td>
<td align="right">7789300</td>
<td align="right">46193</td>
<td align="right">88988</td>
<td align="right">14154</td>
<td align="right">463070</td>
<td align="right">10903</td>
<td align="right">32430</td>
<td align="right">29187</td>
<td align="right">12902000</td>
<td align="right">9</td>
<td align="right">333220</td>
<td align="right">210680</td>
<td align="right">166450000</td>
</tr>
<tr class="odd">
<td align="left">HXZ-V0</td>
<td align="left">V0</td>
<td align="right">3719000</td>
<td align="right">316360</td>
<td align="right">91189</td>
<td align="right">14390000</td>
<td align="right">37784000</td>
<td align="right">21965000.0</td>
<td align="right">459320</td>
<td align="right">5671200</td>
<td align="right">8502200</td>
<td align="right">6758300</td>
<td align="right">71495000</td>
<td align="right">518950</td>
<td align="right">438800</td>
<td align="right">518950</td>
<td align="right">1222000</td>
<td align="right">36295</td>
<td align="right">953350</td>
<td align="right">8538900</td>
<td align="right">88531</td>
<td align="right">454250</td>
<td align="right">952750</td>
<td align="right">56697</td>
<td align="right">45953</td>
<td align="right">115110</td>
<td align="right">2798900</td>
<td align="right">348560</td>
<td align="right">79613</td>
<td align="right">134400</td>
<td align="right">438750</td>
<td align="right">7569200</td>
<td align="right">24432</td>
<td align="right">747830</td>
<td align="right">86317</td>
<td align="right">2163600</td>
</tr>
<tr class="even">
<td align="left">LJY-V0</td>
<td align="left">V0</td>
<td align="right">1641600</td>
<td align="right">285270</td>
<td align="right">72194</td>
<td align="right">7366800</td>
<td align="right">9557700</td>
<td align="right">3289400.0</td>
<td align="right">71782</td>
<td align="right">756830</td>
<td align="right">30602</td>
<td align="right">531930</td>
<td align="right">387590</td>
<td align="right">1345400</td>
<td align="right">6488400</td>
<td align="right">1345400</td>
<td align="right">544550</td>
<td align="right">27188</td>
<td align="right">295820</td>
<td align="right">3163500</td>
<td align="right">136380</td>
<td align="right">180510</td>
<td align="right">819430</td>
<td align="right">21168</td>
<td align="right">171330</td>
<td align="right">159850</td>
<td align="right">1478200</td>
<td align="right">804870</td>
<td align="right">128420</td>
<td align="right">910850</td>
<td align="right">379890</td>
<td align="right">78433</td>
<td align="right">459240</td>
<td align="right">576110</td>
<td align="right">123100</td>
<td align="right">1502600</td>
</tr>
<tr class="odd">
<td align="left">CJY-V0</td>
<td align="left">V0</td>
<td align="right">9</td>
<td align="right">45013</td>
<td align="right">25589</td>
<td align="right">882500</td>
<td align="right">561320</td>
<td align="right">1603.1</td>
<td align="right">9</td>
<td align="right">7463500</td>
<td align="right">556470</td>
<td align="right">5814900</td>
<td align="right">13723000</td>
<td align="right">26319</td>
<td align="right">9</td>
<td align="right">26319</td>
<td align="right">182350</td>
<td align="right">18175</td>
<td align="right">135980</td>
<td align="right">1555700</td>
<td align="right">38015</td>
<td align="right">130400</td>
<td align="right">441760</td>
<td align="right">3275600</td>
<td align="right">235320</td>
<td align="right">154660</td>
<td align="right">169880</td>
<td align="right">568150</td>
<td align="right">35916</td>
<td align="right">48067</td>
<td align="right">215340</td>
<td align="right">328930</td>
<td align="right">9</td>
<td align="right">763870</td>
<td align="right">97575</td>
<td align="right">900440</td>
</tr>
<tr class="even">
<td align="left">WKM-V0</td>
<td align="left">V0</td>
<td align="right">3079600</td>
<td align="right">228130</td>
<td align="right">396980</td>
<td align="right">8410000</td>
<td align="right">12296000</td>
<td align="right">7266400.0</td>
<td align="right">42405</td>
<td align="right">13785000</td>
<td align="right">4553400</td>
<td align="right">9620400</td>
<td align="right">1311800</td>
<td align="right">4392400</td>
<td align="right">9</td>
<td align="right">4392400</td>
<td align="right">74831</td>
<td align="right">79472</td>
<td align="right">48558</td>
<td align="right">5309200</td>
<td align="right">88741</td>
<td align="right">221440</td>
<td align="right">593130</td>
<td align="right">44678</td>
<td align="right">250550</td>
<td align="right">140720</td>
<td align="right">1660200</td>
<td align="right">522490</td>
<td align="right">234090</td>
<td align="right">263740</td>
<td align="right">415690</td>
<td align="right">9312900</td>
<td align="right">586940</td>
<td align="right">619550</td>
<td align="right">136990</td>
<td align="right">8894600</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="functional-analysis-1.html#cb216-1" tabindex="-1"></a><span class="do">## Check metabolites Names of input table. Found &gt;15 compounds without matches.</span></span>
<span id="cb216-2"><a href="functional-analysis-1.html#cb216-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CrossReferencing</span>(mSet, <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”
[1] “0”<br />
[2] “Over half of the compound IDs could not be matched to our database. Please make sure that correct compound IDs or common compound names are used.”</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="functional-analysis-1.html#cb217-1" tabindex="-1"></a><span class="do">## Keep matched metabolites</span></span>
<span id="cb217-2"><a href="functional-analysis-1.html#cb217-2" tabindex="-1"></a>metabolites_keep <span class="ot">&lt;-</span> mSet<span class="sc">$</span>name.map<span class="sc">$</span>query.vec[mSet<span class="sc">$</span>name.map<span class="sc">$</span>match.state <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb217-3"><a href="functional-analysis-1.html#cb217-3" tabindex="-1"></a>input_df <span class="ot">&lt;-</span> input_df[<span class="fu">c</span>(<span class="st">&#39;Sample&#39;</span>,<span class="st">&#39;Group&#39;</span>, metabolites_keep)]</span>
<span id="cb217-4"><a href="functional-analysis-1.html#cb217-4" tabindex="-1"></a></span>
<span id="cb217-5"><a href="functional-analysis-1.html#cb217-5" tabindex="-1"></a><span class="do">## Overwrite previously generated abundance csv file with matched metabolites</span></span>
<span id="cb217-6"><a href="functional-analysis-1.html#cb217-6" tabindex="-1"></a><span class="fu">write.csv</span>(input_df, <span class="st">&#39;./dataset/OutputFiles/GvHD_stool_metabolites_TM.csv&#39;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb217-7"><a href="functional-analysis-1.html#cb217-7" tabindex="-1"></a></span>
<span id="cb217-8"><a href="functional-analysis-1.html#cb217-8" tabindex="-1"></a><span class="do">## Initialize data object again</span></span>
<span id="cb217-9"><a href="functional-analysis-1.html#cb217-9" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">InitDataObjects</span>(<span class="st">&quot;conc&quot;</span>, <span class="st">&quot;pathqea&quot;</span>, <span class="cn">FALSE</span>)</span>
<span id="cb217-10"><a href="functional-analysis-1.html#cb217-10" tabindex="-1"></a></span>
<span id="cb217-11"><a href="functional-analysis-1.html#cb217-11" tabindex="-1"></a><span class="do">## Read in updated metabolites abundance table</span></span>
<span id="cb217-12"><a href="functional-analysis-1.html#cb217-12" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Read.TextData</span>(mSet, <span class="st">&#39;./dataset/OutputFiles/GvHD_stool_metabolites_TM.csv&#39;</span>, <span class="st">&quot;rowu&quot;</span>, <span class="st">&quot;disc&quot;</span>)</span>
<span id="cb217-13"><a href="functional-analysis-1.html#cb217-13" tabindex="-1"></a></span>
<span id="cb217-14"><a href="functional-analysis-1.html#cb217-14" tabindex="-1"></a><span class="do">## Check Sanity and replace 0</span></span>
<span id="cb217-15"><a href="functional-analysis-1.html#cb217-15" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SanityCheckData</span>(mSet)</span></code></pre></div>
<p>[1] “Successfully passed sanity check!”<br />
[2] “Samples are not paired.”<br />
[3] “2 groups were detected in samples.”<br />
[4] “Only English letters, numbers, underscore, hyphen and forward slash (/) are allowed.”<br />
[5] “<font color=\"orange\">Other special characters or punctuations (if any) will be stripped off.</font>”<br />
[6] “All data values are numeric.”<br />
[7] “A total of 0 (0%) missing values were detected.”<br />
[8] “<u>By default, missing values will be replaced by 1/5 of min positive values of their corresponding variables</u>”
[9] “Click the <b>Proceed</b> button if you accept the default practice;”<br />
[10] “Or click the <b>Missing Values</b> button to use other methods.”</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="functional-analysis-1.html#cb218-1" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">ReplaceMin</span>(mSet)</span>
<span id="cb218-2"><a href="functional-analysis-1.html#cb218-2" tabindex="-1"></a></span>
<span id="cb218-3"><a href="functional-analysis-1.html#cb218-3" tabindex="-1"></a><span class="do">## Check metabolites Names of input table again</span></span>
<span id="cb218-4"><a href="functional-analysis-1.html#cb218-4" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CrossReferencing</span>(mSet, <span class="st">&quot;name&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “Loaded files from MetaboAnalyst web-server.”
[1] “1”<br />
[2] “Name matching OK, please inspect (and manual correct) the results then proceed.”</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="functional-analysis-1.html#cb219-1" tabindex="-1"></a><span class="do">## Creates a mapping result table shows HMDB, KEGG, PubChem, etc. IDs. Saved as &quot;name_map.csv&quot; or can be found in mSet$dataSet$map.table. Compounds with no hits will contain NAs across the columns.</span></span>
<span id="cb219-2"><a href="functional-analysis-1.html#cb219-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CreateMappingResultTable</span>(mSet)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="functional-analysis-1.html#cb220-1" tabindex="-1"></a><span class="do">## Normalize</span></span>
<span id="cb220-2"><a href="functional-analysis-1.html#cb220-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PreparePrenormData</span>(mSet)</span>
<span id="cb220-3"><a href="functional-analysis-1.html#cb220-3" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">Normalization</span>(mSet, <span class="at">rowNorm =</span> <span class="st">&quot;SumNorm&quot;</span>, <span class="at">transNorm =</span> <span class="st">&quot;LogNorm&quot;</span>, <span class="at">scaleNorm =</span> <span class="st">&quot;ParetoNorm&quot;</span>)</span>
<span id="cb220-4"><a href="functional-analysis-1.html#cb220-4" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotNormSummary</span>(mSet, </span>
<span id="cb220-5"><a href="functional-analysis-1.html#cb220-5" tabindex="-1"></a>                        <span class="at">imgName =</span> <span class="st">&quot;./dataset/OutputFiles/kegg_pathnorm_0_&quot;</span>, </span>
<span id="cb220-6"><a href="functional-analysis-1.html#cb220-6" tabindex="-1"></a>                        <span class="at">format =</span> <span class="st">&quot;png&quot;</span>, <span class="at">dpi =</span> <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb220-7"><a href="functional-analysis-1.html#cb220-7" tabindex="-1"></a></span>
<span id="cb220-8"><a href="functional-analysis-1.html#cb220-8" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/kegg_pathnorm_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/kegg_pathnorm_0_dpi250.png" width="1312" /></p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="functional-analysis-1.html#cb221-1" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">PlotSampleNormSummary</span>(mSet, <span class="st">&quot;./dataset/OutputFiles/kegg_pathsnorm_0_&quot;</span>, <span class="st">&quot;png&quot;</span>, <span class="dv">250</span>, <span class="at">width=</span><span class="cn">NA</span>)</span>
<span id="cb221-2"><a href="functional-analysis-1.html#cb221-2" tabindex="-1"></a></span>
<span id="cb221-3"><a href="functional-analysis-1.html#cb221-3" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/kegg_pathsnorm_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/kegg_pathsnorm_0_dpi250.png" width="1312" /></p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="functional-analysis-1.html#cb222-1" tabindex="-1"></a><span class="do">## Enrich to KEGG</span></span>
<span id="cb222-2"><a href="functional-analysis-1.html#cb222-2" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetKEGG.PathLib</span>(mSet, <span class="st">&quot;hsa&quot;</span>, <span class="st">&quot;current&quot;</span>)</span>
<span id="cb222-3"><a href="functional-analysis-1.html#cb222-3" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">SetMetabolomeFilter</span>(mSet, F)</span>
<span id="cb222-4"><a href="functional-analysis-1.html#cb222-4" tabindex="-1"></a>mSet <span class="ot">&lt;-</span> <span class="fu">CalculateQeaScore</span>(mSet, <span class="st">&quot;rbc&quot;</span>, <span class="st">&quot;gt&quot;</span>)</span></code></pre></div>
<p>[1] “Loaded files from MetaboAnalyst web-server.”
[1] “<a href="http://api.xialab.ca/pathwayqea" class="uri">http://api.xialab.ca/pathwayqea</a>”
[1] “Failed to connect to Xia Lab API Server!”</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="functional-analysis-1.html#cb223-1" tabindex="-1"></a><span class="co"># pathway_res &lt;- read.csv(&#39;./pathway_results.csv&#39;, check.names = FALSE)</span></span>
<span id="cb223-2"><a href="functional-analysis-1.html#cb223-2" tabindex="-1"></a></span>
<span id="cb223-3"><a href="functional-analysis-1.html#cb223-3" tabindex="-1"></a><span class="co"># knitr::kable(head(pathway_res))</span></span>
<span id="cb223-4"><a href="functional-analysis-1.html#cb223-4" tabindex="-1"></a></span>
<span id="cb223-5"><a href="functional-analysis-1.html#cb223-5" tabindex="-1"></a><span class="co"># mSet &lt;- PlotPathSummary(mSet, F, &quot;./dataset/OutputFiles/kegg_path_view_0_&quot;, &quot;png&quot;, 250, width=NA, NA, NA )</span></span>
<span id="cb223-6"><a href="functional-analysis-1.html#cb223-6" tabindex="-1"></a></span>
<span id="cb223-7"><a href="functional-analysis-1.html#cb223-7" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">include_graphics</span>(<span class="st">&#39;./dataset/OutputFiles/kegg_path_view_0_dpi250.png&#39;</span>)</span></code></pre></div>
<p><img src="dataset/OutputFiles/kegg_path_view_0_dpi250.png" width="875" /></p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="functional-analysis-1.html#cb224-1" tabindex="-1"></a><span class="do">## Plot specified pathway map</span></span>
<span id="cb224-2"><a href="functional-analysis-1.html#cb224-2" tabindex="-1"></a><span class="co"># mSet &lt;- PlotKEGGPath(mSet, &quot;Phenylalanine, tyrosine and tryptophan biosynthesis&quot;,576, 480, &quot;png&quot;, NULL)</span></span>
<span id="cb224-3"><a href="functional-analysis-1.html#cb224-3" tabindex="-1"></a><span class="co"># mSet &lt;- RerenderMetPAGraph(mSet, &quot;zoom1658398230135.png&quot;,576.0, 480.0, 100.0)</span></span>
<span id="cb224-4"><a href="functional-analysis-1.html#cb224-4" tabindex="-1"></a><span class="co"># mSet &lt;- PlotKEGGPath(mSet, &quot;Glycine, serine and threonine metabolism&quot;,576, 480, &quot;png&quot;, NULL)</span></span></code></pre></div>
<hr />
</div>
</div>
<div id="functional-analysis-by-r-package" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Functional Analysis by R package<a href="functional-analysis-1.html#functional-analysis-by-r-package" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><p>Functional Analysis for DE metabolites</p>
<ul>
<li><p>ORA: Over Representive Analysis</p></li>
<li><p>GSEA: Gene Set Enrichment Analysis</p></li>
</ul></li>
</ul>
<div id="loading-r-packages" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Loading R packages<a href="functional-analysis-1.html#loading-r-packages" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="functional-analysis-1.html#cb225-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb225-2"><a href="functional-analysis-1.html#cb225-2" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb225-3"><a href="functional-analysis-1.html#cb225-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb225-4"><a href="functional-analysis-1.html#cb225-4" tabindex="-1"></a><span class="fu">library</span>(clusterProfiler)</span>
<span id="cb225-5"><a href="functional-analysis-1.html#cb225-5" tabindex="-1"></a><span class="fu">library</span>(org.Mm.eg.db)</span>
<span id="cb225-6"><a href="functional-analysis-1.html#cb225-6" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb225-7"><a href="functional-analysis-1.html#cb225-7" tabindex="-1"></a><span class="fu">library</span>(ropls)</span>
<span id="cb225-8"><a href="functional-analysis-1.html#cb225-8" tabindex="-1"></a><span class="fu">library</span>(Biobase)</span>
<span id="cb225-9"><a href="functional-analysis-1.html#cb225-9" tabindex="-1"></a><span class="fu">library</span>(SummarizedExperiment)</span>
<span id="cb225-10"><a href="functional-analysis-1.html#cb225-10" tabindex="-1"></a></span>
<span id="cb225-11"><a href="functional-analysis-1.html#cb225-11" tabindex="-1"></a><span class="fu">library</span>(massdatabase)</span>
<span id="cb225-12"><a href="functional-analysis-1.html#cb225-12" tabindex="-1"></a><span class="fu">library</span>(MicrobiomeProfiler)</span></code></pre></div>
</div>
<div id="importing-data-6" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Importing Data<a href="functional-analysis-1.html#importing-data-6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="functional-analysis-1.html#cb226-1" tabindex="-1"></a>ExprSet <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./dataset/POMA/ExprSet_raw.RDS&quot;</span>)</span>
<span id="cb226-2"><a href="functional-analysis-1.html#cb226-2" tabindex="-1"></a>se_impute <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./dataset/POMA/se_impute.RDS&quot;</span>)</span>
<span id="cb226-3"><a href="functional-analysis-1.html#cb226-3" tabindex="-1"></a>se_norm <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;./dataset/POMA/se_normalize.RDS&quot;</span>)</span></code></pre></div>
</div>
<div id="differential-analysis" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Differential Analysis<a href="functional-analysis-1.html#differential-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Fold change (group1 vs group2)</p>
<ul>
<li>RawData</li>
</ul></li>
<li><p>VIP (Variable influence on projection &amp; coefficient)</p>
<ul>
<li><p>Variable influence on projection (VIP) for orthogonal projections to latent structures (OPLS)</p></li>
<li><p>Variable influence on projection (VIP) for projections to latent structures (PLS)</p></li>
</ul></li>
<li><p>T-test</p>
<ul>
<li>significant differences between two groups (p value)</li>
</ul></li>
<li><p>Merging result</p>
<ul>
<li><p>Foldchange by Raw Data</p></li>
<li><p>VIP by Normalized Data</p></li>
<li><p>test Pvalue by Normalized Data</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="functional-analysis-1.html#cb227-1" tabindex="-1"></a>FoldChange <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb227-2"><a href="functional-analysis-1.html#cb227-2" tabindex="-1"></a>    x,</span>
<span id="cb227-3"><a href="functional-analysis-1.html#cb227-3" tabindex="-1"></a>    group,</span>
<span id="cb227-4"><a href="functional-analysis-1.html#cb227-4" tabindex="-1"></a>    group_names) {</span>
<span id="cb227-5"><a href="functional-analysis-1.html#cb227-5" tabindex="-1"></a>  </span>
<span id="cb227-6"><a href="functional-analysis-1.html#cb227-6" tabindex="-1"></a>  <span class="co"># dataseat</span></span>
<span id="cb227-7"><a href="functional-analysis-1.html#cb227-7" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb227-8"><a href="functional-analysis-1.html#cb227-8" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb227-9"><a href="functional-analysis-1.html#cb227-9" tabindex="-1"></a>  profile <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb227-10"><a href="functional-analysis-1.html#cb227-10" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb227-11"><a href="functional-analysis-1.html#cb227-11" tabindex="-1"></a></span>
<span id="cb227-12"><a href="functional-analysis-1.html#cb227-12" tabindex="-1"></a>  <span class="fu">colnames</span>(metadata)[<span class="fu">which</span>(<span class="fu">colnames</span>(metadata) <span class="sc">==</span> group)] <span class="ot">&lt;-</span> <span class="st">&quot;CompVar&quot;</span></span>
<span id="cb227-13"><a href="functional-analysis-1.html#cb227-13" tabindex="-1"></a>  phenotype <span class="ot">&lt;-</span> metadata <span class="sc">%&gt;%</span></span>
<span id="cb227-14"><a href="functional-analysis-1.html#cb227-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(CompVar <span class="sc">%in%</span> group_names) <span class="sc">%&gt;%</span></span>
<span id="cb227-15"><a href="functional-analysis-1.html#cb227-15" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CompVar =</span> <span class="fu">as.character</span>(CompVar)) <span class="sc">%&gt;%</span></span>
<span id="cb227-16"><a href="functional-analysis-1.html#cb227-16" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CompVar =</span> <span class="fu">factor</span>(CompVar, <span class="at">levels =</span> group_names))</span>
<span id="cb227-17"><a href="functional-analysis-1.html#cb227-17" tabindex="-1"></a>  </span>
<span id="cb227-18"><a href="functional-analysis-1.html#cb227-18" tabindex="-1"></a>  sid <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">rownames</span>(phenotype), <span class="fu">colnames</span>(profile))</span>
<span id="cb227-19"><a href="functional-analysis-1.html#cb227-19" tabindex="-1"></a>  phen <span class="ot">&lt;-</span> phenotype[<span class="fu">pmatch</span>(sid, <span class="fu">rownames</span>(phenotype)), , ]</span>
<span id="cb227-20"><a href="functional-analysis-1.html#cb227-20" tabindex="-1"></a>  prof <span class="ot">&lt;-</span> profile <span class="sc">%&gt;%</span></span>
<span id="cb227-21"><a href="functional-analysis-1.html#cb227-21" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sid))</span>
<span id="cb227-22"><a href="functional-analysis-1.html#cb227-22" tabindex="-1"></a>  </span>
<span id="cb227-23"><a href="functional-analysis-1.html#cb227-23" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">colnames</span>(prof) <span class="sc">==</span> <span class="fu">rownames</span>(phen))) {</span>
<span id="cb227-24"><a href="functional-analysis-1.html#cb227-24" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Wrong Order&quot;</span>)</span>
<span id="cb227-25"><a href="functional-analysis-1.html#cb227-25" tabindex="-1"></a>  }</span>
<span id="cb227-26"><a href="functional-analysis-1.html#cb227-26" tabindex="-1"></a>  </span>
<span id="cb227-27"><a href="functional-analysis-1.html#cb227-27" tabindex="-1"></a>  fc_res <span class="ot">&lt;-</span> <span class="fu">apply</span>(prof, <span class="dv">1</span>, <span class="cf">function</span>(x1, y1) {</span>
<span id="cb227-28"><a href="functional-analysis-1.html#cb227-28" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(x1), <span class="at">group =</span> y1)</span>
<span id="cb227-29"><a href="functional-analysis-1.html#cb227-29" tabindex="-1"></a>    mn <span class="ot">&lt;-</span> <span class="fu">tapply</span>(dat<span class="sc">$</span>value, dat<span class="sc">$</span>group, <span class="cf">function</span>(x){</span>
<span id="cb227-30"><a href="functional-analysis-1.html#cb227-30" tabindex="-1"></a>      <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb227-31"><a href="functional-analysis-1.html#cb227-31" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span></span>
<span id="cb227-32"><a href="functional-analysis-1.html#cb227-32" tabindex="-1"></a>      <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb227-33"><a href="functional-analysis-1.html#cb227-33" tabindex="-1"></a>      stats<span class="sc">::</span><span class="fu">setNames</span>(<span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb227-34"><a href="functional-analysis-1.html#cb227-34" tabindex="-1"></a>      tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;Group&quot;</span>)</span>
<span id="cb227-35"><a href="functional-analysis-1.html#cb227-35" tabindex="-1"></a></span>
<span id="cb227-36"><a href="functional-analysis-1.html#cb227-36" tabindex="-1"></a>    mn1 <span class="ot">&lt;-</span> <span class="fu">with</span>(mn, mn[Group <span class="sc">%in%</span> group_names[<span class="dv">1</span>], <span class="st">&quot;value&quot;</span>])</span>
<span id="cb227-37"><a href="functional-analysis-1.html#cb227-37" tabindex="-1"></a>    mn2 <span class="ot">&lt;-</span> <span class="fu">with</span>(mn, mn[Group <span class="sc">%in%</span> group_names[<span class="dv">2</span>], <span class="st">&quot;value&quot;</span>])</span>
<span id="cb227-38"><a href="functional-analysis-1.html#cb227-38" tabindex="-1"></a>    mnall <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>value, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb227-39"><a href="functional-analysis-1.html#cb227-39" tabindex="-1"></a>    </span>
<span id="cb227-40"><a href="functional-analysis-1.html#cb227-40" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(mn1 <span class="sc">!=</span> <span class="dv">0</span>, mn2 <span class="sc">!=</span> <span class="dv">0</span>)) {</span>
<span id="cb227-41"><a href="functional-analysis-1.html#cb227-41" tabindex="-1"></a>      fc <span class="ot">&lt;-</span> mn1 <span class="sc">/</span> mn2</span>
<span id="cb227-42"><a href="functional-analysis-1.html#cb227-42" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb227-43"><a href="functional-analysis-1.html#cb227-43" tabindex="-1"></a>      fc <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb227-44"><a href="functional-analysis-1.html#cb227-44" tabindex="-1"></a>    }</span>
<span id="cb227-45"><a href="functional-analysis-1.html#cb227-45" tabindex="-1"></a>    </span>
<span id="cb227-46"><a href="functional-analysis-1.html#cb227-46" tabindex="-1"></a>    logfc <span class="ot">&lt;-</span> <span class="fu">log2</span>(fc)</span>
<span id="cb227-47"><a href="functional-analysis-1.html#cb227-47" tabindex="-1"></a></span>
<span id="cb227-48"><a href="functional-analysis-1.html#cb227-48" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(fc, logfc, mnall, mn1, mn2)</span>
<span id="cb227-49"><a href="functional-analysis-1.html#cb227-49" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb227-50"><a href="functional-analysis-1.html#cb227-50" tabindex="-1"></a>  }, phen<span class="sc">$</span>CompVar) <span class="sc">%&gt;%</span></span>
<span id="cb227-51"><a href="functional-analysis-1.html#cb227-51" tabindex="-1"></a>    base<span class="sc">::</span><span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb227-52"><a href="functional-analysis-1.html#cb227-52" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;Feature&quot;</span>)</span>
<span id="cb227-53"><a href="functional-analysis-1.html#cb227-53" tabindex="-1"></a>  </span>
<span id="cb227-54"><a href="functional-analysis-1.html#cb227-54" tabindex="-1"></a>  <span class="fu">colnames</span>(fc_res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FeatureID&quot;</span>, <span class="st">&quot;FoldChange&quot;</span>, </span>
<span id="cb227-55"><a href="functional-analysis-1.html#cb227-55" tabindex="-1"></a>                        <span class="st">&quot;Log2FoldChange&quot;</span>,</span>
<span id="cb227-56"><a href="functional-analysis-1.html#cb227-56" tabindex="-1"></a>                        <span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">(All)&quot;</span>,</span>
<span id="cb227-57"><a href="functional-analysis-1.html#cb227-57" tabindex="-1"></a>                     <span class="fu">paste0</span>(<span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;former&quot;</span>, <span class="st">&quot;latter&quot;</span>)))  </span>
<span id="cb227-58"><a href="functional-analysis-1.html#cb227-58" tabindex="-1"></a>  </span>
<span id="cb227-59"><a href="functional-analysis-1.html#cb227-59" tabindex="-1"></a>  <span class="co"># Number of Group</span></span>
<span id="cb227-60"><a href="functional-analysis-1.html#cb227-60" tabindex="-1"></a>  dat_status <span class="ot">&lt;-</span> <span class="fu">table</span>(phen<span class="sc">$</span>CompVar)</span>
<span id="cb227-61"><a href="functional-analysis-1.html#cb227-61" tabindex="-1"></a>  dat_status_number <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat_status)</span>
<span id="cb227-62"><a href="functional-analysis-1.html#cb227-62" tabindex="-1"></a>  dat_status_name <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_status)</span>
<span id="cb227-63"><a href="functional-analysis-1.html#cb227-63" tabindex="-1"></a>  fc_res<span class="sc">$</span>Block <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">paste</span>(dat_status_number[<span class="dv">1</span>], dat_status_name[<span class="dv">1</span>], <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb227-64"><a href="functional-analysis-1.html#cb227-64" tabindex="-1"></a>                       <span class="st">&quot;vs&quot;</span>,</span>
<span id="cb227-65"><a href="functional-analysis-1.html#cb227-65" tabindex="-1"></a>                       <span class="fu">paste</span>(dat_status_number[<span class="dv">2</span>], dat_status_name[<span class="dv">2</span>], <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb227-66"><a href="functional-analysis-1.html#cb227-66" tabindex="-1"></a>  </span>
<span id="cb227-67"><a href="functional-analysis-1.html#cb227-67" tabindex="-1"></a>  res <span class="ot">&lt;-</span> fc_res <span class="sc">%&gt;%</span></span>
<span id="cb227-68"><a href="functional-analysis-1.html#cb227-68" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(FeatureID, Block, <span class="fu">everything</span>())    </span>
<span id="cb227-69"><a href="functional-analysis-1.html#cb227-69" tabindex="-1"></a></span>
<span id="cb227-70"><a href="functional-analysis-1.html#cb227-70" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb227-71"><a href="functional-analysis-1.html#cb227-71" tabindex="-1"></a>}</span>
<span id="cb227-72"><a href="functional-analysis-1.html#cb227-72" tabindex="-1"></a></span>
<span id="cb227-73"><a href="functional-analysis-1.html#cb227-73" tabindex="-1"></a>VIP_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb227-74"><a href="functional-analysis-1.html#cb227-74" tabindex="-1"></a>    x,</span>
<span id="cb227-75"><a href="functional-analysis-1.html#cb227-75" tabindex="-1"></a>    group,</span>
<span id="cb227-76"><a href="functional-analysis-1.html#cb227-76" tabindex="-1"></a>    group_names,</span>
<span id="cb227-77"><a href="functional-analysis-1.html#cb227-77" tabindex="-1"></a>    <span class="at">VIPtype =</span> <span class="fu">c</span>(<span class="st">&quot;OPLS&quot;</span>, <span class="st">&quot;PLS&quot;</span>),</span>
<span id="cb227-78"><a href="functional-analysis-1.html#cb227-78" tabindex="-1"></a>    <span class="at">vip_cutoff =</span> <span class="dv">1</span>) {</span>
<span id="cb227-79"><a href="functional-analysis-1.html#cb227-79" tabindex="-1"></a>  </span>
<span id="cb227-80"><a href="functional-analysis-1.html#cb227-80" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb227-81"><a href="functional-analysis-1.html#cb227-81" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb227-82"><a href="functional-analysis-1.html#cb227-82" tabindex="-1"></a>  profile <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb227-83"><a href="functional-analysis-1.html#cb227-83" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb227-84"><a href="functional-analysis-1.html#cb227-84" tabindex="-1"></a></span>
<span id="cb227-85"><a href="functional-analysis-1.html#cb227-85" tabindex="-1"></a>  <span class="fu">colnames</span>(metadata)[<span class="fu">which</span>(<span class="fu">colnames</span>(metadata) <span class="sc">==</span> group)] <span class="ot">&lt;-</span> <span class="st">&quot;CompVar&quot;</span></span>
<span id="cb227-86"><a href="functional-analysis-1.html#cb227-86" tabindex="-1"></a>  phenotype <span class="ot">&lt;-</span> metadata <span class="sc">%&gt;%</span></span>
<span id="cb227-87"><a href="functional-analysis-1.html#cb227-87" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(CompVar <span class="sc">%in%</span> group_names) <span class="sc">%&gt;%</span></span>
<span id="cb227-88"><a href="functional-analysis-1.html#cb227-88" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CompVar =</span> <span class="fu">as.character</span>(CompVar)) <span class="sc">%&gt;%</span></span>
<span id="cb227-89"><a href="functional-analysis-1.html#cb227-89" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CompVar =</span> <span class="fu">factor</span>(CompVar, <span class="at">levels =</span> group_names))</span>
<span id="cb227-90"><a href="functional-analysis-1.html#cb227-90" tabindex="-1"></a>  </span>
<span id="cb227-91"><a href="functional-analysis-1.html#cb227-91" tabindex="-1"></a>  sid <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">rownames</span>(phenotype), <span class="fu">colnames</span>(profile))</span>
<span id="cb227-92"><a href="functional-analysis-1.html#cb227-92" tabindex="-1"></a>  phen <span class="ot">&lt;-</span> phenotype[<span class="fu">pmatch</span>(sid, <span class="fu">rownames</span>(phenotype)), , ]</span>
<span id="cb227-93"><a href="functional-analysis-1.html#cb227-93" tabindex="-1"></a>  prof <span class="ot">&lt;-</span> profile <span class="sc">%&gt;%</span></span>
<span id="cb227-94"><a href="functional-analysis-1.html#cb227-94" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sid))</span>
<span id="cb227-95"><a href="functional-analysis-1.html#cb227-95" tabindex="-1"></a>  </span>
<span id="cb227-96"><a href="functional-analysis-1.html#cb227-96" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">colnames</span>(prof) <span class="sc">==</span> <span class="fu">rownames</span>(phen))) {</span>
<span id="cb227-97"><a href="functional-analysis-1.html#cb227-97" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Wrong Order&quot;</span>)</span>
<span id="cb227-98"><a href="functional-analysis-1.html#cb227-98" tabindex="-1"></a>  }</span>
<span id="cb227-99"><a href="functional-analysis-1.html#cb227-99" tabindex="-1"></a>  </span>
<span id="cb227-100"><a href="functional-analysis-1.html#cb227-100" tabindex="-1"></a>  dataMatrix <span class="ot">&lt;-</span> prof <span class="sc">%&gt;%</span> base<span class="sc">::</span><span class="fu">t</span>() <span class="co"># row-&gt;sampleID; col-&gt;features</span></span>
<span id="cb227-101"><a href="functional-analysis-1.html#cb227-101" tabindex="-1"></a>  sampleMetadata <span class="ot">&lt;-</span> phen <span class="co"># row-&gt;sampleID; col-&gt;features</span></span>
<span id="cb227-102"><a href="functional-analysis-1.html#cb227-102" tabindex="-1"></a>  </span>
<span id="cb227-103"><a href="functional-analysis-1.html#cb227-103" tabindex="-1"></a>  comparsionVn <span class="ot">&lt;-</span> sampleMetadata[, <span class="st">&quot;CompVar&quot;</span>]</span>
<span id="cb227-104"><a href="functional-analysis-1.html#cb227-104" tabindex="-1"></a>  </span>
<span id="cb227-105"><a href="functional-analysis-1.html#cb227-105" tabindex="-1"></a>  <span class="co"># corrlation between group and features</span></span>
<span id="cb227-106"><a href="functional-analysis-1.html#cb227-106" tabindex="-1"></a>  pvaVn <span class="ot">&lt;-</span> <span class="fu">apply</span>(dataMatrix, <span class="dv">2</span>,</span>
<span id="cb227-107"><a href="functional-analysis-1.html#cb227-107" tabindex="-1"></a>                 <span class="cf">function</span>(feaVn) <span class="fu">cor.test</span>(<span class="fu">as.numeric</span>(comparsionVn), feaVn)[[<span class="st">&quot;p.value&quot;</span>]])</span>
<span id="cb227-108"><a href="functional-analysis-1.html#cb227-108" tabindex="-1"></a>  </span>
<span id="cb227-109"><a href="functional-analysis-1.html#cb227-109" tabindex="-1"></a>  <span class="cf">if</span> (VIPtype <span class="sc">==</span> <span class="st">&quot;OPLS&quot;</span>) {</span>
<span id="cb227-110"><a href="functional-analysis-1.html#cb227-110" tabindex="-1"></a>    vipVn <span class="ot">&lt;-</span> <span class="fu">getVipVn</span>(<span class="fu">opls</span>(dataMatrix, </span>
<span id="cb227-111"><a href="functional-analysis-1.html#cb227-111" tabindex="-1"></a>                           comparsionVn,</span>
<span id="cb227-112"><a href="functional-analysis-1.html#cb227-112" tabindex="-1"></a>                           <span class="at">predI =</span> <span class="dv">1</span>, </span>
<span id="cb227-113"><a href="functional-analysis-1.html#cb227-113" tabindex="-1"></a>                           <span class="at">orthoI =</span> <span class="cn">NA</span>,</span>
<span id="cb227-114"><a href="functional-analysis-1.html#cb227-114" tabindex="-1"></a>                           <span class="at">fig.pdfC =</span> <span class="st">&quot;none&quot;</span>))    </span>
<span id="cb227-115"><a href="functional-analysis-1.html#cb227-115" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb227-116"><a href="functional-analysis-1.html#cb227-116" tabindex="-1"></a>    vipVn <span class="ot">&lt;-</span> <span class="fu">getVipVn</span>(<span class="fu">opls</span>(dataMatrix, </span>
<span id="cb227-117"><a href="functional-analysis-1.html#cb227-117" tabindex="-1"></a>                           comparsionVn,</span>
<span id="cb227-118"><a href="functional-analysis-1.html#cb227-118" tabindex="-1"></a>                           <span class="at">predI =</span> <span class="dv">1</span>, </span>
<span id="cb227-119"><a href="functional-analysis-1.html#cb227-119" tabindex="-1"></a>                           <span class="at">fig.pdfC =</span> <span class="st">&quot;none&quot;</span>))    </span>
<span id="cb227-120"><a href="functional-analysis-1.html#cb227-120" tabindex="-1"></a>  }</span>
<span id="cb227-121"><a href="functional-analysis-1.html#cb227-121" tabindex="-1"></a>  quantVn <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> pvaVn <span class="sc">/</span> <span class="dv">2</span>)</span>
<span id="cb227-122"><a href="functional-analysis-1.html#cb227-122" tabindex="-1"></a>  rmsQuantN <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(quantVn<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb227-123"><a href="functional-analysis-1.html#cb227-123" tabindex="-1"></a>  </span>
<span id="cb227-124"><a href="functional-analysis-1.html#cb227-124" tabindex="-1"></a>  opar <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">font =</span> <span class="dv">2</span>, <span class="at">font.axis =</span> <span class="dv">2</span>, <span class="at">font.lab =</span> <span class="dv">2</span>,</span>
<span id="cb227-125"><a href="functional-analysis-1.html#cb227-125" tabindex="-1"></a>              <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb227-126"><a href="functional-analysis-1.html#cb227-126" tabindex="-1"></a>              <span class="at">mar =</span> <span class="fu">c</span>(<span class="fl">5.1</span>, <span class="fl">4.6</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>),</span>
<span id="cb227-127"><a href="functional-analysis-1.html#cb227-127" tabindex="-1"></a>              <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">pch =</span> <span class="dv">16</span>)</span>
<span id="cb227-128"><a href="functional-analysis-1.html#cb227-128" tabindex="-1"></a>  <span class="fu">plot</span>(pvaVn, </span>
<span id="cb227-129"><a href="functional-analysis-1.html#cb227-129" tabindex="-1"></a>       vipVn,</span>
<span id="cb227-130"><a href="functional-analysis-1.html#cb227-130" tabindex="-1"></a>       <span class="at">col =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb227-131"><a href="functional-analysis-1.html#cb227-131" tabindex="-1"></a>       <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb227-132"><a href="functional-analysis-1.html#cb227-132" tabindex="-1"></a>       <span class="at">xlab =</span> <span class="st">&quot;p-value&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;VIP&quot;</span>, <span class="at">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="at">yaxs =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb227-133"><a href="functional-analysis-1.html#cb227-133" tabindex="-1"></a>  <span class="fu">box</span>(<span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb227-134"><a href="functional-analysis-1.html#cb227-134" tabindex="-1"></a>  <span class="fu">curve</span>(<span class="fu">qnorm</span>(<span class="dv">1</span> <span class="sc">-</span> x <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">/</span> rmsQuantN, <span class="dv">0</span>, <span class="dv">1</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb227-135"><a href="functional-analysis-1.html#cb227-135" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb227-136"><a href="functional-analysis-1.html#cb227-136" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.05</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span>
<span id="cb227-137"><a href="functional-analysis-1.html#cb227-137" tabindex="-1"></a>  </span>
<span id="cb227-138"><a href="functional-analysis-1.html#cb227-138" tabindex="-1"></a>  res_temp <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb227-139"><a href="functional-analysis-1.html#cb227-139" tabindex="-1"></a>      <span class="at">FeatureID =</span> <span class="fu">names</span>(vipVn),</span>
<span id="cb227-140"><a href="functional-analysis-1.html#cb227-140" tabindex="-1"></a>      <span class="at">VIP =</span> vipVn,</span>
<span id="cb227-141"><a href="functional-analysis-1.html#cb227-141" tabindex="-1"></a>      <span class="at">CorPvalue =</span> pvaVn) <span class="sc">%&gt;%</span></span>
<span id="cb227-142"><a href="functional-analysis-1.html#cb227-142" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(VIP))</span>
<span id="cb227-143"><a href="functional-analysis-1.html#cb227-143" tabindex="-1"></a></span>
<span id="cb227-144"><a href="functional-analysis-1.html#cb227-144" tabindex="-1"></a>  vip_select <span class="ot">&lt;-</span> res_temp <span class="sc">%&gt;%</span></span>
<span id="cb227-145"><a href="functional-analysis-1.html#cb227-145" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(VIP <span class="sc">&gt;</span> vip_cutoff) </span>
<span id="cb227-146"><a href="functional-analysis-1.html#cb227-146" tabindex="-1"></a>  </span>
<span id="cb227-147"><a href="functional-analysis-1.html#cb227-147" tabindex="-1"></a>  pl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(vip_select, <span class="fu">aes</span>(FeatureID, VIP)) <span class="sc">+</span></span>
<span id="cb227-148"><a href="functional-analysis-1.html#cb227-148" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> FeatureID, <span class="at">xend =</span> FeatureID,</span>
<span id="cb227-149"><a href="functional-analysis-1.html#cb227-149" tabindex="-1"></a>                     <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> VIP)) <span class="sc">+</span></span>
<span id="cb227-150"><a href="functional-analysis-1.html#cb227-150" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&#39;#008000&#39;</span> ,<span class="at">fill =</span> <span class="st">&#39;#008000&#39;</span>) <span class="sc">+</span></span>
<span id="cb227-151"><a href="functional-analysis-1.html#cb227-151" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="dv">1</span>,<span class="fl">2.5</span>), <span class="at">color =</span> <span class="st">&#39;white&#39;</span>) <span class="sc">+</span></span>
<span id="cb227-152"><a href="functional-analysis-1.html#cb227-152" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&#39;dashed&#39;</span>) <span class="sc">+</span></span>
<span id="cb227-153"><a href="functional-analysis-1.html#cb227-153" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb227-154"><a href="functional-analysis-1.html#cb227-154" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;&#39;</span>, <span class="at">y =</span> <span class="st">&#39;VIP value&#39;</span>) <span class="sc">+</span></span>
<span id="cb227-155"><a href="functional-analysis-1.html#cb227-155" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb227-156"><a href="functional-analysis-1.html#cb227-156" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;none&#39;</span>,</span>
<span id="cb227-157"><a href="functional-analysis-1.html#cb227-157" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&#39;black&#39;</span>,<span class="at">size =</span> <span class="dv">12</span>, <span class="at">family =</span> <span class="st">&#39;Arial&#39;</span>, <span class="at">face =</span> <span class="st">&#39;plain&#39;</span>),</span>
<span id="cb227-158"><a href="functional-analysis-1.html#cb227-158" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb227-159"><a href="functional-analysis-1.html#cb227-159" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb227-160"><a href="functional-analysis-1.html#cb227-160" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&#39;black&#39;</span>,<span class="at">size =</span> <span class="dv">15</span>, <span class="at">family =</span> <span class="st">&#39;Arial&#39;</span>, <span class="at">face =</span> <span class="st">&#39;plain&#39;</span>),</span>
<span id="cb227-161"><a href="functional-analysis-1.html#cb227-161" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb227-162"><a href="functional-analysis-1.html#cb227-162" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&#39;black&#39;</span>,<span class="at">size =</span> <span class="dv">15</span>, <span class="at">family =</span> <span class="st">&#39;Arial&#39;</span>, <span class="at">face =</span> <span class="st">&#39;plain&#39;</span>),</span>
<span id="cb227-163"><a href="functional-analysis-1.html#cb227-163" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&#39;black&#39;</span>),</span>
<span id="cb227-164"><a href="functional-analysis-1.html#cb227-164" tabindex="-1"></a>          <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb227-165"><a href="functional-analysis-1.html#cb227-165" tabindex="-1"></a>  </span>
<span id="cb227-166"><a href="functional-analysis-1.html#cb227-166" tabindex="-1"></a>  <span class="co"># Number of Group</span></span>
<span id="cb227-167"><a href="functional-analysis-1.html#cb227-167" tabindex="-1"></a>  dat_status <span class="ot">&lt;-</span> <span class="fu">table</span>(phen<span class="sc">$</span>CompVar)</span>
<span id="cb227-168"><a href="functional-analysis-1.html#cb227-168" tabindex="-1"></a>  dat_status_number <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat_status)</span>
<span id="cb227-169"><a href="functional-analysis-1.html#cb227-169" tabindex="-1"></a>  dat_status_name <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_status)</span>
<span id="cb227-170"><a href="functional-analysis-1.html#cb227-170" tabindex="-1"></a>  res_temp<span class="sc">$</span>Block <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">paste</span>(dat_status_number[<span class="dv">1</span>], dat_status_name[<span class="dv">1</span>], <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb227-171"><a href="functional-analysis-1.html#cb227-171" tabindex="-1"></a>                       <span class="st">&quot;vs&quot;</span>,</span>
<span id="cb227-172"><a href="functional-analysis-1.html#cb227-172" tabindex="-1"></a>                       <span class="fu">paste</span>(dat_status_number[<span class="dv">2</span>], dat_status_name[<span class="dv">2</span>], <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb227-173"><a href="functional-analysis-1.html#cb227-173" tabindex="-1"></a></span>
<span id="cb227-174"><a href="functional-analysis-1.html#cb227-174" tabindex="-1"></a>  res_df <span class="ot">&lt;-</span> res_temp <span class="sc">%&gt;%</span></span>
<span id="cb227-175"><a href="functional-analysis-1.html#cb227-175" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(FeatureID, Block, <span class="fu">everything</span>())    </span>
<span id="cb227-176"><a href="functional-analysis-1.html#cb227-176" tabindex="-1"></a></span>
<span id="cb227-177"><a href="functional-analysis-1.html#cb227-177" tabindex="-1"></a></span>
<span id="cb227-178"><a href="functional-analysis-1.html#cb227-178" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">vip =</span> res_df,</span>
<span id="cb227-179"><a href="functional-analysis-1.html#cb227-179" tabindex="-1"></a>              <span class="at">plot =</span> pl)</span>
<span id="cb227-180"><a href="functional-analysis-1.html#cb227-180" tabindex="-1"></a>  </span>
<span id="cb227-181"><a href="functional-analysis-1.html#cb227-181" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb227-182"><a href="functional-analysis-1.html#cb227-182" tabindex="-1"></a>}</span>
<span id="cb227-183"><a href="functional-analysis-1.html#cb227-183" tabindex="-1"></a></span>
<span id="cb227-184"><a href="functional-analysis-1.html#cb227-184" tabindex="-1"></a>t_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb227-185"><a href="functional-analysis-1.html#cb227-185" tabindex="-1"></a>    x,</span>
<span id="cb227-186"><a href="functional-analysis-1.html#cb227-186" tabindex="-1"></a>    group,</span>
<span id="cb227-187"><a href="functional-analysis-1.html#cb227-187" tabindex="-1"></a>    group_names) {</span>
<span id="cb227-188"><a href="functional-analysis-1.html#cb227-188" tabindex="-1"></a>  </span>
<span id="cb227-189"><a href="functional-analysis-1.html#cb227-189" tabindex="-1"></a>  <span class="co"># dataseat</span></span>
<span id="cb227-190"><a href="functional-analysis-1.html#cb227-190" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb227-191"><a href="functional-analysis-1.html#cb227-191" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb227-192"><a href="functional-analysis-1.html#cb227-192" tabindex="-1"></a>  profile <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(x) <span class="sc">%&gt;%</span></span>
<span id="cb227-193"><a href="functional-analysis-1.html#cb227-193" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb227-194"><a href="functional-analysis-1.html#cb227-194" tabindex="-1"></a></span>
<span id="cb227-195"><a href="functional-analysis-1.html#cb227-195" tabindex="-1"></a>  <span class="co"># rename variables</span></span>
<span id="cb227-196"><a href="functional-analysis-1.html#cb227-196" tabindex="-1"></a>  <span class="fu">colnames</span>(metadata)[<span class="fu">which</span>(<span class="fu">colnames</span>(metadata) <span class="sc">==</span> group)] <span class="ot">&lt;-</span> <span class="st">&quot;CompVar&quot;</span> </span>
<span id="cb227-197"><a href="functional-analysis-1.html#cb227-197" tabindex="-1"></a>  </span>
<span id="cb227-198"><a href="functional-analysis-1.html#cb227-198" tabindex="-1"></a>  phenotype <span class="ot">&lt;-</span> metadata <span class="sc">%&gt;%</span></span>
<span id="cb227-199"><a href="functional-analysis-1.html#cb227-199" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(CompVar <span class="sc">%in%</span> group_names) <span class="sc">%&gt;%</span></span>
<span id="cb227-200"><a href="functional-analysis-1.html#cb227-200" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CompVar =</span> <span class="fu">as.character</span>(CompVar)) <span class="sc">%&gt;%</span></span>
<span id="cb227-201"><a href="functional-analysis-1.html#cb227-201" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CompVar =</span> <span class="fu">factor</span>(CompVar, <span class="at">levels =</span> group_names))</span>
<span id="cb227-202"><a href="functional-analysis-1.html#cb227-202" tabindex="-1"></a>  </span>
<span id="cb227-203"><a href="functional-analysis-1.html#cb227-203" tabindex="-1"></a>  sid <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">rownames</span>(phenotype), <span class="fu">colnames</span>(profile))</span>
<span id="cb227-204"><a href="functional-analysis-1.html#cb227-204" tabindex="-1"></a>  phen <span class="ot">&lt;-</span> phenotype[<span class="fu">pmatch</span>(sid, <span class="fu">rownames</span>(phenotype)), , ]</span>
<span id="cb227-205"><a href="functional-analysis-1.html#cb227-205" tabindex="-1"></a>  prof <span class="ot">&lt;-</span> profile <span class="sc">%&gt;%</span></span>
<span id="cb227-206"><a href="functional-analysis-1.html#cb227-206" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sid))</span>
<span id="cb227-207"><a href="functional-analysis-1.html#cb227-207" tabindex="-1"></a>  </span>
<span id="cb227-208"><a href="functional-analysis-1.html#cb227-208" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(<span class="fu">colnames</span>(prof) <span class="sc">==</span> <span class="fu">rownames</span>(phen))) {</span>
<span id="cb227-209"><a href="functional-analysis-1.html#cb227-209" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Wrong Order&quot;</span>)</span>
<span id="cb227-210"><a href="functional-analysis-1.html#cb227-210" tabindex="-1"></a>  }</span>
<span id="cb227-211"><a href="functional-analysis-1.html#cb227-211" tabindex="-1"></a></span>
<span id="cb227-212"><a href="functional-analysis-1.html#cb227-212" tabindex="-1"></a>  t_res <span class="ot">&lt;-</span> <span class="fu">apply</span>(prof, <span class="dv">1</span>, <span class="cf">function</span>(x1, y1) {</span>
<span id="cb227-213"><a href="functional-analysis-1.html#cb227-213" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(x1), <span class="at">group =</span> y1)</span>
<span id="cb227-214"><a href="functional-analysis-1.html#cb227-214" tabindex="-1"></a>    </span>
<span id="cb227-215"><a href="functional-analysis-1.html#cb227-215" tabindex="-1"></a>    rest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(<span class="at">data =</span> dat, value <span class="sc">~</span> group)</span>
<span id="cb227-216"><a href="functional-analysis-1.html#cb227-216" tabindex="-1"></a></span>
<span id="cb227-217"><a href="functional-analysis-1.html#cb227-217" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">c</span>(rest<span class="sc">$</span>statistic, rest<span class="sc">$</span>p.value)</span>
<span id="cb227-218"><a href="functional-analysis-1.html#cb227-218" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb227-219"><a href="functional-analysis-1.html#cb227-219" tabindex="-1"></a>  }, phen<span class="sc">$</span>CompVar) <span class="sc">%&gt;%</span></span>
<span id="cb227-220"><a href="functional-analysis-1.html#cb227-220" tabindex="-1"></a>    base<span class="sc">::</span><span class="fu">t</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb227-221"><a href="functional-analysis-1.html#cb227-221" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;Feature&quot;</span>)</span>
<span id="cb227-222"><a href="functional-analysis-1.html#cb227-222" tabindex="-1"></a>  </span>
<span id="cb227-223"><a href="functional-analysis-1.html#cb227-223" tabindex="-1"></a>  <span class="fu">colnames</span>(t_res) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;FeatureID&quot;</span>, <span class="st">&quot;Statistic&quot;</span>, <span class="st">&quot;Pvalue&quot;</span>)</span>
<span id="cb227-224"><a href="functional-analysis-1.html#cb227-224" tabindex="-1"></a>  t_res<span class="sc">$</span>AdjustedPvalue <span class="ot">&lt;-</span> <span class="fu">p.adjust</span>(<span class="fu">as.numeric</span>(t_res<span class="sc">$</span>Pvalue), <span class="at">method =</span> <span class="st">&quot;BH&quot;</span>)</span>
<span id="cb227-225"><a href="functional-analysis-1.html#cb227-225" tabindex="-1"></a>  </span>
<span id="cb227-226"><a href="functional-analysis-1.html#cb227-226" tabindex="-1"></a>  <span class="co"># Number of Group</span></span>
<span id="cb227-227"><a href="functional-analysis-1.html#cb227-227" tabindex="-1"></a>  dat_status <span class="ot">&lt;-</span> <span class="fu">table</span>(phen<span class="sc">$</span>CompVar)</span>
<span id="cb227-228"><a href="functional-analysis-1.html#cb227-228" tabindex="-1"></a>  dat_status_number <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(dat_status)</span>
<span id="cb227-229"><a href="functional-analysis-1.html#cb227-229" tabindex="-1"></a>  dat_status_name <span class="ot">&lt;-</span> <span class="fu">names</span>(dat_status)</span>
<span id="cb227-230"><a href="functional-analysis-1.html#cb227-230" tabindex="-1"></a>  t_res<span class="sc">$</span>Block <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">paste</span>(dat_status_number[<span class="dv">1</span>], dat_status_name[<span class="dv">1</span>], <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb227-231"><a href="functional-analysis-1.html#cb227-231" tabindex="-1"></a>                       <span class="st">&quot;vs&quot;</span>,</span>
<span id="cb227-232"><a href="functional-analysis-1.html#cb227-232" tabindex="-1"></a>                       <span class="fu">paste</span>(dat_status_number[<span class="dv">2</span>], dat_status_name[<span class="dv">2</span>], <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>))</span>
<span id="cb227-233"><a href="functional-analysis-1.html#cb227-233" tabindex="-1"></a>  </span>
<span id="cb227-234"><a href="functional-analysis-1.html#cb227-234" tabindex="-1"></a>  res <span class="ot">&lt;-</span> t_res <span class="sc">%&gt;%</span></span>
<span id="cb227-235"><a href="functional-analysis-1.html#cb227-235" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(FeatureID, Block, <span class="fu">everything</span>())    </span>
<span id="cb227-236"><a href="functional-analysis-1.html#cb227-236" tabindex="-1"></a></span>
<span id="cb227-237"><a href="functional-analysis-1.html#cb227-237" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb227-238"><a href="functional-analysis-1.html#cb227-238" tabindex="-1"></a>}</span>
<span id="cb227-239"><a href="functional-analysis-1.html#cb227-239" tabindex="-1"></a></span>
<span id="cb227-240"><a href="functional-analysis-1.html#cb227-240" tabindex="-1"></a>mergedResults <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb227-241"><a href="functional-analysis-1.html#cb227-241" tabindex="-1"></a>    fc_result,</span>
<span id="cb227-242"><a href="functional-analysis-1.html#cb227-242" tabindex="-1"></a>    vip_result,</span>
<span id="cb227-243"><a href="functional-analysis-1.html#cb227-243" tabindex="-1"></a>    test_result,</span>
<span id="cb227-244"><a href="functional-analysis-1.html#cb227-244" tabindex="-1"></a>    group_names,</span>
<span id="cb227-245"><a href="functional-analysis-1.html#cb227-245" tabindex="-1"></a>    group_labels) {</span>
<span id="cb227-246"><a href="functional-analysis-1.html#cb227-246" tabindex="-1"></a>  </span>
<span id="cb227-247"><a href="functional-analysis-1.html#cb227-247" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(vip_result)) {</span>
<span id="cb227-248"><a href="functional-analysis-1.html#cb227-248" tabindex="-1"></a>    mdat <span class="ot">&lt;-</span> fc_result <span class="sc">%&gt;%</span></span>
<span id="cb227-249"><a href="functional-analysis-1.html#cb227-249" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Block2 =</span> <span class="fu">paste</span>(group_labels, <span class="at">collapse =</span> <span class="st">&quot; vs &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb227-250"><a href="functional-analysis-1.html#cb227-250" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FeatureID =</span> <span class="fu">make.names</span>(FeatureID)) <span class="sc">%&gt;%</span></span>
<span id="cb227-251"><a href="functional-analysis-1.html#cb227-251" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">(All)&quot;</span>, </span>
<span id="cb227-252"><a href="functional-analysis-1.html#cb227-252" tabindex="-1"></a>                              <span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">former&quot;</span>, </span>
<span id="cb227-253"><a href="functional-analysis-1.html#cb227-253" tabindex="-1"></a>                              <span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">latter&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb227-254"><a href="functional-analysis-1.html#cb227-254" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(test_result <span class="sc">%&gt;%</span></span>
<span id="cb227-255"><a href="functional-analysis-1.html#cb227-255" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Block) <span class="sc">%&gt;%</span></span>
<span id="cb227-256"><a href="functional-analysis-1.html#cb227-256" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FeatureID =</span> <span class="fu">make.names</span>(FeatureID)),</span>
<span id="cb227-257"><a href="functional-analysis-1.html#cb227-257" tabindex="-1"></a>                        <span class="at">by =</span> <span class="st">&quot;FeatureID&quot;</span>) </span>
<span id="cb227-258"><a href="functional-analysis-1.html#cb227-258" tabindex="-1"></a>    </span>
<span id="cb227-259"><a href="functional-analysis-1.html#cb227-259" tabindex="-1"></a>    res <span class="ot">&lt;-</span> mdat <span class="sc">%&gt;%</span></span>
<span id="cb227-260"><a href="functional-analysis-1.html#cb227-260" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(FeatureID, Block2, Block,</span>
<span id="cb227-261"><a href="functional-analysis-1.html#cb227-261" tabindex="-1"></a>                    FoldChange, Log2FoldChange,</span>
<span id="cb227-262"><a href="functional-analysis-1.html#cb227-262" tabindex="-1"></a>                    Statistic, Pvalue, AdjustedPvalue,</span>
<span id="cb227-263"><a href="functional-analysis-1.html#cb227-263" tabindex="-1"></a>                    <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb227-264"><a href="functional-analysis-1.html#cb227-264" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(AdjustedPvalue, Log2FoldChange)    </span>
<span id="cb227-265"><a href="functional-analysis-1.html#cb227-265" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb227-266"><a href="functional-analysis-1.html#cb227-266" tabindex="-1"></a>    mdat <span class="ot">&lt;-</span> fc_result <span class="sc">%&gt;%</span></span>
<span id="cb227-267"><a href="functional-analysis-1.html#cb227-267" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Block2 =</span> <span class="fu">paste</span>(group_labels, <span class="at">collapse =</span> <span class="st">&quot; vs &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb227-268"><a href="functional-analysis-1.html#cb227-268" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FeatureID =</span> <span class="fu">make.names</span>(FeatureID)) <span class="sc">%&gt;%</span></span>
<span id="cb227-269"><a href="functional-analysis-1.html#cb227-269" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">(All)&quot;</span>, </span>
<span id="cb227-270"><a href="functional-analysis-1.html#cb227-270" tabindex="-1"></a>                              <span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">former&quot;</span>, </span>
<span id="cb227-271"><a href="functional-analysis-1.html#cb227-271" tabindex="-1"></a>                              <span class="st">&quot;Mean Abundance</span><span class="sc">\n</span><span class="st">latter&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb227-272"><a href="functional-analysis-1.html#cb227-272" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(vip_result <span class="sc">%&gt;%</span></span>
<span id="cb227-273"><a href="functional-analysis-1.html#cb227-273" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Block) <span class="sc">%&gt;%</span></span>
<span id="cb227-274"><a href="functional-analysis-1.html#cb227-274" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FeatureID =</span> <span class="fu">make.names</span>(FeatureID)),</span>
<span id="cb227-275"><a href="functional-analysis-1.html#cb227-275" tabindex="-1"></a>                        <span class="at">by =</span> <span class="st">&quot;FeatureID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb227-276"><a href="functional-analysis-1.html#cb227-276" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">inner_join</span>(test_result <span class="sc">%&gt;%</span></span>
<span id="cb227-277"><a href="functional-analysis-1.html#cb227-277" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Block) <span class="sc">%&gt;%</span></span>
<span id="cb227-278"><a href="functional-analysis-1.html#cb227-278" tabindex="-1"></a>                          dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FeatureID =</span> <span class="fu">make.names</span>(FeatureID)),</span>
<span id="cb227-279"><a href="functional-analysis-1.html#cb227-279" tabindex="-1"></a>                        <span class="at">by =</span> <span class="st">&quot;FeatureID&quot;</span>) </span>
<span id="cb227-280"><a href="functional-analysis-1.html#cb227-280" tabindex="-1"></a>    </span>
<span id="cb227-281"><a href="functional-analysis-1.html#cb227-281" tabindex="-1"></a>    res <span class="ot">&lt;-</span> mdat <span class="sc">%&gt;%</span></span>
<span id="cb227-282"><a href="functional-analysis-1.html#cb227-282" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(FeatureID, Block2, Block,</span>
<span id="cb227-283"><a href="functional-analysis-1.html#cb227-283" tabindex="-1"></a>                    FoldChange, Log2FoldChange,</span>
<span id="cb227-284"><a href="functional-analysis-1.html#cb227-284" tabindex="-1"></a>                    VIP, CorPvalue,</span>
<span id="cb227-285"><a href="functional-analysis-1.html#cb227-285" tabindex="-1"></a>                    Statistic, Pvalue, AdjustedPvalue,</span>
<span id="cb227-286"><a href="functional-analysis-1.html#cb227-286" tabindex="-1"></a>                    <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb227-287"><a href="functional-analysis-1.html#cb227-287" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(AdjustedPvalue, Log2FoldChange)    </span>
<span id="cb227-288"><a href="functional-analysis-1.html#cb227-288" tabindex="-1"></a>  }</span>
<span id="cb227-289"><a href="functional-analysis-1.html#cb227-289" tabindex="-1"></a>  </span>
<span id="cb227-290"><a href="functional-analysis-1.html#cb227-290" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb227-291"><a href="functional-analysis-1.html#cb227-291" tabindex="-1"></a>}</span>
<span id="cb227-292"><a href="functional-analysis-1.html#cb227-292" tabindex="-1"></a></span>
<span id="cb227-293"><a href="functional-analysis-1.html#cb227-293" tabindex="-1"></a>fc_res <span class="ot">&lt;-</span> <span class="fu">FoldChange</span>(</span>
<span id="cb227-294"><a href="functional-analysis-1.html#cb227-294" tabindex="-1"></a>           <span class="at">x =</span> se_impute,</span>
<span id="cb227-295"><a href="functional-analysis-1.html#cb227-295" tabindex="-1"></a>           <span class="at">group =</span> <span class="st">&quot;group&quot;</span>,</span>
<span id="cb227-296"><a href="functional-analysis-1.html#cb227-296" tabindex="-1"></a>           <span class="at">group_names =</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Moderate&quot;</span>))</span>
<span id="cb227-297"><a href="functional-analysis-1.html#cb227-297" tabindex="-1"></a></span>
<span id="cb227-298"><a href="functional-analysis-1.html#cb227-298" tabindex="-1"></a>vip_res <span class="ot">&lt;-</span> <span class="fu">VIP_fun</span>(</span>
<span id="cb227-299"><a href="functional-analysis-1.html#cb227-299" tabindex="-1"></a>  <span class="at">x =</span> se_norm,</span>
<span id="cb227-300"><a href="functional-analysis-1.html#cb227-300" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;group&quot;</span>,</span>
<span id="cb227-301"><a href="functional-analysis-1.html#cb227-301" tabindex="-1"></a>  <span class="at">group_names =</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>),</span>
<span id="cb227-302"><a href="functional-analysis-1.html#cb227-302" tabindex="-1"></a>  <span class="at">VIPtype =</span> <span class="st">&quot;PLS&quot;</span>,</span>
<span id="cb227-303"><a href="functional-analysis-1.html#cb227-303" tabindex="-1"></a>  <span class="at">vip_cutoff =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## PLS-DA
## 26 samples x 167 variables and 1 response
## standard scaling of predictors and response(s)
##       R2X(cum) R2Y(cum) Q2(cum) RMSEE pre ort pR2Y  pQ2
## Total     0.12    0.692    0.33 0.288   1   0  0.1 0.05</code></pre>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-115-1.png" width="672" /></p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="functional-analysis-1.html#cb229-1" tabindex="-1"></a>ttest_res <span class="ot">&lt;-</span> <span class="fu">t_fun</span>(</span>
<span id="cb229-2"><a href="functional-analysis-1.html#cb229-2" tabindex="-1"></a>  <span class="at">x =</span> se_norm,</span>
<span id="cb229-3"><a href="functional-analysis-1.html#cb229-3" tabindex="-1"></a>  <span class="at">group =</span> <span class="st">&quot;group&quot;</span>,</span>
<span id="cb229-4"><a href="functional-analysis-1.html#cb229-4" tabindex="-1"></a>  <span class="at">group_names =</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>))</span>
<span id="cb229-5"><a href="functional-analysis-1.html#cb229-5" tabindex="-1"></a></span>
<span id="cb229-6"><a href="functional-analysis-1.html#cb229-6" tabindex="-1"></a>m_results <span class="ot">&lt;-</span> <span class="fu">mergedResults</span>(</span>
<span id="cb229-7"><a href="functional-analysis-1.html#cb229-7" tabindex="-1"></a>  <span class="at">fc_result =</span> fc_res,</span>
<span id="cb229-8"><a href="functional-analysis-1.html#cb229-8" tabindex="-1"></a>  <span class="at">vip_result =</span> vip_res<span class="sc">$</span>vip,</span>
<span id="cb229-9"><a href="functional-analysis-1.html#cb229-9" tabindex="-1"></a>  <span class="at">test_result =</span> ttest_res,</span>
<span id="cb229-10"><a href="functional-analysis-1.html#cb229-10" tabindex="-1"></a>  <span class="at">group_names =</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>),</span>
<span id="cb229-11"><a href="functional-analysis-1.html#cb229-11" tabindex="-1"></a>  <span class="at">group_labels =</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>))</span>
<span id="cb229-12"><a href="functional-analysis-1.html#cb229-12" tabindex="-1"></a></span>
<span id="cb229-13"><a href="functional-analysis-1.html#cb229-13" tabindex="-1"></a><span class="fu">head</span>(m_results)</span></code></pre></div>
<pre><code>##   FeatureID         Block2                  Block FoldChange Log2FoldChange      VIP   CorPvalue Statistic      Pvalue AdjustedPvalue
## 1   M_42449 Mild vs Severe 14_Mild vs 19_Moderate  0.6571801     -0.6056393 2.362694 0.002247897 -3.498896 0.001881585      0.2132448
## 2   M_52446 Mild vs Severe 14_Mild vs 19_Moderate  0.7040861     -0.5061763 2.059461 0.009476225 -2.892892 0.008125613      0.2132448
## 3    M_1566 Mild vs Severe 14_Mild vs 19_Moderate  0.7161609     -0.4816443 2.143655 0.006556886 -3.077688 0.005431005      0.2132448
## 4   M_19263 Mild vs Severe 14_Mild vs 19_Moderate  0.7165011     -0.4809592 2.128317 0.007023483 -3.073546 0.005774977      0.2132448
## 5   M_42448 Mild vs Severe 14_Mild vs 19_Moderate  0.7577644     -0.4001788 2.006246 0.011828403 -2.793941 0.010215320      0.2132448
## 6   M_43761 Mild vs Severe 14_Mild vs 19_Moderate  0.8685495     -0.2033201 2.043515 0.010136007 -2.822338 0.009428795      0.2132448</code></pre>
</div>
<div id="metabolites-id-for-merged-results" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Metabolites ID for Merged Results<a href="functional-analysis-1.html#metabolites-id-for-merged-results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>HMDBID</p></li>
<li><p>KEGG ID: cpd_ID</p></li>
</ul>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="functional-analysis-1.html#cb231-1" tabindex="-1"></a>get_metaboID <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb231-2"><a href="functional-analysis-1.html#cb231-2" tabindex="-1"></a>  <span class="at">x =</span> ExprSet,</span>
<span id="cb231-3"><a href="functional-analysis-1.html#cb231-3" tabindex="-1"></a>  dat,</span>
<span id="cb231-4"><a href="functional-analysis-1.html#cb231-4" tabindex="-1"></a>  group_names,</span>
<span id="cb231-5"><a href="functional-analysis-1.html#cb231-5" tabindex="-1"></a>  <span class="at">index_names =</span> <span class="fu">c</span>(<span class="st">&quot;FoldChange&quot;</span>, <span class="st">&quot;Log2FoldChange&quot;</span>, <span class="st">&quot;VIP&quot;</span>, <span class="st">&quot;CorPvalue&quot;</span>, <span class="st">&quot;Pvalue&quot;</span>, <span class="st">&quot;AdjustedPvalue&quot;</span>),</span>
<span id="cb231-6"><a href="functional-analysis-1.html#cb231-6" tabindex="-1"></a>  <span class="at">index_cutoff =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="fl">0.05</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>)) {</span>
<span id="cb231-7"><a href="functional-analysis-1.html#cb231-7" tabindex="-1"></a>  </span>
<span id="cb231-8"><a href="functional-analysis-1.html#cb231-8" tabindex="-1"></a>  <span class="co"># x = ExprSet</span></span>
<span id="cb231-9"><a href="functional-analysis-1.html#cb231-9" tabindex="-1"></a>  <span class="co"># dat = m_results</span></span>
<span id="cb231-10"><a href="functional-analysis-1.html#cb231-10" tabindex="-1"></a>  <span class="co"># group_names = &quot;Mild vs Severe&quot;</span></span>
<span id="cb231-11"><a href="functional-analysis-1.html#cb231-11" tabindex="-1"></a>  <span class="co"># index_names = c(&quot;Log2FoldChange&quot;, &quot;AdjustedPvalue&quot;)</span></span>
<span id="cb231-12"><a href="functional-analysis-1.html#cb231-12" tabindex="-1"></a>  <span class="co"># index_cutoff = c(0, 1)</span></span>
<span id="cb231-13"><a href="functional-analysis-1.html#cb231-13" tabindex="-1"></a>  </span>
<span id="cb231-14"><a href="functional-analysis-1.html#cb231-14" tabindex="-1"></a>  feature <span class="ot">&lt;-</span> Biobase<span class="sc">::</span><span class="fu">fData</span>(x)</span>
<span id="cb231-15"><a href="functional-analysis-1.html#cb231-15" tabindex="-1"></a>  <span class="fu">colnames</span>(feature)[<span class="fu">which</span>(<span class="fu">colnames</span>(feature) <span class="sc">==</span> <span class="st">&quot;SampleID HMDBID&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;HMDB&quot;</span></span>
<span id="cb231-16"><a href="functional-analysis-1.html#cb231-16" tabindex="-1"></a>  <span class="fu">colnames</span>(feature)[<span class="fu">which</span>(<span class="fu">colnames</span>(feature) <span class="sc">==</span> <span class="st">&quot;KEGG&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;cpd_ID&quot;</span></span>
<span id="cb231-17"><a href="functional-analysis-1.html#cb231-17" tabindex="-1"></a>  <span class="fu">colnames</span>(feature)[<span class="fu">which</span>(<span class="fu">colnames</span>(feature) <span class="sc">==</span> <span class="st">&quot;BIOCHEMICAL&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;Compounds&quot;</span></span>
<span id="cb231-18"><a href="functional-analysis-1.html#cb231-18" tabindex="-1"></a>  feature<span class="sc">$</span>HMDB <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;,</span><span class="sc">\\</span><span class="st">S+&quot;</span>, <span class="st">&quot;&quot;</span>, feature<span class="sc">$</span>HMDB)</span>
<span id="cb231-19"><a href="functional-analysis-1.html#cb231-19" tabindex="-1"></a>  </span>
<span id="cb231-20"><a href="functional-analysis-1.html#cb231-20" tabindex="-1"></a>  temp_dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb231-21"><a href="functional-analysis-1.html#cb231-21" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Block2 <span class="sc">%in%</span> group_names) <span class="sc">%&gt;%</span></span>
<span id="cb231-22"><a href="functional-analysis-1.html#cb231-22" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">inner_join</span>(feature <span class="sc">%&gt;%</span></span>
<span id="cb231-23"><a href="functional-analysis-1.html#cb231-23" tabindex="-1"></a>                        tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;FeatureID&quot;</span>),</span>
<span id="cb231-24"><a href="functional-analysis-1.html#cb231-24" tabindex="-1"></a>                      <span class="at">by =</span> <span class="st">&quot;FeatureID&quot;</span>)</span>
<span id="cb231-25"><a href="functional-analysis-1.html#cb231-25" tabindex="-1"></a>  </span>
<span id="cb231-26"><a href="functional-analysis-1.html#cb231-26" tabindex="-1"></a>  <span class="fu">colnames</span>(temp_dat)[<span class="fu">which</span>(<span class="fu">colnames</span>(temp_dat) <span class="sc">==</span> index_names[<span class="dv">1</span>])] <span class="ot">&lt;-</span> <span class="st">&quot;DA_index1&quot;</span></span>
<span id="cb231-27"><a href="functional-analysis-1.html#cb231-27" tabindex="-1"></a>  <span class="fu">colnames</span>(temp_dat)[<span class="fu">which</span>(<span class="fu">colnames</span>(temp_dat) <span class="sc">==</span> index_names[<span class="dv">2</span>])] <span class="ot">&lt;-</span> <span class="st">&quot;DA_index2&quot;</span></span>
<span id="cb231-28"><a href="functional-analysis-1.html#cb231-28" tabindex="-1"></a>  </span>
<span id="cb231-29"><a href="functional-analysis-1.html#cb231-29" tabindex="-1"></a>  temp_dat_diff <span class="ot">&lt;-</span> temp_dat <span class="sc">%&gt;%</span></span>
<span id="cb231-30"><a href="functional-analysis-1.html#cb231-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(DA_index1) <span class="sc">&gt;</span> index_cutoff[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb231-31"><a href="functional-analysis-1.html#cb231-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(DA_index2 <span class="sc">&lt;</span> index_cutoff[<span class="dv">2</span>]) </span>
<span id="cb231-32"><a href="functional-analysis-1.html#cb231-32" tabindex="-1"></a>  </span>
<span id="cb231-33"><a href="functional-analysis-1.html#cb231-33" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(temp_dat_diff) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb231-34"><a href="functional-analysis-1.html#cb231-34" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Beyond these thresholds, no significant metabolites were selected&quot;</span>)</span>
<span id="cb231-35"><a href="functional-analysis-1.html#cb231-35" tabindex="-1"></a>  }</span>
<span id="cb231-36"><a href="functional-analysis-1.html#cb231-36" tabindex="-1"></a>  </span>
<span id="cb231-37"><a href="functional-analysis-1.html#cb231-37" tabindex="-1"></a>  <span class="fu">colnames</span>(temp_dat_diff)[<span class="fu">which</span>(<span class="fu">colnames</span>(temp_dat_diff) <span class="sc">==</span> <span class="st">&quot;DA_index1&quot;</span>)] <span class="ot">&lt;-</span> index_names[<span class="dv">1</span>]</span>
<span id="cb231-38"><a href="functional-analysis-1.html#cb231-38" tabindex="-1"></a>  <span class="fu">colnames</span>(temp_dat_diff)[<span class="fu">which</span>(<span class="fu">colnames</span>(temp_dat_diff) <span class="sc">==</span> <span class="st">&quot;DA_index2&quot;</span>)] <span class="ot">&lt;-</span> index_names[<span class="dv">2</span>]</span>
<span id="cb231-39"><a href="functional-analysis-1.html#cb231-39" tabindex="-1"></a>  </span>
<span id="cb231-40"><a href="functional-analysis-1.html#cb231-40" tabindex="-1"></a>  res <span class="ot">&lt;-</span> temp_dat_diff </span>
<span id="cb231-41"><a href="functional-analysis-1.html#cb231-41" tabindex="-1"></a></span>
<span id="cb231-42"><a href="functional-analysis-1.html#cb231-42" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb231-43"><a href="functional-analysis-1.html#cb231-43" tabindex="-1"></a>}</span>
<span id="cb231-44"><a href="functional-analysis-1.html#cb231-44" tabindex="-1"></a></span>
<span id="cb231-45"><a href="functional-analysis-1.html#cb231-45" tabindex="-1"></a>m_results_ID <span class="ot">&lt;-</span> <span class="fu">get_metaboID</span>(</span>
<span id="cb231-46"><a href="functional-analysis-1.html#cb231-46" tabindex="-1"></a>  <span class="at">x =</span> ExprSet,</span>
<span id="cb231-47"><a href="functional-analysis-1.html#cb231-47" tabindex="-1"></a>  <span class="at">dat =</span> m_results,</span>
<span id="cb231-48"><a href="functional-analysis-1.html#cb231-48" tabindex="-1"></a>  <span class="at">group_names =</span> <span class="st">&quot;Mild vs Severe&quot;</span>,</span>
<span id="cb231-49"><a href="functional-analysis-1.html#cb231-49" tabindex="-1"></a>  <span class="at">index_names =</span> <span class="fu">c</span>(<span class="st">&quot;Log2FoldChange&quot;</span>, <span class="st">&quot;AdjustedPvalue&quot;</span>),</span>
<span id="cb231-50"><a href="functional-analysis-1.html#cb231-50" tabindex="-1"></a>  <span class="at">index_cutoff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb231-51"><a href="functional-analysis-1.html#cb231-51" tabindex="-1"></a>  </span>
<span id="cb231-52"><a href="functional-analysis-1.html#cb231-52" tabindex="-1"></a><span class="fu">head</span>(m_results_ID)</span></code></pre></div>
<pre><code>##   FeatureID         Block2                  Block FoldChange Log2FoldChange      VIP   CorPvalue Statistic      Pvalue AdjustedPvalue
## 1   M_42449 Mild vs Severe 14_Mild vs 19_Moderate  0.6571801     -0.6056393 2.362694 0.002247897 -3.498896 0.001881585      0.2132448
## 2   M_52446 Mild vs Severe 14_Mild vs 19_Moderate  0.7040861     -0.5061763 2.059461 0.009476225 -2.892892 0.008125613      0.2132448
## 3    M_1566 Mild vs Severe 14_Mild vs 19_Moderate  0.7161609     -0.4816443 2.143655 0.006556886 -3.077688 0.005431005      0.2132448
## 4   M_19263 Mild vs Severe 14_Mild vs 19_Moderate  0.7165011     -0.4809592 2.128317 0.007023483 -3.073546 0.005774977      0.2132448
## 5   M_42448 Mild vs Severe 14_Mild vs 19_Moderate  0.7577644     -0.4001788 2.006246 0.011828403 -2.793941 0.010215320      0.2132448
## 6   M_43761 Mild vs Severe 14_Mild vs 19_Moderate  0.8685495     -0.2033201 2.043515 0.010136007 -2.822338 0.009428795      0.2132448
##                                 Compounds SUPER PATHWAY                               SUB PATHWAY COMP ID        PLATFORM CHEMICAL ID   RI     MASS
## 1 1-palmitoyl-2-linoleoyl-GPE (16:0/18:2)         Lipid             Phosphatidylethanolamine (PE)   42449  LC/MS Pos Late   100001870 2350 716.5225
## 2 1-stearoyl-2-linoleoyl-GPE (18:0/18:2)*         Lipid             Phosphatidylethanolamine (PE)   52446  LC/MS Pos Late   100008976 2575 744.5538
## 3                      3-aminoisobutyrate    Nucleotide Pyrimidine Metabolism, Thymine containing    1566 LC/MS Pos Early        1114 2190 104.0706
## 4    1-palmitoyl-2-oleoyl-GPE (16:0/18:1)         Lipid             Phosphatidylethanolamine (PE)   19263  LC/MS Pos Late        1526 2600 718.5381
## 5     1-stearoyl-2-oleoyl-GPE (18:0/18:1)         Lipid             Phosphatidylethanolamine (PE)   42448  LC/MS Pos Late   100001856 2950 746.5694
## 6                       2-aminoheptanoate         Lipid                         Fatty Acid, Amino   43761 LC/MS Pos Early   100004542 3160 146.1176
##   PUBCHEM                    CAS cpd_ID        HMDB
## 1 9546747                   &lt;NA&gt;   &lt;NA&gt; HMDB0005322
## 2 9546749                   &lt;NA&gt;   &lt;NA&gt; HMDB0008994
## 3   64956 10569-72-9;214139-20-5 C05145 HMDB0002166
## 4 5283496             26662-94-2   &lt;NA&gt; HMDB0005320
## 5 9546742                   &lt;NA&gt;   &lt;NA&gt; HMDB0008993
## 6  227939              1115-90-8   &lt;NA&gt; HMDB0094649</code></pre>
</div>
<div id="kegg-pathway-compound" class="section level3 hasAnchor" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> KEGG PATHWAY COMPOUND<a href="functional-analysis-1.html#kegg-pathway-compound" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>KEGG pathway ID：request_kegg_pathway_info</p></li>
<li><p>KEGG pathway compound: request_kegg_pathway</p></li>
<li><p>data.frame with all pathway contained compounds id: 1st-&gt;pathwayID &amp; 2nd-&gt;compoundID</p></li>
</ul>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="functional-analysis-1.html#cb233-1" tabindex="-1"></a>get_kegg_pathway_compound <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb233-2"><a href="functional-analysis-1.html#cb233-2" tabindex="-1"></a>    <span class="at">org_id =</span> <span class="fu">c</span>(<span class="st">&quot;hsa&quot;</span>, <span class="st">&quot;mmu&quot;</span>)) {</span>
<span id="cb233-3"><a href="functional-analysis-1.html#cb233-3" tabindex="-1"></a></span>
<span id="cb233-4"><a href="functional-analysis-1.html#cb233-4" tabindex="-1"></a>  pathway_names <span class="ot">&lt;-</span> <span class="fu">request_kegg_pathway_info</span>(<span class="at">organism =</span> org_id)</span>
<span id="cb233-5"><a href="functional-analysis-1.html#cb233-5" tabindex="-1"></a></span>
<span id="cb233-6"><a href="functional-analysis-1.html#cb233-6" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb233-7"><a href="functional-analysis-1.html#cb233-7" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(pathway_names)) {</span>
<span id="cb233-8"><a href="functional-analysis-1.html#cb233-8" tabindex="-1"></a>    <span class="co"># i = 12</span></span>
<span id="cb233-9"><a href="functional-analysis-1.html#cb233-9" tabindex="-1"></a>    temp_pathway <span class="ot">&lt;-</span> <span class="fu">request_kegg_pathway</span>(<span class="at">pathway_id =</span> pathway_names<span class="sc">$</span>KEGG.ID[i])</span>
<span id="cb233-10"><a href="functional-analysis-1.html#cb233-10" tabindex="-1"></a>    temp_colnames <span class="ot">&lt;-</span> <span class="fu">names</span>(temp_pathway)</span>
<span id="cb233-11"><a href="functional-analysis-1.html#cb233-11" tabindex="-1"></a></span>
<span id="cb233-12"><a href="functional-analysis-1.html#cb233-12" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">&quot;COMPOUND&quot;</span>, <span class="st">&quot;ENTRY&quot;</span>, <span class="st">&quot;NAME&quot;</span>, <span class="st">&quot;CLASS&quot;</span>, <span class="st">&quot;PATHWAY_MAP&quot;</span>) <span class="sc">%in%</span> temp_colnames)) {</span>
<span id="cb233-13"><a href="functional-analysis-1.html#cb233-13" tabindex="-1"></a>      <span class="fu">print</span>(i)</span>
<span id="cb233-14"><a href="functional-analysis-1.html#cb233-14" tabindex="-1"></a>      temp_compound <span class="ot">&lt;-</span> temp_pathway<span class="sc">$</span>COMPOUND</span>
<span id="cb233-15"><a href="functional-analysis-1.html#cb233-15" tabindex="-1"></a>      temp_class <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(temp_pathway<span class="sc">$</span>CLASS, <span class="st">&quot;; &quot;</span>))</span>
<span id="cb233-16"><a href="functional-analysis-1.html#cb233-16" tabindex="-1"></a>      temp_df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Pathway =</span> temp_pathway<span class="sc">$</span>ENTRY,</span>
<span id="cb233-17"><a href="functional-analysis-1.html#cb233-17" tabindex="-1"></a>                             <span class="at">NAME =</span> temp_pathway<span class="sc">$</span>NAME,</span>
<span id="cb233-18"><a href="functional-analysis-1.html#cb233-18" tabindex="-1"></a>                             <span class="co">#DESCRIPTION = temp_pathway$DESCRIPTION,</span></span>
<span id="cb233-19"><a href="functional-analysis-1.html#cb233-19" tabindex="-1"></a>                             <span class="at">CLASS1 =</span> temp_class[<span class="dv">1</span>],</span>
<span id="cb233-20"><a href="functional-analysis-1.html#cb233-20" tabindex="-1"></a>                             <span class="at">CLASS2 =</span> temp_class[<span class="dv">2</span>],</span>
<span id="cb233-21"><a href="functional-analysis-1.html#cb233-21" tabindex="-1"></a>                             <span class="at">PATHWAY_MAP =</span> temp_pathway<span class="sc">$</span>PATHWAY_MAP)</span>
<span id="cb233-22"><a href="functional-analysis-1.html#cb233-22" tabindex="-1"></a>      temp_df2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Pathway =</span> <span class="fu">rep</span>(temp_pathway<span class="sc">$</span>ENTRY, <span class="fu">length</span>(temp_compound)),</span>
<span id="cb233-23"><a href="functional-analysis-1.html#cb233-23" tabindex="-1"></a>                             <span class="at">COMPOUND =</span> <span class="fu">names</span>(temp_compound),</span>
<span id="cb233-24"><a href="functional-analysis-1.html#cb233-24" tabindex="-1"></a>                             <span class="at">COMPOUND_DESCRIPTION =</span> temp_compound)</span>
<span id="cb233-25"><a href="functional-analysis-1.html#cb233-25" tabindex="-1"></a></span>
<span id="cb233-26"><a href="functional-analysis-1.html#cb233-26" tabindex="-1"></a>      temp_df <span class="ot">&lt;-</span> temp_df1 <span class="sc">%&gt;%</span></span>
<span id="cb233-27"><a href="functional-analysis-1.html#cb233-27" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">full_join</span>(temp_df2, <span class="at">by =</span> <span class="st">&quot;Pathway&quot;</span>)</span>
<span id="cb233-28"><a href="functional-analysis-1.html#cb233-28" tabindex="-1"></a></span>
<span id="cb233-29"><a href="functional-analysis-1.html#cb233-29" tabindex="-1"></a>      res <span class="ot">&lt;-</span> <span class="fu">rbind</span>(res, temp_df)</span>
<span id="cb233-30"><a href="functional-analysis-1.html#cb233-30" tabindex="-1"></a>    }</span>
<span id="cb233-31"><a href="functional-analysis-1.html#cb233-31" tabindex="-1"></a>  }</span>
<span id="cb233-32"><a href="functional-analysis-1.html#cb233-32" tabindex="-1"></a></span>
<span id="cb233-33"><a href="functional-analysis-1.html#cb233-33" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb233-34"><a href="functional-analysis-1.html#cb233-34" tabindex="-1"></a>}</span>
<span id="cb233-35"><a href="functional-analysis-1.html#cb233-35" tabindex="-1"></a></span>
<span id="cb233-36"><a href="functional-analysis-1.html#cb233-36" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="st">&quot;./dataset/KEGG_COMPOUND_PATHWAY/&quot;</span>)) {</span>
<span id="cb233-37"><a href="functional-analysis-1.html#cb233-37" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="st">&quot;./dataset/KEGG_COMPOUND_PATHWAY/&quot;</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb233-38"><a href="functional-analysis-1.html#cb233-38" tabindex="-1"></a>}</span>
<span id="cb233-39"><a href="functional-analysis-1.html#cb233-39" tabindex="-1"></a></span>
<span id="cb233-40"><a href="functional-analysis-1.html#cb233-40" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(<span class="st">&quot;./dataset/KEGG_COMPOUND_PATHWAY/KEGG_COMPOUND_PATHWAY_mmu.csv&quot;</span>)) {</span>
<span id="cb233-41"><a href="functional-analysis-1.html#cb233-41" tabindex="-1"></a>  kegg_compound <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;./dataset/KEGG_COMPOUND_PATHWAY/KEGG_COMPOUND_PATHWAY_mmu.csv&quot;</span>)</span>
<span id="cb233-42"><a href="functional-analysis-1.html#cb233-42" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb233-43"><a href="functional-analysis-1.html#cb233-43" tabindex="-1"></a>  kegg_compound <span class="ot">&lt;-</span> <span class="fu">get_kegg_pathway_compound</span>(<span class="at">org_id =</span> <span class="st">&quot;mmu&quot;</span>)</span>
<span id="cb233-44"><a href="functional-analysis-1.html#cb233-44" tabindex="-1"></a>  <span class="fu">write.csv</span>(kegg_compound, <span class="st">&quot;./dataset/KEGG_COMPOUND_PATHWAY/KEGG_COMPOUND_PATHWAY_mmu.csv&quot;</span>, <span class="at">row.names =</span> F)</span>
<span id="cb233-45"><a href="functional-analysis-1.html#cb233-45" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="functions-related-to-analysis" class="section level3 hasAnchor" number="4.3.6">
<h3><span class="header-section-number">4.3.6</span> Functions related to Analysis<a href="functional-analysis-1.html#functions-related-to-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>significant metabolites</p></li>
<li><p>enrichment analysis</p></li>
<li><p>plotting results</p></li>
</ul>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="functional-analysis-1.html#cb234-1" tabindex="-1"></a>get_significant <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb234-2"><a href="functional-analysis-1.html#cb234-2" tabindex="-1"></a>    dat,</span>
<span id="cb234-3"><a href="functional-analysis-1.html#cb234-3" tabindex="-1"></a>    group_names,</span>
<span id="cb234-4"><a href="functional-analysis-1.html#cb234-4" tabindex="-1"></a>    <span class="at">lg2fc_cutoff =</span> <span class="fl">0.5</span>,</span>
<span id="cb234-5"><a href="functional-analysis-1.html#cb234-5" tabindex="-1"></a>    <span class="at">pval_cutoff =</span> <span class="fl">0.05</span>,</span>
<span id="cb234-6"><a href="functional-analysis-1.html#cb234-6" tabindex="-1"></a>    <span class="at">qval_cutoff =</span> <span class="fl">0.3</span>) {</span>
<span id="cb234-7"><a href="functional-analysis-1.html#cb234-7" tabindex="-1"></a></span>
<span id="cb234-8"><a href="functional-analysis-1.html#cb234-8" tabindex="-1"></a>  dat_group <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb234-9"><a href="functional-analysis-1.html#cb234-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Block2 <span class="sc">%in%</span> <span class="fu">paste</span>(group_names, <span class="at">collapse =</span> <span class="st">&quot; vs &quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb234-10"><a href="functional-analysis-1.html#cb234-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>()</span>
<span id="cb234-11"><a href="functional-analysis-1.html#cb234-11" tabindex="-1"></a>  </span>
<span id="cb234-12"><a href="functional-analysis-1.html#cb234-12" tabindex="-1"></a>  <span class="co"># remove cp_id eq &quot;-&quot;</span></span>
<span id="cb234-13"><a href="functional-analysis-1.html#cb234-13" tabindex="-1"></a>  dat_fa <span class="ot">&lt;-</span> dat_group <span class="sc">%&gt;%</span> </span>
<span id="cb234-14"><a href="functional-analysis-1.html#cb234-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(cpd_ID <span class="sc">!=</span> <span class="st">&quot;-&quot;</span>)</span>
<span id="cb234-15"><a href="functional-analysis-1.html#cb234-15" tabindex="-1"></a>  </span>
<span id="cb234-16"><a href="functional-analysis-1.html#cb234-16" tabindex="-1"></a>  <span class="fu">colnames</span>(dat_fa)[<span class="fu">which</span>(<span class="fu">colnames</span>(dat_fa) <span class="sc">==</span> <span class="st">&quot;Log2FoldChange&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;lg2fc&quot;</span> <span class="co"># Log2FoldChange (Median)</span></span>
<span id="cb234-17"><a href="functional-analysis-1.html#cb234-17" tabindex="-1"></a>  <span class="fu">colnames</span>(dat_fa)[<span class="fu">which</span>(<span class="fu">colnames</span>(dat_fa) <span class="sc">==</span> <span class="st">&quot;Pvalue&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;pval&quot;</span></span>
<span id="cb234-18"><a href="functional-analysis-1.html#cb234-18" tabindex="-1"></a>  <span class="fu">colnames</span>(dat_fa)[<span class="fu">which</span>(<span class="fu">colnames</span>(dat_fa) <span class="sc">==</span> <span class="st">&quot;AdjustedPvalue&quot;</span>)] <span class="ot">&lt;-</span> <span class="st">&quot;qval&quot;</span></span>
<span id="cb234-19"><a href="functional-analysis-1.html#cb234-19" tabindex="-1"></a>  </span>
<span id="cb234-20"><a href="functional-analysis-1.html#cb234-20" tabindex="-1"></a>  <span class="co"># convert NA into 1</span></span>
<span id="cb234-21"><a href="functional-analysis-1.html#cb234-21" tabindex="-1"></a>  dat_fa<span class="sc">$</span>qval[<span class="fu">is.na</span>(dat_fa<span class="sc">$</span>qval)] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb234-22"><a href="functional-analysis-1.html#cb234-22" tabindex="-1"></a>  </span>
<span id="cb234-23"><a href="functional-analysis-1.html#cb234-23" tabindex="-1"></a>  <span class="co"># enrichment by beta and Pvalue AdjustedPvalue</span></span>
<span id="cb234-24"><a href="functional-analysis-1.html#cb234-24" tabindex="-1"></a>  dat_fa[<span class="fu">which</span>(dat_fa<span class="sc">$</span>lg2fc <span class="sc">&gt;</span> lg2fc_cutoff <span class="sc">&amp;</span></span>
<span id="cb234-25"><a href="functional-analysis-1.html#cb234-25" tabindex="-1"></a>              dat_fa<span class="sc">$</span>pval <span class="sc">&lt;</span> pval_cutoff <span class="sc">&amp;</span></span>
<span id="cb234-26"><a href="functional-analysis-1.html#cb234-26" tabindex="-1"></a>              dat_fa<span class="sc">$</span>qval <span class="sc">&lt;</span> qval_cutoff),</span>
<span id="cb234-27"><a href="functional-analysis-1.html#cb234-27" tabindex="-1"></a>      <span class="st">&quot;EnrichedDir&quot;</span>] <span class="ot">&lt;-</span> group_names[<span class="dv">1</span>]</span>
<span id="cb234-28"><a href="functional-analysis-1.html#cb234-28" tabindex="-1"></a>  dat_fa[<span class="fu">which</span>(dat_fa<span class="sc">$</span>lg2fc <span class="sc">&lt;</span> <span class="sc">-</span>lg2fc_cutoff <span class="sc">&amp;</span></span>
<span id="cb234-29"><a href="functional-analysis-1.html#cb234-29" tabindex="-1"></a>              dat_fa<span class="sc">$</span>pval <span class="sc">&lt;</span> pval_cutoff <span class="sc">&amp;</span></span>
<span id="cb234-30"><a href="functional-analysis-1.html#cb234-30" tabindex="-1"></a>              dat_fa<span class="sc">$</span>qval <span class="sc">&lt;</span> qval_cutoff),</span>
<span id="cb234-31"><a href="functional-analysis-1.html#cb234-31" tabindex="-1"></a>      <span class="st">&quot;EnrichedDir&quot;</span>] <span class="ot">&lt;-</span> group_names[<span class="dv">2</span>]</span>
<span id="cb234-32"><a href="functional-analysis-1.html#cb234-32" tabindex="-1"></a>  dat_fa[<span class="fu">which</span>(<span class="fu">abs</span>(dat_fa<span class="sc">$</span>lg2fc) <span class="sc">&lt;=</span> lg2fc_cutoff <span class="sc">|</span></span>
<span id="cb234-33"><a href="functional-analysis-1.html#cb234-33" tabindex="-1"></a>              dat_fa<span class="sc">$</span>pval <span class="sc">&gt;=</span> pval_cutoff <span class="sc">|</span></span>
<span id="cb234-34"><a href="functional-analysis-1.html#cb234-34" tabindex="-1"></a>              dat_fa<span class="sc">$</span>qval <span class="sc">&gt;=</span> qval_cutoff),</span>
<span id="cb234-35"><a href="functional-analysis-1.html#cb234-35" tabindex="-1"></a>      <span class="st">&quot;EnrichedDir&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Nonsignif&quot;</span></span>
<span id="cb234-36"><a href="functional-analysis-1.html#cb234-36" tabindex="-1"></a></span>
<span id="cb234-37"><a href="functional-analysis-1.html#cb234-37" tabindex="-1"></a>  <span class="co"># dat status</span></span>
<span id="cb234-38"><a href="functional-analysis-1.html#cb234-38" tabindex="-1"></a>  dat_fa<span class="sc">$</span>EnrichedDir <span class="ot">&lt;-</span> <span class="fu">factor</span>(dat_fa<span class="sc">$</span>EnrichedDir,</span>
<span id="cb234-39"><a href="functional-analysis-1.html#cb234-39" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">c</span>(group_names[<span class="dv">1</span>], <span class="st">&quot;Nonsignif&quot;</span>, group_names[<span class="dv">2</span>]))</span>
<span id="cb234-40"><a href="functional-analysis-1.html#cb234-40" tabindex="-1"></a>  df_status <span class="ot">&lt;-</span> <span class="fu">table</span>(dat_fa<span class="sc">$</span>EnrichedDir) <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb234-41"><a href="functional-analysis-1.html#cb234-41" tabindex="-1"></a>    stats<span class="sc">::</span><span class="fu">setNames</span>(<span class="fu">c</span>(<span class="st">&quot;Group&quot;</span>, <span class="st">&quot;Number&quot;</span>))</span>
<span id="cb234-42"><a href="functional-analysis-1.html#cb234-42" tabindex="-1"></a>  grp1_number <span class="ot">&lt;-</span> <span class="fu">with</span>(df_status, df_status[Group <span class="sc">%in%</span> group_names[<span class="dv">1</span>], <span class="st">&quot;Number&quot;</span>])</span>
<span id="cb234-43"><a href="functional-analysis-1.html#cb234-43" tabindex="-1"></a>  grp2_number <span class="ot">&lt;-</span> <span class="fu">with</span>(df_status, df_status[Group <span class="sc">%in%</span> group_names[<span class="dv">2</span>], <span class="st">&quot;Number&quot;</span>])</span>
<span id="cb234-44"><a href="functional-analysis-1.html#cb234-44" tabindex="-1"></a>  nsf_number <span class="ot">&lt;-</span> <span class="fu">with</span>(df_status, df_status[Group <span class="sc">%in%</span> <span class="st">&quot;Nonsignif&quot;</span>, <span class="st">&quot;Number&quot;</span>])</span>
<span id="cb234-45"><a href="functional-analysis-1.html#cb234-45" tabindex="-1"></a>  legend_label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">paste0</span>(group_names[<span class="dv">1</span>], <span class="st">&quot; (&quot;</span>, grp1_number, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb234-46"><a href="functional-analysis-1.html#cb234-46" tabindex="-1"></a>                    <span class="fu">paste0</span>(<span class="st">&quot;Nonsignif&quot;</span>, <span class="st">&quot; (&quot;</span>, nsf_number, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb234-47"><a href="functional-analysis-1.html#cb234-47" tabindex="-1"></a>                    <span class="fu">paste0</span>(group_names[<span class="dv">2</span>], <span class="st">&quot; (&quot;</span>, grp2_number, <span class="st">&quot;)&quot;</span>))</span>
<span id="cb234-48"><a href="functional-analysis-1.html#cb234-48" tabindex="-1"></a></span>
<span id="cb234-49"><a href="functional-analysis-1.html#cb234-49" tabindex="-1"></a>  <span class="co"># significant features</span></span>
<span id="cb234-50"><a href="functional-analysis-1.html#cb234-50" tabindex="-1"></a>  dat_signif <span class="ot">&lt;-</span> dat_fa <span class="sc">%&gt;%</span></span>
<span id="cb234-51"><a href="functional-analysis-1.html#cb234-51" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(lg2fc, pval, qval) <span class="sc">%&gt;%</span></span>
<span id="cb234-52"><a href="functional-analysis-1.html#cb234-52" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(pval <span class="sc">&lt;</span> pval_cutoff) <span class="sc">%&gt;%</span></span>
<span id="cb234-53"><a href="functional-analysis-1.html#cb234-53" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(qval <span class="sc">&lt;</span> qval_cutoff) <span class="sc">%&gt;%</span></span>
<span id="cb234-54"><a href="functional-analysis-1.html#cb234-54" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(lg2fc) <span class="sc">&gt;</span> lg2fc_cutoff) <span class="sc">%&gt;%</span></span>
<span id="cb234-55"><a href="functional-analysis-1.html#cb234-55" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(FeatureID, Block, EnrichedDir, lg2fc, pval, qval, cpd_ID, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb234-56"><a href="functional-analysis-1.html#cb234-56" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">FeatureID =</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;-&quot;</span>, FeatureID))</span>
<span id="cb234-57"><a href="functional-analysis-1.html#cb234-57" tabindex="-1"></a>  </span>
<span id="cb234-58"><a href="functional-analysis-1.html#cb234-58" tabindex="-1"></a>  <span class="co"># print(table(dat_signif$EnrichedDir))</span></span>
<span id="cb234-59"><a href="functional-analysis-1.html#cb234-59" tabindex="-1"></a></span>
<span id="cb234-60"><a href="functional-analysis-1.html#cb234-60" tabindex="-1"></a>  res_up <span class="ot">&lt;-</span> dat_signif <span class="sc">%&gt;%</span> <span class="co"># enriched in 1st group</span></span>
<span id="cb234-61"><a href="functional-analysis-1.html#cb234-61" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(EnrichedDir <span class="sc">==</span> group_names[<span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb234-62"><a href="functional-analysis-1.html#cb234-62" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Status =</span> <span class="st">&quot;UpRegulated&quot;</span>)</span>
<span id="cb234-63"><a href="functional-analysis-1.html#cb234-63" tabindex="-1"></a></span>
<span id="cb234-64"><a href="functional-analysis-1.html#cb234-64" tabindex="-1"></a>  res_down <span class="ot">&lt;-</span> dat_signif <span class="sc">%&gt;%</span> <span class="co"># enriched in 2st group</span></span>
<span id="cb234-65"><a href="functional-analysis-1.html#cb234-65" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(EnrichedDir <span class="sc">==</span> group_names[<span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb234-66"><a href="functional-analysis-1.html#cb234-66" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Status =</span> <span class="st">&quot;DownRegulated&quot;</span>)</span>
<span id="cb234-67"><a href="functional-analysis-1.html#cb234-67" tabindex="-1"></a></span>
<span id="cb234-68"><a href="functional-analysis-1.html#cb234-68" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">none =</span> dat_fa <span class="sc">%&gt;%</span></span>
<span id="cb234-69"><a href="functional-analysis-1.html#cb234-69" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(FeatureID, Block, EnrichedDir, lg2fc, pval, qval, cpd_ID, <span class="fu">everything</span>()),</span>
<span id="cb234-70"><a href="functional-analysis-1.html#cb234-70" tabindex="-1"></a>              <span class="at">all =</span> dat_signif,</span>
<span id="cb234-71"><a href="functional-analysis-1.html#cb234-71" tabindex="-1"></a>              <span class="at">up =</span> res_up,</span>
<span id="cb234-72"><a href="functional-analysis-1.html#cb234-72" tabindex="-1"></a>              <span class="at">down =</span> res_down)</span>
<span id="cb234-73"><a href="functional-analysis-1.html#cb234-73" tabindex="-1"></a></span>
<span id="cb234-74"><a href="functional-analysis-1.html#cb234-74" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb234-75"><a href="functional-analysis-1.html#cb234-75" tabindex="-1"></a>}</span>
<span id="cb234-76"><a href="functional-analysis-1.html#cb234-76" tabindex="-1"></a></span>
<span id="cb234-77"><a href="functional-analysis-1.html#cb234-77" tabindex="-1"></a>get_enrichment <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb234-78"><a href="functional-analysis-1.html#cb234-78" tabindex="-1"></a>    dat,</span>
<span id="cb234-79"><a href="functional-analysis-1.html#cb234-79" tabindex="-1"></a>    <span class="at">ref =</span> kegg_compound,</span>
<span id="cb234-80"><a href="functional-analysis-1.html#cb234-80" tabindex="-1"></a>    <span class="at">direction =</span> <span class="fu">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;DownRegulated&quot;</span>, <span class="st">&quot;UpRegulated&quot;</span>), <span class="co"># DownRegulated-&gt;1st group; UpRegulated-&gt;2nd group</span></span>
<span id="cb234-81"><a href="functional-analysis-1.html#cb234-81" tabindex="-1"></a>    group_names,</span>
<span id="cb234-82"><a href="functional-analysis-1.html#cb234-82" tabindex="-1"></a>    <span class="at">enrich_type =</span> <span class="fu">c</span>(<span class="st">&quot;ORA&quot;</span>, <span class="st">&quot;GSEA&quot;</span>),</span>
<span id="cb234-83"><a href="functional-analysis-1.html#cb234-83" tabindex="-1"></a>    <span class="at">lg2fc_cutoff =</span> <span class="fl">0.5</span>,</span>
<span id="cb234-84"><a href="functional-analysis-1.html#cb234-84" tabindex="-1"></a>    <span class="at">pval_cutoff =</span> <span class="fl">0.05</span>,</span>
<span id="cb234-85"><a href="functional-analysis-1.html#cb234-85" tabindex="-1"></a>    <span class="at">qval_cutoff =</span> <span class="fl">0.3</span>) {</span>
<span id="cb234-86"><a href="functional-analysis-1.html#cb234-86" tabindex="-1"></a></span>
<span id="cb234-87"><a href="functional-analysis-1.html#cb234-87" tabindex="-1"></a>  <span class="co"># dat = m_results_ID</span></span>
<span id="cb234-88"><a href="functional-analysis-1.html#cb234-88" tabindex="-1"></a>  <span class="co"># ref = kegg_compound</span></span>
<span id="cb234-89"><a href="functional-analysis-1.html#cb234-89" tabindex="-1"></a>  <span class="co"># direction = &quot;none&quot;</span></span>
<span id="cb234-90"><a href="functional-analysis-1.html#cb234-90" tabindex="-1"></a>  <span class="co"># group_names = c(&quot;Mild&quot;, &quot;Severe&quot;)</span></span>
<span id="cb234-91"><a href="functional-analysis-1.html#cb234-91" tabindex="-1"></a>  <span class="co"># enrich_type = &quot;GSEA&quot;</span></span>
<span id="cb234-92"><a href="functional-analysis-1.html#cb234-92" tabindex="-1"></a>  <span class="co"># lg2fc_cutoff = 0</span></span>
<span id="cb234-93"><a href="functional-analysis-1.html#cb234-93" tabindex="-1"></a>  <span class="co"># pval_cutoff = 1</span></span>
<span id="cb234-94"><a href="functional-analysis-1.html#cb234-94" tabindex="-1"></a>  <span class="co"># qval_cutoff = 1  </span></span>
<span id="cb234-95"><a href="functional-analysis-1.html#cb234-95" tabindex="-1"></a>  </span>
<span id="cb234-96"><a href="functional-analysis-1.html#cb234-96" tabindex="-1"></a>  temp_input <span class="ot">&lt;-</span> <span class="fu">get_significant</span>(</span>
<span id="cb234-97"><a href="functional-analysis-1.html#cb234-97" tabindex="-1"></a>    <span class="at">dat =</span> dat,</span>
<span id="cb234-98"><a href="functional-analysis-1.html#cb234-98" tabindex="-1"></a>    <span class="at">group_names =</span> group_names,</span>
<span id="cb234-99"><a href="functional-analysis-1.html#cb234-99" tabindex="-1"></a>    <span class="at">lg2fc_cutoff =</span> lg2fc_cutoff,</span>
<span id="cb234-100"><a href="functional-analysis-1.html#cb234-100" tabindex="-1"></a>    <span class="at">pval_cutoff =</span> pval_cutoff,</span>
<span id="cb234-101"><a href="functional-analysis-1.html#cb234-101" tabindex="-1"></a>    <span class="at">qval_cutoff =</span> qval_cutoff)</span>
<span id="cb234-102"><a href="functional-analysis-1.html#cb234-102" tabindex="-1"></a>  </span>
<span id="cb234-103"><a href="functional-analysis-1.html#cb234-103" tabindex="-1"></a>  <span class="cf">if</span> (direction <span class="sc">==</span> <span class="st">&quot;All&quot;</span>) {</span>
<span id="cb234-104"><a href="functional-analysis-1.html#cb234-104" tabindex="-1"></a>    inputdata <span class="ot">&lt;-</span> temp_input<span class="sc">$</span>all</span>
<span id="cb234-105"><a href="functional-analysis-1.html#cb234-105" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (direction <span class="sc">==</span> <span class="st">&quot;UpRegulated&quot;</span>) {</span>
<span id="cb234-106"><a href="functional-analysis-1.html#cb234-106" tabindex="-1"></a>    inputdata <span class="ot">&lt;-</span> temp_input<span class="sc">$</span>up</span>
<span id="cb234-107"><a href="functional-analysis-1.html#cb234-107" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (direction <span class="sc">==</span> <span class="st">&quot;DownRegulated&quot;</span>) {</span>
<span id="cb234-108"><a href="functional-analysis-1.html#cb234-108" tabindex="-1"></a>    inputdata <span class="ot">&lt;-</span> temp_input<span class="sc">$</span>down</span>
<span id="cb234-109"><a href="functional-analysis-1.html#cb234-109" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (direction <span class="sc">==</span> <span class="st">&quot;none&quot;</span>) {</span>
<span id="cb234-110"><a href="functional-analysis-1.html#cb234-110" tabindex="-1"></a>    inputdata <span class="ot">&lt;-</span> temp_input<span class="sc">$</span>none</span>
<span id="cb234-111"><a href="functional-analysis-1.html#cb234-111" tabindex="-1"></a>  } </span>
<span id="cb234-112"><a href="functional-analysis-1.html#cb234-112" tabindex="-1"></a></span>
<span id="cb234-113"><a href="functional-analysis-1.html#cb234-113" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(inputdata) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb234-114"><a href="functional-analysis-1.html#cb234-114" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;Beyond these thresholds, no significant metabolites were selected&quot;</span>)</span>
<span id="cb234-115"><a href="functional-analysis-1.html#cb234-115" tabindex="-1"></a>  }  </span>
<span id="cb234-116"><a href="functional-analysis-1.html#cb234-116" tabindex="-1"></a>  </span>
<span id="cb234-117"><a href="functional-analysis-1.html#cb234-117" tabindex="-1"></a>  inputdata<span class="sc">$</span>cpd_ID <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+</span><span class="sc">\\</span><span class="st">|</span><span class="sc">\\</span><span class="st">s+</span><span class="sc">\\</span><span class="st">w+</span><span class="sc">\\</span><span class="st">d+&quot;</span>, <span class="st">&quot;&quot;</span>, inputdata<span class="sc">$</span>cpd_ID)</span>
<span id="cb234-118"><a href="functional-analysis-1.html#cb234-118" tabindex="-1"></a>  inputdata<span class="sc">$</span>cpd_ID <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;,</span><span class="sc">\\</span><span class="st">S+&quot;</span>, <span class="st">&quot;&quot;</span>, inputdata<span class="sc">$</span>cpd_ID)</span>
<span id="cb234-119"><a href="functional-analysis-1.html#cb234-119" tabindex="-1"></a>  </span>
<span id="cb234-120"><a href="functional-analysis-1.html#cb234-120" tabindex="-1"></a>  ref_cln <span class="ot">&lt;-</span> ref <span class="sc">%&gt;%</span></span>
<span id="cb234-121"><a href="functional-analysis-1.html#cb234-121" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(PATHWAY_MAP, COMPOUND) <span class="sc">%&gt;%</span></span>
<span id="cb234-122"><a href="functional-analysis-1.html#cb234-122" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Pathway =</span> PATHWAY_MAP)</span>
<span id="cb234-123"><a href="functional-analysis-1.html#cb234-123" tabindex="-1"></a></span>
<span id="cb234-124"><a href="functional-analysis-1.html#cb234-124" tabindex="-1"></a>  <span class="cf">if</span> (enrich_type <span class="sc">==</span> <span class="st">&quot;ORA&quot;</span>) {</span>
<span id="cb234-125"><a href="functional-analysis-1.html#cb234-125" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">enricher</span>(</span>
<span id="cb234-126"><a href="functional-analysis-1.html#cb234-126" tabindex="-1"></a>                <span class="at">gene =</span> inputdata<span class="sc">$</span>cpd_ID,</span>
<span id="cb234-127"><a href="functional-analysis-1.html#cb234-127" tabindex="-1"></a>                <span class="at">pvalueCutoff =</span> <span class="fl">0.05</span>,</span>
<span id="cb234-128"><a href="functional-analysis-1.html#cb234-128" tabindex="-1"></a>                <span class="at">pAdjustMethod =</span> <span class="st">&quot;BH&quot;</span>,</span>
<span id="cb234-129"><a href="functional-analysis-1.html#cb234-129" tabindex="-1"></a>                <span class="at">minGSSize =</span> <span class="dv">10</span>,</span>
<span id="cb234-130"><a href="functional-analysis-1.html#cb234-130" tabindex="-1"></a>                <span class="at">maxGSSize =</span> <span class="dv">500</span>,</span>
<span id="cb234-131"><a href="functional-analysis-1.html#cb234-131" tabindex="-1"></a>                <span class="at">qvalueCutoff =</span> <span class="fl">0.2</span>,</span>
<span id="cb234-132"><a href="functional-analysis-1.html#cb234-132" tabindex="-1"></a>                <span class="at">TERM2GENE =</span> ref_cln)</span>
<span id="cb234-133"><a href="functional-analysis-1.html#cb234-133" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (enrich_type <span class="sc">==</span> <span class="st">&quot;GSEA&quot;</span>) {</span>
<span id="cb234-134"><a href="functional-analysis-1.html#cb234-134" tabindex="-1"></a>    dat_GSEA <span class="ot">&lt;-</span> inputdata <span class="sc">%&gt;%</span></span>
<span id="cb234-135"><a href="functional-analysis-1.html#cb234-135" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(lg2fc))</span>
<span id="cb234-136"><a href="functional-analysis-1.html#cb234-136" tabindex="-1"></a>    cpd_lg2fc <span class="ot">&lt;-</span> dat_GSEA<span class="sc">$</span>lg2fc</span>
<span id="cb234-137"><a href="functional-analysis-1.html#cb234-137" tabindex="-1"></a>    <span class="fu">names</span>(cpd_lg2fc) <span class="ot">&lt;-</span> dat_GSEA<span class="sc">$</span>cpd_ID</span>
<span id="cb234-138"><a href="functional-analysis-1.html#cb234-138" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> clusterProfiler<span class="sc">::</span><span class="fu">GSEA</span>(</span>
<span id="cb234-139"><a href="functional-analysis-1.html#cb234-139" tabindex="-1"></a>                <span class="at">geneList =</span> cpd_lg2fc,</span>
<span id="cb234-140"><a href="functional-analysis-1.html#cb234-140" tabindex="-1"></a>                <span class="at">pvalueCutoff =</span> <span class="fl">0.05</span>,</span>
<span id="cb234-141"><a href="functional-analysis-1.html#cb234-141" tabindex="-1"></a>                <span class="at">pAdjustMethod =</span> <span class="st">&quot;BH&quot;</span>,</span>
<span id="cb234-142"><a href="functional-analysis-1.html#cb234-142" tabindex="-1"></a>                <span class="at">minGSSize =</span> <span class="dv">10</span>,</span>
<span id="cb234-143"><a href="functional-analysis-1.html#cb234-143" tabindex="-1"></a>                <span class="at">maxGSSize =</span> <span class="dv">500</span>,</span>
<span id="cb234-144"><a href="functional-analysis-1.html#cb234-144" tabindex="-1"></a>                <span class="at">TERM2GENE =</span> ref_cln)</span>
<span id="cb234-145"><a href="functional-analysis-1.html#cb234-145" tabindex="-1"></a>  }</span>
<span id="cb234-146"><a href="functional-analysis-1.html#cb234-146" tabindex="-1"></a></span>
<span id="cb234-147"><a href="functional-analysis-1.html#cb234-147" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(fit<span class="sc">@</span>result) <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb234-148"><a href="functional-analysis-1.html#cb234-148" tabindex="-1"></a>    <span class="cf">if</span> (enrich_type <span class="sc">==</span> <span class="st">&quot;ORA&quot;</span>) {</span>
<span id="cb234-149"><a href="functional-analysis-1.html#cb234-149" tabindex="-1"></a>      EA_res <span class="ot">&lt;-</span> fit<span class="sc">@</span>result <span class="sc">%&gt;%</span></span>
<span id="cb234-150"><a href="functional-analysis-1.html#cb234-150" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Description)) <span class="sc">%&gt;%</span></span>
<span id="cb234-151"><a href="functional-analysis-1.html#cb234-151" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">CompoundRatio =</span> GeneRatio,</span>
<span id="cb234-152"><a href="functional-analysis-1.html#cb234-152" tabindex="-1"></a>                      <span class="at">CompoundID =</span> geneID,</span>
<span id="cb234-153"><a href="functional-analysis-1.html#cb234-153" tabindex="-1"></a>                      <span class="at">NAME =</span> Description) <span class="sc">%&gt;%</span></span>
<span id="cb234-154"><a href="functional-analysis-1.html#cb234-154" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(ID, NAME, <span class="fu">everything</span>())      </span>
<span id="cb234-155"><a href="functional-analysis-1.html#cb234-155" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (enrich_type <span class="sc">==</span> <span class="st">&quot;GSEA&quot;</span>) {</span>
<span id="cb234-156"><a href="functional-analysis-1.html#cb234-156" tabindex="-1"></a>      EA_res <span class="ot">&lt;-</span> fit<span class="sc">@</span>result <span class="sc">%&gt;%</span></span>
<span id="cb234-157"><a href="functional-analysis-1.html#cb234-157" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Description)) <span class="sc">%&gt;%</span></span>
<span id="cb234-158"><a href="functional-analysis-1.html#cb234-158" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">NAME =</span> Description) <span class="sc">%&gt;%</span></span>
<span id="cb234-159"><a href="functional-analysis-1.html#cb234-159" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(ID, NAME, <span class="fu">everything</span>())       </span>
<span id="cb234-160"><a href="functional-analysis-1.html#cb234-160" tabindex="-1"></a>    }</span>
<span id="cb234-161"><a href="functional-analysis-1.html#cb234-161" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb234-162"><a href="functional-analysis-1.html#cb234-162" tabindex="-1"></a>    EA_res <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb234-163"><a href="functional-analysis-1.html#cb234-163" tabindex="-1"></a>  }</span>
<span id="cb234-164"><a href="functional-analysis-1.html#cb234-164" tabindex="-1"></a></span>
<span id="cb234-165"><a href="functional-analysis-1.html#cb234-165" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">data =</span> inputdata,</span>
<span id="cb234-166"><a href="functional-analysis-1.html#cb234-166" tabindex="-1"></a>              <span class="at">enrich =</span> EA_res)</span>
<span id="cb234-167"><a href="functional-analysis-1.html#cb234-167" tabindex="-1"></a></span>
<span id="cb234-168"><a href="functional-analysis-1.html#cb234-168" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb234-169"><a href="functional-analysis-1.html#cb234-169" tabindex="-1"></a>}</span>
<span id="cb234-170"><a href="functional-analysis-1.html#cb234-170" tabindex="-1"></a></span>
<span id="cb234-171"><a href="functional-analysis-1.html#cb234-171" tabindex="-1"></a>plot_enrichment <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb234-172"><a href="functional-analysis-1.html#cb234-172" tabindex="-1"></a>    inputdata,</span>
<span id="cb234-173"><a href="functional-analysis-1.html#cb234-173" tabindex="-1"></a>    <span class="at">qval_cutoff =</span> <span class="fl">0.05</span>,</span>
<span id="cb234-174"><a href="functional-analysis-1.html#cb234-174" tabindex="-1"></a>    <span class="at">topN =</span> <span class="dv">10</span>,</span>
<span id="cb234-175"><a href="functional-analysis-1.html#cb234-175" tabindex="-1"></a>    <span class="at">plot_type =</span> <span class="fu">c</span>(<span class="st">&quot;bubble&quot;</span>, <span class="st">&quot;bar&quot;</span>),</span>
<span id="cb234-176"><a href="functional-analysis-1.html#cb234-176" tabindex="-1"></a>    <span class="at">enrich_type =</span> <span class="fu">c</span>(<span class="st">&quot;ORA&quot;</span>, <span class="st">&quot;GSEA&quot;</span>)) {</span>
<span id="cb234-177"><a href="functional-analysis-1.html#cb234-177" tabindex="-1"></a></span>
<span id="cb234-178"><a href="functional-analysis-1.html#cb234-178" tabindex="-1"></a></span>
<span id="cb234-179"><a href="functional-analysis-1.html#cb234-179" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(inputdata) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb234-180"><a href="functional-analysis-1.html#cb234-180" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;No pathway please check your input&quot;</span>)</span>
<span id="cb234-181"><a href="functional-analysis-1.html#cb234-181" tabindex="-1"></a>  }</span>
<span id="cb234-182"><a href="functional-analysis-1.html#cb234-182" tabindex="-1"></a></span>
<span id="cb234-183"><a href="functional-analysis-1.html#cb234-183" tabindex="-1"></a>  <span class="cf">if</span> (enrich_type <span class="sc">==</span> <span class="st">&quot;ORA&quot;</span>) {</span>
<span id="cb234-184"><a href="functional-analysis-1.html#cb234-184" tabindex="-1"></a></span>
<span id="cb234-185"><a href="functional-analysis-1.html#cb234-185" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(inputdata<span class="sc">$</span>qvalue))) {</span>
<span id="cb234-186"><a href="functional-analysis-1.html#cb234-186" tabindex="-1"></a>      inputdata<span class="sc">$</span>qvalue <span class="ot">&lt;-</span> inputdata<span class="sc">$</span>p.adjust</span>
<span id="cb234-187"><a href="functional-analysis-1.html#cb234-187" tabindex="-1"></a>    }</span>
<span id="cb234-188"><a href="functional-analysis-1.html#cb234-188" tabindex="-1"></a></span>
<span id="cb234-189"><a href="functional-analysis-1.html#cb234-189" tabindex="-1"></a>    plotdata_temp <span class="ot">&lt;-</span> inputdata <span class="sc">%&gt;%</span></span>
<span id="cb234-190"><a href="functional-analysis-1.html#cb234-190" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(ID, NAME, CompoundRatio, qvalue, Count) <span class="sc">%&gt;%</span></span>
<span id="cb234-191"><a href="functional-analysis-1.html#cb234-191" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(qvalue <span class="sc">&lt;</span> qval_cutoff)</span>
<span id="cb234-192"><a href="functional-analysis-1.html#cb234-192" tabindex="-1"></a></span>
<span id="cb234-193"><a href="functional-analysis-1.html#cb234-193" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(plotdata_temp) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb234-194"><a href="functional-analysis-1.html#cb234-194" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;No pathway met the threshold of qvalue&quot;</span>)</span>
<span id="cb234-195"><a href="functional-analysis-1.html#cb234-195" tabindex="-1"></a>    }</span>
<span id="cb234-196"><a href="functional-analysis-1.html#cb234-196" tabindex="-1"></a></span>
<span id="cb234-197"><a href="functional-analysis-1.html#cb234-197" tabindex="-1"></a>    plotdata <span class="ot">&lt;-</span> plotdata_temp <span class="sc">%&gt;%</span></span>
<span id="cb234-198"><a href="functional-analysis-1.html#cb234-198" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>topN) <span class="sc">%&gt;%</span></span>
<span id="cb234-199"><a href="functional-analysis-1.html#cb234-199" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">qvalue =</span> <span class="fu">as.numeric</span>(qvalue),</span>
<span id="cb234-200"><a href="functional-analysis-1.html#cb234-200" tabindex="-1"></a>                    <span class="at">Count =</span> <span class="fu">as.numeric</span>(Count)) <span class="sc">%&gt;%</span></span>
<span id="cb234-201"><a href="functional-analysis-1.html#cb234-201" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb234-202"><a href="functional-analysis-1.html#cb234-202" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CompoundRatio1 =</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(CompoundRatio, <span class="st">&quot;/&quot;</span>))[<span class="dv">1</span>],</span>
<span id="cb234-203"><a href="functional-analysis-1.html#cb234-203" tabindex="-1"></a>                    <span class="at">CompoundRatio2 =</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(CompoundRatio, <span class="st">&quot;/&quot;</span>))[<span class="dv">2</span>],</span>
<span id="cb234-204"><a href="functional-analysis-1.html#cb234-204" tabindex="-1"></a>                    <span class="at">CompoundRatio =</span> <span class="fu">as.numeric</span>(CompoundRatio1) <span class="sc">/</span> <span class="fu">as.numeric</span>(CompoundRatio2)) <span class="sc">%&gt;%</span></span>
<span id="cb234-205"><a href="functional-analysis-1.html#cb234-205" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;CompoundRatio1&quot;</span>, <span class="st">&quot;CompoundRatio2&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb234-206"><a href="functional-analysis-1.html#cb234-206" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">gsub</span>(<span class="st">&quot; - Mus musculus </span><span class="sc">\\</span><span class="st">(house mouse</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, NAME)) <span class="sc">%&gt;%</span></span>
<span id="cb234-207"><a href="functional-analysis-1.html#cb234-207" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(CompoundRatio)  <span class="sc">%&gt;%</span></span>
<span id="cb234-208"><a href="functional-analysis-1.html#cb234-208" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Yvalue =</span> CompoundRatio)</span>
<span id="cb234-209"><a href="functional-analysis-1.html#cb234-209" tabindex="-1"></a>    y_lab <span class="ot">&lt;-</span> <span class="st">&quot;CompoundRatio&quot;</span></span>
<span id="cb234-210"><a href="functional-analysis-1.html#cb234-210" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (enrich_type <span class="sc">==</span> <span class="st">&quot;GSEA&quot;</span>) {</span>
<span id="cb234-211"><a href="functional-analysis-1.html#cb234-211" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(inputdata<span class="sc">$</span>qvalue))) {</span>
<span id="cb234-212"><a href="functional-analysis-1.html#cb234-212" tabindex="-1"></a>      inputdata<span class="sc">$</span>qvalues <span class="ot">&lt;-</span> inputdata<span class="sc">$</span>p.adjust</span>
<span id="cb234-213"><a href="functional-analysis-1.html#cb234-213" tabindex="-1"></a>    }</span>
<span id="cb234-214"><a href="functional-analysis-1.html#cb234-214" tabindex="-1"></a>    plotdata_temp <span class="ot">&lt;-</span> inputdata <span class="sc">%&gt;%</span></span>
<span id="cb234-215"><a href="functional-analysis-1.html#cb234-215" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(ID, NAME, enrichmentScore, qvalues, setSize) <span class="sc">%&gt;%</span> </span>
<span id="cb234-216"><a href="functional-analysis-1.html#cb234-216" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(qvalues <span class="sc">&lt;</span> qval_cutoff)</span>
<span id="cb234-217"><a href="functional-analysis-1.html#cb234-217" tabindex="-1"></a></span>
<span id="cb234-218"><a href="functional-analysis-1.html#cb234-218" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(plotdata_temp) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb234-219"><a href="functional-analysis-1.html#cb234-219" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">&quot;No pathway met the threshold of qvalue&quot;</span>)</span>
<span id="cb234-220"><a href="functional-analysis-1.html#cb234-220" tabindex="-1"></a>    }</span>
<span id="cb234-221"><a href="functional-analysis-1.html#cb234-221" tabindex="-1"></a></span>
<span id="cb234-222"><a href="functional-analysis-1.html#cb234-222" tabindex="-1"></a>    plotdata <span class="ot">&lt;-</span> plotdata_temp <span class="sc">%&gt;%</span></span>
<span id="cb234-223"><a href="functional-analysis-1.html#cb234-223" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>topN) <span class="sc">%&gt;%</span></span>
<span id="cb234-224"><a href="functional-analysis-1.html#cb234-224" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">qvalue =</span> qvalues,</span>
<span id="cb234-225"><a href="functional-analysis-1.html#cb234-225" tabindex="-1"></a>                    <span class="at">Count =</span> setSize) <span class="sc">%&gt;%</span></span>
<span id="cb234-226"><a href="functional-analysis-1.html#cb234-226" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">qvalue =</span> <span class="fu">as.numeric</span>(qvalue),</span>
<span id="cb234-227"><a href="functional-analysis-1.html#cb234-227" tabindex="-1"></a>                    <span class="at">Count =</span> <span class="fu">as.numeric</span>(Count),</span>
<span id="cb234-228"><a href="functional-analysis-1.html#cb234-228" tabindex="-1"></a>                    <span class="at">enrichmentScore =</span> <span class="fu">as.numeric</span>(enrichmentScore)) <span class="sc">%&gt;%</span></span>
<span id="cb234-229"><a href="functional-analysis-1.html#cb234-229" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">gsub</span>(<span class="st">&quot; - Mus musculus </span><span class="sc">\\</span><span class="st">(house mouse</span><span class="sc">\\</span><span class="st">)&quot;</span>, <span class="st">&quot;&quot;</span>, NAME)) <span class="sc">%&gt;%</span></span>
<span id="cb234-230"><a href="functional-analysis-1.html#cb234-230" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(enrichmentScore) <span class="sc">%&gt;%</span></span>
<span id="cb234-231"><a href="functional-analysis-1.html#cb234-231" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Yvalue =</span> enrichmentScore)</span>
<span id="cb234-232"><a href="functional-analysis-1.html#cb234-232" tabindex="-1"></a>    y_lab <span class="ot">&lt;-</span> <span class="st">&quot;enrichmentScore&quot;</span></span>
<span id="cb234-233"><a href="functional-analysis-1.html#cb234-233" tabindex="-1"></a>  }</span>
<span id="cb234-234"><a href="functional-analysis-1.html#cb234-234" tabindex="-1"></a></span>
<span id="cb234-235"><a href="functional-analysis-1.html#cb234-235" tabindex="-1"></a>  plotdata<span class="sc">$</span>NAME <span class="ot">&lt;-</span> <span class="fu">factor</span>(plotdata<span class="sc">$</span>NAME, <span class="at">levels =</span> <span class="fu">as.character</span>(plotdata<span class="sc">$</span>NAME))</span>
<span id="cb234-236"><a href="functional-analysis-1.html#cb234-236" tabindex="-1"></a></span>
<span id="cb234-237"><a href="functional-analysis-1.html#cb234-237" tabindex="-1"></a>  final_topN <span class="ot">&lt;-</span> <span class="fu">nrow</span>(plotdata)</span>
<span id="cb234-238"><a href="functional-analysis-1.html#cb234-238" tabindex="-1"></a></span>
<span id="cb234-239"><a href="functional-analysis-1.html#cb234-239" tabindex="-1"></a>  <span class="cf">if</span> (plot_type <span class="sc">==</span> <span class="st">&quot;bubble&quot;</span>) {</span>
<span id="cb234-240"><a href="functional-analysis-1.html#cb234-240" tabindex="-1"></a>    pl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x =</span> NAME, <span class="at">y =</span> Yvalue)) <span class="sc">+</span></span>
<span id="cb234-241"><a href="functional-analysis-1.html#cb234-241" tabindex="-1"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> Count, <span class="at">color =</span> qvalue)) <span class="sc">+</span></span>
<span id="cb234-242"><a href="functional-analysis-1.html#cb234-242" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb234-243"><a href="functional-analysis-1.html#cb234-243" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> y_lab, <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top&quot;</span>, final_topN, <span class="st">&quot;of Enrichment&quot;</span>)) <span class="sc">+</span></span>
<span id="cb234-244"><a href="functional-analysis-1.html#cb234-244" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb234-245"><a href="functional-analysis-1.html#cb234-245" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">size =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>),</span>
<span id="cb234-246"><a href="functional-analysis-1.html#cb234-246" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>))<span class="sc">+</span></span>
<span id="cb234-247"><a href="functional-analysis-1.html#cb234-247" tabindex="-1"></a>      <span class="fu">scale_color_gradientn</span>(<span class="at">name =</span> <span class="st">&quot;q value&quot;</span>,</span>
<span id="cb234-248"><a href="functional-analysis-1.html#cb234-248" tabindex="-1"></a>                            <span class="at">colours =</span> <span class="fu">rainbow</span>(<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb234-249"><a href="functional-analysis-1.html#cb234-249" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> .<span class="dv">5</span>),</span>
<span id="cb234-250"><a href="functional-analysis-1.html#cb234-250" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb234-251"><a href="functional-analysis-1.html#cb234-251" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb234-252"><a href="functional-analysis-1.html#cb234-252" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb234-253"><a href="functional-analysis-1.html#cb234-253" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (plot_type <span class="sc">==</span> <span class="st">&quot;bar&quot;</span>) {</span>
<span id="cb234-254"><a href="functional-analysis-1.html#cb234-254" tabindex="-1"></a>    pl <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plotdata, <span class="fu">aes</span>(<span class="at">x =</span> NAME, <span class="at">y =</span> Yvalue, <span class="at">fill =</span> <span class="sc">-</span><span class="fu">log</span>(qvalue))) <span class="sc">+</span></span>
<span id="cb234-255"><a href="functional-analysis-1.html#cb234-255" tabindex="-1"></a>      <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>()) <span class="sc">+</span></span>
<span id="cb234-256"><a href="functional-analysis-1.html#cb234-256" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb234-257"><a href="functional-analysis-1.html#cb234-257" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> y_lab, <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Top&quot;</span>, final_topN, <span class="st">&quot;of Enrichment&quot;</span>)) <span class="sc">+</span></span>
<span id="cb234-258"><a href="functional-analysis-1.html#cb234-258" tabindex="-1"></a>      <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb234-259"><a href="functional-analysis-1.html#cb234-259" tabindex="-1"></a>      <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb234-260"><a href="functional-analysis-1.html#cb234-260" tabindex="-1"></a>      <span class="fu">scale_color_gradientn</span>(<span class="at">name =</span> <span class="st">&quot;-log10(q value)&quot;</span>,</span>
<span id="cb234-261"><a href="functional-analysis-1.html#cb234-261" tabindex="-1"></a>                            <span class="at">colours =</span> <span class="fu">rainbow</span>(<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb234-262"><a href="functional-analysis-1.html#cb234-262" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">12</span>, <span class="at">hjust =</span> .<span class="dv">5</span>),</span>
<span id="cb234-263"><a href="functional-analysis-1.html#cb234-263" tabindex="-1"></a>            <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb234-264"><a href="functional-analysis-1.html#cb234-264" tabindex="-1"></a>            <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&#39;bold&#39;</span>, <span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb234-265"><a href="functional-analysis-1.html#cb234-265" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>)</span>
<span id="cb234-266"><a href="functional-analysis-1.html#cb234-266" tabindex="-1"></a>  }</span>
<span id="cb234-267"><a href="functional-analysis-1.html#cb234-267" tabindex="-1"></a></span>
<span id="cb234-268"><a href="functional-analysis-1.html#cb234-268" tabindex="-1"></a>  <span class="fu">return</span>(pl)</span>
<span id="cb234-269"><a href="functional-analysis-1.html#cb234-269" tabindex="-1"></a>}</span></code></pre></div>
<div id="ora" class="section level4 hasAnchor" number="4.3.6.1">
<h4><span class="header-section-number">4.3.6.1</span> ORA<a href="functional-analysis-1.html#ora" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>ORA: Enriched KEGG pathway for Down-Regulated Metabolites</li>
</ul>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="functional-analysis-1.html#cb235-1" tabindex="-1"></a>Mild_Severe_ORA_Down <span class="ot">&lt;-</span> <span class="fu">get_enrichment</span>(</span>
<span id="cb235-2"><a href="functional-analysis-1.html#cb235-2" tabindex="-1"></a>  <span class="at">dat =</span> m_results_ID,</span>
<span id="cb235-3"><a href="functional-analysis-1.html#cb235-3" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;DownRegulated&quot;</span>,</span>
<span id="cb235-4"><a href="functional-analysis-1.html#cb235-4" tabindex="-1"></a>  <span class="at">group_names =</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>),</span>
<span id="cb235-5"><a href="functional-analysis-1.html#cb235-5" tabindex="-1"></a>  <span class="at">enrich_type =</span> <span class="st">&quot;ORA&quot;</span>, </span>
<span id="cb235-6"><a href="functional-analysis-1.html#cb235-6" tabindex="-1"></a>  <span class="at">lg2fc_cutoff =</span> <span class="dv">0</span>,</span>
<span id="cb235-7"><a href="functional-analysis-1.html#cb235-7" tabindex="-1"></a>  <span class="at">pval_cutoff =</span> <span class="fl">0.5</span>,</span>
<span id="cb235-8"><a href="functional-analysis-1.html#cb235-8" tabindex="-1"></a>  <span class="at">qval_cutoff =</span> <span class="dv">1</span>)</span>
<span id="cb235-9"><a href="functional-analysis-1.html#cb235-9" tabindex="-1"></a></span>
<span id="cb235-10"><a href="functional-analysis-1.html#cb235-10" tabindex="-1"></a><span class="fu">plot_enrichment</span>(</span>
<span id="cb235-11"><a href="functional-analysis-1.html#cb235-11" tabindex="-1"></a>  <span class="at">inputdata =</span> Mild_Severe_ORA_Down<span class="sc">$</span>enrich,</span>
<span id="cb235-12"><a href="functional-analysis-1.html#cb235-12" tabindex="-1"></a>  <span class="at">qval_cutoff =</span> <span class="fl">0.5</span>,</span>
<span id="cb235-13"><a href="functional-analysis-1.html#cb235-13" tabindex="-1"></a>  <span class="at">topN =</span> <span class="dv">10</span>,</span>
<span id="cb235-14"><a href="functional-analysis-1.html#cb235-14" tabindex="-1"></a>  <span class="at">plot_type =</span> <span class="st">&quot;bubble&quot;</span>,</span>
<span id="cb235-15"><a href="functional-analysis-1.html#cb235-15" tabindex="-1"></a>  <span class="at">enrich_type =</span> <span class="st">&quot;ORA&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="functional-analysis-1.html#cb236-1" tabindex="-1"></a><span class="fu">head</span>(Mild_Severe_ORA_Down<span class="sc">$</span>enrich)</span></code></pre></div>
<pre><code>##                                                                              ID                                    NAME CompoundRatio BgRatio
## Retrograde endocannabinoid signaling       Retrograde endocannabinoid signaling    Retrograde endocannabinoid signaling           1/5 19/3516
## Thermogenesis                                                     Thermogenesis                           Thermogenesis           1/5 23/3516
## Pentose phosphate pathway                             Pentose phosphate pathway               Pentose phosphate pathway           1/5 36/3516
## Histidine metabolism                                       Histidine metabolism                    Histidine metabolism           1/5 47/3516
## Phenylalanine metabolism                               Phenylalanine metabolism                Phenylalanine metabolism           1/5 49/3516
## Neuroactive ligand-receptor interaction Neuroactive ligand-receptor interaction Neuroactive ligand-receptor interaction           1/5 53/3516
##                                             pvalue   p.adjust     qvalue CompoundID Count
## Retrograde endocannabinoid signaling    0.02674395 0.08982828 0.07354362     C13856     1
## Thermogenesis                           0.03230064 0.08982828 0.07354362     C13856     1
## Pentose phosphate pathway               0.05018484 0.08982828 0.07354362     C00204     1
## Histidine metabolism                    0.06511021 0.08982828 0.07354362     C01152     1
## Phenylalanine metabolism                0.06780364 0.08982828 0.07354362     C05852     1
## Neuroactive ligand-receptor interaction 0.07317187 0.08982828 0.07354362     C13856     1</code></pre>
</div>
<div id="gsea" class="section level4 hasAnchor" number="4.3.6.2">
<h4><span class="header-section-number">4.3.6.2</span> GSEA<a href="functional-analysis-1.html#gsea" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>GSEA: Enriched KEGG pathway for all Metabolites whose rank by log2foldchange</li>
</ul>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="functional-analysis-1.html#cb238-1" tabindex="-1"></a>Mild_Severe_GSEA <span class="ot">&lt;-</span> <span class="fu">get_enrichment</span>(</span>
<span id="cb238-2"><a href="functional-analysis-1.html#cb238-2" tabindex="-1"></a>  <span class="at">dat =</span> m_results_ID,</span>
<span id="cb238-3"><a href="functional-analysis-1.html#cb238-3" tabindex="-1"></a>  <span class="at">direction =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb238-4"><a href="functional-analysis-1.html#cb238-4" tabindex="-1"></a>  <span class="at">group_names =</span> <span class="fu">c</span>(<span class="st">&quot;Mild&quot;</span>, <span class="st">&quot;Severe&quot;</span>),</span>
<span id="cb238-5"><a href="functional-analysis-1.html#cb238-5" tabindex="-1"></a>  <span class="at">enrich_type =</span> <span class="st">&quot;GSEA&quot;</span>, </span>
<span id="cb238-6"><a href="functional-analysis-1.html#cb238-6" tabindex="-1"></a>  <span class="at">lg2fc_cutoff =</span> <span class="dv">0</span>,</span>
<span id="cb238-7"><a href="functional-analysis-1.html#cb238-7" tabindex="-1"></a>  <span class="at">pval_cutoff =</span> <span class="fl">0.5</span>,</span>
<span id="cb238-8"><a href="functional-analysis-1.html#cb238-8" tabindex="-1"></a>  <span class="at">qval_cutoff =</span> <span class="dv">1</span>)</span>
<span id="cb238-9"><a href="functional-analysis-1.html#cb238-9" tabindex="-1"></a></span>
<span id="cb238-10"><a href="functional-analysis-1.html#cb238-10" tabindex="-1"></a><span class="co"># plot_enrichment(</span></span>
<span id="cb238-11"><a href="functional-analysis-1.html#cb238-11" tabindex="-1"></a><span class="co">#   inputdata = Mild_Severe_GSEA$enrich,</span></span>
<span id="cb238-12"><a href="functional-analysis-1.html#cb238-12" tabindex="-1"></a><span class="co">#   qval_cutoff = 0.5,</span></span>
<span id="cb238-13"><a href="functional-analysis-1.html#cb238-13" tabindex="-1"></a><span class="co">#   topN = 10,</span></span>
<span id="cb238-14"><a href="functional-analysis-1.html#cb238-14" tabindex="-1"></a><span class="co">#   plot_type = &quot;bubble&quot;,</span></span>
<span id="cb238-15"><a href="functional-analysis-1.html#cb238-15" tabindex="-1"></a><span class="co">#   enrich_type = &quot;GSEA&quot;)</span></span>
<span id="cb238-16"><a href="functional-analysis-1.html#cb238-16" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb238-17"><a href="functional-analysis-1.html#cb238-17" tabindex="-1"></a><span class="co"># head(Mild_Severe_GSEA$enrich)</span></span></code></pre></div>
</div>
</div>
</div>
<div id="session-info" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Session info<a href="functional-analysis-1.html#session-info" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="functional-analysis-1.html#cb239-1" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code></pre></div>
<pre><code>## ─ Session info ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
##  setting  value
##  version  R version 4.1.3 (2022-03-10)
##  os       macOS Monterey 12.2.1
##  system   x86_64, darwin17.0
##  ui       RStudio
##  language (EN)
##  collate  en_US.UTF-8
##  ctype    en_US.UTF-8
##  tz       Asia/Shanghai
##  date     2023-12-07
##  rstudio  2023.09.0+463 Desert Sunflower (desktop)
##  pandoc   3.1.1 @ /Applications/RStudio.app/Contents/Resources/app/quarto/bin/tools/ (via rmarkdown)
## 
## ─ Packages ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
##  package              * version    date (UTC) lib source
##  abind                  1.4-5      2016-07-21 [2] CRAN (R 4.1.0)
##  ade4                   1.7-22     2023-02-06 [2] CRAN (R 4.1.2)
##  affy                   1.72.0     2021-10-26 [2] Bioconductor
##  affyio                 1.64.0     2021-10-26 [2] Bioconductor
##  annotate               1.72.0     2021-10-26 [2] Bioconductor
##  AnnotationDbi        * 1.60.2     2023-03-10 [2] Bioconductor
##  ape                    5.7-1      2023-03-13 [2] CRAN (R 4.1.2)
##  aplot                  0.1.10     2023-03-08 [2] CRAN (R 4.1.2)
##  attempt                0.3.1      2020-05-03 [2] CRAN (R 4.1.0)
##  backports              1.4.1      2021-12-13 [2] CRAN (R 4.1.0)
##  base64enc              0.1-3      2015-07-28 [2] CRAN (R 4.1.0)
##  Biobase              * 2.54.0     2021-10-26 [2] Bioconductor
##  BiocGenerics         * 0.40.0     2021-10-26 [2] Bioconductor
##  BiocManager            1.30.21    2023-06-10 [2] CRAN (R 4.1.3)
##  BiocParallel           1.28.3     2021-12-09 [2] Bioconductor
##  biomformat             1.22.0     2021-10-26 [2] Bioconductor
##  Biostrings             2.62.0     2021-10-26 [2] Bioconductor
##  bit                    4.0.5      2022-11-15 [2] CRAN (R 4.1.2)
##  bit64                  4.0.5      2020-08-30 [2] CRAN (R 4.1.0)
##  bitops                 1.0-7      2021-04-24 [2] CRAN (R 4.1.0)
##  blob                   1.2.4      2023-03-17 [2] CRAN (R 4.1.2)
##  bookdown               0.34       2023-05-09 [2] CRAN (R 4.1.2)
##  broom                  1.0.5      2023-06-09 [2] CRAN (R 4.1.3)
##  bslib                  0.6.0      2023-11-21 [1] CRAN (R 4.1.3)
##  cachem                 1.0.8      2023-05-01 [2] CRAN (R 4.1.2)
##  Cairo                  1.6-0      2022-07-05 [2] CRAN (R 4.1.2)
##  callr                  3.7.3      2022-11-02 [2] CRAN (R 4.1.2)
##  car                    3.1-2      2023-03-30 [2] CRAN (R 4.1.2)
##  carData                3.0-5      2022-01-06 [2] CRAN (R 4.1.2)
##  caret                  6.0-94     2023-03-21 [2] CRAN (R 4.1.2)
##  caTools                1.18.2     2021-03-28 [2] CRAN (R 4.1.0)
##  cellranger             1.1.0      2016-07-27 [2] CRAN (R 4.1.0)
##  checkmate              2.2.0      2023-04-27 [2] CRAN (R 4.1.2)
##  circlize               0.4.15     2022-05-10 [2] CRAN (R 4.1.2)
##  class                  7.3-22     2023-05-03 [2] CRAN (R 4.1.2)
##  cli                    3.6.1      2023-03-23 [2] CRAN (R 4.1.2)
##  clue                   0.3-64     2023-01-31 [2] CRAN (R 4.1.2)
##  cluster              * 2.1.4      2022-08-22 [2] CRAN (R 4.1.2)
##  clusterProfiler      * 4.2.2      2022-01-13 [2] Bioconductor
##  codetools              0.2-19     2023-02-01 [2] CRAN (R 4.1.2)
##  coin                   1.4-2      2021-10-08 [2] CRAN (R 4.1.0)
##  colorspace             2.1-0      2023-01-23 [2] CRAN (R 4.1.2)
##  ComplexHeatmap         2.10.0     2021-10-26 [2] Bioconductor
##  config                 0.3.1      2020-12-17 [2] CRAN (R 4.1.0)
##  corpcor                1.6.10     2021-09-16 [2] CRAN (R 4.1.0)
##  cowplot                1.1.1      2020-12-30 [2] CRAN (R 4.1.0)
##  crayon                 1.5.2      2022-09-29 [2] CRAN (R 4.1.2)
##  crmn                   0.0.21     2020-02-10 [2] CRAN (R 4.1.0)
##  curl                   5.0.1      2023-06-07 [2] CRAN (R 4.1.3)
##  data.table             1.14.8     2023-02-17 [2] CRAN (R 4.1.2)
##  DBI                    1.1.3      2022-06-18 [2] CRAN (R 4.1.2)
##  DelayedArray           0.20.0     2021-10-26 [2] Bioconductor
##  dendextend           * 1.17.1     2023-03-25 [2] CRAN (R 4.1.2)
##  DESeq2                 1.34.0     2021-10-26 [2] Bioconductor
##  devtools               2.4.5      2022-10-11 [2] CRAN (R 4.1.2)
##  digest                 0.6.33     2023-07-07 [1] CRAN (R 4.1.3)
##  DO.db                  2.9        2022-04-11 [2] Bioconductor
##  doParallel             1.0.17     2022-02-07 [2] CRAN (R 4.1.2)
##  doRNG                  1.8.6      2023-01-16 [2] CRAN (R 4.1.2)
##  DOSE                   3.20.1     2021-11-18 [2] Bioconductor
##  doSNOW                 1.0.20     2022-02-04 [2] CRAN (R 4.1.2)
##  downloader             0.4        2015-07-09 [2] CRAN (R 4.1.0)
##  dplyr                * 1.1.2      2023-04-20 [2] CRAN (R 4.1.2)
##  DT                     0.28       2023-05-18 [2] CRAN (R 4.1.3)
##  dynamicTreeCut         1.63-1     2016-03-11 [2] CRAN (R 4.1.0)
##  e1071                  1.7-13     2023-02-01 [2] CRAN (R 4.1.2)
##  edgeR                  3.36.0     2021-10-26 [2] Bioconductor
##  ellipse                0.4.5      2023-04-05 [2] CRAN (R 4.1.2)
##  ellipsis               0.3.2      2021-04-29 [2] CRAN (R 4.1.0)
##  enrichplot             1.14.2     2022-02-24 [2] Bioconductor
##  evaluate               0.21       2023-05-05 [2] CRAN (R 4.1.2)
##  factoextra           * 1.0.7      2020-04-01 [2] CRAN (R 4.1.0)
##  fansi                  1.0.4      2023-01-22 [2] CRAN (R 4.1.2)
##  farver                 2.1.1      2022-07-06 [2] CRAN (R 4.1.2)
##  fastcluster            1.2.3      2021-05-24 [2] CRAN (R 4.1.0)
##  fastmap                1.1.1      2023-02-24 [2] CRAN (R 4.1.2)
##  fastmatch              1.1-3      2021-07-23 [2] CRAN (R 4.1.0)
##  fdrtool                1.2.17     2021-11-13 [2] CRAN (R 4.1.0)
##  fgsea                  1.20.0     2021-10-26 [2] Bioconductor
##  filematrix             1.3        2018-02-27 [2] CRAN (R 4.1.0)
##  foreach                1.5.2      2022-02-02 [2] CRAN (R 4.1.2)
##  foreign                0.8-84     2022-12-06 [2] CRAN (R 4.1.2)
##  forestplot             3.1.1      2022-12-06 [2] CRAN (R 4.1.2)
##  Formula                1.2-5      2023-02-24 [2] CRAN (R 4.1.2)
##  fs                     1.6.2      2023-04-25 [2] CRAN (R 4.1.2)
##  furrr                  0.3.1      2022-08-15 [2] CRAN (R 4.1.2)
##  future                 1.33.0     2023-07-01 [2] CRAN (R 4.1.3)
##  future.apply           1.11.0     2023-05-21 [2] CRAN (R 4.1.3)
##  genefilter             1.76.0     2021-10-26 [2] Bioconductor
##  geneplotter            1.72.0     2021-10-26 [2] Bioconductor
##  generics               0.1.3      2022-07-05 [2] CRAN (R 4.1.2)
##  GenomeInfoDb         * 1.30.1     2022-01-30 [2] Bioconductor
##  GenomeInfoDbData       1.2.7      2022-03-09 [2] Bioconductor
##  GenomicRanges        * 1.46.1     2021-11-18 [2] Bioconductor
##  GetoptLong             1.0.5      2020-12-15 [2] CRAN (R 4.1.0)
##  ggforce                0.4.1      2022-10-04 [2] CRAN (R 4.1.2)
##  ggfun                  0.1.1      2023-06-24 [2] CRAN (R 4.1.3)
##  ggplot2              * 3.4.2      2023-04-03 [2] CRAN (R 4.1.2)
##  ggplotify              0.1.1      2023-06-27 [2] CRAN (R 4.1.3)
##  ggpubr                 0.6.0      2023-02-10 [2] CRAN (R 4.1.2)
##  ggraph               * 2.1.0.9000 2023-07-11 [1] Github (thomasp85/ggraph@febab71)
##  ggrepel                0.9.3      2023-02-03 [2] CRAN (R 4.1.2)
##  ggsignif               0.6.4      2022-10-13 [2] CRAN (R 4.1.2)
##  ggtree                 3.2.1      2021-11-16 [2] Bioconductor
##  glasso                 1.11       2019-10-01 [2] CRAN (R 4.1.0)
##  glmnet               * 4.1-7      2023-03-23 [2] CRAN (R 4.1.2)
##  GlobalOptions          0.1.2      2020-06-10 [2] CRAN (R 4.1.0)
##  globals                0.16.2     2022-11-21 [2] CRAN (R 4.1.2)
##  globaltest             5.48.0     2021-10-26 [2] Bioconductor
##  glue                 * 1.6.2      2022-02-24 [2] CRAN (R 4.1.2)
##  Gmisc                * 3.0.2      2023-03-13 [2] CRAN (R 4.1.2)
##  gmm                    1.8        2023-06-06 [2] CRAN (R 4.1.3)
##  gmp                    0.7-1      2023-02-07 [2] CRAN (R 4.1.2)
##  GO.db                  3.14.0     2022-04-11 [2] Bioconductor
##  golem                  0.4.1      2023-06-05 [2] CRAN (R 4.1.3)
##  GOSemSim               2.20.0     2021-10-26 [2] Bioconductor
##  gower                  1.0.1      2022-12-22 [2] CRAN (R 4.1.2)
##  gplots                 3.1.3      2022-04-25 [2] CRAN (R 4.1.2)
##  graphlayouts           1.0.0      2023-05-01 [2] CRAN (R 4.1.2)
##  gridExtra              2.3        2017-09-09 [2] CRAN (R 4.1.0)
##  gridGraphics           0.5-1      2020-12-13 [2] CRAN (R 4.1.0)
##  gtable                 0.3.3      2023-03-21 [2] CRAN (R 4.1.2)
##  gtools                 3.9.4      2022-11-27 [2] CRAN (R 4.1.2)
##  hardhat                1.3.0      2023-03-30 [2] CRAN (R 4.1.2)
##  highr                  0.10       2022-12-22 [2] CRAN (R 4.1.2)
##  Hmisc                  5.1-0      2023-05-08 [2] CRAN (R 4.1.2)
##  hms                    1.1.3      2023-03-21 [2] CRAN (R 4.1.2)
##  htmlTable            * 2.4.1      2022-07-07 [2] CRAN (R 4.1.2)
##  htmltools              0.5.7      2023-11-03 [1] CRAN (R 4.1.3)
##  htmlwidgets            1.6.2      2023-03-17 [2] CRAN (R 4.1.2)
##  httpuv                 1.6.11     2023-05-11 [2] CRAN (R 4.1.3)
##  httr                 * 1.4.6      2023-05-08 [2] CRAN (R 4.1.2)
##  huge                   1.3.5      2021-06-30 [2] CRAN (R 4.1.0)
##  igraph                 1.5.0      2023-06-16 [1] CRAN (R 4.1.3)
##  impute                 1.68.0     2021-10-26 [2] Bioconductor
##  imputeLCMD             2.1        2022-06-10 [2] CRAN (R 4.1.2)
##  ipred                  0.9-14     2023-03-09 [2] CRAN (R 4.1.2)
##  IRanges              * 2.28.0     2021-10-26 [2] Bioconductor
##  irlba                  2.3.5.1    2022-10-03 [2] CRAN (R 4.1.2)
##  iterators              1.0.14     2022-02-05 [2] CRAN (R 4.1.2)
##  itertools              0.1-3      2014-03-12 [2] CRAN (R 4.1.0)
##  jpeg                   0.1-10     2022-11-29 [2] CRAN (R 4.1.2)
##  jquerylib              0.1.4      2021-04-26 [2] CRAN (R 4.1.0)
##  jsonlite               1.8.7      2023-06-29 [2] CRAN (R 4.1.3)
##  KEGGREST               1.34.0     2021-10-26 [2] Bioconductor
##  KernSmooth             2.23-22    2023-07-10 [2] CRAN (R 4.1.3)
##  knitr                  1.43       2023-05-25 [2] CRAN (R 4.1.3)
##  labeling               0.4.2      2020-10-20 [2] CRAN (R 4.1.0)
##  later                  1.3.1      2023-05-02 [2] CRAN (R 4.1.2)
##  lattice                0.21-8     2023-04-05 [2] CRAN (R 4.1.2)
##  lava                   1.7.2.1    2023-02-27 [2] CRAN (R 4.1.2)
##  lavaan                 0.6-15     2023-03-14 [2] CRAN (R 4.1.2)
##  lazyeval               0.2.2      2019-03-15 [2] CRAN (R 4.1.0)
##  libcoin                1.0-9      2021-09-27 [2] CRAN (R 4.1.0)
##  lifecycle              1.0.3      2022-10-07 [2] CRAN (R 4.1.2)
##  limma                  3.50.3     2022-04-07 [2] Bioconductor
##  listenv                0.9.0      2022-12-16 [2] CRAN (R 4.1.2)
##  locfit                 1.5-9.8    2023-06-11 [2] CRAN (R 4.1.3)
##  lubridate              1.9.2      2023-02-10 [2] CRAN (R 4.1.2)
##  magrittr             * 2.0.3      2022-03-30 [2] CRAN (R 4.1.2)
##  MALDIquant             1.22.1     2023-03-20 [2] CRAN (R 4.1.2)
##  MASS                   7.3-60     2023-05-04 [2] CRAN (R 4.1.2)
##  massdatabase         * 1.0.7      2023-05-30 [2] gitlab (jaspershen/massdatabase@df83e93)
##  massdataset          * 1.0.24     2023-05-30 [2] gitlab (jaspershen/massdataset@b397116)
##  masstools            * 1.0.10     2023-05-30 [2] gitlab (jaspershen/masstools@b3c73bc)
##  Matrix               * 1.6-0      2023-07-08 [2] CRAN (R 4.1.3)
##  MatrixGenerics       * 1.6.0      2021-10-26 [2] Bioconductor
##  matrixStats          * 1.0.0      2023-06-02 [2] CRAN (R 4.1.3)
##  memoise                2.0.1      2021-11-26 [2] CRAN (R 4.1.0)
##  MetaboAnalystR       * 3.2.0      2022-06-28 [2] Github (xia-lab/MetaboAnalystR@892a31b)
##  metagenomeSeq          1.36.0     2021-10-26 [2] Bioconductor
##  metid                * 1.2.26     2023-05-30 [2] gitlab (jaspershen/metid@6bde121)
##  metpath              * 1.0.5      2023-05-30 [2] gitlab (jaspershen/metpath@adcad4f)
##  mgcv                   1.8-42     2023-03-02 [2] CRAN (R 4.1.2)
##  MicrobiomeProfiler   * 1.0.0      2021-10-26 [2] Bioconductor
##  mime                   0.12       2021-09-28 [2] CRAN (R 4.1.0)
##  miniUI                 0.1.1.1    2018-05-18 [2] CRAN (R 4.1.0)
##  missForest             1.5        2022-04-14 [2] CRAN (R 4.1.2)
##  mixedCCA               1.6.2      2022-09-09 [2] CRAN (R 4.1.2)
##  mixOmics               6.18.1     2021-11-18 [2] Bioconductor (R 4.1.2)
##  mnormt                 2.1.1      2022-09-26 [2] CRAN (R 4.1.2)
##  ModelMetrics           1.2.2.2    2020-03-17 [2] CRAN (R 4.1.0)
##  modeltools             0.2-23     2020-03-05 [2] CRAN (R 4.1.0)
##  MsCoreUtils            1.6.2      2022-02-24 [2] Bioconductor
##  MSnbase              * 2.20.4     2022-01-16 [2] Bioconductor
##  multcomp               1.4-25     2023-06-20 [2] CRAN (R 4.1.3)
##  multtest               2.50.0     2021-10-26 [2] Bioconductor
##  munsell                0.5.0      2018-06-12 [2] CRAN (R 4.1.0)
##  mvtnorm                1.2-2      2023-06-08 [2] CRAN (R 4.1.3)
##  mzID                   1.32.0     2021-10-26 [2] Bioconductor
##  mzR                  * 2.28.0     2021-10-27 [2] Bioconductor
##  ncdf4                  1.21       2023-01-07 [2] CRAN (R 4.1.2)
##  NetCoMi              * 1.0.3      2022-07-14 [2] Github (stefpeschel/NetCoMi@d4d80d3)
##  nlme                   3.1-162    2023-01-31 [2] CRAN (R 4.1.2)
##  nnet                   7.3-19     2023-05-03 [2] CRAN (R 4.1.2)
##  norm                   1.0-11.1   2023-06-18 [2] CRAN (R 4.1.3)
##  openxlsx               4.2.5.2    2023-02-06 [2] CRAN (R 4.1.2)
##  org.Mm.eg.db         * 3.14.0     2022-11-23 [2] Bioconductor
##  parallelly             1.36.0     2023-05-26 [2] CRAN (R 4.1.3)
##  patchwork              1.1.2      2022-08-19 [2] CRAN (R 4.1.2)
##  pbapply                1.7-2      2023-06-27 [2] CRAN (R 4.1.3)
##  pbivnorm               0.6.0      2015-01-23 [2] CRAN (R 4.1.0)
##  pcaMethods             1.86.0     2021-10-26 [2] Bioconductor
##  pcaPP                  2.0-3      2022-10-24 [2] CRAN (R 4.1.2)
##  permute                0.9-7      2022-01-27 [2] CRAN (R 4.1.2)
##  phyloseq               1.38.0     2021-10-26 [2] Bioconductor
##  pillar                 1.9.0      2023-03-22 [2] CRAN (R 4.1.2)
##  pkgbuild               1.4.2      2023-06-26 [2] CRAN (R 4.1.3)
##  pkgconfig              2.0.3      2019-09-22 [2] CRAN (R 4.1.0)
##  pkgload                1.3.2.1    2023-07-08 [2] CRAN (R 4.1.3)
##  plotly               * 4.10.2     2023-06-03 [2] CRAN (R 4.1.3)
##  plyr                   1.8.8      2022-11-11 [2] CRAN (R 4.1.2)
##  png                    0.1-8      2022-11-29 [2] CRAN (R 4.1.2)
##  polyclip               1.10-4     2022-10-20 [2] CRAN (R 4.1.2)
##  POMA                 * 1.7.2      2022-07-26 [2] Github (pcastellanoescuder/POMA@bc8a972)
##  preprocessCore         1.56.0     2021-10-26 [2] Bioconductor
##  prettyunits            1.1.1      2020-01-24 [2] CRAN (R 4.1.0)
##  pROC                   1.18.4     2023-07-06 [2] CRAN (R 4.1.3)
##  processx               3.8.2      2023-06-30 [2] CRAN (R 4.1.3)
##  prodlim                2023.03.31 2023-04-02 [2] CRAN (R 4.1.2)
##  profvis                0.3.8      2023-05-02 [2] CRAN (R 4.1.2)
##  progress               1.2.2      2019-05-16 [2] CRAN (R 4.1.0)
##  promises               1.2.0.1    2021-02-11 [2] CRAN (R 4.1.0)
##  ProtGenerics         * 1.26.0     2021-10-26 [2] Bioconductor
##  proxy                  0.4-27     2022-06-09 [2] CRAN (R 4.1.2)
##  ps                     1.7.5      2023-04-18 [2] CRAN (R 4.1.2)
##  psych                  2.3.6      2023-06-21 [2] CRAN (R 4.1.3)
##  pulsar                 0.3.10     2023-01-26 [2] CRAN (R 4.1.2)
##  purrr                  1.0.1      2023-01-10 [2] CRAN (R 4.1.2)
##  qgraph                 1.9.5      2023-05-16 [2] CRAN (R 4.1.3)
##  qs                     0.25.5     2023-02-22 [2] CRAN (R 4.1.2)
##  quadprog               1.5-8      2019-11-20 [2] CRAN (R 4.1.0)
##  qvalue                 2.26.0     2021-10-26 [2] Bioconductor
##  R6                     2.5.1      2021-08-19 [2] CRAN (R 4.1.0)
##  ragg                   1.2.5      2023-01-12 [2] CRAN (R 4.1.2)
##  randomForest           4.7-1.1    2022-05-23 [2] CRAN (R 4.1.2)
##  RankProd               3.20.0     2021-10-26 [2] Bioconductor
##  RApiSerialize          0.1.2      2022-08-25 [2] CRAN (R 4.1.2)
##  rARPACK                0.11-0     2016-03-10 [2] CRAN (R 4.1.0)
##  rbibutils              2.2.13     2023-01-13 [2] CRAN (R 4.1.2)
##  RColorBrewer           1.1-3      2022-04-03 [2] CRAN (R 4.1.2)
##  Rcpp                 * 1.0.11     2023-07-06 [1] CRAN (R 4.1.3)
##  RcppParallel           5.1.7      2023-02-27 [2] CRAN (R 4.1.2)
##  RCurl                  1.98-1.12  2023-03-27 [2] CRAN (R 4.1.2)
##  Rdisop                 1.54.0     2021-10-26 [2] Bioconductor
##  Rdpack                 2.4        2022-07-20 [2] CRAN (R 4.1.2)
##  readr                  2.1.4      2023-02-10 [2] CRAN (R 4.1.2)
##  readxl               * 1.4.3      2023-07-06 [2] CRAN (R 4.1.3)
##  recipes                1.0.6      2023-04-25 [2] CRAN (R 4.1.2)
##  remotes                2.4.2      2021-11-30 [2] CRAN (R 4.1.0)
##  reshape2               1.4.4      2020-04-09 [2] CRAN (R 4.1.0)
##  rhdf5                  2.38.1     2022-03-10 [2] Bioconductor
##  rhdf5filters           1.6.0      2021-10-26 [2] Bioconductor
##  Rhdf5lib               1.16.0     2021-10-26 [2] Bioconductor
##  rjson                  0.2.21     2022-01-09 [2] CRAN (R 4.1.2)
##  rlang                  1.1.1      2023-04-28 [1] CRAN (R 4.1.2)
##  rmarkdown              2.23       2023-07-01 [2] CRAN (R 4.1.3)
##  Rmpfr                  0.9-2      2023-04-22 [2] CRAN (R 4.1.2)
##  rngtools               1.5.2      2021-09-20 [2] CRAN (R 4.1.0)
##  rootSolve              1.8.2.3    2021-09-29 [2] CRAN (R 4.1.0)
##  ropls                * 1.26.4     2022-01-11 [2] Bioconductor
##  rpart                  4.1.19     2022-10-21 [2] CRAN (R 4.1.2)
##  Rserve               * 1.8-11     2022-11-28 [2] CRAN (R 4.1.2)
##  RSpectra               0.16-1     2022-04-24 [2] CRAN (R 4.1.2)
##  RSQLite                2.3.1      2023-04-03 [2] CRAN (R 4.1.2)
##  rstatix                0.7.2      2023-02-01 [2] CRAN (R 4.1.2)
##  rstudioapi             0.15.0     2023-07-07 [2] CRAN (R 4.1.3)
##  rvest                  1.0.3      2022-08-19 [2] CRAN (R 4.1.2)
##  S4Vectors            * 0.32.4     2022-03-29 [2] Bioconductor
##  sandwich               3.0-2      2022-06-15 [2] CRAN (R 4.1.2)
##  sass                   0.4.6      2023-05-03 [2] CRAN (R 4.1.2)
##  scales                 1.2.1      2022-08-20 [2] CRAN (R 4.1.2)
##  scatterpie             0.2.1      2023-06-07 [2] CRAN (R 4.1.3)
##  scrime                 1.3.5      2018-12-01 [2] CRAN (R 4.1.0)
##  sessioninfo            1.2.2      2021-12-06 [2] CRAN (R 4.1.0)
##  shadowtext             0.1.2      2022-04-22 [2] CRAN (R 4.1.2)
##  shape                  1.4.6      2021-05-19 [2] CRAN (R 4.1.0)
##  shiny                  1.7.4.1    2023-07-06 [2] CRAN (R 4.1.3)
##  shinycustomloader      0.9.0      2018-03-27 [2] CRAN (R 4.1.0)
##  shinyWidgets           0.7.6      2023-01-08 [2] CRAN (R 4.1.2)
##  siggenes               1.68.0     2021-10-26 [2] Bioconductor
##  snow                   0.4-4      2021-10-27 [2] CRAN (R 4.1.0)
##  SpiecEasi            * 1.1.2      2022-07-14 [2] Github (zdk123/SpiecEasi@c463727)
##  SPRING               * 1.0.4      2022-08-03 [2] Github (GraceYoon/SPRING@3d641a4)
##  stringdist             0.9.10     2022-11-07 [2] CRAN (R 4.1.2)
##  stringfish             0.15.8     2023-05-30 [2] CRAN (R 4.1.3)
##  stringi                1.7.12     2023-01-11 [2] CRAN (R 4.1.2)
##  stringr                1.5.0      2022-12-02 [2] CRAN (R 4.1.2)
##  SummarizedExperiment * 1.24.0     2021-10-26 [2] Bioconductor
##  survival               3.5-5      2023-03-12 [2] CRAN (R 4.1.2)
##  systemfonts            1.0.4      2022-02-11 [2] CRAN (R 4.1.2)
##  textshaping            0.3.6      2021-10-13 [2] CRAN (R 4.1.0)
##  TH.data                1.1-2      2023-04-17 [2] CRAN (R 4.1.2)
##  tibble               * 3.2.1      2023-03-20 [2] CRAN (R 4.1.2)
##  tidygraph              1.2.3      2023-02-01 [2] CRAN (R 4.1.2)
##  tidyr                  1.3.0      2023-01-24 [2] CRAN (R 4.1.2)
##  tidyselect             1.2.0      2022-10-10 [2] CRAN (R 4.1.2)
##  tidytree               0.4.2      2022-12-18 [2] CRAN (R 4.1.2)
##  timechange             0.2.0      2023-01-11 [2] CRAN (R 4.1.2)
##  timeDate               4022.108   2023-01-07 [2] CRAN (R 4.1.2)
##  tmvtnorm               1.5        2022-03-22 [2] CRAN (R 4.1.2)
##  treeio                 1.18.1     2021-11-14 [2] Bioconductor
##  tweenr                 2.0.2      2022-09-06 [2] CRAN (R 4.1.2)
##  tzdb                   0.4.0      2023-05-12 [2] CRAN (R 4.1.3)
##  urlchecker             1.0.1      2021-11-30 [2] CRAN (R 4.1.0)
##  usethis                2.2.2      2023-07-06 [2] CRAN (R 4.1.3)
##  utf8                   1.2.3      2023-01-31 [2] CRAN (R 4.1.2)
##  vctrs                  0.6.3      2023-06-14 [1] CRAN (R 4.1.3)
##  vegan                  2.6-4      2022-10-11 [2] CRAN (R 4.1.2)
##  VGAM                   1.1-8      2023-03-09 [2] CRAN (R 4.1.2)
##  viridis                0.6.3      2023-05-03 [2] CRAN (R 4.1.2)
##  viridisLite            0.4.2      2023-05-02 [2] CRAN (R 4.1.2)
##  vsn                    3.62.0     2021-10-26 [2] Bioconductor
##  WGCNA                  1.72-1     2023-01-18 [2] CRAN (R 4.1.2)
##  withr                  2.5.0      2022-03-03 [2] CRAN (R 4.1.2)
##  Wrench                 1.12.0     2021-10-26 [2] Bioconductor
##  xfun                   0.40       2023-08-09 [1] CRAN (R 4.1.3)
##  XMAS2                * 2.2.0      2023-12-06 [1] local
##  XML                    3.99-0.14  2023-03-19 [2] CRAN (R 4.1.2)
##  xml2                   1.3.5      2023-07-06 [2] CRAN (R 4.1.3)
##  xtable                 1.8-4      2019-04-21 [2] CRAN (R 4.1.0)
##  XVector                0.34.0     2021-10-26 [2] Bioconductor
##  yaml                   2.3.7      2023-01-23 [2] CRAN (R 4.1.2)
##  yulab.utils            0.0.6      2022-12-20 [2] CRAN (R 4.1.2)
##  zip                    2.3.0      2023-04-17 [2] CRAN (R 4.1.2)
##  zlibbioc               1.40.0     2021-10-26 [2] Bioconductor
##  zoo                    1.8-12     2023-04-13 [2] CRAN (R 4.1.2)
## 
##  [1] /Users/zouhua/Library/R/x86_64/4.1/library
##  [2] /Library/Frameworks/R.framework/Versions/4.1/Resources/library
## 
## ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="statistical-analysis-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="metorigin-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XbiomeAnalysis/Metabolomics_Aanlysis/blob/main/02-Functional-Analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true,
"toc_depth": 3
}
});
});
</script>

</body>

</html>
