<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Example | Data Analysis in Metabolomics</title>
  <meta name="description" content="A template for Data Analysis in Metabolomics" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Example | Data Analysis in Metabolomics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A template for Data Analysis in Metabolomics" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Example | Data Analysis in Metabolomics" />
  
  <meta name="twitter:description" content="A template for Data Analysis in Metabolomics" />
  

<meta name="author" content="Hua Zou and Bangzhuo Tong" />


<meta name="date" content="2022-08-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="pathway-analysis.html"/>
<link rel="next" href="references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Analysis in Metabolomics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#what-is-metabolomics"><i class="fa fa-check"></i><b>1.1</b> What is metabolomics?</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#what-are-the-procedures-in-this-template"><i class="fa fa-check"></i><b>1.2</b> What are the procedures in this template?</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#statistical-analysis"><i class="fa fa-check"></i><b>1.2.1</b> Statistical Analysis</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#functional-analysis"><i class="fa fa-check"></i><b>1.2.2</b> Functional Analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#software"><i class="fa fa-check"></i><b>1.3</b> Software</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#reference"><i class="fa fa-check"></i><b>1.4</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-processing.html"><a href="data-processing.html"><i class="fa fa-check"></i><b>2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-processing.html"><a href="data-processing.html#loading-packages"><i class="fa fa-check"></i><b>2.1</b> Loading packages</a></li>
<li class="chapter" data-level="2.2" data-path="data-processing.html"><a href="data-processing.html#importing-data"><i class="fa fa-check"></i><b>2.2</b> Importing data</a></li>
<li class="chapter" data-level="2.3" data-path="data-processing.html"><a href="data-processing.html#data-checking"><i class="fa fa-check"></i><b>2.3</b> Data Checking</a></li>
<li class="chapter" data-level="2.4" data-path="data-processing.html"><a href="data-processing.html#data-filtering"><i class="fa fa-check"></i><b>2.4</b> Data Filtering</a></li>
<li class="chapter" data-level="2.5" data-path="data-processing.html"><a href="data-processing.html#missing-value-imputation"><i class="fa fa-check"></i><b>2.5</b> Missing Value Imputation</a></li>
<li class="chapter" data-level="2.6" data-path="data-processing.html"><a href="data-processing.html#data-normalization"><i class="fa fa-check"></i><b>2.6</b> Data Normalization</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="data-processing.html"><a href="data-processing.html#normalization-by-normalizedata-function"><i class="fa fa-check"></i><b>2.6.1</b> Normalization by <strong>NormalizeData</strong> function</a></li>
<li class="chapter" data-level="2.6.2" data-path="data-processing.html"><a href="data-processing.html#normalization-by-poma-r-package"><i class="fa fa-check"></i><b>2.6.2</b> Normalization by <strong>POMA</strong> R package</a></li>
<li class="chapter" data-level="2.6.3" data-path="data-processing.html"><a href="data-processing.html#comparison-of-unnormalized-and-normalized-dataset"><i class="fa fa-check"></i><b>2.6.3</b> Comparison of unnormalized and normalized dataset</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="data-processing.html"><a href="data-processing.html#removing-outliers"><i class="fa fa-check"></i><b>2.7</b> Removing outliers</a></li>
<li class="chapter" data-level="2.8" data-path="data-processing.html"><a href="data-processing.html#saving-datasets-into-rds-files"><i class="fa fa-check"></i><b>2.8</b> Saving datasets into RDS files</a></li>
<li class="chapter" data-level="2.9" data-path="data-processing.html"><a href="data-processing.html#systematic-information"><i class="fa fa-check"></i><b>2.9</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cluster-analysis.html"><a href="cluster-analysis.html"><i class="fa fa-check"></i><b>3</b> Cluster Analysis</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#loading-packages-1"><i class="fa fa-check"></i><b>3.1</b> Loading packages</a></li>
<li class="chapter" data-level="3.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#importing-data-1"><i class="fa fa-check"></i><b>3.2</b> Importing data</a></li>
<li class="chapter" data-level="3.3" data-path="cluster-analysis.html"><a href="cluster-analysis.html#hierarchical-clustering"><i class="fa fa-check"></i><b>3.3</b> Hierarchical Clustering</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="cluster-analysis.html"><a href="cluster-analysis.html#agglomerative-hierarchical-clustering"><i class="fa fa-check"></i><b>3.3.1</b> Agglomerative Hierarchical Clustering</a></li>
<li class="chapter" data-level="3.3.2" data-path="cluster-analysis.html"><a href="cluster-analysis.html#divisive-hierarchical-clustering"><i class="fa fa-check"></i><b>3.3.2</b> Divisive Hierarchical Clustering</a></li>
<li class="chapter" data-level="3.3.3" data-path="cluster-analysis.html"><a href="cluster-analysis.html#comparison"><i class="fa fa-check"></i><b>3.3.3</b> Comparison</a></li>
<li class="chapter" data-level="3.3.4" data-path="cluster-analysis.html"><a href="cluster-analysis.html#determining-optimal-clusters"><i class="fa fa-check"></i><b>3.3.4</b> Determining Optimal Clusters</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="cluster-analysis.html"><a href="cluster-analysis.html#partitional-clustering"><i class="fa fa-check"></i><b>3.4</b> Partitional Clustering</a></li>
<li class="chapter" data-level="3.5" data-path="cluster-analysis.html"><a href="cluster-analysis.html#systematic-information-1"><i class="fa fa-check"></i><b>3.5</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html"><i class="fa fa-check"></i><b>4</b> Chemometrics Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html#loading-packages-2"><i class="fa fa-check"></i><b>4.1</b> Loading packages</a></li>
<li class="chapter" data-level="4.2" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html#importing-data-2"><i class="fa fa-check"></i><b>4.2</b> Importing data</a></li>
<li class="chapter" data-level="4.3" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html#principal-component-analysis-pca"><i class="fa fa-check"></i><b>4.3</b> Principal Component Analysis (PCA)</a></li>
<li class="chapter" data-level="4.4" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html#partial-least-squares-discriminant-analysis-pls-da"><i class="fa fa-check"></i><b>4.4</b> Partial Least Squares-Discriminant Analysis (PLS-DA)</a></li>
<li class="chapter" data-level="4.5" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html#sparse-partial-least-squares-discriminant-analysis-spls-da"><i class="fa fa-check"></i><b>4.5</b> Sparse Partial Least Squares-Discriminant Analysis (sPLS-DA)</a></li>
<li class="chapter" data-level="4.6" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html#orthogonal-partial-least-squares-discriminant-analysis-orthopls-da"><i class="fa fa-check"></i><b>4.6</b> Orthogonal Partial Least Squares-Discriminant Analysis (orthoPLS-DA)</a></li>
<li class="chapter" data-level="4.7" data-path="chemometrics-analysis.html"><a href="chemometrics-analysis.html#systematic-information-2"><i class="fa fa-check"></i><b>4.7</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="univariate-analysis.html"><a href="univariate-analysis.html"><i class="fa fa-check"></i><b>5</b> Univariate Analysis</a>
<ul>
<li class="chapter" data-level="5.1" data-path="univariate-analysis.html"><a href="univariate-analysis.html#loading-packages-3"><i class="fa fa-check"></i><b>5.1</b> Loading packages</a></li>
<li class="chapter" data-level="5.2" data-path="univariate-analysis.html"><a href="univariate-analysis.html#importing-data-3"><i class="fa fa-check"></i><b>5.2</b> Importing data</a></li>
<li class="chapter" data-level="5.3" data-path="univariate-analysis.html"><a href="univariate-analysis.html#fold-change-analysis"><i class="fa fa-check"></i><b>5.3</b> Fold Change Analysis</a></li>
<li class="chapter" data-level="5.4" data-path="univariate-analysis.html"><a href="univariate-analysis.html#t-test"><i class="fa fa-check"></i><b>5.4</b> T Test</a></li>
<li class="chapter" data-level="5.5" data-path="univariate-analysis.html"><a href="univariate-analysis.html#wilcoxon-test"><i class="fa fa-check"></i><b>5.5</b> Wilcoxon Test</a></li>
<li class="chapter" data-level="5.6" data-path="univariate-analysis.html"><a href="univariate-analysis.html#limma-test"><i class="fa fa-check"></i><b>5.6</b> Limma Test</a></li>
<li class="chapter" data-level="5.7" data-path="univariate-analysis.html"><a href="univariate-analysis.html#volcano-plot"><i class="fa fa-check"></i><b>5.7</b> Volcano plot</a></li>
<li class="chapter" data-level="5.8" data-path="univariate-analysis.html"><a href="univariate-analysis.html#correlation-heatmaps"><i class="fa fa-check"></i><b>5.8</b> Correlation Heatmaps</a></li>
<li class="chapter" data-level="5.9" data-path="univariate-analysis.html"><a href="univariate-analysis.html#glasso-this-function-will-compute-a-gaussian-graphical-model-using-the-glmnet-package"><i class="fa fa-check"></i><b>5.9</b> glasso: this function will compute a Gaussian Graphical Model using the glmnet package</a></li>
<li class="chapter" data-level="5.10" data-path="univariate-analysis.html"><a href="univariate-analysis.html#systematic-information-3"><i class="fa fa-check"></i><b>5.10</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html"><i class="fa fa-check"></i><b>6</b> Multivariate analysis</a>
<ul>
<li class="chapter" data-level="6.1" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#loading-packages-4"><i class="fa fa-check"></i><b>6.1</b> Loading packages</a></li>
<li class="chapter" data-level="6.2" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#importing-data-4"><i class="fa fa-check"></i><b>6.2</b> Importing data</a></li>
<li class="chapter" data-level="6.3" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#data-curation"><i class="fa fa-check"></i><b>6.3</b> Data curation</a></li>
<li class="chapter" data-level="6.4" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#regularized-generalized-linear-models"><i class="fa fa-check"></i><b>6.4</b> Regularized Generalized Linear Models</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#lasso-alpha-1"><i class="fa fa-check"></i><b>6.4.1</b> Lasso: alpha = 1</a></li>
<li class="chapter" data-level="6.4.2" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#ridge-alpha-0"><i class="fa fa-check"></i><b>6.4.2</b> Ridge: alpha = 0</a></li>
<li class="chapter" data-level="6.4.3" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#elasticnet-0-alpha-1"><i class="fa fa-check"></i><b>6.4.3</b> Elasticnet: 0 &lt; alpha &lt; 1</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#classification"><i class="fa fa-check"></i><b>6.5</b> Classification</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#random-forest"><i class="fa fa-check"></i><b>6.5.1</b> Random Forest</a></li>
<li class="chapter" data-level="6.5.2" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#support-vector-machine-svm"><i class="fa fa-check"></i><b>6.5.2</b> Support Vector Machine (SVM)</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="multivariate-analysis.html"><a href="multivariate-analysis.html#systematic-information-4"><i class="fa fa-check"></i><b>6.6</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="network-analysis.html"><a href="network-analysis.html"><i class="fa fa-check"></i><b>7</b> Network Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="network-analysis.html"><a href="network-analysis.html#introduction-1"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="network-analysis.html"><a href="network-analysis.html#loading-packages-5"><i class="fa fa-check"></i><b>7.2</b> Loading packages</a></li>
<li class="chapter" data-level="7.3" data-path="network-analysis.html"><a href="network-analysis.html#importing-data-5"><i class="fa fa-check"></i><b>7.3</b> Importing data</a></li>
<li class="chapter" data-level="7.4" data-path="network-analysis.html"><a href="network-analysis.html#data-curation-1"><i class="fa fa-check"></i><b>7.4</b> Data curation</a></li>
<li class="chapter" data-level="7.5" data-path="network-analysis.html"><a href="network-analysis.html#associations-among-features"><i class="fa fa-check"></i><b>7.5</b> Associations Among Features</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="network-analysis.html"><a href="network-analysis.html#single-network-with-pearson-correlation-as-association-measure"><i class="fa fa-check"></i><b>7.5.1</b> Single network with Pearson correlation as association measure</a></li>
<li class="chapter" data-level="7.5.2" data-path="network-analysis.html"><a href="network-analysis.html#single-network-with-spearman-correlation-as-association-measure"><i class="fa fa-check"></i><b>7.5.2</b> Single network with spearman correlation as association measure</a></li>
<li class="chapter" data-level="7.5.3" data-path="network-analysis.html"><a href="network-analysis.html#single-network-with-wgcna-bicor-as-association-measure"><i class="fa fa-check"></i><b>7.5.3</b> Single network with WGCNA (bicor) as association measure</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="network-analysis.html"><a href="network-analysis.html#network-comparison"><i class="fa fa-check"></i><b>7.6</b> Network comparison</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="network-analysis.html"><a href="network-analysis.html#data-preparing"><i class="fa fa-check"></i><b>7.6.1</b> Data preparing</a></li>
<li class="chapter" data-level="7.6.2" data-path="network-analysis.html"><a href="network-analysis.html#building-network-model-3"><i class="fa fa-check"></i><b>7.6.2</b> Building network model</a></li>
<li class="chapter" data-level="7.6.3" data-path="network-analysis.html"><a href="network-analysis.html#network-analysis-1"><i class="fa fa-check"></i><b>7.6.3</b> Network analysis</a></li>
<li class="chapter" data-level="7.6.4" data-path="network-analysis.html"><a href="network-analysis.html#visualizing-the-network-3"><i class="fa fa-check"></i><b>7.6.4</b> Visualizing the network</a></li>
<li class="chapter" data-level="7.6.5" data-path="network-analysis.html"><a href="network-analysis.html#quantitative-network-comparison"><i class="fa fa-check"></i><b>7.6.5</b> Quantitative network comparison</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="network-analysis.html"><a href="network-analysis.html#systematic-information-5"><i class="fa fa-check"></i><b>7.7</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html"><i class="fa fa-check"></i><b>8</b> Enrichment Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html#enviroment-set-up"><i class="fa fa-check"></i><b>8.1</b> Enviroment Set up</a></li>
<li class="chapter" data-level="8.2" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html#over-representation-analysis-ora"><i class="fa fa-check"></i><b>8.2</b> Over representation analysis (ORA)</a></li>
<li class="chapter" data-level="8.3" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html#clean-environment-1"><i class="fa fa-check"></i><b>8.3</b> Clean environment 1</a></li>
<li class="chapter" data-level="8.4" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html#single-sample-profiling"><i class="fa fa-check"></i><b>8.4</b> Single Sample Profiling</a></li>
<li class="chapter" data-level="8.5" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html#clean-environment-2"><i class="fa fa-check"></i><b>8.5</b> Clean environment 2</a></li>
<li class="chapter" data-level="8.6" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html#quantitative-enrichment-analysis-qea"><i class="fa fa-check"></i><b>8.6</b> Quantitative Enrichment Analysis (QEA)</a></li>
<li class="chapter" data-level="8.7" data-path="enrichment-analysis.html"><a href="enrichment-analysis.html#systematic-information-6"><i class="fa fa-check"></i><b>8.7</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="pathway-analysis.html"><a href="pathway-analysis.html"><i class="fa fa-check"></i><b>9</b> Pathway Analysis</a>
<ul>
<li class="chapter" data-level="9.1" data-path="pathway-analysis.html"><a href="pathway-analysis.html#enviroment-set-up-1"><i class="fa fa-check"></i><b>9.1</b> Enviroment Set up</a></li>
<li class="chapter" data-level="9.2" data-path="pathway-analysis.html"><a href="pathway-analysis.html#over-representation-analysis"><i class="fa fa-check"></i><b>9.2</b> Over representation analysis</a></li>
<li class="chapter" data-level="9.3" data-path="pathway-analysis.html"><a href="pathway-analysis.html#clean-environment-1-1"><i class="fa fa-check"></i><b>9.3</b> Clean environment 1</a></li>
<li class="chapter" data-level="9.4" data-path="pathway-analysis.html"><a href="pathway-analysis.html#concentration-table-qea"><i class="fa fa-check"></i><b>9.4</b> Concentration Table (QEA)</a></li>
<li class="chapter" data-level="9.5" data-path="pathway-analysis.html"><a href="pathway-analysis.html#systematic-information-7"><i class="fa fa-check"></i><b>9.5</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="example.html"><a href="example.html"><i class="fa fa-check"></i><b>10</b> Example</a>
<ul>
<li class="chapter" data-level="10.1" data-path="example.html"><a href="example.html#loading-packages-6"><i class="fa fa-check"></i><b>10.1</b> Loading packages</a></li>
<li class="chapter" data-level="10.2" data-path="example.html"><a href="example.html#importing-data-6"><i class="fa fa-check"></i><b>10.2</b> Importing data</a></li>
<li class="chapter" data-level="10.3" data-path="example.html"><a href="example.html#data-processing-1"><i class="fa fa-check"></i><b>10.3</b> Data Processing</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="example.html"><a href="example.html#data-checking-1"><i class="fa fa-check"></i><b>10.3.1</b> Data Checking</a></li>
<li class="chapter" data-level="10.3.2" data-path="example.html"><a href="example.html#data-filtering-1"><i class="fa fa-check"></i><b>10.3.2</b> Data Filtering</a></li>
<li class="chapter" data-level="10.3.3" data-path="example.html"><a href="example.html#missing-value-imputation-1"><i class="fa fa-check"></i><b>10.3.3</b> Missing Value Imputation</a></li>
<li class="chapter" data-level="10.3.4" data-path="example.html"><a href="example.html#data-normalization-1"><i class="fa fa-check"></i><b>10.3.4</b> Data Normalization</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="example.html"><a href="example.html#cluster-analysis-1"><i class="fa fa-check"></i><b>10.4</b> Cluster Analysis</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="example.html"><a href="example.html#hierarchical-clustering-1"><i class="fa fa-check"></i><b>10.4.1</b> Hierarchical Clustering</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="example.html"><a href="example.html#chemometrics-analysis-1"><i class="fa fa-check"></i><b>10.5</b> Chemometrics Analysis</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="example.html"><a href="example.html#partial-least-squares-discriminant-analysis-pls-da-1"><i class="fa fa-check"></i><b>10.5.1</b> Partial Least Squares-Discriminant Analysis (PLS-DA)</a></li>
<li class="chapter" data-level="10.5.2" data-path="example.html"><a href="example.html#sparse-partial-least-squares-discriminant-analysis-spls-da-1"><i class="fa fa-check"></i><b>10.5.2</b> Sparse Partial Least Squares-Discriminant Analysis (sPLS-DA)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="example.html"><a href="example.html#univariate-analysis-1"><i class="fa fa-check"></i><b>10.6</b> Univariate Analysis</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="example.html"><a href="example.html#fold-change-analysis-1"><i class="fa fa-check"></i><b>10.6.1</b> Fold Change Analysis</a></li>
<li class="chapter" data-level="10.6.2" data-path="example.html"><a href="example.html#t-test-1"><i class="fa fa-check"></i><b>10.6.2</b> T Test</a></li>
<li class="chapter" data-level="10.6.3" data-path="example.html"><a href="example.html#volcano-plot-1"><i class="fa fa-check"></i><b>10.6.3</b> Volcano plot</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="example.html"><a href="example.html#feature-selection"><i class="fa fa-check"></i><b>10.7</b> Feature Selection</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="example.html"><a href="example.html#regularized-generalized-linear-models-lasso-alpha-1"><i class="fa fa-check"></i><b>10.7.1</b> Regularized Generalized Linear Models (Lasso: alpha = 1)</a></li>
<li class="chapter" data-level="10.7.2" data-path="example.html"><a href="example.html#classification-random-forest"><i class="fa fa-check"></i><b>10.7.2</b> Classification (Random Forest)</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="example.html"><a href="example.html#network-analysis-2"><i class="fa fa-check"></i><b>10.8</b> Network Analysis</a>
<ul>
<li class="chapter" data-level="10.8.1" data-path="example.html"><a href="example.html#data-curation-2"><i class="fa fa-check"></i><b>10.8.1</b> Data curation</a></li>
<li class="chapter" data-level="10.8.2" data-path="example.html"><a href="example.html#building-network-model-4"><i class="fa fa-check"></i><b>10.8.2</b> Building network model</a></li>
<li class="chapter" data-level="10.8.3" data-path="example.html"><a href="example.html#visualizing-the-network-4"><i class="fa fa-check"></i><b>10.8.3</b> Visualizing the network</a></li>
</ul></li>
<li class="chapter" data-level="10.9" data-path="example.html"><a href="example.html#network-analysis-by-wgcna"><i class="fa fa-check"></i><b>10.9</b> Network Analysis by WGCNA</a>
<ul>
<li class="chapter" data-level="10.9.1" data-path="example.html"><a href="example.html#data-curation-3"><i class="fa fa-check"></i><b>10.9.1</b> Data curation</a></li>
<li class="chapter" data-level="10.9.2" data-path="example.html"><a href="example.html#tuning-soft-thresholds"><i class="fa fa-check"></i><b>10.9.2</b> Tuning soft thresholds</a></li>
<li class="chapter" data-level="10.9.3" data-path="example.html"><a href="example.html#create-the-network-using-the-blockwisemodules"><i class="fa fa-check"></i><b>10.9.3</b> Create the network using the <code>blockwiseModules</code></a></li>
<li class="chapter" data-level="10.9.4" data-path="example.html"><a href="example.html#plot-modules"><i class="fa fa-check"></i><b>10.9.4</b> plot modules</a></li>
<li class="chapter" data-level="10.9.5" data-path="example.html"><a href="example.html#relationships-among-modules"><i class="fa fa-check"></i><b>10.9.5</b> Relationships among modules</a></li>
<li class="chapter" data-level="10.9.6" data-path="example.html"><a href="example.html#module-eigengene-correlation"><i class="fa fa-check"></i><b>10.9.6</b> Module (Eigengene) correlation</a></li>
<li class="chapter" data-level="10.9.7" data-path="example.html"><a href="example.html#relate-module-cluster-assignments-to-groups"><i class="fa fa-check"></i><b>10.9.7</b> Relate Module (cluster) Assignments to Groups</a></li>
<li class="chapter" data-level="10.9.8" data-path="example.html"><a href="example.html#generate-and-export-networks"><i class="fa fa-check"></i><b>10.9.8</b> Generate and Export Networks</a></li>
<li class="chapter" data-level="10.9.9" data-path="example.html"><a href="example.html#network-visualization"><i class="fa fa-check"></i><b>10.9.9</b> Network visualization</a></li>
</ul></li>
<li class="chapter" data-level="10.10" data-path="example.html"><a href="example.html#systematic-information-8"><i class="fa fa-check"></i><b>10.10</b> Systematic Information</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Analysis in Metabolomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Example<a href="example.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We perform all the data analysis on our own metabolomic data in this chapter. There are several datasets:</p>
<ul>
<li><p><strong>GvHD stool metabolites TM wide-target sequencing</strong>: /home/xuxiaomin/project/NanFangHospitalGvHD/00.data/metabolites_TM/MWY-20-522-01_2021-03-25_17-34-06/1.Data_assess/ALL_sample_data.xlsx</p></li>
<li><p><strong>GvHD stool metabolites SCFA</strong>: /home/xuxiaomin/project/NanFangHospitalGvHD/00.data/metabolites_scfa/SCFA.levels.xlsx</p></li>
<li><p><strong>PD-1 mice trial (round 2) serum metabolites TM wide-target sequencing</strong>: /home/xuxiaomin/project/pd1_mice/Round_2/00.data/MetaboliteSerum/MWY-20-049/1.Data_assess/all_group/ALL_sample_data.xlsx</p></li>
</ul>
<p>and the metadata:</p>
<ul>
<li><strong>GvHD metadata</strong>: /home/xuxiaomin/project/NanFangHospitalGvHD/00.data/metadata/metadata_v4.txt</li>
</ul>
<p>We transform their names as following:</p>
<ul>
<li><p>GvHD_stool_metabolites_TM.xlsx</p></li>
<li><p>GvHD_stool_metabolites_SCFA.xlsx</p></li>
<li><p>PD1_mice_serum_metabolites_TM.xlsx</p></li>
<li><p>GvHD_metadata.txt</p></li>
</ul>
<p>Here, we use the <code>GvHD_stool_metabolites_TM.xlsx</code> to practice our template.</p>
<div id="loading-packages-6" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Loading packages<a href="example.html#loading-packages-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="example.html#cb175-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> F)</span>
<span id="cb175-2"><a href="example.html#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="example.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb175-4"><a href="example.html#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb175-5"><a href="example.html#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(POMA)</span>
<span id="cb175-6"><a href="example.html#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb175-7"><a href="example.html#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb175-8"><a href="example.html#cb175-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb175-9"><a href="example.html#cb175-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SummarizedExperiment)</span>
<span id="cb175-10"><a href="example.html#cb175-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb175-11"><a href="example.html#cb175-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-12"><a href="example.html#cb175-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)    <span class="co"># clustering algorithms</span></span>
<span id="cb175-13"><a href="example.html#cb175-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra) <span class="co"># clustering visualization</span></span>
<span id="cb175-14"><a href="example.html#cb175-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend) <span class="co"># for comparing two dendrograms</span></span>
<span id="cb175-15"><a href="example.html#cb175-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-16"><a href="example.html#cb175-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NetCoMi)</span>
<span id="cb175-17"><a href="example.html#cb175-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SPRING)</span>
<span id="cb175-18"><a href="example.html#cb175-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SpiecEasi)</span>
<span id="cb175-19"><a href="example.html#cb175-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-20"><a href="example.html#cb175-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(WGCNA)</span>
<span id="cb175-21"><a href="example.html#cb175-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-22"><a href="example.html#cb175-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-23"><a href="example.html#cb175-23" aria-hidden="true" tabindex="-1"></a><span class="co"># rm(list = ls())</span></span>
<span id="cb175-24"><a href="example.html#cb175-24" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">stringsAsFactors =</span> F)</span>
<span id="cb175-25"><a href="example.html#cb175-25" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">future.globals.maxSize =</span> <span class="dv">1000</span> <span class="sc">*</span> <span class="dv">1024</span><span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="importing-data-6" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Importing data<a href="example.html#importing-data-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>features table</li>
</ul>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="example.html#cb176-1" aria-hidden="true" tabindex="-1"></a>profile <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xlsx</span>(<span class="st">&quot;./dataset/GvHD_stool_metabolites_TM.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="dv">1</span>)</span>
<span id="cb176-2"><a href="example.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(profile)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 78
##   Index  Compounds 物质  `Class I` 物质一级分类 `Class II` 物质二级分类 `Q1 (Da)` `Molecular Wei…`
##   &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1 MEDL0… 2-Hydrox… -     -         -            -          -                 117.             118.
## 2 MEDL0… Phe-Asp   -     -         -            -          -                 245.             348.
## 3 MEDL0… Glu-Phe   -     -         -            -          -                 293.             294.
## 4 MEDL0… Glu-Trp   -     -         -            -          -                 334.             333.
## 5 MEDL0… 1-Oleoyl… -     -         -            -          -                 525.             521.
## 6 MEDL0… Conferti… -     -         -            -          -                 233.             234.
## # … with 69 more variables: `Ionization model` &lt;chr&gt;, Formula &lt;chr&gt;, `KEGG ID` &lt;chr&gt;, HMDB &lt;chr&gt;,
## #   `Pubchem CID` &lt;chr&gt;, CAS &lt;chr&gt;, ChEBI &lt;chr&gt;, Metlin &lt;chr&gt;, mix01 &lt;dbl&gt;, mix02 &lt;dbl&gt;,
## #   mix03 &lt;dbl&gt;, mix04 &lt;dbl&gt;, mix05 &lt;dbl&gt;, mix06 &lt;dbl&gt;, mix07 &lt;dbl&gt;, `TZW-V0` &lt;dbl&gt;,
## #   `LBC-V0` &lt;dbl&gt;, `HXZ-V0` &lt;dbl&gt;, `LJY-V0` &lt;dbl&gt;, `CJY-V0` &lt;dbl&gt;, `WKM-V0` &lt;dbl&gt;,
## #   `WJH-V0` &lt;dbl&gt;, `ZTX2-V0` &lt;dbl&gt;, `DGL-V0` &lt;dbl&gt;, `ZHP-V0` &lt;dbl&gt;, `MZH-V0` &lt;dbl&gt;,
## #   `WL-V0` &lt;dbl&gt;, `LWJ2-V0` &lt;dbl&gt;, `SZP-V0` &lt;dbl&gt;, `LPQ-V0` &lt;dbl&gt;, `LHR-V0` &lt;dbl&gt;,
## #   `XQ-V0` &lt;dbl&gt;, `LJD-V0` &lt;dbl&gt;, `LXH-V0` &lt;dbl&gt;, `YF-V0` &lt;dbl&gt;, `ZJW-V0` &lt;dbl&gt;, …</code></pre>
<ul>
<li>metadata table</li>
</ul>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="example.html#cb178-1" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="st">&quot;./dataset/GvHD_metadata.txt&quot;</span>)</span>
<span id="cb178-2"><a href="example.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(metadata)</span></code></pre></div>
<pre><code>##    seq_id           SampleName FMT_status        SampleType Group V1_outcome GVHD_type
## 1:   4371                  CJY         V0             stool   kid         CR     cGVHD
## 2:   4389                  CJY         V1             stool   kid         CR     cGVHD
## 3:   4426 CJY_WKM_LXH_FMTdonor            bacteria_solution donor                     
## 4:   4375                  DGL         V0             stool adult         CR     cGVHD
## 5:   4393                  DGL         V1             stool adult         CR     cGVHD
## 6:   4435         DGL_FMTdonor            bacteria_solution donor                     
##    GVHD_type_phynotype Donor baseline_merge baseline_aGVHD_sainai baseline_aGVHD_sainai_detail
## 1:            diarrhea   DO1                                                                  
## 2:            diarrhea   DO1                                                                  
## 3:                                                                                            
## 4:               bowel   DO2         medium                                                   
## 5:               bowel   DO2                                                                  
## 6:                                                                                            
##    baseline_aGVHD_glucksberg baseline_aGVHD_glucksberg_detail baseline_cGVHD_NIH
## 1:                                                                              
## 2:                                                                              
## 3:                                                                              
## 4:                                                                          中度
## 5:                                                                              
## 6:                                                                              
##    baseline_cGVHD_NIH_detail Baseline_infection antibiotics_48h_pre_or_post_FMT
## 1:                                                                             
## 2:                                                                             
## 3:                                                                             
## 4:          肠道2级，皮肤1级                                                   
## 5:                                                                             
## 6:                                                                             
##    GVHDdrug_antiMicrobiomeDrug_2weeksPreV0 GVHDdrug_antiMicrobiomeDrug_V0toV1       FMT_method
## 1:                                                                            nasojejunal tube
## 2:                                                                            nasojejunal tube
## 3:                                                                                            
## 4:            他克莫司、麦考酚酯、伊曲康唑       他克莫司、麦考酚酯、伊曲康唑      colonoscope
## 5:            他克莫司、麦考酚酯、伊曲康唑       他克莫司、麦考酚酯、伊曲康唑      colonoscope
## 6:                                                                                            
##    gender age Diagnosis HSCT_DLI_date                                          Pretreatment
## 1:   male   3       AML     2020/5/28 Ara-c+CY+IVBu+ATG+Flu+PTCy+PTCy（Ara+Cy+Bu+Flu+PTCy）
## 2:   male   3       AML     2020/5/28 Ara-c+CY+IVBu+ATG+Flu+PTCy+PTCy（Ara+Cy+Bu+Flu+PTCy）
## 3:         NA                                                                              
## 4:   male  36       AML     2019/12/1                                                  BUCY
## 5:   male  36       AML     2019/12/1                                                  BUCY
## 6:         NA                                                                              
##    Pretreatment_type      GVHD_prevention death relapse
## 1:  marrow cleansing PTCY+PTFLU+MMF+FK506              
## 2:  marrow cleansing PTCY+PTFLU+MMF+FK506              
## 3:                                                     
## 4:  marrow cleansing      CSA+MTX+MMF+ATG              
## 5:  marrow cleansing      CSA+MTX+MMF+ATG              
## 6:</code></pre>
<ul>
<li><p>Data Preparation: SummarizedExperiment object</p></li>
<li><p>Renaming column</p></li>
<li><p>Replace 9 by NA</p></li>
<li><p>column with <code>mix</code> prefix are regards as <strong>QC</strong> samples</p></li>
</ul>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="example.html#cb180-1" aria-hidden="true" tabindex="-1"></a>getSEobject <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb180-2"><a href="example.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-3"><a href="example.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># x = metadata</span></span>
<span id="cb180-4"><a href="example.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># y = profile</span></span>
<span id="cb180-5"><a href="example.html#cb180-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-6"><a href="example.html#cb180-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mix : qc samples</span></span>
<span id="cb180-7"><a href="example.html#cb180-7" aria-hidden="true" tabindex="-1"></a>  qc_samples <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">&quot;mix&quot;</span>, <span class="fu">colnames</span>(profile), <span class="at">value =</span> T)</span>
<span id="cb180-8"><a href="example.html#cb180-8" aria-hidden="true" tabindex="-1"></a>  qc_groups <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">SampleID =</span> qc_samples,</span>
<span id="cb180-9"><a href="example.html#cb180-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">V1_outcome =</span> <span class="fu">rep</span>(<span class="st">&quot;QC&quot;</span>, <span class="fu">length</span>(qc_samples)),</span>
<span id="cb180-10"><a href="example.html#cb180-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">SampleName =</span> <span class="fu">rep</span>(<span class="st">&quot;SampleName&quot;</span>, <span class="fu">length</span>(qc_samples)),</span>
<span id="cb180-11"><a href="example.html#cb180-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FMT_status =</span> <span class="fu">rep</span>(<span class="st">&quot;FMT_status&quot;</span>, <span class="fu">length</span>(qc_samples)),</span>
<span id="cb180-12"><a href="example.html#cb180-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">gender =</span> <span class="fu">rep</span>(<span class="st">&quot;gender&quot;</span>, <span class="fu">length</span>(qc_samples)),</span>
<span id="cb180-13"><a href="example.html#cb180-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">age =</span> <span class="fu">rep</span>(<span class="st">&quot;age&quot;</span>, <span class="fu">length</span>(qc_samples)))</span>
<span id="cb180-14"><a href="example.html#cb180-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># target table</span></span>
<span id="cb180-15"><a href="example.html#cb180-15" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> </span>
<span id="cb180-16"><a href="example.html#cb180-16" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(FMT_status <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb180-17"><a href="example.html#cb180-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">SampleID =</span> <span class="fu">paste</span>(SampleName, FMT_status, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb180-18"><a href="example.html#cb180-18" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(SampleID, V1_outcome, SampleName, FMT_status, gender, age) <span class="sc">%&gt;%</span></span>
<span id="cb180-19"><a href="example.html#cb180-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(qc_groups)</span>
<span id="cb180-20"><a href="example.html#cb180-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-21"><a href="example.html#cb180-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># profile column </span></span>
<span id="cb180-22"><a href="example.html#cb180-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(y) <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;-&quot;</span>, <span class="st">&quot;_&quot;</span>, <span class="fu">colnames</span>(y))</span>
<span id="cb180-23"><a href="example.html#cb180-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-24"><a href="example.html#cb180-24" aria-hidden="true" tabindex="-1"></a>  sid <span class="ot">&lt;-</span> <span class="fu">intersect</span>(target<span class="sc">$</span>SampleID, <span class="fu">colnames</span>(y))</span>
<span id="cb180-25"><a href="example.html#cb180-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-26"><a href="example.html#cb180-26" aria-hidden="true" tabindex="-1"></a>  features <span class="ot">&lt;-</span> y <span class="sc">%&gt;%</span> </span>
<span id="cb180-27"><a href="example.html#cb180-27" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">all_of</span>(sid)) <span class="sc">%&gt;%</span></span>
<span id="cb180-28"><a href="example.html#cb180-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">t</span>()</span>
<span id="cb180-29"><a href="example.html#cb180-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(features) <span class="ot">&lt;-</span> y<span class="sc">$</span>Index</span>
<span id="cb180-30"><a href="example.html#cb180-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-31"><a href="example.html#cb180-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replace 9 by NA </span></span>
<span id="cb180-32"><a href="example.html#cb180-32" aria-hidden="true" tabindex="-1"></a>  features[features <span class="sc">==</span> <span class="dv">9</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb180-33"><a href="example.html#cb180-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-34"><a href="example.html#cb180-34" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> target[<span class="fu">pmatch</span>(sid, target<span class="sc">$</span>SampleID), , F]</span>
<span id="cb180-35"><a href="example.html#cb180-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb180-36"><a href="example.html#cb180-36" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">PomaSummarizedExperiment</span>(<span class="at">target =</span> target, </span>
<span id="cb180-37"><a href="example.html#cb180-37" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">features =</span> features)</span>
<span id="cb180-38"><a href="example.html#cb180-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)  </span>
<span id="cb180-39"><a href="example.html#cb180-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb180-40"><a href="example.html#cb180-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-41"><a href="example.html#cb180-41" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">getSEobject</span>(metadata, profile)</span>
<span id="cb180-42"><a href="example.html#cb180-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-43"><a href="example.html#cb180-43" aria-hidden="true" tabindex="-1"></a>se</span></code></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 1235 61 
## metadata(0):
## assays(1): &#39;&#39;
## rownames(1235): MEDL00066 MEDL00356 ... MW0169477 MW0169569
## rowData names(0):
## colnames(61): CJY_V0 CJY_V1 ... mix06 mix07
## colData names(5): group SampleName FMT_status gender age</code></pre>
</div>
<div id="data-processing-1" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Data Processing<a href="example.html#data-processing-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="data-checking-1" class="section level3 hasAnchor" number="10.3.1">
<h3><span class="header-section-number">10.3.1</span> Data Checking<a href="example.html#data-checking-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Features in PomaSummarizedExperiment object must have the following criterion:</p>
<ul>
<li><p>All data values are numeric.</p></li>
<li><p>A total of 0 (0%) missing values were detected.</p></li>
</ul>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="example.html#cb182-1" aria-hidden="true" tabindex="-1"></a>CheckData <span class="ot">&lt;-</span> <span class="cf">function</span>(object) {</span>
<span id="cb182-2"><a href="example.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-3"><a href="example.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  features_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(object)</span>
<span id="cb182-4"><a href="example.html#cb182-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-5"><a href="example.html#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># numeric &amp; missing values</span></span>
<span id="cb182-6"><a href="example.html#cb182-6" aria-hidden="true" tabindex="-1"></a>  int_mat <span class="ot">&lt;-</span> features_tab</span>
<span id="cb182-7"><a href="example.html#cb182-7" aria-hidden="true" tabindex="-1"></a>  rowNms <span class="ot">&lt;-</span> <span class="fu">rownames</span>(int_mat)</span>
<span id="cb182-8"><a href="example.html#cb182-8" aria-hidden="true" tabindex="-1"></a>  colNms <span class="ot">&lt;-</span> <span class="fu">colnames</span>(int_mat)</span>
<span id="cb182-9"><a href="example.html#cb182-9" aria-hidden="true" tabindex="-1"></a>  naNms <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(int_mat))</span>
<span id="cb182-10"><a href="example.html#cb182-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(int_mat)) {</span>
<span id="cb182-11"><a href="example.html#cb182-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">class</span>(int_mat[, i]) <span class="sc">==</span> <span class="st">&quot;integer64&quot;</span>) {</span>
<span id="cb182-12"><a href="example.html#cb182-12" aria-hidden="true" tabindex="-1"></a>      int_mat[, i] <span class="ot">&lt;-</span> <span class="fu">as.double</span>(int_mat[, i])</span>
<span id="cb182-13"><a href="example.html#cb182-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb182-14"><a href="example.html#cb182-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb182-15"><a href="example.html#cb182-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-16"><a href="example.html#cb182-16" aria-hidden="true" tabindex="-1"></a>  num_mat <span class="ot">&lt;-</span> <span class="fu">apply</span>(int_mat, <span class="dv">2</span>, as.numeric)</span>
<span id="cb182-17"><a href="example.html#cb182-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">is.na</span>(num_mat)) <span class="sc">&gt;</span> naNms) {</span>
<span id="cb182-18"><a href="example.html#cb182-18" aria-hidden="true" tabindex="-1"></a>    num_mat <span class="ot">&lt;-</span> <span class="fu">apply</span>(int_mat, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;,&quot;</span>,  <span class="st">&quot;&quot;</span>, x)))</span>
<span id="cb182-19"><a href="example.html#cb182-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">is.na</span>(num_mat)) <span class="sc">&gt;</span> naNms) {</span>
<span id="cb182-20"><a href="example.html#cb182-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;&lt;font color=</span><span class="sc">\&quot;</span><span class="st">red</span><span class="sc">\&quot;</span><span class="st">&gt;Non-numeric values were found and replaced by NA.&lt;/font&gt;&quot;</span>)</span>
<span id="cb182-21"><a href="example.html#cb182-21" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb182-22"><a href="example.html#cb182-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">&quot;All data values are numeric.&quot;</span>)</span>
<span id="cb182-23"><a href="example.html#cb182-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb182-24"><a href="example.html#cb182-24" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb182-25"><a href="example.html#cb182-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;All data values are numeric.&quot;</span>)</span>
<span id="cb182-26"><a href="example.html#cb182-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb182-27"><a href="example.html#cb182-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-28"><a href="example.html#cb182-28" aria-hidden="true" tabindex="-1"></a>  int_mat <span class="ot">&lt;-</span> num_mat</span>
<span id="cb182-29"><a href="example.html#cb182-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(int_mat) <span class="ot">&lt;-</span> rowNms</span>
<span id="cb182-30"><a href="example.html#cb182-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(int_mat) <span class="ot">&lt;-</span> colNms</span>
<span id="cb182-31"><a href="example.html#cb182-31" aria-hidden="true" tabindex="-1"></a>  varCol <span class="ot">&lt;-</span> <span class="fu">apply</span>(int_mat, <span class="dv">2</span>, var, <span class="at">na.rm =</span> T)</span>
<span id="cb182-32"><a href="example.html#cb182-32" aria-hidden="true" tabindex="-1"></a>  constCol <span class="ot">&lt;-</span> (varCol <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(varCol))</span>
<span id="cb182-33"><a href="example.html#cb182-33" aria-hidden="true" tabindex="-1"></a>  constNum <span class="ot">&lt;-</span> <span class="fu">sum</span>(constCol, <span class="at">na.rm =</span> T)</span>
<span id="cb182-34"><a href="example.html#cb182-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (constNum <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb182-35"><a href="example.html#cb182-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">&quot;&lt;font color=</span><span class="sc">\&quot;</span><span class="st">red</span><span class="sc">\&quot;</span><span class="st">&gt;&quot;</span>, constNum, </span>
<span id="cb182-36"><a href="example.html#cb182-36" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;features with a constant or single value across samples were found and deleted.&lt;/font&gt;&quot;</span>))</span>
<span id="cb182-37"><a href="example.html#cb182-37" aria-hidden="true" tabindex="-1"></a>    int_mat <span class="ot">&lt;-</span> int_mat[, <span class="sc">!</span>constCol, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb182-38"><a href="example.html#cb182-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb182-39"><a href="example.html#cb182-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-40"><a href="example.html#cb182-40" aria-hidden="true" tabindex="-1"></a>  totalCount <span class="ot">&lt;-</span> <span class="fu">nrow</span>(int_mat) <span class="sc">*</span> <span class="fu">ncol</span>(int_mat)</span>
<span id="cb182-41"><a href="example.html#cb182-41" aria-hidden="true" tabindex="-1"></a>  naCount <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(int_mat))</span>
<span id="cb182-42"><a href="example.html#cb182-42" aria-hidden="true" tabindex="-1"></a>  naPercent <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> naCount<span class="sc">/</span>totalCount, <span class="dv">1</span>)</span>
<span id="cb182-43"><a href="example.html#cb182-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-44"><a href="example.html#cb182-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">&quot;A total of &quot;</span>, naCount, <span class="st">&quot; (&quot;</span>, naPercent, </span>
<span id="cb182-45"><a href="example.html#cb182-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;%) missing values were detected.&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>))  </span>
<span id="cb182-46"><a href="example.html#cb182-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-47"><a href="example.html#cb182-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save int_mat into se object </span></span>
<span id="cb182-48"><a href="example.html#cb182-48" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(object) <span class="sc">%&gt;%</span></span>
<span id="cb182-49"><a href="example.html#cb182-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb182-50"><a href="example.html#cb182-50" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;SampleID&quot;</span>)</span>
<span id="cb182-51"><a href="example.html#cb182-51" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">PomaSummarizedExperiment</span>(<span class="at">target =</span> target, </span>
<span id="cb182-52"><a href="example.html#cb182-52" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">features =</span> <span class="fu">t</span>(int_mat))</span>
<span id="cb182-53"><a href="example.html#cb182-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb182-54"><a href="example.html#cb182-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb182-55"><a href="example.html#cb182-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb182-56"><a href="example.html#cb182-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-57"><a href="example.html#cb182-57" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">CheckData</span>(<span class="at">object =</span> se)</span>
<span id="cb182-58"><a href="example.html#cb182-58" aria-hidden="true" tabindex="-1"></a>se</span></code></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 1235 61 
## metadata(0):
## assays(1): &#39;&#39;
## rownames(1235): MEDL00066 MEDL00356 ... MW0169477 MW0169569
## rowData names(0):
## colnames(61): CJY_V0 CJY_V1 ... mix06 mix07
## colData names(5): group SampleName FMT_status gender age</code></pre>
</div>
<div id="data-filtering-1" class="section level3 hasAnchor" number="10.3.2">
<h3><span class="header-section-number">10.3.2</span> Data Filtering<a href="example.html#data-filtering-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="example.html#cb184-1" aria-hidden="true" tabindex="-1"></a>FilterFeature <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb184-2"><a href="example.html#cb184-2" aria-hidden="true" tabindex="-1"></a>                       object,</span>
<span id="cb184-3"><a href="example.html#cb184-3" aria-hidden="true" tabindex="-1"></a>                       qc_label,</span>
<span id="cb184-4"><a href="example.html#cb184-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;iqr&quot;</span>, <span class="st">&quot;rsd&quot;</span>, </span>
<span id="cb184-5"><a href="example.html#cb184-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;nrsd&quot;</span>, <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;sd&quot;</span>,</span>
<span id="cb184-6"><a href="example.html#cb184-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;mad&quot;</span>, <span class="st">&quot;median&quot;</span>),</span>
<span id="cb184-7"><a href="example.html#cb184-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">rsd_cutoff =</span> <span class="dv">25</span>) {</span>
<span id="cb184-8"><a href="example.html#cb184-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-9"><a href="example.html#cb184-9" aria-hidden="true" tabindex="-1"></a>  features_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(object) </span>
<span id="cb184-10"><a href="example.html#cb184-10" aria-hidden="true" tabindex="-1"></a>  metadata_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(object) </span>
<span id="cb184-11"><a href="example.html#cb184-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-12"><a href="example.html#cb184-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># QC samples</span></span>
<span id="cb184-13"><a href="example.html#cb184-13" aria-hidden="true" tabindex="-1"></a>  qc_samples <span class="ot">&lt;-</span> metadata_tab <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb184-14"><a href="example.html#cb184-14" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">==</span> qc_label)</span>
<span id="cb184-15"><a href="example.html#cb184-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">dim</span>(qc_samples)[<span class="dv">1</span>] <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb184-16"><a href="example.html#cb184-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">&quot;No qc samples have been chosen, please check your input&quot;</span>)</span>
<span id="cb184-17"><a href="example.html#cb184-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb184-18"><a href="example.html#cb184-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-19"><a href="example.html#cb184-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># QC samples&#39; feature table</span></span>
<span id="cb184-20"><a href="example.html#cb184-20" aria-hidden="true" tabindex="-1"></a>  qc_feature <span class="ot">&lt;-</span> features_tab[, <span class="fu">colnames</span>(features_tab) <span class="sc">%in%</span> <span class="fu">rownames</span>(qc_samples)] <span class="sc">%&gt;%</span></span>
<span id="cb184-21"><a href="example.html#cb184-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>()</span>
<span id="cb184-22"><a href="example.html#cb184-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-23"><a href="example.html#cb184-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter features by QC RSD</span></span>
<span id="cb184-24"><a href="example.html#cb184-24" aria-hidden="true" tabindex="-1"></a>  rsd <span class="ot">&lt;-</span> rsd_cutoff <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb184-25"><a href="example.html#cb184-25" aria-hidden="true" tabindex="-1"></a>  sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(qc_feature, <span class="dv">2</span>, sd, <span class="at">na.rm =</span> T)</span>
<span id="cb184-26"><a href="example.html#cb184-26" aria-hidden="true" tabindex="-1"></a>  mns <span class="ot">&lt;-</span> <span class="fu">apply</span>(qc_feature, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb184-27"><a href="example.html#cb184-27" aria-hidden="true" tabindex="-1"></a>  rsd_vals <span class="ot">&lt;-</span> <span class="fu">abs</span>(sds<span class="sc">/</span>mns) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb184-28"><a href="example.html#cb184-28" aria-hidden="true" tabindex="-1"></a>  gd_inx <span class="ot">&lt;-</span> rsd_vals <span class="sc">&lt;</span> rsd</span>
<span id="cb184-29"><a href="example.html#cb184-29" aria-hidden="true" tabindex="-1"></a>  int_mat <span class="ot">&lt;-</span> features_tab[gd_inx, ]</span>
<span id="cb184-30"><a href="example.html#cb184-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Removed &quot;</span>, (<span class="fu">dim</span>(qc_feature)[<span class="dv">2</span>] <span class="sc">-</span> <span class="fu">dim</span>(int_mat)[<span class="dv">1</span>]), </span>
<span id="cb184-31"><a href="example.html#cb184-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot; features based on QC RSD values. QC samples are excluded from downstream functional analysis.&quot;</span>)</span>
<span id="cb184-32"><a href="example.html#cb184-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-33"><a href="example.html#cb184-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># whether to filter features by percentage according to the number</span></span>
<span id="cb184-34"><a href="example.html#cb184-34" aria-hidden="true" tabindex="-1"></a>  PerformFeatureFilter <span class="ot">&lt;-</span> <span class="cf">function</span>(datMatrix, </span>
<span id="cb184-35"><a href="example.html#cb184-35" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">qc_method =</span> method,</span>
<span id="cb184-36"><a href="example.html#cb184-36" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">remain_num =</span> <span class="cn">NULL</span>) {</span>
<span id="cb184-37"><a href="example.html#cb184-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-38"><a href="example.html#cb184-38" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> datMatrix</span>
<span id="cb184-39"><a href="example.html#cb184-39" aria-hidden="true" tabindex="-1"></a>    feat_num <span class="ot">&lt;-</span> <span class="fu">ncol</span>(dat)</span>
<span id="cb184-40"><a href="example.html#cb184-40" aria-hidden="true" tabindex="-1"></a>    feat_nms <span class="ot">&lt;-</span> <span class="fu">colnames</span>(dat)</span>
<span id="cb184-41"><a href="example.html#cb184-41" aria-hidden="true" tabindex="-1"></a>    nm <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb184-42"><a href="example.html#cb184-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;none&quot;</span> <span class="sc">&amp;&amp;</span> feat_num <span class="sc">&lt;</span> <span class="dv">5000</span>) { <span class="co"># only allow for less than 4000</span></span>
<span id="cb184-43"><a href="example.html#cb184-43" aria-hidden="true" tabindex="-1"></a>      remain <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">TRUE</span>, feat_num)</span>
<span id="cb184-44"><a href="example.html#cb184-44" aria-hidden="true" tabindex="-1"></a>      nm <span class="ot">&lt;-</span> <span class="st">&quot;No filtering was applied&quot;</span></span>
<span id="cb184-45"><a href="example.html#cb184-45" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb184-46"><a href="example.html#cb184-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;rsd&quot;</span>){</span>
<span id="cb184-47"><a href="example.html#cb184-47" aria-hidden="true" tabindex="-1"></a>        sds <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, sd, <span class="at">na.rm =</span> T)</span>
<span id="cb184-48"><a href="example.html#cb184-48" aria-hidden="true" tabindex="-1"></a>        mns <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb184-49"><a href="example.html#cb184-49" aria-hidden="true" tabindex="-1"></a>        filter_val <span class="ot">&lt;-</span> <span class="fu">abs</span>(sds<span class="sc">/</span>mns)</span>
<span id="cb184-50"><a href="example.html#cb184-50" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="st">&quot;Relative standard deviation&quot;</span></span>
<span id="cb184-51"><a href="example.html#cb184-51" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;nrsd&quot;</span> ) {</span>
<span id="cb184-52"><a href="example.html#cb184-52" aria-hidden="true" tabindex="-1"></a>        mads <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, mad, <span class="at">na.rm =</span> T)</span>
<span id="cb184-53"><a href="example.html#cb184-53" aria-hidden="true" tabindex="-1"></a>        meds <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, median, <span class="at">na.rm =</span> T)</span>
<span id="cb184-54"><a href="example.html#cb184-54" aria-hidden="true" tabindex="-1"></a>        filter_val <span class="ot">&lt;-</span> <span class="fu">abs</span>(mads<span class="sc">/</span>meds)</span>
<span id="cb184-55"><a href="example.html#cb184-55" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="st">&quot;Non-paramatric relative standard deviation&quot;</span></span>
<span id="cb184-56"><a href="example.html#cb184-56" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;mean&quot;</span>) {</span>
<span id="cb184-57"><a href="example.html#cb184-57" aria-hidden="true" tabindex="-1"></a>        filter_val <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, mean, <span class="at">na.rm =</span> T)</span>
<span id="cb184-58"><a href="example.html#cb184-58" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb184-59"><a href="example.html#cb184-59" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;sd&quot;</span>) {</span>
<span id="cb184-60"><a href="example.html#cb184-60" aria-hidden="true" tabindex="-1"></a>        filter_val <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, sd, <span class="at">na.rm =</span> T)</span>
<span id="cb184-61"><a href="example.html#cb184-61" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="st">&quot;standard deviation&quot;</span></span>
<span id="cb184-62"><a href="example.html#cb184-62" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;mad&quot;</span>) {</span>
<span id="cb184-63"><a href="example.html#cb184-63" aria-hidden="true" tabindex="-1"></a>        filter_val <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, mad, <span class="at">na.rm =</span> T)</span>
<span id="cb184-64"><a href="example.html#cb184-64" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="st">&quot;Median absolute deviation&quot;</span></span>
<span id="cb184-65"><a href="example.html#cb184-65" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;median&quot;</span>) {</span>
<span id="cb184-66"><a href="example.html#cb184-66" aria-hidden="true" tabindex="-1"></a>        filter_val <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, median, <span class="at">na.rm =</span> T)</span>
<span id="cb184-67"><a href="example.html#cb184-67" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="st">&quot;median&quot;</span></span>
<span id="cb184-68"><a href="example.html#cb184-68" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (qc_method <span class="sc">==</span> <span class="st">&quot;iqr&quot;</span>) { <span class="co"># iqr</span></span>
<span id="cb184-69"><a href="example.html#cb184-69" aria-hidden="true" tabindex="-1"></a>        filter_val <span class="ot">&lt;-</span> <span class="fu">apply</span>(dat, <span class="dv">2</span>, IQR, <span class="at">na.rm =</span> T)</span>
<span id="cb184-70"><a href="example.html#cb184-70" aria-hidden="true" tabindex="-1"></a>        nm <span class="ot">&lt;-</span> <span class="st">&quot;Interquantile Range&quot;</span></span>
<span id="cb184-71"><a href="example.html#cb184-71" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb184-72"><a href="example.html#cb184-72" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb184-73"><a href="example.html#cb184-73" aria-hidden="true" tabindex="-1"></a>      <span class="co"># get the rank of the filtered variables</span></span>
<span id="cb184-74"><a href="example.html#cb184-74" aria-hidden="true" tabindex="-1"></a>      rk <span class="ot">&lt;-</span> <span class="fu">rank</span>(<span class="sc">-</span>filter_val, <span class="at">ties.method =</span> <span class="st">&quot;random&quot;</span>)</span>
<span id="cb184-75"><a href="example.html#cb184-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb184-76"><a href="example.html#cb184-76" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.null</span>(remain_num)) { <span class="co"># apply empirical filtering based on data size</span></span>
<span id="cb184-77"><a href="example.html#cb184-77" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (feat_num <span class="sc">&lt;</span> <span class="dv">250</span>) { <span class="co"># reduce 5%</span></span>
<span id="cb184-78"><a href="example.html#cb184-78" aria-hidden="true" tabindex="-1"></a>            remain <span class="ot">&lt;-</span> rk <span class="sc">&lt;</span> feat_num <span class="sc">*</span> <span class="fl">0.95</span></span>
<span id="cb184-79"><a href="example.html#cb184-79" aria-hidden="true" tabindex="-1"></a>            <span class="fu">message</span>(<span class="st">&quot;Further feature filtering based on &quot;</span>, nm)</span>
<span id="cb184-80"><a href="example.html#cb184-80" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> <span class="cf">if</span> (feat_num <span class="sc">&lt;</span> <span class="dv">500</span>) { <span class="co"># reduce 10%</span></span>
<span id="cb184-81"><a href="example.html#cb184-81" aria-hidden="true" tabindex="-1"></a>            remain <span class="ot">&lt;-</span> rk <span class="sc">&lt;</span> feat_num <span class="sc">*</span> <span class="fl">0.9</span></span>
<span id="cb184-82"><a href="example.html#cb184-82" aria-hidden="true" tabindex="-1"></a>            <span class="fu">message</span>(<span class="st">&quot;Further feature filtering based on &quot;</span>, nm)</span>
<span id="cb184-83"><a href="example.html#cb184-83" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> <span class="cf">if</span> (feat_num <span class="sc">&lt;</span> <span class="dv">1000</span>) { <span class="co"># reduce 25%</span></span>
<span id="cb184-84"><a href="example.html#cb184-84" aria-hidden="true" tabindex="-1"></a>            remain <span class="ot">&lt;-</span> rk <span class="sc">&lt;</span> feat_num <span class="sc">*</span> <span class="fl">0.75</span></span>
<span id="cb184-85"><a href="example.html#cb184-85" aria-hidden="true" tabindex="-1"></a>            <span class="fu">message</span>(<span class="st">&quot;Further feature filtering based on &quot;</span>, nm)</span>
<span id="cb184-86"><a href="example.html#cb184-86" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> { <span class="co"># reduce 40%, if still over 5000, then only use top 5000</span></span>
<span id="cb184-87"><a href="example.html#cb184-87" aria-hidden="true" tabindex="-1"></a>            remain <span class="ot">&lt;-</span> rk <span class="sc">&lt;</span> feat_num <span class="sc">*</span> <span class="fl">0.6</span></span>
<span id="cb184-88"><a href="example.html#cb184-88" aria-hidden="true" tabindex="-1"></a>            <span class="fu">message</span>(<span class="st">&quot;Further feature filtering based on &quot;</span>, nm)</span>
<span id="cb184-89"><a href="example.html#cb184-89" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb184-90"><a href="example.html#cb184-90" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb184-91"><a href="example.html#cb184-91" aria-hidden="true" tabindex="-1"></a>        remain <span class="ot">&lt;-</span> rk <span class="sc">&lt;</span> remain_num</span>
<span id="cb184-92"><a href="example.html#cb184-92" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb184-93"><a href="example.html#cb184-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb184-94"><a href="example.html#cb184-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-95"><a href="example.html#cb184-95" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> datMatrix[, remain]</span>
<span id="cb184-96"><a href="example.html#cb184-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb184-97"><a href="example.html#cb184-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb184-98"><a href="example.html#cb184-98" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb184-99"><a href="example.html#cb184-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-100"><a href="example.html#cb184-100" aria-hidden="true" tabindex="-1"></a>  feature_res <span class="ot">&lt;-</span> <span class="fu">PerformFeatureFilter</span>(<span class="fu">t</span>(int_mat))</span>
<span id="cb184-101"><a href="example.html#cb184-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-102"><a href="example.html#cb184-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove QC samples </span></span>
<span id="cb184-103"><a href="example.html#cb184-103" aria-hidden="true" tabindex="-1"></a>  feature_final <span class="ot">&lt;-</span> feature_res[<span class="sc">!</span><span class="fu">rownames</span>(feature_res) <span class="sc">%in%</span> <span class="fu">rownames</span>(qc_samples), ]</span>
<span id="cb184-104"><a href="example.html#cb184-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-105"><a href="example.html#cb184-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save int_mat into se object </span></span>
<span id="cb184-106"><a href="example.html#cb184-106" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> metadata_tab <span class="sc">%&gt;%</span> </span>
<span id="cb184-107"><a href="example.html#cb184-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb184-108"><a href="example.html#cb184-108" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;SampleID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-109"><a href="example.html#cb184-109" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(SampleID <span class="sc">%in%</span> <span class="fu">rownames</span>(feature_final))</span>
<span id="cb184-110"><a href="example.html#cb184-110" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">PomaSummarizedExperiment</span>(<span class="at">target =</span> target, </span>
<span id="cb184-111"><a href="example.html#cb184-111" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">features =</span> feature_final)</span>
<span id="cb184-112"><a href="example.html#cb184-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-113"><a href="example.html#cb184-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res) </span>
<span id="cb184-114"><a href="example.html#cb184-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-115"><a href="example.html#cb184-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-116"><a href="example.html#cb184-116" aria-hidden="true" tabindex="-1"></a>se_filter <span class="ot">&lt;-</span> <span class="fu">FilterFeature</span>(<span class="at">object =</span> se,</span>
<span id="cb184-117"><a href="example.html#cb184-117" aria-hidden="true" tabindex="-1"></a>                           <span class="at">qc_label =</span> <span class="st">&quot;QC&quot;</span>,</span>
<span id="cb184-118"><a href="example.html#cb184-118" aria-hidden="true" tabindex="-1"></a>                           <span class="at">method =</span> <span class="st">&quot;iqr&quot;</span>)</span>
<span id="cb184-119"><a href="example.html#cb184-119" aria-hidden="true" tabindex="-1"></a>se_filter</span></code></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 715 54 
## metadata(0):
## assays(1): &#39;&#39;
## rownames(715): MEDL00066 MEDL00375 ... MW0168764 MW0169569
## rowData names(0):
## colnames(54): CJY_V0 CJY_V1 ... ZTX2_V0 ZTX2_V1
## colData names(5): group SampleName FMT_status gender age</code></pre>
</div>
<div id="missing-value-imputation-1" class="section level3 hasAnchor" number="10.3.3">
<h3><span class="header-section-number">10.3.3</span> Missing Value Imputation<a href="example.html#missing-value-imputation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="example.html#cb186-1" aria-hidden="true" tabindex="-1"></a>se_impute <span class="ot">&lt;-</span> <span class="fu">PomaImpute</span>(</span>
<span id="cb186-2"><a href="example.html#cb186-2" aria-hidden="true" tabindex="-1"></a>                    se_filter, </span>
<span id="cb186-3"><a href="example.html#cb186-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ZerosAsNA =</span> <span class="cn">TRUE</span>, </span>
<span id="cb186-4"><a href="example.html#cb186-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">RemoveNA =</span> <span class="cn">TRUE</span>, </span>
<span id="cb186-5"><a href="example.html#cb186-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">cutoff =</span> <span class="dv">20</span>, </span>
<span id="cb186-6"><a href="example.html#cb186-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>)</span>
<span id="cb186-7"><a href="example.html#cb186-7" aria-hidden="true" tabindex="-1"></a>se_impute</span></code></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 540 54 
## metadata(0):
## assays(1): &#39;&#39;
## rownames(540): MEDL00066 MEDL00375 ... MW0168675 MW0169569
## rowData names(0):
## colnames(54): CJY_V0 CJY_V1 ... ZTX2_V0 ZTX2_V1
## colData names(5): group SampleName FMT_status gender age</code></pre>
</div>
<div id="data-normalization-1" class="section level3 hasAnchor" number="10.3.4">
<h3><span class="header-section-number">10.3.4</span> Data Normalization<a href="example.html#data-normalization-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="normalization-by-normalizedata-function-1" class="section level4 hasAnchor" number="10.3.4.1">
<h4><span class="header-section-number">10.3.4.1</span> Normalization by <strong>NormalizeData</strong> function<a href="example.html#normalization-by-normalizedata-function-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="example.html#cb188-1" aria-hidden="true" tabindex="-1"></a>NormalizeData <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb188-2"><a href="example.html#cb188-2" aria-hidden="true" tabindex="-1"></a>                      object,</span>
<span id="cb188-3"><a href="example.html#cb188-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rowNorm =</span> <span class="fu">c</span>(<span class="st">&quot;Quantile&quot;</span>, <span class="st">&quot;GroupPQN&quot;</span>, <span class="st">&quot;SamplePQN&quot;</span>, </span>
<span id="cb188-4"><a href="example.html#cb188-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;CompNorm&quot;</span>, <span class="st">&quot;SumNorm&quot;</span>, <span class="st">&quot;MedianNorm&quot;</span>,</span>
<span id="cb188-5"><a href="example.html#cb188-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;SpecNorm&quot;</span>, <span class="st">&quot;None&quot;</span>),</span>
<span id="cb188-6"><a href="example.html#cb188-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">transNorm =</span> <span class="fu">c</span>(<span class="st">&quot;LogNorm&quot;</span>, <span class="st">&quot;SrNorm&quot;</span>, <span class="st">&quot;CrNorm&quot;</span>, <span class="st">&quot;None&quot;</span>),</span>
<span id="cb188-7"><a href="example.html#cb188-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scaleNorm =</span> <span class="fu">c</span>(<span class="st">&quot;MeanCenter&quot;</span>, <span class="st">&quot;AutoNorm&quot;</span>, <span class="st">&quot;ParetoNorm&quot;</span>, </span>
<span id="cb188-8"><a href="example.html#cb188-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;RangeNorm&quot;</span>, <span class="st">&quot;None&quot;</span>),</span>
<span id="cb188-9"><a href="example.html#cb188-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ref =</span> <span class="cn">NULL</span>,</span>
<span id="cb188-10"><a href="example.html#cb188-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">SpeWeight =</span> <span class="dv">1</span>) {</span>
<span id="cb188-11"><a href="example.html#cb188-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-12"><a href="example.html#cb188-12" aria-hidden="true" tabindex="-1"></a>  features_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(object) </span>
<span id="cb188-13"><a href="example.html#cb188-13" aria-hidden="true" tabindex="-1"></a>  metadata_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(object)   </span>
<span id="cb188-14"><a href="example.html#cb188-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-15"><a href="example.html#cb188-15" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">t</span>(features_tab)</span>
<span id="cb188-16"><a href="example.html#cb188-16" aria-hidden="true" tabindex="-1"></a>  colNames <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data)</span>
<span id="cb188-17"><a href="example.html#cb188-17" aria-hidden="true" tabindex="-1"></a>  rowNames <span class="ot">&lt;-</span> <span class="fu">rownames</span>(data)</span>
<span id="cb188-18"><a href="example.html#cb188-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-19"><a href="example.html#cb188-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">#############################################</span></span>
<span id="cb188-20"><a href="example.html#cb188-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sample normalization</span></span>
<span id="cb188-21"><a href="example.html#cb188-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># perform quantile normalization on the raw data (can be log transformed later by user)</span></span>
<span id="cb188-22"><a href="example.html#cb188-22" aria-hidden="true" tabindex="-1"></a>  QuantileNormalize <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb188-23"><a href="example.html#cb188-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">t</span>(preprocessCore<span class="sc">::</span><span class="fu">normalize.quantiles</span>(<span class="fu">t</span>(data), <span class="at">copy=</span><span class="cn">FALSE</span>)));</span>
<span id="cb188-24"><a href="example.html#cb188-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-25"><a href="example.html#cb188-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize by a reference sample (probability quotient normalization)</span></span>
<span id="cb188-26"><a href="example.html#cb188-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ref should be the name of the reference sample</span></span>
<span id="cb188-27"><a href="example.html#cb188-27" aria-hidden="true" tabindex="-1"></a>  ProbNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ref_smpl) {</span>
<span id="cb188-28"><a href="example.html#cb188-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x<span class="sc">/</span><span class="fu">median</span>(<span class="fu">as.numeric</span>(x<span class="sc">/</span>ref_smpl), <span class="at">na.rm =</span> T))</span>
<span id="cb188-29"><a href="example.html#cb188-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-30"><a href="example.html#cb188-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-31"><a href="example.html#cb188-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize by a reference reference (i.e. creatinine)</span></span>
<span id="cb188-32"><a href="example.html#cb188-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ref should be the name of the cmpd</span></span>
<span id="cb188-33"><a href="example.html#cb188-33" aria-hidden="true" tabindex="-1"></a>  CompNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ref) {</span>
<span id="cb188-34"><a href="example.html#cb188-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1000</span><span class="sc">*</span>x<span class="sc">/</span>x[ref])</span>
<span id="cb188-35"><a href="example.html#cb188-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-36"><a href="example.html#cb188-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-37"><a href="example.html#cb188-37" aria-hidden="true" tabindex="-1"></a>  SumNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb188-38"><a href="example.html#cb188-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1000</span><span class="sc">*</span>x<span class="sc">/</span><span class="fu">sum</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb188-39"><a href="example.html#cb188-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-40"><a href="example.html#cb188-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-41"><a href="example.html#cb188-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize by median</span></span>
<span id="cb188-42"><a href="example.html#cb188-42" aria-hidden="true" tabindex="-1"></a>  MedianNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb188-43"><a href="example.html#cb188-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x<span class="sc">/</span><span class="fu">median</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb188-44"><a href="example.html#cb188-44" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb188-45"><a href="example.html#cb188-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-46"><a href="example.html#cb188-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># row-wise normalization</span></span>
<span id="cb188-47"><a href="example.html#cb188-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (rowNorm <span class="sc">==</span> <span class="st">&quot;Quantile&quot;</span>) {</span>
<span id="cb188-48"><a href="example.html#cb188-48" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">QuantileNormalize</span>(data)</span>
<span id="cb188-49"><a href="example.html#cb188-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># this can introduce constant variables if a variable is </span></span>
<span id="cb188-50"><a href="example.html#cb188-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># at the same rank across all samples (replaced by its average across all)</span></span>
<span id="cb188-51"><a href="example.html#cb188-51" aria-hidden="true" tabindex="-1"></a>    varCol <span class="ot">&lt;-</span> <span class="fu">apply</span>(data, <span class="dv">2</span>, var, <span class="at">na.rm =</span> T)</span>
<span id="cb188-52"><a href="example.html#cb188-52" aria-hidden="true" tabindex="-1"></a>    constCol <span class="ot">&lt;-</span> (varCol <span class="sc">==</span> <span class="dv">0</span> <span class="sc">|</span> <span class="fu">is.na</span>(varCol))</span>
<span id="cb188-53"><a href="example.html#cb188-53" aria-hidden="true" tabindex="-1"></a>    constNum <span class="ot">&lt;-</span> <span class="fu">sum</span>(constCol, <span class="at">na.rm =</span> T)</span>
<span id="cb188-54"><a href="example.html#cb188-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (constNum <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb188-55"><a href="example.html#cb188-55" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="fu">paste</span>(<span class="st">&quot;After quantile normalization&quot;</span>, constNum, </span>
<span id="cb188-56"><a href="example.html#cb188-56" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;features with a constant value were found and deleted.&quot;</span>))</span>
<span id="cb188-57"><a href="example.html#cb188-57" aria-hidden="true" tabindex="-1"></a>      data <span class="ot">&lt;-</span> data[, <span class="sc">!</span>constCol, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb188-58"><a href="example.html#cb188-58" aria-hidden="true" tabindex="-1"></a>      colNames <span class="ot">&lt;-</span> <span class="fu">colnames</span>(data)</span>
<span id="cb188-59"><a href="example.html#cb188-59" aria-hidden="true" tabindex="-1"></a>      rowNames <span class="ot">&lt;-</span> <span class="fu">rownames</span>(data)</span>
<span id="cb188-60"><a href="example.html#cb188-60" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb188-61"><a href="example.html#cb188-61" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;Quantile Normalization&quot;</span></span>
<span id="cb188-62"><a href="example.html#cb188-62" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (rowNorm <span class="sc">==</span> <span class="st">&quot;GroupPQN&quot;</span>) {</span>
<span id="cb188-63"><a href="example.html#cb188-63" aria-hidden="true" tabindex="-1"></a>    grp_inx <span class="ot">&lt;-</span> metadata_tab<span class="sc">$</span>group <span class="sc">==</span> ref</span>
<span id="cb188-64"><a href="example.html#cb188-64" aria-hidden="true" tabindex="-1"></a>    ref.smpl <span class="ot">&lt;-</span> <span class="fu">apply</span>(data[grp_inx, , <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="dv">2</span>, mean)</span>
<span id="cb188-65"><a href="example.html#cb188-65" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(data, <span class="dv">1</span>, ProbNorm, ref.smpl))</span>
<span id="cb188-66"><a href="example.html#cb188-66" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;Probabilistic Quotient Normalization by a reference group&quot;</span></span>
<span id="cb188-67"><a href="example.html#cb188-67" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (rowNorm <span class="sc">==</span> <span class="st">&quot;SamplePQN&quot;</span>) {</span>
<span id="cb188-68"><a href="example.html#cb188-68" aria-hidden="true" tabindex="-1"></a>    ref.smpl <span class="ot">&lt;-</span> data[ref, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb188-69"><a href="example.html#cb188-69" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(data, <span class="dv">1</span>, ProbNorm, ref.smpl))</span>
<span id="cb188-70"><a href="example.html#cb188-70" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;Probabilistic Quotient Normalization by a reference sample&quot;</span></span>
<span id="cb188-71"><a href="example.html#cb188-71" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (rowNorm <span class="sc">==</span> <span class="st">&quot;CompNorm&quot;</span>) {</span>
<span id="cb188-72"><a href="example.html#cb188-72" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(<span class="fu">t</span>(data), <span class="dv">1</span>, CompNorm, ref))</span>
<span id="cb188-73"><a href="example.html#cb188-73" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;Normalization by a reference feature&quot;</span>;</span>
<span id="cb188-74"><a href="example.html#cb188-74" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (rowNorm <span class="sc">==</span> <span class="st">&quot;SumNorm&quot;</span>) {</span>
<span id="cb188-75"><a href="example.html#cb188-75" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(data, <span class="dv">1</span>, SumNorm))</span>
<span id="cb188-76"><a href="example.html#cb188-76" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;Normalization to constant sum&quot;</span></span>
<span id="cb188-77"><a href="example.html#cb188-77" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (rowNorm <span class="sc">==</span> <span class="st">&quot;MedianNorm&quot;</span>) {</span>
<span id="cb188-78"><a href="example.html#cb188-78" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(data, <span class="dv">1</span>, MedianNorm))</span>
<span id="cb188-79"><a href="example.html#cb188-79" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;Normalization to sample median&quot;</span></span>
<span id="cb188-80"><a href="example.html#cb188-80" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(rowNorm <span class="sc">==</span> <span class="st">&quot;SpecNorm&quot;</span>) {</span>
<span id="cb188-81"><a href="example.html#cb188-81" aria-hidden="true" tabindex="-1"></a>    norm.vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(SpeWeight, <span class="fu">nrow</span>(data)) <span class="co"># default all same weight vec to prevent error</span></span>
<span id="cb188-82"><a href="example.html#cb188-82" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data <span class="sc">/</span> norm.vec</span>
<span id="cb188-83"><a href="example.html#cb188-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;No sample specific information were given, all set to 1.0&quot;</span>)</span>
<span id="cb188-84"><a href="example.html#cb188-84" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;Normalization by sample-specific factor&quot;</span></span>
<span id="cb188-85"><a href="example.html#cb188-85" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb188-86"><a href="example.html#cb188-86" aria-hidden="true" tabindex="-1"></a>    <span class="co"># nothing to do</span></span>
<span id="cb188-87"><a href="example.html#cb188-87" aria-hidden="true" tabindex="-1"></a>    rownm <span class="ot">&lt;-</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb188-88"><a href="example.html#cb188-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-89"><a href="example.html#cb188-89" aria-hidden="true" tabindex="-1"></a>  <span class="do">################################################ </span></span>
<span id="cb188-90"><a href="example.html#cb188-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-91"><a href="example.html#cb188-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use apply will lose dimension info (i.e. row names and colnames)</span></span>
<span id="cb188-92"><a href="example.html#cb188-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(data) <span class="ot">&lt;-</span> rowNames</span>
<span id="cb188-93"><a href="example.html#cb188-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> colNames</span>
<span id="cb188-94"><a href="example.html#cb188-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-95"><a href="example.html#cb188-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if the reference by feature, the feature column should be removed, since it is all 1</span></span>
<span id="cb188-96"><a href="example.html#cb188-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(rowNorm <span class="sc">==</span> <span class="st">&quot;CompNorm&quot;</span> <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(ref)){</span>
<span id="cb188-97"><a href="example.html#cb188-97" aria-hidden="true" tabindex="-1"></a>    inx <span class="ot">&lt;-</span> <span class="fu">match</span>(ref, <span class="fu">colnames</span>(data))</span>
<span id="cb188-98"><a href="example.html#cb188-98" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> data[, <span class="sc">-</span>inx, drop<span class="ot">=</span><span class="cn">FALSE</span>]</span>
<span id="cb188-99"><a href="example.html#cb188-99" aria-hidden="true" tabindex="-1"></a>    colNames <span class="ot">&lt;-</span> colNames[<span class="sc">-</span>inx]</span>
<span id="cb188-100"><a href="example.html#cb188-100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-101"><a href="example.html#cb188-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-102"><a href="example.html#cb188-102" aria-hidden="true" tabindex="-1"></a>  <span class="do">#############################################</span></span>
<span id="cb188-103"><a href="example.html#cb188-103" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  Data transformation</span></span>
<span id="cb188-104"><a href="example.html#cb188-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># generalize log, tolerant to 0 and negative values</span></span>
<span id="cb188-105"><a href="example.html#cb188-105" aria-hidden="true" tabindex="-1"></a>  LogNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, min.val) {</span>
<span id="cb188-106"><a href="example.html#cb188-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">log10</span>((x <span class="sc">+</span> <span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> min.val<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb188-107"><a href="example.html#cb188-107" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-108"><a href="example.html#cb188-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-109"><a href="example.html#cb188-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># square root, tolerant to negative values</span></span>
<span id="cb188-110"><a href="example.html#cb188-110" aria-hidden="true" tabindex="-1"></a>  SquareRootNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x, min.val) {</span>
<span id="cb188-111"><a href="example.html#cb188-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(((x <span class="sc">+</span> <span class="fu">sqrt</span>(x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> min.val<span class="sc">^</span><span class="dv">2</span>))<span class="sc">/</span><span class="dv">2</span>)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb188-112"><a href="example.html#cb188-112" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-113"><a href="example.html#cb188-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-114"><a href="example.html#cb188-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (transNorm <span class="sc">==</span> <span class="st">&quot;LogNorm&quot;</span>) {</span>
<span id="cb188-115"><a href="example.html#cb188-115" aria-hidden="true" tabindex="-1"></a>    min.val <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">abs</span>(data[data <span class="sc">!=</span> <span class="dv">0</span>]))<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb188-116"><a href="example.html#cb188-116" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">apply</span>(data, <span class="dv">2</span>, LogNorm, min.val)</span>
<span id="cb188-117"><a href="example.html#cb188-117" aria-hidden="true" tabindex="-1"></a>    transnm <span class="ot">&lt;-</span> <span class="st">&quot;Log10 Normalization&quot;</span></span>
<span id="cb188-118"><a href="example.html#cb188-118" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (transNorm <span class="sc">==</span> <span class="st">&quot;SrNorm&quot;</span>) {</span>
<span id="cb188-119"><a href="example.html#cb188-119" aria-hidden="true" tabindex="-1"></a>    min.val <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">abs</span>(data[data <span class="sc">!=</span> <span class="dv">0</span>]))<span class="sc">/</span><span class="dv">10</span></span>
<span id="cb188-120"><a href="example.html#cb188-120" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">apply</span>(data, <span class="dv">2</span>, SquareRootNorm, min.val)</span>
<span id="cb188-121"><a href="example.html#cb188-121" aria-hidden="true" tabindex="-1"></a>    transnm <span class="ot">&lt;-</span> <span class="st">&quot;Square Root Transformation&quot;</span></span>
<span id="cb188-122"><a href="example.html#cb188-122" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (transNorm <span class="sc">==</span> <span class="st">&quot;CrNorm&quot;</span>) {</span>
<span id="cb188-123"><a href="example.html#cb188-123" aria-hidden="true" tabindex="-1"></a>    norm.data <span class="ot">&lt;-</span> <span class="fu">abs</span>(data)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span>
<span id="cb188-124"><a href="example.html#cb188-124" aria-hidden="true" tabindex="-1"></a>    norm.data[data <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="sc">-</span>norm.data[data <span class="sc">&lt;</span> <span class="dv">0</span>]</span>
<span id="cb188-125"><a href="example.html#cb188-125" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> norm.data</span>
<span id="cb188-126"><a href="example.html#cb188-126" aria-hidden="true" tabindex="-1"></a>    transnm <span class="ot">&lt;-</span> <span class="st">&quot;Cubic Root Transformation&quot;</span></span>
<span id="cb188-127"><a href="example.html#cb188-127" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb188-128"><a href="example.html#cb188-128" aria-hidden="true" tabindex="-1"></a>    transnm <span class="ot">&lt;-</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb188-129"><a href="example.html#cb188-129" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-130"><a href="example.html#cb188-130" aria-hidden="true" tabindex="-1"></a>  <span class="do">#############################################</span></span>
<span id="cb188-131"><a href="example.html#cb188-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-132"><a href="example.html#cb188-132" aria-hidden="true" tabindex="-1"></a>  <span class="do">#############################################</span></span>
<span id="cb188-133"><a href="example.html#cb188-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data scaling</span></span>
<span id="cb188-134"><a href="example.html#cb188-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize to zero mean and unit variance</span></span>
<span id="cb188-135"><a href="example.html#cb188-135" aria-hidden="true" tabindex="-1"></a>  AutoNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb188-136"><a href="example.html#cb188-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sd</span>(x, <span class="at">na.rm =</span> T))</span>
<span id="cb188-137"><a href="example.html#cb188-137" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-138"><a href="example.html#cb188-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-139"><a href="example.html#cb188-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize to zero mean but variance/SE</span></span>
<span id="cb188-140"><a href="example.html#cb188-140" aria-hidden="true" tabindex="-1"></a>  ParetoNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb188-141"><a href="example.html#cb188-141" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">sd</span>(x, <span class="at">na.rm =</span> T)))</span>
<span id="cb188-142"><a href="example.html#cb188-142" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-143"><a href="example.html#cb188-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-144"><a href="example.html#cb188-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize to zero mean but variance/SE</span></span>
<span id="cb188-145"><a href="example.html#cb188-145" aria-hidden="true" tabindex="-1"></a>  MeanCenter <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb188-146"><a href="example.html#cb188-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x <span class="sc">-</span> <span class="fu">mean</span>(x))</span>
<span id="cb188-147"><a href="example.html#cb188-147" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-148"><a href="example.html#cb188-148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-149"><a href="example.html#cb188-149" aria-hidden="true" tabindex="-1"></a>  <span class="co"># normalize to zero mean but variance/SE</span></span>
<span id="cb188-150"><a href="example.html#cb188-150" aria-hidden="true" tabindex="-1"></a>  RangeNorm <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb188-151"><a href="example.html#cb188-151" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">max</span>(x) <span class="sc">==</span> <span class="fu">min</span>(x)) {</span>
<span id="cb188-152"><a href="example.html#cb188-152" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(x)</span>
<span id="cb188-153"><a href="example.html#cb188-153" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb188-154"><a href="example.html#cb188-154" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>((x <span class="sc">-</span> <span class="fu">mean</span>(x))<span class="sc">/</span>(<span class="fu">max</span>(x) <span class="sc">-</span> <span class="fu">min</span>(x)))</span>
<span id="cb188-155"><a href="example.html#cb188-155" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb188-156"><a href="example.html#cb188-156" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-157"><a href="example.html#cb188-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-158"><a href="example.html#cb188-158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (scaleNorm <span class="sc">==</span> <span class="st">&quot;MeanCenter&quot;</span>) {</span>
<span id="cb188-159"><a href="example.html#cb188-159" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">apply</span>(data, <span class="dv">2</span>, MeanCenter)</span>
<span id="cb188-160"><a href="example.html#cb188-160" aria-hidden="true" tabindex="-1"></a>    scalenm <span class="ot">&lt;-</span> <span class="st">&quot;Mean Centering&quot;</span></span>
<span id="cb188-161"><a href="example.html#cb188-161" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (scaleNorm <span class="sc">==</span> <span class="st">&quot;AutoNorm&quot;</span>) {</span>
<span id="cb188-162"><a href="example.html#cb188-162" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">apply</span>(data, <span class="dv">2</span>, AutoNorm)</span>
<span id="cb188-163"><a href="example.html#cb188-163" aria-hidden="true" tabindex="-1"></a>    scalenm <span class="ot">&lt;-</span> <span class="st">&quot;Autoscaling&quot;</span></span>
<span id="cb188-164"><a href="example.html#cb188-164" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (scaleNorm <span class="sc">==</span> <span class="st">&quot;ParetoNorm&quot;</span>) {</span>
<span id="cb188-165"><a href="example.html#cb188-165" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">apply</span>(data, <span class="dv">2</span>, ParetoNorm)</span>
<span id="cb188-166"><a href="example.html#cb188-166" aria-hidden="true" tabindex="-1"></a>    scalenm <span class="ot">&lt;-</span> <span class="st">&quot;Pareto Scaling&quot;</span></span>
<span id="cb188-167"><a href="example.html#cb188-167" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (scaleNorm <span class="sc">==</span> <span class="st">&quot;RangeNorm&quot;</span>) {</span>
<span id="cb188-168"><a href="example.html#cb188-168" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">apply</span>(data, <span class="dv">2</span>, RangeNorm)</span>
<span id="cb188-169"><a href="example.html#cb188-169" aria-hidden="true" tabindex="-1"></a>    scalenm <span class="ot">&lt;-</span> <span class="st">&quot;Range Scaling&quot;</span></span>
<span id="cb188-170"><a href="example.html#cb188-170" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb188-171"><a href="example.html#cb188-171" aria-hidden="true" tabindex="-1"></a>    scalenm <span class="ot">&lt;-</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb188-172"><a href="example.html#cb188-172" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb188-173"><a href="example.html#cb188-173" aria-hidden="true" tabindex="-1"></a>  <span class="do">############################################# </span></span>
<span id="cb188-174"><a href="example.html#cb188-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-175"><a href="example.html#cb188-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">&quot;Row norm: &quot;</span>, rownm, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb188-176"><a href="example.html#cb188-176" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;Data Transformation norm: &quot;</span>, transnm, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb188-177"><a href="example.html#cb188-177" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;Data Scaling norm: &quot;</span>, scalenm, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)  </span>
<span id="cb188-178"><a href="example.html#cb188-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-179"><a href="example.html#cb188-179" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note after using &quot;apply&quot; function, all the attribute lost, need to add back</span></span>
<span id="cb188-180"><a href="example.html#cb188-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(data) <span class="ot">&lt;-</span> rowNames</span>
<span id="cb188-181"><a href="example.html#cb188-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> colNames</span>
<span id="cb188-182"><a href="example.html#cb188-182" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-183"><a href="example.html#cb188-183" aria-hidden="true" tabindex="-1"></a>  target <span class="ot">&lt;-</span> metadata_tab <span class="sc">%&gt;%</span> </span>
<span id="cb188-184"><a href="example.html#cb188-184" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb188-185"><a href="example.html#cb188-185" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">&quot;SampleID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb188-186"><a href="example.html#cb188-186" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(SampleID<span class="sc">%in%</span><span class="fu">rownames</span>(data))</span>
<span id="cb188-187"><a href="example.html#cb188-187" aria-hidden="true" tabindex="-1"></a>  se <span class="ot">&lt;-</span> <span class="fu">PomaSummarizedExperiment</span>(<span class="at">target =</span> target, </span>
<span id="cb188-188"><a href="example.html#cb188-188" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">features =</span> data)</span>
<span id="cb188-189"><a href="example.html#cb188-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-190"><a href="example.html#cb188-190" aria-hidden="true" tabindex="-1"></a>  <span class="co"># need to do some sanity check, for log there may be Inf values introduced</span></span>
<span id="cb188-191"><a href="example.html#cb188-191" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">CheckData</span>(se)</span>
<span id="cb188-192"><a href="example.html#cb188-192" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-193"><a href="example.html#cb188-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb188-194"><a href="example.html#cb188-194" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb188-195"><a href="example.html#cb188-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-196"><a href="example.html#cb188-196" aria-hidden="true" tabindex="-1"></a>se_normalize <span class="ot">&lt;-</span> <span class="fu">NormalizeData</span>(</span>
<span id="cb188-197"><a href="example.html#cb188-197" aria-hidden="true" tabindex="-1"></a>                      <span class="at">object =</span> se_impute,</span>
<span id="cb188-198"><a href="example.html#cb188-198" aria-hidden="true" tabindex="-1"></a>                      <span class="at">rowNorm =</span> <span class="st">&quot;None&quot;</span>,</span>
<span id="cb188-199"><a href="example.html#cb188-199" aria-hidden="true" tabindex="-1"></a>                      <span class="at">transNorm =</span> <span class="st">&quot;LogNorm&quot;</span>,</span>
<span id="cb188-200"><a href="example.html#cb188-200" aria-hidden="true" tabindex="-1"></a>                      <span class="at">scaleNorm =</span> <span class="st">&quot;ParetoNorm&quot;</span>)</span>
<span id="cb188-201"><a href="example.html#cb188-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-202"><a href="example.html#cb188-202" aria-hidden="true" tabindex="-1"></a>se_normalize</span></code></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 540 54 
## metadata(0):
## assays(1): &#39;&#39;
## rownames(540): MEDL00066 MEDL00375 ... MW0168675 MW0169569
## rowData names(0):
## colnames(54): CJY_V0 CJY_V1 ... ZTX2_V0 ZTX2_V1
## colData names(5): group SampleName FMT_status gender age</code></pre>
</div>
<div id="normalization-by-poma-r-package-1" class="section level4 hasAnchor" number="10.3.4.2">
<h4><span class="header-section-number">10.3.4.2</span> Normalization by <strong>POMA</strong> R package<a href="example.html#normalization-by-poma-r-package-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="example.html#cb190-1" aria-hidden="true" tabindex="-1"></a>se_normalize_v2 <span class="ot">&lt;-</span> <span class="fu">PomaNorm</span>(se_impute, <span class="at">method =</span> <span class="st">&quot;log_pareto&quot;</span>)</span>
<span id="cb190-2"><a href="example.html#cb190-2" aria-hidden="true" tabindex="-1"></a>se_normalize_v2</span></code></pre></div>
<pre><code>## class: SummarizedExperiment 
## dim: 540 54 
## metadata(0):
## assays(1): &#39;&#39;
## rownames(540): MEDL00066 MEDL00375 ... MW0168675 MW0169569
## rowData names(0):
## colnames(54): CJY_V0 CJY_V1 ... ZTX2_V0 ZTX2_V1
## colData names(5): group SampleName FMT_status gender age</code></pre>
</div>
<div id="comparison-of-unnormalized-and-normalized-dataset-1" class="section level4 hasAnchor" number="10.3.4.3">
<h4><span class="header-section-number">10.3.4.3</span> Comparison of unnormalized and normalized dataset<a href="example.html#comparison-of-unnormalized-and-normalized-dataset-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>boxplot</li>
</ul>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="example.html#cb192-1" aria-hidden="true" tabindex="-1"></a>pl_unnor <span class="ot">&lt;-</span> <span class="fu">PomaBoxplots</span>(se_impute, <span class="at">group =</span> <span class="st">&quot;samples&quot;</span>, <span class="at">jitter =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb192-2"><a href="example.html#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Not Normalized&quot;</span>) <span class="sc">+</span></span>
<span id="cb192-3"><a href="example.html#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="co"># data before normalization</span></span>
<span id="cb192-4"><a href="example.html#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="example.html#cb192-5" aria-hidden="true" tabindex="-1"></a>pl_nor <span class="ot">&lt;-</span> <span class="fu">PomaBoxplots</span>(se_normalize, <span class="at">group =</span> <span class="st">&quot;samples&quot;</span>, <span class="at">jitter =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb192-6"><a href="example.html#cb192-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Normalized&quot;</span>) <span class="co"># data after normalization</span></span>
<span id="cb192-7"><a href="example.html#cb192-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-8"><a href="example.html#cb192-8" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(pl_unnor, pl_nor, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">&quot;v&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-100-1.png" width="1344" /></p>
<ul>
<li>density</li>
</ul>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="example.html#cb193-1" aria-hidden="true" tabindex="-1"></a>pl_unnor <span class="ot">&lt;-</span> <span class="fu">PomaDensity</span>(se_impute, <span class="at">group =</span> <span class="st">&quot;features&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-2"><a href="example.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Not Normalized&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-3"><a href="example.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="co"># data before normalization</span></span>
<span id="cb193-4"><a href="example.html#cb193-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-5"><a href="example.html#cb193-5" aria-hidden="true" tabindex="-1"></a>pl_nor <span class="ot">&lt;-</span> <span class="fu">PomaDensity</span>(se_normalize, <span class="at">group =</span> <span class="st">&quot;features&quot;</span>) <span class="sc">+</span></span>
<span id="cb193-6"><a href="example.html#cb193-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Normalized&quot;</span>) <span class="co"># data after normalization</span></span>
<span id="cb193-7"><a href="example.html#cb193-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-8"><a href="example.html#cb193-8" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(pl_unnor, pl_nor, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">align =</span> <span class="st">&quot;v&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-101-1.png" width="960" /></p>
</div>
</div>
</div>
<div id="cluster-analysis-1" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Cluster Analysis<a href="example.html#cluster-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="hierarchical-clustering-1" class="section level3 hasAnchor" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Hierarchical Clustering<a href="example.html#hierarchical-clustering-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="example.html#cb194-1" aria-hidden="true" tabindex="-1"></a>HieraCluster <span class="ot">&lt;-</span> <span class="cf">function</span>(object,</span>
<span id="cb194-2"><a href="example.html#cb194-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method_dis =</span> <span class="fu">c</span>(<span class="st">&quot;euclidean&quot;</span>, <span class="st">&quot;bray&quot;</span>),</span>
<span id="cb194-3"><a href="example.html#cb194-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method_cluster =</span> <span class="fu">c</span>(<span class="st">&quot;average&quot;</span>, <span class="st">&quot;single&quot;</span>, <span class="st">&quot;complete&quot;</span>, <span class="st">&quot;ward&quot;</span>, <span class="st">&quot;ward.D2&quot;</span>),</span>
<span id="cb194-4"><a href="example.html#cb194-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">cluster_type =</span> <span class="fu">c</span>(<span class="st">&quot;Agglomerative&quot;</span>, <span class="st">&quot;Divisive&quot;</span>),</span>
<span id="cb194-5"><a href="example.html#cb194-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tree_num =</span> <span class="dv">4</span>) {</span>
<span id="cb194-6"><a href="example.html#cb194-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-7"><a href="example.html#cb194-7" aria-hidden="true" tabindex="-1"></a>  features_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(object) </span>
<span id="cb194-8"><a href="example.html#cb194-8" aria-hidden="true" tabindex="-1"></a>  metadata_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(object)</span>
<span id="cb194-9"><a href="example.html#cb194-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-10"><a href="example.html#cb194-10" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">t</span>(features_tab)</span>
<span id="cb194-11"><a href="example.html#cb194-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cluster_type <span class="sc">==</span> <span class="st">&quot;Agglomerative&quot;</span>) {</span>
<span id="cb194-12"><a href="example.html#cb194-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Agglomerative Hierarchical Clustering </span></span>
<span id="cb194-13"><a href="example.html#cb194-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Dissimilarity matrix</span></span>
<span id="cb194-14"><a href="example.html#cb194-14" aria-hidden="true" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">dist</span>(df, <span class="at">method =</span> method_dis)</span>
<span id="cb194-15"><a href="example.html#cb194-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-16"><a href="example.html#cb194-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Hierarchical clustering using Linkage method</span></span>
<span id="cb194-17"><a href="example.html#cb194-17" aria-hidden="true" tabindex="-1"></a>    hc <span class="ot">&lt;-</span> <span class="fu">hclust</span>(d, <span class="at">method =</span> method_cluster)</span>
<span id="cb194-18"><a href="example.html#cb194-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># hc &lt;- agnes(df, method = method_cluster)</span></span>
<span id="cb194-19"><a href="example.html#cb194-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb194-20"><a href="example.html#cb194-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">####### identifying the strongest clustering structure ################</span></span>
<span id="cb194-21"><a href="example.html#cb194-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # methods to assess</span></span>
<span id="cb194-22"><a href="example.html#cb194-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># m &lt;- c( &quot;average&quot;, &quot;single&quot;, &quot;complete&quot;, &quot;ward&quot;)</span></span>
<span id="cb194-23"><a href="example.html#cb194-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># names(m) &lt;- c( &quot;average&quot;, &quot;single&quot;, &quot;complete&quot;, &quot;ward&quot;)</span></span>
<span id="cb194-24"><a href="example.html#cb194-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span></span>
<span id="cb194-25"><a href="example.html#cb194-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># # function to compute coefficient</span></span>
<span id="cb194-26"><a href="example.html#cb194-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ac &lt;- function(x) {</span></span>
<span id="cb194-27"><a href="example.html#cb194-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">#   agnes(df, method = x)$ac</span></span>
<span id="cb194-28"><a href="example.html#cb194-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># }</span></span>
<span id="cb194-29"><a href="example.html#cb194-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span></span>
<span id="cb194-30"><a href="example.html#cb194-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># map_dbl(m, ac)     </span></span>
<span id="cb194-31"><a href="example.html#cb194-31" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (cluster_type <span class="sc">==</span> <span class="st">&quot;Divisive&quot;</span>) {</span>
<span id="cb194-32"><a href="example.html#cb194-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Divisive Hierarchical Clustering </span></span>
<span id="cb194-33"><a href="example.html#cb194-33" aria-hidden="true" tabindex="-1"></a>    hc <span class="ot">&lt;-</span> <span class="fu">diana</span>(df, <span class="at">metric =</span> method_dis)</span>
<span id="cb194-34"><a href="example.html#cb194-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb194-35"><a href="example.html#cb194-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-36"><a href="example.html#cb194-36" aria-hidden="true" tabindex="-1"></a>  hc_res <span class="ot">&lt;-</span> <span class="fu">as.hclust</span>(hc)</span>
<span id="cb194-37"><a href="example.html#cb194-37" aria-hidden="true" tabindex="-1"></a>  sub_grp <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc_res, <span class="at">k =</span> tree_num)</span>
<span id="cb194-38"><a href="example.html#cb194-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-39"><a href="example.html#cb194-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(hc_res, <span class="at">cex =</span> <span class="fl">0.6</span>)</span>
<span id="cb194-40"><a href="example.html#cb194-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rect.hclust</span>(hc_res, <span class="at">k =</span> tree_num, <span class="at">border =</span> <span class="dv">2</span><span class="sc">:</span>(tree_num<span class="sc">+</span><span class="dv">1</span>)) </span>
<span id="cb194-41"><a href="example.html#cb194-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-42"><a href="example.html#cb194-42" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">data=</span>df,</span>
<span id="cb194-43"><a href="example.html#cb194-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">cluster=</span>sub_grp,</span>
<span id="cb194-44"><a href="example.html#cb194-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">hc=</span>hc_res)</span>
<span id="cb194-45"><a href="example.html#cb194-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb194-46"><a href="example.html#cb194-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(res)</span>
<span id="cb194-47"><a href="example.html#cb194-47" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<ul>
<li>Calculation</li>
</ul>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="example.html#cb195-1" aria-hidden="true" tabindex="-1"></a>Agg_hc_res <span class="ot">&lt;-</span> <span class="fu">HieraCluster</span>(</span>
<span id="cb195-2"><a href="example.html#cb195-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">object =</span> se_normalize,</span>
<span id="cb195-3"><a href="example.html#cb195-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">method_dis =</span> <span class="st">&quot;euclidean&quot;</span>,</span>
<span id="cb195-4"><a href="example.html#cb195-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">method_cluster =</span> <span class="st">&quot;ward.D2&quot;</span>,</span>
<span id="cb195-5"><a href="example.html#cb195-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">cluster_type =</span> <span class="st">&quot;Agglomerative&quot;</span>,</span>
<span id="cb195-6"><a href="example.html#cb195-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">tree_num =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-103-1.png" width="768" /></p>
<ul>
<li>Visualization: visualize the result in a scatter plot</li>
</ul>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="example.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_cluster</span>(<span class="fu">list</span>(<span class="at">data =</span> Agg_hc_res<span class="sc">$</span>data, </span>
<span id="cb196-2"><a href="example.html#cb196-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster =</span> Agg_hc_res<span class="sc">$</span>cluster))</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-104-1.png" width="768" /></p>
</div>
</div>
<div id="chemometrics-analysis-1" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Chemometrics Analysis<a href="example.html#chemometrics-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="partial-least-squares-discriminant-analysis-pls-da-1" class="section level3 hasAnchor" number="10.5.1">
<h3><span class="header-section-number">10.5.1</span> Partial Least Squares-Discriminant Analysis (PLS-DA)<a href="example.html#partial-least-squares-discriminant-analysis-pls-da-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Calculation</li>
</ul>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="example.html#cb197-1" aria-hidden="true" tabindex="-1"></a>poma_plsda <span class="ot">&lt;-</span> <span class="fu">PomaMultivariate</span>(se_normalize, <span class="at">method =</span> <span class="st">&quot;plsda&quot;</span>)</span></code></pre></div>
<ul>
<li>scatter plot</li>
</ul>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="example.html#cb198-1" aria-hidden="true" tabindex="-1"></a>poma_plsda<span class="sc">$</span>scoresplot <span class="sc">+</span></span>
<span id="cb198-2"><a href="example.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Scores Plot (plsda)&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-106-1.png" width="768" /></p>
<ul>
<li>errors plot</li>
</ul>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="example.html#cb199-1" aria-hidden="true" tabindex="-1"></a>poma_plsda<span class="sc">$</span>errors_plsda_plot <span class="sc">+</span></span>
<span id="cb199-2"><a href="example.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Error Plot (plsda)&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-107-1.png" width="768" /></p>
</div>
<div id="sparse-partial-least-squares-discriminant-analysis-spls-da-1" class="section level3 hasAnchor" number="10.5.2">
<h3><span class="header-section-number">10.5.2</span> Sparse Partial Least Squares-Discriminant Analysis (sPLS-DA)<a href="example.html#sparse-partial-least-squares-discriminant-analysis-spls-da-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>Even though PLS is highly efficient in a high dimensional context, the interpretability of PLS needed to be improved. sPLS has been recently developed by our team to perform simultaneous variable selection in both data sets X and Y data sets, by including LASSO penalizations in PLS on each pair of loading vectors</p>
</blockquote>
<ul>
<li>Calculation</li>
</ul>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="example.html#cb200-1" aria-hidden="true" tabindex="-1"></a>poma_splsda <span class="ot">&lt;-</span> <span class="fu">PomaMultivariate</span>(se_normalize, <span class="at">method =</span> <span class="st">&quot;splsda&quot;</span>)</span></code></pre></div>
<ul>
<li>scatter plot</li>
</ul>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="example.html#cb201-1" aria-hidden="true" tabindex="-1"></a>poma_splsda<span class="sc">$</span>scoresplot <span class="sc">+</span></span>
<span id="cb201-2"><a href="example.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Scores Plot (splsda)&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-109-1.png" width="768" /></p>
</div>
</div>
<div id="univariate-analysis-1" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Univariate Analysis<a href="example.html#univariate-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="fold-change-analysis-1" class="section level3 hasAnchor" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> Fold Change Analysis<a href="example.html#fold-change-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="example.html#cb202-1" aria-hidden="true" tabindex="-1"></a>FoldChange <span class="ot">&lt;-</span> <span class="cf">function</span>(object,</span>
<span id="cb202-2"><a href="example.html#cb202-2" aria-hidden="true" tabindex="-1"></a>                       group_names,</span>
<span id="cb202-3"><a href="example.html#cb202-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">fc_cutoff =</span> <span class="dv">2</span>,</span>
<span id="cb202-4"><a href="example.html#cb202-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cmp_type =</span> <span class="dv">0</span>, </span>
<span id="cb202-5"><a href="example.html#cb202-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">paired =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb202-6"><a href="example.html#cb202-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-7"><a href="example.html#cb202-7" aria-hidden="true" tabindex="-1"></a>  features_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(object) </span>
<span id="cb202-8"><a href="example.html#cb202-8" aria-hidden="true" tabindex="-1"></a>  metadata_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">colData</span>(object)   </span>
<span id="cb202-9"><a href="example.html#cb202-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-10"><a href="example.html#cb202-10" aria-hidden="true" tabindex="-1"></a>  metadata <span class="ot">&lt;-</span> metadata_tab <span class="sc">%&gt;%</span></span>
<span id="cb202-11"><a href="example.html#cb202-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb202-12"><a href="example.html#cb202-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(group <span class="sc">%in%</span> group_names)</span>
<span id="cb202-13"><a href="example.html#cb202-13" aria-hidden="true" tabindex="-1"></a>  profile <span class="ot">&lt;-</span> features_tab[, <span class="fu">pmatch</span>(<span class="fu">rownames</span>(metadata), <span class="fu">colnames</span>(features_tab))]</span>
<span id="cb202-14"><a href="example.html#cb202-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-15"><a href="example.html#cb202-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make sure threshold is above 1</span></span>
<span id="cb202-16"><a href="example.html#cb202-16" aria-hidden="true" tabindex="-1"></a>  fc_cutoff <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(fc_cutoff <span class="sc">&gt;</span> <span class="dv">1</span>, fc_cutoff, <span class="dv">1</span><span class="sc">/</span>fc_cutoff)</span>
<span id="cb202-17"><a href="example.html#cb202-17" aria-hidden="true" tabindex="-1"></a>  max_cutoff <span class="ot">&lt;-</span> fc_cutoff</span>
<span id="cb202-18"><a href="example.html#cb202-18" aria-hidden="true" tabindex="-1"></a>  min_cutoff <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> fc_cutoff</span>
<span id="cb202-19"><a href="example.html#cb202-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-20"><a href="example.html#cb202-20" aria-hidden="true" tabindex="-1"></a>  GetFC <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb202-21"><a href="example.html#cb202-21" aria-hidden="true" tabindex="-1"></a>                    y,</span>
<span id="cb202-22"><a href="example.html#cb202-22" aria-hidden="true" tabindex="-1"></a>                    cmpType, </span>
<span id="cb202-23"><a href="example.html#cb202-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">paired =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb202-24"><a href="example.html#cb202-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-25"><a href="example.html#cb202-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># x = profile</span></span>
<span id="cb202-26"><a href="example.html#cb202-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y = metadata</span></span>
<span id="cb202-27"><a href="example.html#cb202-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cmpType = cmp_type</span></span>
<span id="cb202-28"><a href="example.html#cb202-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># paired = paired    </span></span>
<span id="cb202-29"><a href="example.html#cb202-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-30"><a href="example.html#cb202-30" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">t</span>(x)</span>
<span id="cb202-31"><a href="example.html#cb202-31" aria-hidden="true" tabindex="-1"></a>    colNames <span class="ot">&lt;-</span> <span class="fu">colnames</span>(x)</span>
<span id="cb202-32"><a href="example.html#cb202-32" aria-hidden="true" tabindex="-1"></a>    rowNames <span class="ot">&lt;-</span> <span class="fu">rownames</span>(x)</span>
<span id="cb202-33"><a href="example.html#cb202-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-34"><a href="example.html#cb202-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (paired) { </span>
<span id="cb202-35"><a href="example.html#cb202-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># compute the average of paired FC (unit is pair)</span></span>
<span id="cb202-36"><a href="example.html#cb202-36" aria-hidden="true" tabindex="-1"></a>      G1 <span class="ot">&lt;-</span> x[<span class="fu">which</span>(y<span class="sc">$</span>group <span class="sc">==</span> group_names[<span class="dv">1</span>]), ]</span>
<span id="cb202-37"><a href="example.html#cb202-37" aria-hidden="true" tabindex="-1"></a>      G2 <span class="ot">&lt;-</span> x[<span class="fu">which</span>(y<span class="sc">$</span>group <span class="sc">==</span> group_names[<span class="dv">2</span>]), ]</span>
<span id="cb202-38"><a href="example.html#cb202-38" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb202-39"><a href="example.html#cb202-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (cmpType <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb202-40"><a href="example.html#cb202-40" aria-hidden="true" tabindex="-1"></a>        fc.mat <span class="ot">&lt;-</span> G1 <span class="sc">-</span> G2</span>
<span id="cb202-41"><a href="example.html#cb202-41" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb202-42"><a href="example.html#cb202-42" aria-hidden="true" tabindex="-1"></a>        fc.mat <span class="ot">&lt;-</span> G2 <span class="sc">-</span> G1</span>
<span id="cb202-43"><a href="example.html#cb202-43" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb202-44"><a href="example.html#cb202-44" aria-hidden="true" tabindex="-1"></a>      fc.log <span class="ot">&lt;-</span> <span class="fu">apply</span>(fc.mat, <span class="dv">2</span>, mean)</span>
<span id="cb202-45"><a href="example.html#cb202-45" aria-hidden="true" tabindex="-1"></a>      fc.all <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="dv">2</span><span class="sc">^</span>fc.log, <span class="dv">5</span>)</span>
<span id="cb202-46"><a href="example.html#cb202-46" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb202-47"><a href="example.html#cb202-47" aria-hidden="true" tabindex="-1"></a>      m1 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(x[<span class="fu">which</span>(y<span class="sc">$</span>group <span class="sc">==</span> group_names[<span class="dv">1</span>]), ])</span>
<span id="cb202-48"><a href="example.html#cb202-48" aria-hidden="true" tabindex="-1"></a>      m2 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(x[<span class="fu">which</span>(y<span class="sc">$</span>group <span class="sc">==</span> group_names[<span class="dv">2</span>]), ])</span>
<span id="cb202-49"><a href="example.html#cb202-49" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb202-50"><a href="example.html#cb202-50" aria-hidden="true" tabindex="-1"></a>      <span class="co"># create a named matrix of sig vars for display</span></span>
<span id="cb202-51"><a href="example.html#cb202-51" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (cmpType <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb202-52"><a href="example.html#cb202-52" aria-hidden="true" tabindex="-1"></a>          ratio <span class="ot">&lt;-</span> m1<span class="sc">/</span>m2</span>
<span id="cb202-53"><a href="example.html#cb202-53" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb202-54"><a href="example.html#cb202-54" aria-hidden="true" tabindex="-1"></a>          ratio <span class="ot">&lt;-</span> m2<span class="sc">/</span>m1</span>
<span id="cb202-55"><a href="example.html#cb202-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb202-56"><a href="example.html#cb202-56" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb202-57"><a href="example.html#cb202-57" aria-hidden="true" tabindex="-1"></a>      fc.all <span class="ot">&lt;-</span> <span class="fu">signif</span>(ratio, <span class="dv">5</span>)</span>
<span id="cb202-58"><a href="example.html#cb202-58" aria-hidden="true" tabindex="-1"></a>      ratio[ratio <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb202-59"><a href="example.html#cb202-59" aria-hidden="true" tabindex="-1"></a>      fc.log <span class="ot">&lt;-</span> <span class="fu">signif</span>(<span class="fu">log2</span>(ratio), <span class="dv">5</span>)</span>
<span id="cb202-60"><a href="example.html#cb202-60" aria-hidden="true" tabindex="-1"></a>      fc.log[<span class="fu">is.infinite</span>(fc.log) <span class="sc">&amp;</span> fc.log <span class="sc">&lt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">99</span></span>
<span id="cb202-61"><a href="example.html#cb202-61" aria-hidden="true" tabindex="-1"></a>      fc.log[<span class="fu">is.infinite</span>(fc.log) <span class="sc">&amp;</span> fc.log <span class="sc">&gt;</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">99</span></span>
<span id="cb202-62"><a href="example.html#cb202-62" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb202-63"><a href="example.html#cb202-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-64"><a href="example.html#cb202-64" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(fc.all) <span class="ot">&lt;-</span> <span class="fu">names</span>(fc.log) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(x)</span>
<span id="cb202-65"><a href="example.html#cb202-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb202-66"><a href="example.html#cb202-66" aria-hidden="true" tabindex="-1"></a>    res <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">fc.all =</span> fc.all, <span class="at">fc.log =</span> fc.log)</span>
<span id="cb202-67"><a href="example.html#cb202-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(res)</span>
<span id="cb202-68"><a href="example.html#cb202-68" aria-hidden="true" tabindex="-1"></a>  }  </span>
<span id="cb202-69"><a href="example.html#cb202-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-70"><a href="example.html#cb202-70" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">GetFC</span>(profile, metadata, cmp_type, paired)</span>
<span id="cb202-71"><a href="example.html#cb202-71" aria-hidden="true" tabindex="-1"></a>  fc.all <span class="ot">&lt;-</span> res<span class="sc">$</span>fc.all</span>
<span id="cb202-72"><a href="example.html#cb202-72" aria-hidden="true" tabindex="-1"></a>  fc.log <span class="ot">&lt;-</span> res<span class="sc">$</span>fc.log</span>
<span id="cb202-73"><a href="example.html#cb202-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-74"><a href="example.html#cb202-74" aria-hidden="true" tabindex="-1"></a>  inx.up <span class="ot">&lt;-</span> fc.all <span class="sc">&gt;</span> max_cutoff</span>
<span id="cb202-75"><a href="example.html#cb202-75" aria-hidden="true" tabindex="-1"></a>  inx.down <span class="ot">&lt;-</span> fc.all <span class="sc">&lt;</span> min_cutoff</span>
<span id="cb202-76"><a href="example.html#cb202-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(inx.up) <span class="ot">&lt;-</span> <span class="fu">names</span>(inx.down) <span class="ot">&lt;-</span> <span class="fu">names</span>(fc.all)</span>
<span id="cb202-77"><a href="example.html#cb202-77" aria-hidden="true" tabindex="-1"></a>  imp.inx <span class="ot">&lt;-</span> inx.up <span class="sc">|</span> inx.down</span>
<span id="cb202-78"><a href="example.html#cb202-78" aria-hidden="true" tabindex="-1"></a>  sig.mat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(fc.all[imp.inx, <span class="at">drop =</span> F], fc.log[imp.inx, <span class="at">drop =</span> F])</span>
<span id="cb202-79"><a href="example.html#cb202-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(sig.mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Fold Change&quot;</span>, <span class="st">&quot;log2(FC)&quot;</span>)</span>
<span id="cb202-80"><a href="example.html#cb202-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-81"><a href="example.html#cb202-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># order by absolute log value (since symmetrical in pos and neg)</span></span>
<span id="cb202-82"><a href="example.html#cb202-82" aria-hidden="true" tabindex="-1"></a>  inx.ord <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">abs</span>(sig.mat[, <span class="dv">2</span>]), <span class="at">decreasing =</span> T)</span>
<span id="cb202-83"><a href="example.html#cb202-83" aria-hidden="true" tabindex="-1"></a>  sig.mat <span class="ot">&lt;-</span> sig.mat[inx.ord, , drop <span class="ot">=</span> F]</span>
<span id="cb202-84"><a href="example.html#cb202-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb202-85"><a href="example.html#cb202-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sig.mat)</span>
<span id="cb202-86"><a href="example.html#cb202-86" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb202-87"><a href="example.html#cb202-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-88"><a href="example.html#cb202-88" aria-hidden="true" tabindex="-1"></a>FC_res <span class="ot">&lt;-</span> <span class="fu">FoldChange</span>(</span>
<span id="cb202-89"><a href="example.html#cb202-89" aria-hidden="true" tabindex="-1"></a>           <span class="at">object =</span> se_normalize, </span>
<span id="cb202-90"><a href="example.html#cb202-90" aria-hidden="true" tabindex="-1"></a>           <span class="at">fc_cutoff =</span> <span class="dv">2</span>,</span>
<span id="cb202-91"><a href="example.html#cb202-91" aria-hidden="true" tabindex="-1"></a>           <span class="at">group_names =</span> <span class="fu">c</span>(<span class="st">&quot;NR&quot;</span>, <span class="st">&quot;PR&quot;</span>),</span>
<span id="cb202-92"><a href="example.html#cb202-92" aria-hidden="true" tabindex="-1"></a>           <span class="at">cmp_type =</span> <span class="dv">0</span>, </span>
<span id="cb202-93"><a href="example.html#cb202-93" aria-hidden="true" tabindex="-1"></a>           <span class="at">paired =</span> <span class="cn">FALSE</span>)</span>
<span id="cb202-94"><a href="example.html#cb202-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-95"><a href="example.html#cb202-95" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(FC_res)</span></code></pre></div>
<pre><code>##           Fold Change log2(FC)
## MEDL00066    -8.31480      -99
## MEDL00375    -0.34779      -99
## MEDL01844    -0.40162      -99
## MEDL01922    -0.18899      -99
## MEDL01994    -0.54180      -99
## MEDL02018    -0.34413      -99</code></pre>
</div>
<div id="t-test-1" class="section level3 hasAnchor" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> T Test<a href="example.html#t-test-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="example.html#cb204-1" aria-hidden="true" tabindex="-1"></a>group_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;NR&quot;</span>, <span class="st">&quot;PR&quot;</span>)</span>
<span id="cb204-2"><a href="example.html#cb204-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-3"><a href="example.html#cb204-3" aria-hidden="true" tabindex="-1"></a>se_normalize_subset <span class="ot">&lt;-</span> se_normalize[, se_normalize<span class="sc">$</span>group <span class="sc">%in%</span> group_names]</span>
<span id="cb204-4"><a href="example.html#cb204-4" aria-hidden="true" tabindex="-1"></a>se_normalize_subset<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(se_normalize_subset<span class="sc">$</span>group))</span>
<span id="cb204-5"><a href="example.html#cb204-5" aria-hidden="true" tabindex="-1"></a>ttest_res <span class="ot">&lt;-</span> <span class="fu">PomaUnivariate</span>(se_normalize_subset, <span class="at">method =</span> <span class="st">&quot;ttest&quot;</span>)</span>
<span id="cb204-6"><a href="example.html#cb204-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ttest_res)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##   feature      FC diff_means pvalue pvalueAdj mean_NR mean_PR sd_NR sd_PR
##   &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 MEDL00066 -0.12      0.174 0.506      0.833 -0.155   0.0187 0.700 0.991
## 2 MEDL00375 -2.88      0.149 0.503      0.833 -0.0384  0.111  0.827 0.620
## 3 MEDL00587  1.40      0.014 0.937      0.980  0.0342  0.0480 0.571 0.573
## 4 MEDL01844 -2.49     -0.311 0.232      0.662  0.0891 -0.222  0.850 0.849
## 5 MEDL01922 -5.29      0.069 0.812      0.931 -0.0110  0.0584 0.751 1.13 
## 6 MEDL01994 -1.85      0.117 0.0795     0.434 -0.0412  0.0760 0.182 0.245</code></pre>
</div>
<div id="volcano-plot-1" class="section level3 hasAnchor" number="10.6.3">
<h3><span class="header-section-number">10.6.3</span> Volcano plot<a href="example.html#volcano-plot-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="example.html#cb206-1" aria-hidden="true" tabindex="-1"></a>se_impute_subset <span class="ot">&lt;-</span> se_impute[, se_impute<span class="sc">$</span>group <span class="sc">%in%</span> group_names]</span>
<span id="cb206-2"><a href="example.html#cb206-2" aria-hidden="true" tabindex="-1"></a>se_impute_subset<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(se_impute_subset<span class="sc">$</span>group))</span>
<span id="cb206-3"><a href="example.html#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="example.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="fu">PomaVolcano</span>(se_impute_subset, </span>
<span id="cb206-5"><a href="example.html#cb206-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">pval =</span> <span class="st">&quot;raw&quot;</span>,</span>
<span id="cb206-6"><a href="example.html#cb206-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">pval_cutoff =</span> <span class="fl">0.05</span>,</span>
<span id="cb206-7"><a href="example.html#cb206-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">log2FC =</span> <span class="fl">0.5</span>,</span>
<span id="cb206-8"><a href="example.html#cb206-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlim =</span> <span class="dv">3</span>,</span>
<span id="cb206-9"><a href="example.html#cb206-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">labels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb206-10"><a href="example.html#cb206-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot_title =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-112-1.png" width="576" /></p>
</div>
</div>
<div id="feature-selection" class="section level2 hasAnchor" number="10.7">
<h2><span class="header-section-number">10.7</span> Feature Selection<a href="example.html#feature-selection" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="regularized-generalized-linear-models-lasso-alpha-1" class="section level3 hasAnchor" number="10.7.1">
<h3><span class="header-section-number">10.7.1</span> Regularized Generalized Linear Models (Lasso: alpha = 1)<a href="example.html#regularized-generalized-linear-models-lasso-alpha-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="example.html#cb207-1" aria-hidden="true" tabindex="-1"></a>lasso_res <span class="ot">&lt;-</span> <span class="fu">PomaLasso</span>(se_normalize_subset, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">labels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb207-2"><a href="example.html#cb207-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-3"><a href="example.html#cb207-3" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(lasso_res<span class="sc">$</span>cvLassoPlot,</span>
<span id="cb207-4"><a href="example.html#cb207-4" aria-hidden="true" tabindex="-1"></a>                   lasso_res<span class="sc">$</span>coefficientPlot,</span>
<span id="cb207-5"><a href="example.html#cb207-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">align =</span> <span class="st">&quot;h&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-113-1.png" width="1152" /></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="example.html#cb208-1" aria-hidden="true" tabindex="-1"></a>lasso_res<span class="sc">$</span>coefficients</span></code></pre></div>
<pre><code>## # A tibble: 21 × 2
##    feature     coefficient
##    &lt;chr&gt;             &lt;dbl&gt;
##  1 (Intercept)     -0.207 
##  2 MEDL01844       -0.0577
##  3 MEDN0366        -0.478 
##  4 MEDN1135         0.542 
##  5 MEDN1285        -0.152 
##  6 MEDP0006         0.208 
##  7 MEDP0089        -0.228 
##  8 MEDP0151         0.329 
##  9 MEDP0295        -0.134 
## 10 MEDP0401        -0.220 
## # … with 11 more rows</code></pre>
</div>
<div id="classification-random-forest" class="section level3 hasAnchor" number="10.7.2">
<h3><span class="header-section-number">10.7.2</span> Classification (Random Forest)<a href="example.html#classification-random-forest" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Calculation</li>
</ul>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="example.html#cb210-1" aria-hidden="true" tabindex="-1"></a>poma_rf <span class="ot">&lt;-</span> <span class="fu">PomaRandForest</span>(se_normalize_subset, <span class="at">ntest =</span> <span class="dv">10</span>, <span class="at">nvar =</span> <span class="dv">10</span>)</span>
<span id="cb210-2"><a href="example.html#cb210-2" aria-hidden="true" tabindex="-1"></a>poma_rf<span class="sc">$</span>error_tree</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-114-1.png" width="576" /></p>
<ul>
<li>table</li>
</ul>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="example.html#cb211-1" aria-hidden="true" tabindex="-1"></a>poma_rf<span class="sc">$</span>confusionMatrix<span class="sc">$</span>table</span></code></pre></div>
<pre><code>##           Reference
## Prediction 1 2
##          1 1 1
##          2 0 2</code></pre>
<ul>
<li>Important features</li>
</ul>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="example.html#cb213-1" aria-hidden="true" tabindex="-1"></a>poma_rf<span class="sc">$</span>MeanDecreaseGini_plot</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-116-1.png" width="576" /></p>
</div>
</div>
<div id="network-analysis-2" class="section level2 hasAnchor" number="10.8">
<h2><span class="header-section-number">10.8</span> Network Analysis<a href="example.html#network-analysis-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="data-curation-2" class="section level3 hasAnchor" number="10.8.1">
<h3><span class="header-section-number">10.8.1</span> Data curation<a href="example.html#data-curation-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="example.html#cb214-1" aria-hidden="true" tabindex="-1"></a>features_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(se_filter) <span class="sc">%&gt;%</span> </span>
<span id="cb214-2"><a href="example.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>()</span>
<span id="cb214-3"><a href="example.html#cb214-3" aria-hidden="true" tabindex="-1"></a>features_tab[<span class="fu">is.na</span>(features_tab)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb214-4"><a href="example.html#cb214-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-5"><a href="example.html#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(features_tab[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre><code>##        MEDL00066 MEDL00375 MEDL00587 MEDL01799 MEDL01801 MEDL01844 MEDL01922 MEDL01994 MEDL02002
## CJY_V0     10447     31087    618200         0         0    127250         0   2590400         0
## CJY_V1   4011900     88306    563130     51267   1046200   4172100    107560   3772200    133920
## DGL_V0    560560    449150   1079300    304040    147100  19462000     39149   2950700   3216700
## DGL_V1    149120    263050   2047500     24342    357050  14373000    964600   3328000   2512900
## HXZ_V0    442540    216830   1399700   1481800   1976000   7830000    269570   2588200   3719000
## HXZ_V1    181010     37280   1171700         0         0   5171400    196770   3097700         0
##        MEDL02018
## CJY_V0    485040
## CJY_V1   1400100
## DGL_V0    684140
## DGL_V1   1659500
## HXZ_V0   3433700
## HXZ_V1   3269900</code></pre>
</div>
<div id="building-network-model-4" class="section level3 hasAnchor" number="10.8.2">
<h3><span class="header-section-number">10.8.2</span> Building network model<a href="example.html#building-network-model-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="example.html#cb216-1" aria-hidden="true" tabindex="-1"></a>net_single <span class="ot">&lt;-</span> <span class="fu">netConstruct</span>(features_tab, </span>
<span id="cb216-2"><a href="example.html#cb216-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">measure =</span> <span class="st">&quot;sparcc&quot;</span>,</span>
<span id="cb216-3"><a href="example.html#cb216-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">measurePar =</span> <span class="fu">list</span>(<span class="at">iter =</span> <span class="dv">20</span>,</span>
<span id="cb216-4"><a href="example.html#cb216-4" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">inner_iter =</span> <span class="dv">10</span>,</span>
<span id="cb216-5"><a href="example.html#cb216-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">th =</span> <span class="fl">0.1</span>),</span>
<span id="cb216-6"><a href="example.html#cb216-6" aria-hidden="true" tabindex="-1"></a>                           <span class="at">filtTax =</span> <span class="st">&quot;highestVar&quot;</span>,</span>
<span id="cb216-7"><a href="example.html#cb216-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">filtTaxPar =</span> <span class="fu">list</span>(<span class="at">highestVar =</span> <span class="dv">50</span>),</span>
<span id="cb216-8"><a href="example.html#cb216-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">filtSamp =</span> <span class="st">&quot;totalReads&quot;</span>,</span>
<span id="cb216-9"><a href="example.html#cb216-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">filtSampPar =</span> <span class="fu">list</span>(<span class="at">totalReads =</span> <span class="dv">100</span>),</span>
<span id="cb216-10"><a href="example.html#cb216-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">verbose =</span> <span class="dv">3</span>,</span>
<span id="cb216-11"><a href="example.html#cb216-11" aria-hidden="true" tabindex="-1"></a>                           <span class="at">seed =</span> <span class="dv">123</span>)</span></code></pre></div>
</div>
<div id="visualizing-the-network-4" class="section level3 hasAnchor" number="10.8.3">
<h3><span class="header-section-number">10.8.3</span> Visualizing the network<a href="example.html#visualizing-the-network-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="example.html#cb217-1" aria-hidden="true" tabindex="-1"></a>props_single <span class="ot">&lt;-</span> <span class="fu">netAnalyze</span>(net_single, <span class="at">clustMethod =</span> <span class="st">&quot;cluster_fast_greedy&quot;</span>)</span>
<span id="cb217-2"><a href="example.html#cb217-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-3"><a href="example.html#cb217-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(props_single, </span>
<span id="cb217-4"><a href="example.html#cb217-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">nodeColor =</span> <span class="st">&quot;cluster&quot;</span>, </span>
<span id="cb217-5"><a href="example.html#cb217-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">nodeSize =</span> <span class="st">&quot;eigenvector&quot;</span>,</span>
<span id="cb217-6"><a href="example.html#cb217-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">repulsion =</span> <span class="fl">0.8</span>,</span>
<span id="cb217-7"><a href="example.html#cb217-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">rmSingles =</span> <span class="cn">TRUE</span>,</span>
<span id="cb217-8"><a href="example.html#cb217-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">labelScale =</span> <span class="cn">FALSE</span>,</span>
<span id="cb217-9"><a href="example.html#cb217-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">cexLabels =</span> <span class="fl">1.6</span>,</span>
<span id="cb217-10"><a href="example.html#cb217-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">nodeSizeSpread =</span> <span class="dv">3</span>,</span>
<span id="cb217-11"><a href="example.html#cb217-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">cexNodes =</span> <span class="dv">2</span>,</span>
<span id="cb217-12"><a href="example.html#cb217-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">title1 =</span> <span class="st">&quot;Network on metabolomics with Pearson correlations&quot;</span>, </span>
<span id="cb217-13"><a href="example.html#cb217-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">showTitle =</span> <span class="cn">TRUE</span>,</span>
<span id="cb217-14"><a href="example.html#cb217-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">cexTitle =</span> <span class="fl">1.5</span>)</span>
<span id="cb217-15"><a href="example.html#cb217-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-16"><a href="example.html#cb217-16" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="fl">0.7</span>, <span class="fl">1.1</span>, <span class="at">cex =</span> <span class="fl">1.2</span>, <span class="at">title =</span> <span class="st">&quot;estimated correlation:&quot;</span>,</span>
<span id="cb217-17"><a href="example.html#cb217-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">&quot;+&quot;</span>,<span class="st">&quot;-&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;#009900&quot;</span>,<span class="st">&quot;red&quot;</span>),</span>
<span id="cb217-18"><a href="example.html#cb217-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">horiz =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-119-1.png" width="1152" /></p>
</div>
</div>
<div id="network-analysis-by-wgcna" class="section level2 hasAnchor" number="10.9">
<h2><span class="header-section-number">10.9</span> Network Analysis by WGCNA<a href="example.html#network-analysis-by-wgcna" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Performing Network Analysis step by step through <strong>WGCNA</strong> R package.</p>
<div id="data-curation-3" class="section level3 hasAnchor" number="10.9.1">
<h3><span class="header-section-number">10.9.1</span> Data curation<a href="example.html#data-curation-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><p>Data Matrix</p>
<ul>
<li><p>Row -&gt; metabolites</p></li>
<li><p>Column -&gt; samples</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="example.html#cb218-1" aria-hidden="true" tabindex="-1"></a>features_tab <span class="ot">&lt;-</span> SummarizedExperiment<span class="sc">::</span><span class="fu">assay</span>(se_impute)</span>
<span id="cb218-2"><a href="example.html#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(features_tab[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre><code>##            CJY_V0  CJY_V1   DGL_V0   DGL_V1  HXZ_V0  HXZ_V1  LBC_V0  LBC_V1    LHC_V1     LHC_V0
## MEDL00066   10447 4011900   560560   149120  442540  181010   12620  173400   97848.0   25072.83
## MEDL00375   31087   88306   449150   263050  216830   37280  302150  607850   87101.0    7595.70
## MEDL00587  618200  563130  1079300  2047500 1399700 1171700 1120700 1109300 1025300.0  533040.00
## MEDL01844  127250 4172100 19462000 14373000 7830000 5171400   57063 1946700  100670.0  143560.00
## MEDL01922  184698  107560    39149   964600  269570  196770   28797   72528  140508.2  182958.02
## MEDL01994 2590400 3772200  2950700  3328000 2588200 3097700 3373500 3283000 3427700.0 3223700.00</code></pre>
<ul>
<li>Data normalization</li>
</ul>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="example.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TSS</span></span>
<span id="cb220-2"><a href="example.html#cb220-2" aria-hidden="true" tabindex="-1"></a>features_tab_norm <span class="ot">&lt;-</span> XMAS2<span class="sc">::</span><span class="fu">norm_tss</span>(phyloseq<span class="sc">::</span><span class="fu">otu_table</span>(features_tab, <span class="at">taxa_are_rows =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="example.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">t</span>()</span>
<span id="cb220-4"><a href="example.html#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(features_tab_norm[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code></pre></div>
<pre><code>##           MEDL00066    MEDL00375    MEDL00587    MEDL01844    MEDL01922    MEDL01994    MEDL02002
## CJY_V0 7.266924e-06 2.162409e-05 0.0004300194 8.851499e-05 1.284758e-04 0.0018018800 9.688354e-04
## CJY_V1 2.018886e-03 4.443774e-05 0.0002833808 2.099503e-03 5.412682e-05 0.0018982634 6.739182e-05
## DGL_V0 1.534502e-04 1.229523e-04 0.0002954523 5.327614e-03 1.071682e-05 0.0008077376 8.805537e-04
## DGL_V1 3.721535e-05 6.564846e-05 0.0005109874 3.587019e-03 2.407318e-04 0.0008305572 6.271356e-04
## HXZ_V0 1.100101e-04 5.390131e-05 0.0003479485 1.946443e-03 6.701183e-05 0.0006433951 9.244983e-04
## HXZ_V1 6.310899e-05 1.299764e-05 0.0004085122 1.803004e-03 6.860370e-05 0.0010800105 8.873314e-04
##           MEDL02018    MEDL02174    MEDL02519
## CJY_V0 0.0003373934 0.0008276238 5.364045e-04
## CJY_V1 0.0007045646 0.0053125408 9.121950e-04
## DGL_V0 0.0001872795 0.0013967809 6.574793e-04
## DGL_V1 0.0004141556 0.0060542331 1.840278e-04
## HXZ_V0 0.0008535762 0.0018885718 1.518648e-04
## HXZ_V1 0.0011400479 0.0009249314 5.116427e-06</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="example.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # CSS</span></span>
<span id="cb222-2"><a href="example.html#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="co"># features_tab_norm &lt;- XMAS2::norm_css(phyloseq::otu_table(features_tab, taxa_are_rows = T)) %&gt;% </span></span>
<span id="cb222-3"><a href="example.html#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   data.frame() %&gt;% t()</span></span>
<span id="cb222-4"><a href="example.html#cb222-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print(features_tab_norm[1:6, 1:10])</span></span></code></pre></div>
</div>
<div id="tuning-soft-thresholds" class="section level3 hasAnchor" number="10.9.2">
<h3><span class="header-section-number">10.9.2</span> Tuning soft thresholds<a href="example.html#tuning-soft-thresholds" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Picking a threshhold value (if correlation is below threshold, remove the edge). WGCNA will try a range of soft thresholds and create a diagnostic plot.</p>
<ul>
<li>Choose a set of soft-thresholding powers</li>
</ul>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="example.html#cb223-1" aria-hidden="true" tabindex="-1"></a>powers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>), <span class="fu">seq</span>(<span class="dv">12</span>, <span class="dv">20</span>, <span class="dv">2</span>))</span></code></pre></div>
<ul>
<li><p>Call the network topology analysis function</p>
<ul>
<li><p>Row -&gt; samples</p></li>
<li><p>Column -&gt; metabolites</p></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="example.html#cb224-1" aria-hidden="true" tabindex="-1"></a>sft <span class="ot">&lt;-</span> <span class="fu">pickSoftThreshold</span>(</span>
<span id="cb224-2"><a href="example.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  features_tab_norm,</span>
<span id="cb224-3"><a href="example.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">powerVector =</span> powers,</span>
<span id="cb224-4"><a href="example.html#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">networkType =</span> <span class="st">&quot;unsigned&quot;</span>,</span>
<span id="cb224-5"><a href="example.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## pickSoftThreshold: will use block size 540.
##  pickSoftThreshold: calculating connectivity for given powers...
##    ..working on genes 1 through 540 of 540
##    Power SFT.R.sq  slope truncated.R.sq mean.k. median.k. max.k.
## 1      1   0.1930 -1.720          0.956  76.600    76.600 125.00
## 2      2   0.0573 -0.241          0.516  22.200    19.800  44.10
## 3      3   0.8500 -1.090          0.860  10.600     7.420  32.90
## 4      4   0.9330 -1.200          0.923   6.690     3.780  27.80
## 5      5   0.9750 -1.170          0.968   4.900     2.430  24.20
## 6      6   0.9680 -1.190          0.959   3.870     1.750  21.40
## 7      7   0.9400 -1.160          0.923   3.200     1.350  19.20
## 8      8   0.9570 -1.160          0.947   2.720     1.140  17.40
## 9      9   0.9500 -1.180          0.939   2.370     1.040  15.80
## 10    10   0.9480 -1.200          0.936   2.090     0.944  14.60
## 11    12   0.9420 -1.200          0.930   1.700     0.686  12.60
## 12    14   0.8850 -1.260          0.867   1.430     0.501  11.00
## 13    16   0.8260 -1.220          0.846   1.240     0.326   9.87
## 14    18   0.8220 -1.180          0.859   1.100     0.236   8.94
## 15    20   0.8910 -1.140          0.942   0.989     0.191   8.19</code></pre>
<ul>
<li>the optimal power value</li>
</ul>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="example.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb226-2"><a href="example.html#cb226-2" aria-hidden="true" tabindex="-1"></a>cex1 <span class="ot">=</span> <span class="fl">1.2</span></span>
<span id="cb226-3"><a href="example.html#cb226-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-4"><a href="example.html#cb226-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sft<span class="sc">$</span>fitIndices[, <span class="dv">1</span>],</span>
<span id="cb226-5"><a href="example.html#cb226-5" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span><span class="fu">sign</span>(sft<span class="sc">$</span>fitIndices[, <span class="dv">3</span>]) <span class="sc">*</span> sft<span class="sc">$</span>fitIndices[, <span class="dv">2</span>],</span>
<span id="cb226-6"><a href="example.html#cb226-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Soft Threshold (power)&quot;</span>,</span>
<span id="cb226-7"><a href="example.html#cb226-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Scale Free Topology Model Fit, signed R^2&quot;</span>,</span>
<span id="cb226-8"><a href="example.html#cb226-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Scale independence&quot;</span>)</span>
<span id="cb226-9"><a href="example.html#cb226-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb226-10"><a href="example.html#cb226-10" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(sft<span class="sc">$</span>fitIndices[, <span class="dv">1</span>],</span>
<span id="cb226-11"><a href="example.html#cb226-11" aria-hidden="true" tabindex="-1"></a>     <span class="sc">-</span><span class="fu">sign</span>(sft<span class="sc">$</span>fitIndices[, <span class="dv">3</span>]) <span class="sc">*</span> sft<span class="sc">$</span>fitIndices[, <span class="dv">2</span>],</span>
<span id="cb226-12"><a href="example.html#cb226-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels =</span> powers, <span class="at">cex =</span> cex1, <span class="at">col =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb226-13"><a href="example.html#cb226-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb226-14"><a href="example.html#cb226-14" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">0.90</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb226-15"><a href="example.html#cb226-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sft<span class="sc">$</span>fitIndices[, <span class="dv">1</span>],</span>
<span id="cb226-16"><a href="example.html#cb226-16" aria-hidden="true" tabindex="-1"></a>     sft<span class="sc">$</span>fitIndices[, <span class="dv">5</span>],</span>
<span id="cb226-17"><a href="example.html#cb226-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Soft Threshold (power)&quot;</span>,</span>
<span id="cb226-18"><a href="example.html#cb226-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">&quot;Mean Connectivity&quot;</span>,</span>
<span id="cb226-19"><a href="example.html#cb226-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">type =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb226-20"><a href="example.html#cb226-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">&quot;Mean connectivity&quot;</span>)</span>
<span id="cb226-21"><a href="example.html#cb226-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb226-22"><a href="example.html#cb226-22" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(sft<span class="sc">$</span>fitIndices[, <span class="dv">1</span>],</span>
<span id="cb226-23"><a href="example.html#cb226-23" aria-hidden="true" tabindex="-1"></a>     sft<span class="sc">$</span>fitIndices[, <span class="dv">5</span>],</span>
<span id="cb226-24"><a href="example.html#cb226-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">labels =</span> powers,</span>
<span id="cb226-25"><a href="example.html#cb226-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex =</span> cex1, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-124-1.png" width="768" /></p>
<p><strong>Notice</strong>: We’ pick <strong>5</strong> but feel free to experiment with other powers to see how it affects your results.</p>
</div>
<div id="create-the-network-using-the-blockwisemodules" class="section level3 hasAnchor" number="10.9.3">
<h3><span class="header-section-number">10.9.3</span> Create the network using the <code>blockwiseModules</code><a href="example.html#create-the-network-using-the-blockwisemodules" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>building network</li>
</ul>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="example.html#cb227-1" aria-hidden="true" tabindex="-1"></a>picked_power <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb227-2"><a href="example.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="co"># temp_cor &lt;- cor       </span></span>
<span id="cb227-3"><a href="example.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="co"># cor &lt;- WGCNA::cor </span></span>
<span id="cb227-4"><a href="example.html#cb227-4" aria-hidden="true" tabindex="-1"></a>netwk <span class="ot">&lt;-</span> <span class="fu">blockwiseModules</span>(features_tab_norm,</span>
<span id="cb227-5"><a href="example.html#cb227-5" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb227-6"><a href="example.html#cb227-6" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># == Adjacency Function ==</span></span>
<span id="cb227-7"><a href="example.html#cb227-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">power =</span> picked_power,                <span class="co"># &lt;= power here</span></span>
<span id="cb227-8"><a href="example.html#cb227-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">networkType =</span> <span class="st">&quot;signed&quot;</span>,</span>
<span id="cb227-9"><a href="example.html#cb227-9" aria-hidden="true" tabindex="-1"></a>                          </span>
<span id="cb227-10"><a href="example.html#cb227-10" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># == Network construction arguments: correlation options</span></span>
<span id="cb227-11"><a href="example.html#cb227-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">corType =</span> <span class="st">&quot;bicor&quot;</span>,</span>
<span id="cb227-12"><a href="example.html#cb227-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxPOutliers =</span> <span class="fl">0.05</span>,</span>
<span id="cb227-13"><a href="example.html#cb227-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-14"><a href="example.html#cb227-14" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># == Tree and Block Options ==</span></span>
<span id="cb227-15"><a href="example.html#cb227-15" aria-hidden="true" tabindex="-1"></a>                          <span class="at">deepSplit =</span> <span class="dv">2</span>,</span>
<span id="cb227-16"><a href="example.html#cb227-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pamRespectsDendro =</span> F,</span>
<span id="cb227-17"><a href="example.html#cb227-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">minModuleSize =</span> <span class="dv">20</span>,</span>
<span id="cb227-18"><a href="example.html#cb227-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">maxBlockSize =</span> <span class="dv">4000</span>,</span>
<span id="cb227-19"><a href="example.html#cb227-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-20"><a href="example.html#cb227-20" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># == Module Adjustments ==</span></span>
<span id="cb227-21"><a href="example.html#cb227-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">reassignThreshold =</span> <span class="dv">0</span>,</span>
<span id="cb227-22"><a href="example.html#cb227-22" aria-hidden="true" tabindex="-1"></a>                          <span class="at">mergeCutHeight =</span> <span class="fl">0.25</span>,</span>
<span id="cb227-23"><a href="example.html#cb227-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-24"><a href="example.html#cb227-24" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># == TOM == Archive the run results in TOM file (saves time)</span></span>
<span id="cb227-25"><a href="example.html#cb227-25" aria-hidden="true" tabindex="-1"></a>                          <span class="at">saveTOMs =</span> T,</span>
<span id="cb227-26"><a href="example.html#cb227-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">saveTOMFileBase =</span> <span class="fu">paste0</span>(<span class="st">&quot;./dataset/&quot;</span>, <span class="st">&quot;GvHD&quot;</span>),</span>
<span id="cb227-27"><a href="example.html#cb227-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-28"><a href="example.html#cb227-28" aria-hidden="true" tabindex="-1"></a>                          <span class="co"># == Output Options</span></span>
<span id="cb227-29"><a href="example.html#cb227-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">numericLabels =</span> T,</span>
<span id="cb227-30"><a href="example.html#cb227-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">verbose =</span> <span class="dv">3</span>,</span>
<span id="cb227-31"><a href="example.html#cb227-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">randomSeed =</span> <span class="dv">123</span>)</span></code></pre></div>
<pre><code>##  Calculating module eigengenes block-wise from all genes
##    Flagging genes and samples with too many missing values...
##     ..step 1
##  ..Working on block 1 .
##     TOM calculation: adjacency..
##     ..will not use multithreading.
##      Fraction of slow calculations: 0.000000
##     ..connectivity..
##     ..matrix multiplication (system BLAS)..
##     ..normalization..
##     ..done.
##    ..saving TOM for block 1 into file ./dataset/GvHD-block.1.RData
##  ....clustering..
##  ....detecting modules..
##  ....calculating module eigengenes..
##  ....checking kME in modules..
##      ..removing 22 genes from module 1 because their KME is too low.
##      ..removing 19 genes from module 2 because their KME is too low.
##      ..removing 36 genes from module 3 because their KME is too low.
##      ..removing 15 genes from module 4 because their KME is too low.
##      ..removing 2 genes from module 5 because their KME is too low.
##      ..removing 2 genes from module 6 because their KME is too low.
##  ..merging modules that are too close..
##      mergeCloseModules: Merging modules whose distance is less than 0.25
##        Calculating new MEs...</code></pre>
<ul>
<li>Modules’ number</li>
</ul>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="example.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(netwk<span class="sc">$</span>colors)</span></code></pre></div>
<pre><code>## 
##   0   1   2   3   4   5   6   7 
##  96 128  89  68  55  44  33  27</code></pre>
<ul>
<li>hubs</li>
</ul>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="example.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(netwk<span class="sc">$</span>MEs) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(features_tab_norm)</span>
<span id="cb231-2"><a href="example.html#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(netwk<span class="sc">$</span>colors) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(features_tab_norm)</span>
<span id="cb231-3"><a href="example.html#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(netwk<span class="sc">$</span>unmergedColors) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(features_tab_norm)</span>
<span id="cb231-4"><a href="example.html#cb231-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-5"><a href="example.html#cb231-5" aria-hidden="true" tabindex="-1"></a>hubs <span class="ot">&lt;-</span> <span class="fu">chooseTopHubInEachModule</span>(features_tab_norm, netwk<span class="sc">$</span>colors)</span>
<span id="cb231-6"><a href="example.html#cb231-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-7"><a href="example.html#cb231-7" aria-hidden="true" tabindex="-1"></a>hubs</span></code></pre></div>
<pre><code>##           0           1           2           3           4           5           6           7 
##  &quot;MEDN1108&quot;  &quot;MEDP1255&quot;  &quot;MEDP1033&quot;  &quot;MEDP0434&quot; &quot;MW0107573&quot;  &quot;MEDP0065&quot;  &quot;MEDP1386&quot;  &quot;MEDP0389&quot;</code></pre>
<ul>
<li>The number of features per module</li>
</ul>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="example.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(netwk<span class="sc">$</span>colors) <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="example.html#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb233-3"><a href="example.html#cb233-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Module =</span> Var1, <span class="at">Number =</span> Freq) <span class="sc">%&gt;%</span> </span>
<span id="cb233-4"><a href="example.html#cb233-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Module_color =</span> <span class="fu">labels2colors</span>(<span class="fu">as.numeric</span>(<span class="fu">as.character</span>(Module)))) <span class="sc">%&gt;%</span> </span>
<span id="cb233-5"><a href="example.html#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Module, <span class="at">y =</span> Number, <span class="at">fill =</span> Module)) <span class="sc">+</span></span>
<span id="cb233-6"><a href="example.html#cb233-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Number), <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.18</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb233-7"><a href="example.html#cb233-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">&quot;#000000&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-8"><a href="example.html#cb233-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ggtitle</span>(<span class="st">&quot;Number of features per module&quot;</span>) <span class="sc">+</span></span>
<span id="cb233-9"><a href="example.html#cb233-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb233-10"><a href="example.html#cb233-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb233-11"><a href="example.html#cb233-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb233-12"><a href="example.html#cb233-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb233-13"><a href="example.html#cb233-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb233-14"><a href="example.html#cb233-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-128-1.png" width="768" /></p>
</div>
<div id="plot-modules" class="section level3 hasAnchor" number="10.9.4">
<h3><span class="header-section-number">10.9.4</span> plot modules<a href="example.html#plot-modules" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="example.html#cb234-1" aria-hidden="true" tabindex="-1"></a>mergedColors <span class="ot">&lt;-</span> <span class="fu">labels2colors</span>(netwk<span class="sc">$</span>colors)</span>
<span id="cb234-2"><a href="example.html#cb234-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-3"><a href="example.html#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDendroAndColors</span>(</span>
<span id="cb234-4"><a href="example.html#cb234-4" aria-hidden="true" tabindex="-1"></a>  netwk<span class="sc">$</span>dendrograms[[<span class="dv">1</span>]],</span>
<span id="cb234-5"><a href="example.html#cb234-5" aria-hidden="true" tabindex="-1"></a>  mergedColors[netwk<span class="sc">$</span>blockGenes[[<span class="dv">1</span>]]],</span>
<span id="cb234-6"><a href="example.html#cb234-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Module colors&quot;</span>,</span>
<span id="cb234-7"><a href="example.html#cb234-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dendroLabels =</span> <span class="cn">FALSE</span>,</span>
<span id="cb234-8"><a href="example.html#cb234-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">hang =</span> <span class="fl">0.03</span>,</span>
<span id="cb234-9"><a href="example.html#cb234-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">addGuide =</span> <span class="cn">TRUE</span>,</span>
<span id="cb234-10"><a href="example.html#cb234-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">guideHang =</span> <span class="fl">0.05</span> )</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-129-1.png" width="768" /></p>
</div>
<div id="relationships-among-modules" class="section level3 hasAnchor" number="10.9.5">
<h3><span class="header-section-number">10.9.5</span> Relationships among modules<a href="example.html#relationships-among-modules" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="example.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotEigengeneNetworks</span>(netwk<span class="sc">$</span>MEs, </span>
<span id="cb235-2"><a href="example.html#cb235-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;Eigengene adjacency heatmap&quot;</span>,</span>
<span id="cb235-3"><a href="example.html#cb235-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">marDendro =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb235-4"><a href="example.html#cb235-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">marHeatmap =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">2</span>), </span>
<span id="cb235-5"><a href="example.html#cb235-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">plotDendrograms =</span> T,</span>
<span id="cb235-6"><a href="example.html#cb235-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xLabelsAngle =</span> <span class="dv">90</span>)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-130-1.png" width="768" /></p>
</div>
<div id="module-eigengene-correlation" class="section level3 hasAnchor" number="10.9.6">
<h3><span class="header-section-number">10.9.6</span> Module (Eigengene) correlation<a href="example.html#module-eigengene-correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="example.html#cb236-1" aria-hidden="true" tabindex="-1"></a>MEs <span class="ot">&lt;-</span> netwk<span class="sc">$</span>MEs</span>
<span id="cb236-2"><a href="example.html#cb236-2" aria-hidden="true" tabindex="-1"></a>MEs_R <span class="ot">&lt;-</span> <span class="fu">bicor</span>(MEs, MEs, <span class="at">maxPOutliers =</span> <span class="fl">0.05</span>)</span>
<span id="cb236-3"><a href="example.html#cb236-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-4"><a href="example.html#cb236-4" aria-hidden="true" tabindex="-1"></a>idx.r <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(MEs_R) <span class="sc">==</span> <span class="st">&quot;ME0&quot;</span>)</span>
<span id="cb236-5"><a href="example.html#cb236-5" aria-hidden="true" tabindex="-1"></a>idx.c <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">colnames</span>(MEs_R) <span class="sc">==</span> <span class="st">&quot;ME0&quot;</span>)</span>
<span id="cb236-6"><a href="example.html#cb236-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-7"><a href="example.html#cb236-7" aria-hidden="true" tabindex="-1"></a>MEs_R_noME0 <span class="ot">&lt;-</span> MEs_R[<span class="sc">-</span>idx.r, <span class="sc">-</span>idx.c]</span>
<span id="cb236-8"><a href="example.html#cb236-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-9"><a href="example.html#cb236-9" aria-hidden="true" tabindex="-1"></a>MEs_R_density <span class="ot">&lt;-</span> MEs_R[<span class="fu">upper.tri</span>(MEs_R_noME0)] <span class="sc">%&gt;%</span> </span>
<span id="cb236-10"><a href="example.html#cb236-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb236-11"><a href="example.html#cb236-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="st">&quot;correlation&quot;</span> <span class="ot">=</span> <span class="st">&quot;.&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb236-12"><a href="example.html#cb236-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>correlation)) <span class="sc">+</span> </span>
<span id="cb236-13"><a href="example.html#cb236-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span> </span>
<span id="cb236-14"><a href="example.html#cb236-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">paste0</span>(<span class="st">&quot;ME correlation density</span><span class="sc">\n</span><span class="st"> without &quot;</span>, <span class="st">&quot;ME0&quot;</span>))</span>
<span id="cb236-15"><a href="example.html#cb236-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-16"><a href="example.html#cb236-16" aria-hidden="true" tabindex="-1"></a>MEs_R_Corr <span class="ot">&lt;-</span> pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(MEs_R, <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">&quot;Blue&quot;</span>, <span class="st">&quot;White&quot;</span>, <span class="st">&quot;Red&quot;</span>))(<span class="dv">100</span>),</span>
<span id="cb236-17"><a href="example.html#cb236-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">silent =</span> T, </span>
<span id="cb236-18"><a href="example.html#cb236-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="at">length.out =</span> <span class="dv">101</span>),</span>
<span id="cb236-19"><a href="example.html#cb236-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">treeheight_row =</span> <span class="dv">5</span>, </span>
<span id="cb236-20"><a href="example.html#cb236-20" aria-hidden="true" tabindex="-1"></a>                   <span class="at">treeheight_col =</span> <span class="dv">5</span>,</span>
<span id="cb236-21"><a href="example.html#cb236-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">main =</span> <span class="fu">paste0</span>(<span class="st">&quot;ME correlation heatmap&quot;</span>),</span>
<span id="cb236-22"><a href="example.html#cb236-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels_row =</span> <span class="fu">rownames</span>(MEs_R),</span>
<span id="cb236-23"><a href="example.html#cb236-23" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels_col =</span>  <span class="fu">colnames</span>(MEs_R)) </span>
<span id="cb236-24"><a href="example.html#cb236-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-25"><a href="example.html#cb236-25" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(MEs_R_density, MEs_R_Corr<span class="sc">$</span>gtable, </span>
<span id="cb236-26"><a href="example.html#cb236-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), </span>
<span id="cb236-27"><a href="example.html#cb236-27" aria-hidden="true" tabindex="-1"></a>                   <span class="at">label_size =</span> <span class="dv">15</span>, </span>
<span id="cb236-28"><a href="example.html#cb236-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="dv">1</span>),</span>
<span id="cb236-29"><a href="example.html#cb236-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">align =</span> <span class="st">&quot;h&quot;</span>) </span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-131-1.png" width="576" /></p>
</div>
<div id="relate-module-cluster-assignments-to-groups" class="section level3 hasAnchor" number="10.9.7">
<h3><span class="header-section-number">10.9.7</span> Relate Module (cluster) Assignments to Groups<a href="example.html#relate-module-cluster-assignments-to-groups" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="example.html#cb237-1" aria-hidden="true" tabindex="-1"></a>module_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb237-2"><a href="example.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">featureID =</span> <span class="fu">names</span>(netwk<span class="sc">$</span>colors),</span>
<span id="cb237-3"><a href="example.html#cb237-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">colors =</span> <span class="fu">labels2colors</span>(netwk<span class="sc">$</span>colors)</span>
<span id="cb237-4"><a href="example.html#cb237-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-5"><a href="example.html#cb237-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-6"><a href="example.html#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Module Eigengenes per cluster</span></span>
<span id="cb237-7"><a href="example.html#cb237-7" aria-hidden="true" tabindex="-1"></a>MEs0 <span class="ot">&lt;-</span> <span class="fu">moduleEigengenes</span>(features_tab_norm, mergedColors)<span class="sc">$</span>eigengenes</span>
<span id="cb237-8"><a href="example.html#cb237-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-9"><a href="example.html#cb237-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder modules so similar modules are next to each other</span></span>
<span id="cb237-10"><a href="example.html#cb237-10" aria-hidden="true" tabindex="-1"></a>MEs0 <span class="ot">&lt;-</span> <span class="fu">orderMEs</span>(MEs0)</span>
<span id="cb237-11"><a href="example.html#cb237-11" aria-hidden="true" tabindex="-1"></a>module_order <span class="ot">&lt;-</span> <span class="fu">names</span>(MEs0) <span class="sc">%&gt;%</span> <span class="fu">gsub</span>(<span class="st">&quot;ME&quot;</span>,<span class="st">&quot;&quot;</span>, .)</span>
<span id="cb237-12"><a href="example.html#cb237-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-13"><a href="example.html#cb237-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add group names</span></span>
<span id="cb237-14"><a href="example.html#cb237-14" aria-hidden="true" tabindex="-1"></a>MEs0<span class="sc">$</span>group <span class="ot">&lt;-</span> <span class="fu">paste0</span>(se_impute<span class="sc">$</span>group, <span class="fu">rownames</span>(<span class="fu">colData</span>(se_impute)))  <span class="co"># row.names(MEs0) == rownames(colData(se_impute))</span></span>
<span id="cb237-15"><a href="example.html#cb237-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-16"><a href="example.html#cb237-16" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy &amp; plot data</span></span>
<span id="cb237-17"><a href="example.html#cb237-17" aria-hidden="true" tabindex="-1"></a>mME <span class="ot">&lt;-</span> MEs0 <span class="sc">%&gt;%</span></span>
<span id="cb237-18"><a href="example.html#cb237-18" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>group) <span class="sc">%&gt;%</span></span>
<span id="cb237-19"><a href="example.html#cb237-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-20"><a href="example.html#cb237-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">gsub</span>(<span class="st">&quot;ME&quot;</span>, <span class="st">&quot;&quot;</span>, name),</span>
<span id="cb237-21"><a href="example.html#cb237-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> module_order)</span>
<span id="cb237-22"><a href="example.html#cb237-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-23"><a href="example.html#cb237-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-24"><a href="example.html#cb237-24" aria-hidden="true" tabindex="-1"></a>mME <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(., <span class="fu">aes</span>(<span class="at">x=</span>group, <span class="at">y=</span>name, <span class="at">fill=</span>value)) <span class="sc">+</span></span>
<span id="cb237-25"><a href="example.html#cb237-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb237-26"><a href="example.html#cb237-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Module-samples Relationships&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Modules&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;corr&quot;</span>) <span class="sc">+</span>  </span>
<span id="cb237-27"><a href="example.html#cb237-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb237-28"><a href="example.html#cb237-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">low =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb237-29"><a href="example.html#cb237-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">high =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb237-30"><a href="example.html#cb237-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">mid =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb237-31"><a href="example.html#cb237-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">midpoint =</span> <span class="dv">0</span>,</span>
<span id="cb237-32"><a href="example.html#cb237-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">limit =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb237-33"><a href="example.html#cb237-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb237-34"><a href="example.html#cb237-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>))</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-132-1.png" width="768" /></p>
<p><strong>Result</strong>:</p>
<ol style="list-style-type: decimal">
<li>the <em>black</em> modules seems negatively associated (red shading) with the PR groups.</li>
</ol>
</div>
<div id="generate-and-export-networks" class="section level3 hasAnchor" number="10.9.8">
<h3><span class="header-section-number">10.9.8</span> Generate and Export Networks<a href="example.html#generate-and-export-networks" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="example.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># modules_of_interest &lt;- c(&quot;green&quot;, &quot;brown&quot;, &quot;black&quot;)</span></span>
<span id="cb238-2"><a href="example.html#cb238-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb238-3"><a href="example.html#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="co"># genes_of_interest &lt;- module_df %&gt;%</span></span>
<span id="cb238-4"><a href="example.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   subset(colors %in% modules_of_interest)</span></span>
<span id="cb238-5"><a href="example.html#cb238-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb238-6"><a href="example.html#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="co"># expr_of_interest &lt;- features_tab_norm[, genes_of_interest$featureID]</span></span>
<span id="cb238-7"><a href="example.html#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb238-8"><a href="example.html#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # Only recalculate TOM for modules of interest </span></span>
<span id="cb238-9"><a href="example.html#cb238-9" aria-hidden="true" tabindex="-1"></a><span class="co"># TOM &lt;- TOMsimilarityFromExpr(expr_of_interest,</span></span>
<span id="cb238-10"><a href="example.html#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                              power = picked_power)</span></span>
<span id="cb238-11"><a href="example.html#cb238-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb238-12"><a href="example.html#cb238-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add feature id to row and columns</span></span>
<span id="cb238-13"><a href="example.html#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="co"># rownames(TOM) &lt;- colnames(expr_of_interest)</span></span>
<span id="cb238-14"><a href="example.html#cb238-14" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(TOM) &lt;- colnames(expr_of_interest)</span></span>
<span id="cb238-15"><a href="example.html#cb238-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb238-16"><a href="example.html#cb238-16" aria-hidden="true" tabindex="-1"></a><span class="co"># edge_list &lt;- data.frame(TOM) %&gt;%</span></span>
<span id="cb238-17"><a href="example.html#cb238-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   tibble::rownames_to_column(&quot;featureID&quot;) %&gt;%</span></span>
<span id="cb238-18"><a href="example.html#cb238-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   tidyr::pivot_longer(-featureID) %&gt;%</span></span>
<span id="cb238-19"><a href="example.html#cb238-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::rename(featureID2 = name, correlation = value) %&gt;%</span></span>
<span id="cb238-20"><a href="example.html#cb238-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   unique() %&gt;%</span></span>
<span id="cb238-21"><a href="example.html#cb238-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   subset(!(featureID == featureID2)) %&gt;%</span></span>
<span id="cb238-22"><a href="example.html#cb238-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   dplyr::mutate(</span></span>
<span id="cb238-23"><a href="example.html#cb238-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     module1 = module_df[featureID, ]$colors,</span></span>
<span id="cb238-24"><a href="example.html#cb238-24" aria-hidden="true" tabindex="-1"></a><span class="co">#     module2 = module_df[featureID2, ]$colors)</span></span>
<span id="cb238-25"><a href="example.html#cb238-25" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb238-26"><a href="example.html#cb238-26" aria-hidden="true" tabindex="-1"></a><span class="co"># head(edge_list)</span></span></code></pre></div>
</div>
<div id="network-visualization" class="section level3 hasAnchor" number="10.9.9">
<h3><span class="header-section-number">10.9.9</span> Network visualization<a href="example.html#network-visualization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="example.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(igraph)</span>
<span id="cb239-2"><a href="example.html#cb239-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb239-3"><a href="example.html#cb239-3" aria-hidden="true" tabindex="-1"></a>strength_adjust <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb239-4"><a href="example.html#cb239-4" aria-hidden="true" tabindex="-1"></a>TOM <span class="ot">&lt;-</span> <span class="fu">TOMsimilarityFromExpr</span>(features_tab_norm,</span>
<span id="cb239-5"><a href="example.html#cb239-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">power =</span> picked_power)</span></code></pre></div>
<pre><code>## TOM calculation: adjacency..
## ..will not use multithreading.
##  Fraction of slow calculations: 0.000000
## ..connectivity..
## ..matrix multiplication (system BLAS)..
## ..normalization..
## ..done.</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="example.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add feature id to row and columns</span></span>
<span id="cb241-2"><a href="example.html#cb241-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(TOM) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(features_tab_norm)</span>
<span id="cb241-3"><a href="example.html#cb241-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TOM) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(features_tab_norm)</span>
<span id="cb241-4"><a href="example.html#cb241-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-5"><a href="example.html#cb241-5" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph.adjacency</span>(TOM, <span class="at">mode=</span><span class="st">&quot;undirected&quot;</span>, <span class="at">weighted=</span> <span class="cn">TRUE</span>)</span>
<span id="cb241-6"><a href="example.html#cb241-6" aria-hidden="true" tabindex="-1"></a><span class="fu">delete.edges</span>(g, <span class="fu">which</span>(<span class="fu">E</span>(g)<span class="sc">$</span>weight <span class="sc">&lt;</span><span class="dv">1</span>))</span></code></pre></div>
<pre><code>## IGRAPH 56814ae UNW- 540 540 -- 
## + attr: name (v/c), weight (e/n)
## + edges from 56814ae (vertex names):
##  [1] MEDL00066--MEDL00066 MEDL00375--MEDL00375 MEDL00587--MEDL00587 MEDL01844--MEDL01844
##  [5] MEDL01922--MEDL01922 MEDL01994--MEDL01994 MEDL02002--MEDL02002 MEDL02018--MEDL02018
##  [9] MEDL02174--MEDL02174 MEDL02519--MEDL02519 MEDL02630--MEDL02630 MEDL02681--MEDL02681
## [13] MEDN0005 --MEDN0005  MEDN0006 --MEDN0006  MEDN0007 --MEDN0007  MEDN0010 --MEDN0010 
## [17] MEDN0015 --MEDN0015  MEDN0018 --MEDN0018  MEDN0025 --MEDN0025  MEDN0032 --MEDN0032 
## [21] MEDN0036 --MEDN0036  MEDN0042 --MEDN0042  MEDN0046 --MEDN0046  MEDN0047 --MEDN0047 
## [25] MEDN0049 --MEDN0049  MEDN0052 --MEDN0052  MEDN0053 --MEDN0053  MEDN0056 --MEDN0056 
## [29] MEDN0059 --MEDN0059  MEDN0075 --MEDN0075  MEDN0089 --MEDN0089  MEDN0098 --MEDN0098 
## + ... omitted several edges</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="example.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">E</span>(g)<span class="sc">$</span>width <span class="ot">&lt;-</span> <span class="fu">E</span>(g)<span class="sc">$</span>weight<span class="sc">*</span>strength_adjust <span class="sc">+</span> <span class="fu">min</span>(<span class="fu">E</span>(g)<span class="sc">$</span>weight)</span>
<span id="cb243-2"><a href="example.html#cb243-2" aria-hidden="true" tabindex="-1"></a><span class="fu">E</span>(g)<span class="sc">$</span>color <span class="ot">&lt;-</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb243-3"><a href="example.html#cb243-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-4"><a href="example.html#cb243-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(g)</span></code></pre></div>
<p><img src="Data-Analysis-in-Metabolomics_files/figure-html/unnamed-chunk-134-1.png" width="768" /></p>
</div>
</div>
<div id="systematic-information-8" class="section level2 hasAnchor" number="10.10">
<h2><span class="header-section-number">10.10</span> Systematic Information<a href="example.html#systematic-information-8" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="example.html#cb244-1" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">session_info</span>()</span></code></pre></div>
<pre><code>## ─ Session info ─────────────────────────────────────────────────────────────────────────────────
##  setting  value
##  version  R version 4.1.2 (2021-11-01)
##  os       macOS Monterey 12.2.1
##  system   x86_64, darwin17.0
##  ui       RStudio
##  language (EN)
##  collate  en_US.UTF-8
##  ctype    en_US.UTF-8
##  tz       Asia/Shanghai
##  date     2022-08-11
##  rstudio  2022.07.1+554 Spotted Wakerobin (desktop)
##  pandoc   2.18 @ /Applications/RStudio.app/Contents/MacOS/quarto/bin/tools/ (via rmarkdown)
## 
## ─ Packages ─────────────────────────────────────────────────────────────────────────────────────
##  package              * version    date (UTC) lib source
##  abind                  1.4-5      2016-07-21 [1] CRAN (R 4.1.0)
##  ade4                   1.7-18     2021-09-16 [1] CRAN (R 4.1.0)
##  annotate               1.72.0     2021-10-26 [1] Bioconductor
##  AnnotationDbi          1.56.2     2021-11-09 [1] Bioconductor
##  ape                    5.6-2      2022-03-02 [1] CRAN (R 4.1.2)
##  assertthat             0.2.1      2019-03-21 [1] CRAN (R 4.1.0)
##  backports              1.4.1      2021-12-13 [1] CRAN (R 4.1.0)
##  base64enc              0.1-3      2015-07-28 [1] CRAN (R 4.1.0)
##  Biobase              * 2.54.0     2021-10-26 [1] Bioconductor
##  BiocGenerics         * 0.40.0     2021-10-26 [1] Bioconductor
##  BiocParallel           1.28.3     2021-12-09 [1] Bioconductor
##  biomformat             1.22.0     2021-10-26 [1] Bioconductor
##  Biostrings             2.62.0     2021-10-26 [1] Bioconductor
##  bit                    4.0.4      2020-08-04 [1] CRAN (R 4.1.0)
##  bit64                  4.0.5      2020-08-30 [1] CRAN (R 4.1.0)
##  bitops                 1.0-7      2021-04-24 [1] CRAN (R 4.1.0)
##  blob                   1.2.2      2021-07-23 [1] CRAN (R 4.1.0)
##  bookdown               0.27       2022-06-14 [1] CRAN (R 4.1.2)
##  brio                   1.1.3      2021-11-30 [1] CRAN (R 4.1.0)
##  broom                  0.7.12     2022-01-28 [1] CRAN (R 4.1.2)
##  bslib                  0.3.1      2021-10-06 [1] CRAN (R 4.1.0)
##  cachem                 1.0.6      2021-08-19 [1] CRAN (R 4.1.0)
##  Cairo                  1.5-14     2021-12-21 [1] CRAN (R 4.1.2)
##  callr                  3.7.0      2021-04-20 [1] CRAN (R 4.1.0)
##  car                    3.0-12     2021-11-06 [1] CRAN (R 4.1.0)
##  carData                3.0-5      2022-01-06 [1] CRAN (R 4.1.2)
##  caret                  6.0-92     2022-04-19 [1] CRAN (R 4.1.2)
##  caTools                1.18.2     2021-03-28 [1] CRAN (R 4.1.0)
##  cellranger             1.1.0      2016-07-27 [1] CRAN (R 4.1.0)
##  checkmate              2.0.0      2020-02-06 [1] CRAN (R 4.1.0)
##  circlize               0.4.14     2022-02-11 [1] CRAN (R 4.1.2)
##  class                  7.3-20     2022-01-13 [1] CRAN (R 4.1.2)
##  cli                    3.3.0      2022-04-25 [1] CRAN (R 4.1.2)
##  clue                   0.3-60     2021-10-11 [1] CRAN (R 4.1.0)
##  cluster              * 2.1.2      2021-04-17 [1] CRAN (R 4.1.2)
##  codetools              0.2-18     2020-11-04 [1] CRAN (R 4.1.2)
##  coin                   1.4-2      2021-10-08 [1] CRAN (R 4.1.0)
##  colorspace             2.0-3      2022-02-21 [1] CRAN (R 4.1.2)
##  ComplexHeatmap         2.10.0     2021-10-26 [1] Bioconductor
##  corpcor                1.6.10     2021-09-16 [1] CRAN (R 4.1.0)
##  cowplot                1.1.1      2020-12-30 [1] CRAN (R 4.1.0)
##  crayon                 1.5.0      2022-02-14 [1] CRAN (R 4.1.2)
##  crmn                   0.0.21     2020-02-10 [1] CRAN (R 4.1.0)
##  curl                   4.3.2      2021-06-23 [1] CRAN (R 4.1.0)
##  data.table             1.14.2     2021-09-27 [1] CRAN (R 4.1.0)
##  DBI                    1.1.2      2021-12-20 [1] CRAN (R 4.1.0)
##  DelayedArray           0.20.0     2021-10-26 [1] Bioconductor
##  dendextend           * 1.15.2     2021-10-28 [1] CRAN (R 4.1.0)
##  desc                   1.4.1      2022-03-06 [1] CRAN (R 4.1.2)
##  DESeq2                 1.34.0     2021-10-26 [1] Bioconductor
##  devtools               2.4.3      2021-11-30 [1] CRAN (R 4.1.0)
##  digest                 0.6.29     2021-12-01 [1] CRAN (R 4.1.0)
##  doParallel             1.0.17     2022-02-07 [1] CRAN (R 4.1.2)
##  doSNOW                 1.0.20     2022-02-04 [1] CRAN (R 4.1.2)
##  dplyr                * 1.0.8      2022-02-08 [1] CRAN (R 4.1.2)
##  dynamicTreeCut       * 1.63-1     2016-03-11 [1] CRAN (R 4.1.0)
##  e1071                  1.7-9      2021-09-16 [1] CRAN (R 4.1.0)
##  edgeR                  3.36.0     2021-10-26 [1] Bioconductor
##  ellipse                0.4.2      2020-05-27 [1] CRAN (R 4.1.0)
##  ellipsis               0.3.2      2021-04-29 [1] CRAN (R 4.1.0)
##  evaluate               0.15       2022-02-18 [1] CRAN (R 4.1.2)
##  factoextra           * 1.0.7      2020-04-01 [1] CRAN (R 4.1.0)
##  fansi                  1.0.2      2022-01-14 [1] CRAN (R 4.1.2)
##  farver                 2.1.0      2021-02-28 [1] CRAN (R 4.1.0)
##  fastcluster          * 1.2.3      2021-05-24 [1] CRAN (R 4.1.0)
##  fastmap                1.1.0      2021-01-25 [1] CRAN (R 4.1.0)
##  fastmatch              1.1-3      2021-07-23 [1] CRAN (R 4.1.0)
##  fdrtool                1.2.17     2021-11-13 [1] CRAN (R 4.1.0)
##  fgsea                  1.20.0     2021-10-26 [1] Bioconductor
##  filematrix             1.3        2018-02-27 [1] CRAN (R 4.1.0)
##  foreach                1.5.2      2022-02-02 [1] CRAN (R 4.1.2)
##  foreign                0.8-82     2022-01-13 [1] CRAN (R 4.1.2)
##  forestplot             2.0.1      2021-09-03 [1] CRAN (R 4.1.0)
##  Formula                1.2-4      2020-10-16 [1] CRAN (R 4.1.0)
##  fs                     1.5.2      2021-12-08 [1] CRAN (R 4.1.0)
##  future                 1.24.0     2022-02-19 [1] CRAN (R 4.1.2)
##  future.apply           1.8.1      2021-08-10 [1] CRAN (R 4.1.0)
##  genefilter             1.76.0     2021-10-26 [1] Bioconductor
##  geneplotter            1.72.0     2021-10-26 [1] Bioconductor
##  generics               0.1.2      2022-01-31 [1] CRAN (R 4.1.2)
##  GenomeInfoDb         * 1.30.1     2022-01-30 [1] Bioconductor
##  GenomeInfoDbData       1.2.7      2022-03-09 [1] Bioconductor
##  GenomicRanges        * 1.46.1     2021-11-18 [1] Bioconductor
##  GetoptLong             1.0.5      2020-12-15 [1] CRAN (R 4.1.0)
##  ggforce                0.3.3      2021-03-05 [1] CRAN (R 4.1.0)
##  ggplot2              * 3.3.5      2021-06-25 [1] CRAN (R 4.1.0)
##  ggpubr                 0.4.0      2020-06-27 [1] CRAN (R 4.1.0)
##  ggraph               * 2.0.5      2021-02-23 [1] CRAN (R 4.1.0)
##  ggrepel                0.9.1      2021-01-15 [1] CRAN (R 4.1.0)
##  ggsignif               0.6.3      2021-09-09 [1] CRAN (R 4.1.0)
##  glasso                 1.11       2019-10-01 [1] CRAN (R 4.1.0)
##  glmnet               * 4.1-3      2021-11-02 [1] CRAN (R 4.1.0)
##  GlobalOptions          0.1.2      2020-06-10 [1] CRAN (R 4.1.0)
##  globals                0.14.0     2020-11-22 [1] CRAN (R 4.1.0)
##  globaltest             5.48.0     2021-10-26 [1] Bioconductor
##  glue                 * 1.6.2      2022-02-24 [1] CRAN (R 4.1.2)
##  Gmisc                * 3.0.0      2022-01-03 [1] CRAN (R 4.1.2)
##  gmp                    0.6-5      2022-03-17 [1] CRAN (R 4.1.2)
##  GO.db                  3.14.0     2022-04-11 [1] Bioconductor
##  gower                  1.0.0      2022-02-03 [1] CRAN (R 4.1.2)
##  gplots                 3.1.1      2020-11-28 [1] CRAN (R 4.1.0)
##  graphlayouts           0.8.0      2022-01-03 [1] CRAN (R 4.1.2)
##  gridExtra              2.3        2017-09-09 [1] CRAN (R 4.1.0)
##  gtable                 0.3.0      2019-03-25 [1] CRAN (R 4.1.0)
##  gtools                 3.9.2      2021-06-06 [1] CRAN (R 4.1.0)
##  hardhat                0.2.0      2022-01-24 [1] CRAN (R 4.1.2)
##  highr                  0.9        2021-04-16 [1] CRAN (R 4.1.0)
##  Hmisc                  4.6-0      2021-10-07 [1] CRAN (R 4.1.0)
##  htmlTable            * 2.4.0      2022-01-04 [1] CRAN (R 4.1.2)
##  htmltools              0.5.2      2021-08-25 [1] CRAN (R 4.1.0)
##  htmlwidgets            1.5.4      2021-09-08 [1] CRAN (R 4.1.0)
##  httr                 * 1.4.2      2020-07-20 [1] CRAN (R 4.1.0)
##  huge                   1.3.5      2021-06-30 [1] CRAN (R 4.1.0)
##  igraph               * 1.2.11     2022-01-04 [1] CRAN (R 4.1.2)
##  impute                 1.68.0     2021-10-26 [1] Bioconductor
##  ipred                  0.9-12     2021-09-15 [1] CRAN (R 4.1.0)
##  IRanges              * 2.28.0     2021-10-26 [1] Bioconductor
##  irlba                  2.3.5      2021-12-06 [1] CRAN (R 4.1.0)
##  iterators              1.0.14     2022-02-05 [1] CRAN (R 4.1.2)
##  jpeg                   0.1-9      2021-07-24 [1] CRAN (R 4.1.0)
##  jquerylib              0.1.4      2021-04-26 [1] CRAN (R 4.1.0)
##  jsonlite               1.8.0      2022-02-22 [1] CRAN (R 4.1.2)
##  KEGGREST               1.34.0     2021-10-26 [1] Bioconductor
##  KernSmooth             2.23-20    2021-05-03 [1] CRAN (R 4.1.2)
##  knitr                  1.39       2022-04-26 [1] CRAN (R 4.1.2)
##  labeling               0.4.2      2020-10-20 [1] CRAN (R 4.1.0)
##  lattice                0.20-45    2021-09-22 [1] CRAN (R 4.1.2)
##  latticeExtra           0.6-29     2019-12-19 [1] CRAN (R 4.1.0)
##  lava                   1.6.10     2021-09-02 [1] CRAN (R 4.1.0)
##  lavaan                 0.6-11     2022-03-31 [1] CRAN (R 4.1.2)
##  lazyeval               0.2.2      2019-03-15 [1] CRAN (R 4.1.0)
##  libcoin                1.0-9      2021-09-27 [1] CRAN (R 4.1.0)
##  lifecycle              1.0.1      2021-09-24 [1] CRAN (R 4.1.0)
##  limma                  3.50.1     2022-02-17 [1] Bioconductor
##  listenv                0.8.0      2019-12-05 [1] CRAN (R 4.1.0)
##  locfit                 1.5-9.5    2022-03-03 [1] CRAN (R 4.1.2)
##  lubridate              1.8.0      2021-10-07 [1] CRAN (R 4.1.0)
##  magrittr             * 2.0.2      2022-01-26 [1] CRAN (R 4.1.2)
##  MASS                   7.3-55     2022-01-13 [1] CRAN (R 4.1.2)
##  Matrix               * 1.4-0      2021-12-08 [1] CRAN (R 4.1.0)
##  MatrixGenerics       * 1.6.0      2021-10-26 [1] Bioconductor
##  matrixStats          * 0.61.0     2021-09-17 [1] CRAN (R 4.1.0)
##  memoise                2.0.1      2021-11-26 [1] CRAN (R 4.1.0)
##  MetaboAnalystR       * 3.2.0      2022-06-28 [1] Github (xia-lab/MetaboAnalystR@892a31b)
##  metagenomeSeq          1.36.0     2021-10-26 [1] Bioconductor
##  mgcv                   1.8-39     2022-02-24 [1] CRAN (R 4.1.2)
##  mixedCCA               1.5.2      2022-07-14 [1] Github (irinagain/mixedCCA@c6d41a3)
##  mixOmics               6.18.1     2021-11-18 [1] Bioconductor (R 4.1.2)
##  mnormt                 2.0.2      2020-09-01 [1] CRAN (R 4.1.0)
##  ModelMetrics           1.2.2.2    2020-03-17 [1] CRAN (R 4.1.0)
##  modeltools             0.2-23     2020-03-05 [1] CRAN (R 4.1.0)
##  multcomp               1.4-18     2022-01-04 [1] CRAN (R 4.1.2)
##  multtest               2.50.0     2021-10-26 [1] Bioconductor
##  munsell                0.5.0      2018-06-12 [1] CRAN (R 4.1.0)
##  mvtnorm                1.1-3      2021-10-08 [1] CRAN (R 4.1.0)
##  NADA                   1.6-1.1    2020-03-22 [1] CRAN (R 4.1.0)
##  NetCoMi              * 1.0.3      2022-07-14 [1] Github (stefpeschel/NetCoMi@d4d80d3)
##  nlme                   3.1-155    2022-01-13 [1] CRAN (R 4.1.2)
##  nnet                   7.3-17     2022-01-13 [1] CRAN (R 4.1.2)
##  parallelly             1.31.0     2022-04-07 [1] CRAN (R 4.1.2)
##  pbapply                1.5-0      2021-09-16 [1] CRAN (R 4.1.0)
##  pbivnorm               0.6.0      2015-01-23 [1] CRAN (R 4.1.0)
##  pcaMethods             1.86.0     2021-10-26 [1] Bioconductor
##  pcaPP                  1.9-74     2021-04-23 [1] CRAN (R 4.1.0)
##  permute                0.9-7      2022-01-27 [1] CRAN (R 4.1.2)
##  pheatmap               1.0.12     2019-01-04 [1] CRAN (R 4.1.0)
##  phyloseq               1.38.0     2021-10-26 [1] Bioconductor
##  pillar                 1.7.0      2022-02-01 [1] CRAN (R 4.1.2)
##  pkgbuild               1.3.1      2021-12-20 [1] CRAN (R 4.1.0)
##  pkgconfig              2.0.3      2019-09-22 [1] CRAN (R 4.1.0)
##  pkgload                1.2.4      2021-11-30 [1] CRAN (R 4.1.0)
##  plotly               * 4.10.0     2021-10-09 [1] CRAN (R 4.1.0)
##  plyr                   1.8.6      2020-03-03 [1] CRAN (R 4.1.0)
##  png                    0.1-7      2013-12-03 [1] CRAN (R 4.1.0)
##  polyclip               1.10-0     2019-03-14 [1] CRAN (R 4.1.0)
##  POMA                 * 1.7.2      2022-07-26 [1] Github (pcastellanoescuder/POMA@bc8a972)
##  preprocessCore         1.56.0     2021-10-26 [1] Bioconductor
##  prettyunits            1.1.1      2020-01-24 [1] CRAN (R 4.1.0)
##  pROC                   1.18.0     2021-09-03 [1] CRAN (R 4.1.0)
##  processx               3.5.2      2021-04-30 [1] CRAN (R 4.1.0)
##  prodlim                2019.11.13 2019-11-17 [1] CRAN (R 4.1.0)
##  proxy                  0.4-26     2021-06-07 [1] CRAN (R 4.1.0)
##  ps                     1.6.0      2021-02-28 [1] CRAN (R 4.1.0)
##  psych                  2.2.5      2022-05-10 [1] CRAN (R 4.1.2)
##  pulsar                 0.3.7      2020-08-07 [1] CRAN (R 4.1.0)
##  purrr                  0.3.4      2020-04-17 [1] CRAN (R 4.1.0)
##  qgraph                 1.9.2      2022-03-04 [1] CRAN (R 4.1.2)
##  qs                     0.25.3     2022-02-22 [1] CRAN (R 4.1.2)
##  R6                     2.5.1      2021-08-19 [1] CRAN (R 4.1.0)
##  ragg                   1.2.2      2022-02-21 [1] CRAN (R 4.1.2)
##  randomForest           4.7-1      2022-02-03 [1] CRAN (R 4.1.2)
##  RankProd               3.20.0     2021-10-26 [1] Bioconductor
##  RApiSerialize          0.1.0      2014-04-19 [1] CRAN (R 4.1.0)
##  rARPACK                0.11-0     2016-03-10 [1] CRAN (R 4.1.0)
##  rbibutils              2.2.7      2021-12-07 [1] CRAN (R 4.1.0)
##  RColorBrewer           1.1-2      2014-12-07 [1] CRAN (R 4.1.0)
##  Rcpp                 * 1.0.8.2    2022-03-11 [1] CRAN (R 4.1.2)
##  RcppParallel           5.1.5      2022-01-05 [1] CRAN (R 4.1.2)
##  RCurl                  1.98-1.6   2022-02-08 [1] CRAN (R 4.1.2)
##  Rdpack                 2.2        2022-03-19 [1] CRAN (R 4.1.2)
##  readxl               * 1.4.0      2022-03-28 [1] CRAN (R 4.1.2)
##  recipes                0.2.0      2022-02-18 [1] CRAN (R 4.1.2)
##  remotes                2.4.2      2021-11-30 [1] CRAN (R 4.1.0)
##  reshape2               1.4.4      2020-04-09 [1] CRAN (R 4.1.0)
##  rhdf5                  2.38.1     2022-03-10 [1] Bioconductor
##  rhdf5filters           1.6.0      2021-10-26 [1] Bioconductor
##  Rhdf5lib               1.16.0     2021-10-26 [1] Bioconductor
##  rjson                  0.2.21     2022-01-09 [1] CRAN (R 4.1.2)
##  rlang                  1.0.2      2022-03-04 [1] CRAN (R 4.1.2)
##  rmarkdown              2.14       2022-04-25 [1] CRAN (R 4.1.2)
##  Rmpfr                  0.8-9      2022-06-03 [1] CRAN (R 4.1.2)
##  rootSolve              1.8.2.3    2021-09-29 [1] CRAN (R 4.1.0)
##  rpart                  4.1.16     2022-01-24 [1] CRAN (R 4.1.2)
##  rprojroot              2.0.2      2020-11-15 [1] CRAN (R 4.1.0)
##  Rserve               * 1.8-10     2021-11-25 [1] CRAN (R 4.1.0)
##  RSpectra               0.16-0     2019-12-01 [1] CRAN (R 4.1.0)
##  RSQLite                2.2.10     2022-02-17 [1] CRAN (R 4.1.2)
##  rstatix                0.7.0      2021-02-13 [1] CRAN (R 4.1.0)
##  rstudioapi             0.13       2020-11-12 [1] CRAN (R 4.1.0)
##  S4Vectors            * 0.32.3     2021-11-21 [1] Bioconductor
##  sandwich               3.0-1      2021-05-18 [1] CRAN (R 4.1.0)
##  sass                   0.4.0      2021-05-12 [1] CRAN (R 4.1.0)
##  scales                 1.1.1      2020-05-11 [1] CRAN (R 4.1.0)
##  scrime                 1.3.5      2018-12-01 [1] CRAN (R 4.1.0)
##  sessioninfo            1.2.2      2021-12-06 [1] CRAN (R 4.1.0)
##  shape                  1.4.6      2021-05-19 [1] CRAN (R 4.1.0)
##  siggenes               1.68.0     2021-10-26 [1] Bioconductor
##  snow                   0.4-4      2021-10-27 [1] CRAN (R 4.1.0)
##  SpiecEasi            * 1.1.2      2022-07-14 [1] Github (zdk123/SpiecEasi@c463727)
##  SPRING               * 1.0.4      2022-08-03 [1] Github (GraceYoon/SPRING@3d641a4)
##  stringfish             0.15.5     2021-12-01 [1] CRAN (R 4.1.0)
##  stringi                1.7.6      2021-11-29 [1] CRAN (R 4.1.0)
##  stringr                1.4.0      2019-02-10 [1] CRAN (R 4.1.0)
##  SummarizedExperiment * 1.24.0     2021-10-26 [1] Bioconductor
##  survival               3.3-1      2022-03-03 [1] CRAN (R 4.1.2)
##  systemfonts            1.0.4      2022-02-11 [1] CRAN (R 4.1.2)
##  testthat               3.1.2      2022-01-20 [1] CRAN (R 4.1.2)
##  textshaping            0.3.6      2021-10-13 [1] CRAN (R 4.1.0)
##  TH.data                1.1-0      2021-09-27 [1] CRAN (R 4.1.0)
##  tibble               * 3.1.6      2021-11-07 [1] CRAN (R 4.1.0)
##  tidygraph              1.2.1      2022-04-05 [1] CRAN (R 4.1.2)
##  tidyr                  1.2.0      2022-02-01 [1] CRAN (R 4.1.2)
##  tidyselect             1.1.2      2022-02-21 [1] CRAN (R 4.1.2)
##  timeDate               3043.102   2018-02-21 [1] CRAN (R 4.1.0)
##  tmvnsim                1.0-2      2016-12-15 [1] CRAN (R 4.1.0)
##  truncnorm              1.0-8      2018-02-27 [1] CRAN (R 4.1.0)
##  tweenr                 1.0.2      2021-03-23 [1] CRAN (R 4.1.0)
##  usethis                2.1.5      2021-12-09 [1] CRAN (R 4.1.0)
##  utf8                   1.2.2      2021-07-24 [1] CRAN (R 4.1.0)
##  vctrs                  0.3.8      2021-04-29 [1] CRAN (R 4.1.0)
##  vegan                  2.5-7      2020-11-28 [1] CRAN (R 4.1.0)
##  VGAM                   1.1-6      2022-02-14 [1] CRAN (R 4.1.2)
##  viridis                0.6.2      2021-10-13 [1] CRAN (R 4.1.0)
##  viridisLite            0.4.0      2021-04-13 [1] CRAN (R 4.1.0)
##  WGCNA                * 1.71       2022-04-22 [1] CRAN (R 4.1.2)
##  withr                  2.5.0      2022-03-03 [1] CRAN (R 4.1.2)
##  Wrench                 1.12.0     2021-10-26 [1] Bioconductor
##  xfun                   0.30       2022-03-02 [1] CRAN (R 4.1.2)
##  XMAS2                  2.1.7.4    2022-08-09 [1] local
##  XML                    3.99-0.9   2022-02-24 [1] CRAN (R 4.1.2)
##  xtable                 1.8-4      2019-04-21 [1] CRAN (R 4.1.0)
##  XVector                0.34.0     2021-10-26 [1] Bioconductor
##  yaml                   2.3.5      2022-02-21 [1] CRAN (R 4.1.2)
##  zCompositions          1.4.0      2022-01-13 [1] CRAN (R 4.1.2)
##  zlibbioc               1.40.0     2021-10-26 [1] Bioconductor
##  zoo                    1.8-9      2021-03-09 [1] CRAN (R 4.1.0)
## 
##  [1] /Library/Frameworks/R.framework/Versions/4.1/Resources/library
## 
## ────────────────────────────────────────────────────────────────────────────────────────────────</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pathway-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/XbiomeAnalysis/Metabolomics_Aanlysis/blob/main/19-Example.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection",
"scroll_highlight": true,
"toc_depth": 3
}
});
});
</script>

</body>

</html>
